<HTML>
<META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.rsac.org/ratingsv01.html" l gen true comment "RSACi North America Server" by "RodStephens@vb-helper.com" for "http://www.vb-helper.com" on "1998.03.17T18:18-0800" r (n 0 s 0 v 0 l 0))'>
<HEAD>
<TITLE>VB Helper: HowTo: Make a "control array" component in VB .NET</TITLE>
<META NAME="Author" CONTENT="Rod Stephens">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META HTTP-EQUIV="Keywords" CONTENT="control array, component, VB.NET">
<META NAME="Keywords" CONTENT="control array, component, VB.NET">
<META NAME="Description" CONTENT="VB Helper: HowTo: Make a "control array" component in VB .NET">
<META NAME="Copyright" CONTENT="Copyright 1997-2003, Rocky Mountain Computer Consulting, Inc.">
<META NAME="Rating" CONTENT="General">
<META NAME="Robots" CONTENT="All">
</HEAD>

<BODY BGCOLOR="#E1F3FF" BACKGROUND="bg_blue.jpg">

  <!-- This table contains the banner, menu column, and content. -->
  <TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0">
    <!-- ****** -->
    <!-- Banner -->
    <!-- ****** -->
    <TR><TD>
      <TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0" ALIGN="Left">
        <TR>
          <TD BACKGROUND="banner_mid.jpg"><IMG SRC="banner_l.jpg" WIDTH="410" HEIGHT="64"></TD>
          <TD BGCOLOR="#E1F3FF"><IMG SRC="banner_r.jpg" WIDTH="32" HEIGHT="64"></TD>
        </TR>
      </TABLE>
    </TD></TR>
    <TR><TD>&nbsp;</TD></TR>

    <!-- Menu column and content -->
    <TR><TD>
      <TABLE WIDTH="100%" BORDER="0" CELLSPACING="2" CELLPADDING="0">
        <!-- *********** -->
        <!-- Menu column -->
        <!-- *********** -->
        <TR>
          <TD ALIGN="Left" VALIGN="Top">
            <TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
              <!-- Menu top -->
              <TR>
                <TD><IMG SRC="blue_ul.jpg" WIDTH="16" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_um.jpg" WIDTH="93" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_ur.jpg" WIDTH="16" HEIGHT="16"></TD>
              </TR>

              <!-- Menu entries -->
              <TR BGCOLOR="#7FCFFF">
                <TD BACKGROUND="blue_l.jpg" WIDTH="16">&nbsp;</TD>
                <TD><CENTER>
                  <A HREF="index.html"><B><FONT SIZE="+1">Home</FONT></B></A><BR>
                  <A HREF="search.html"><B>Search</B></A><BR>
                  &nbsp;<BR>
                  <A HREF="whats_new.html"><B>What's New</B></A><BR>
                  <A HREF="index_categories.html"><B>Index</B></A><BR>
                  <A HREF="books.html"><B>Books</B></A><BR>
                  <A HREF="links.html"><B>Links</B></A><BR>
                  <A HREF="http://www.topica.com/lists/VBHelperQA/read"><B>Q &amp; A</B></A><BR>
                  <A HREF="newsletter.html"><B>Newsletter</B></A><BR>
                  <A HREF="banners.html"><B>Banners</B></A><BR>
                  &nbsp;<BR>
                  <A HREF="mailto:feedback@vb-helper.com"><B>Feedback</B></A><BR>
                  <A HREF="tip_jar.html"><B>Tip Jar</B></A><BR>
                  &nbsp;<BR>
                  <A HREF="feed.xml"><IMG SRC="xml_rss.jpg" BORDER="0" ALT="XML RSS Feed"></A><BR>
                </CENTER></TD>
                <TD BACKGROUND="blue_r.jpg" WIDTH="16">&nbsp;</TD>
              </TR>

              <!-- Menu bottom -->
              <TR>
                <TD><IMG SRC="blue_ll.jpg" WIDTH="16" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_lm.jpg" WIDTH="93" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_lr.jpg" WIDTH="16" HEIGHT="16"></TD>
              </TR>

              <TR><TD HEIGHT="50" COLSPAN="3">&nbsp;</TR></TD>

              <!-- ******** -->
              <!-- Partners -->
              <!-- ******** -->

              <!-- MVP -->
              <TR><TD COLSPAN="3"><A HREF="http://www.mvps.org"><IMG SRC="mvp_logo.gif" BORDER="0"></A></TR></TD>
              <TR><TD HEIGHT="20" COLSPAN="3">&nbsp;</TR></TD>

              <!-- MSDN VB Community -->
              <TR><TD COLSPAN="3" ALIGN="Center">
<A HREF="http://msdn.microsoft.com/vbasic/community/default.aspx">MSDN Visual Basic Community</A>
              </TD></TR>
              <TR><TD HEIGHT="50" COLSPAN="3">&nbsp;</TR></TD>

              <!-- Amazon Recommends -->
              <TR><TD COLSPAN="3" ALIGN="Center">
<!-- -->
                <SCRIPT SRC="http://rcm.amazon.com/e/cm?t=vbhelper&l=rc1&p=2&o=1" TYPE="text/JavaScript"></SCRIPT>
<!-- -->
                <NOSCRIPT>
                  <TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="125">
                    <TR><TD>
                      <MAP NAME="boxmap">
                        <AREA SHAPE="RECT" COORDS="18, 263, 105, 274" HREF="http://rcm.amazon.com/e/cm/privacy-policy.html?o=1">
                        <AREA COORDS="0,0,10000,10000" HREF="http://www.amazon.com/exec/obidos/redirect-home/vbhelper">
                      </MAP>
                      <img src="http://rcm-images.amazon.com/images/G/01/associates/amzn_recommends/gnbox125x275.gif" width="125" height="275" border="0" usemap="#boxmap">
                    </TD></TR>
                  </TABLE>
                </NOSCRIPT>
              </TD></TR>
              <TR><TD HEIGHT="50" COLSPAN="3">&nbsp;</TR></TD>

              <!-- Wiley -->
              <TR><TD COLSPAN="3" ALIGN="Center" BACKGROUND="sandpaper.gif"><A HREF="http://service.bfast.com/bfast/click?bfmid=37920629&siteid=40078832&bfpage=computer_science" TARGET="_top"><IMG SRC="wiley_logo.gif" BORDER="0" ALIGN="Center" WIDTH="77" HEIGHT="105"></TD></TR>
              <TR><TD HEIGHT="10" COLSPAN="3">&nbsp;</TR></TD>

              <!-- Que -->
              <TR><TD COLSPAN="3" ALIGN="Center"><A HREF="http://www.quepublishing.com"><IMG SRC="que.gif" BORDER="0" ALIGN="Center" WIDTH="121" HEIGHT="36"></A></TD></TR>
              <TR><TD HEIGHT="10" COLSPAN="3">&nbsp;</TR></TD>

              <!-- Amazon -->
              <TR><TD COLSPAN="3" ALIGN="Center"><A HREF="amazon.html"><IMG SRC="amazon_logo.gif" BORDER="0" ALIGN="Center" WIDTH="68" HEIGHT="65"></A></TD></TR>
              <TR><TD HEIGHT="10" COLSPAN="3">&nbsp;</TR></TD>

              <!-- ********** -->
              <!-- More stuff -->
              <!-- ********** -->

            </TABLE>
          </TD>

          <!-- A little space between the menus and content -->
          <TD WIDTH="5">&nbsp;</TD>

          <!-- ******* -->
          <!-- Content -->
          <!-- ******* -->
          <TD WIDTH="100%" ALIGN="Left" VALIGN="Top">
            <TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0">
              <!-- How To Summary -->
              <TR><TD>
                <TABLE WIDTH="100%" BORDER="2" CELLSPACING="0" CELLPADDING="2">
                  <TR><TH ALIGN="Left">Title</TH><TD WIDTH="100%">Make a "control array" component in VB .NET</TD></TR>
                  <TR><TH ALIGN="Left">Description</TH><TD WIDTH="100%">This example shows how to make a "control array" component in VB .NET. You can add and remove controls from the "array" at design time. The "array" provides an event handler shared by all of the controls much as VB 6 does. It also provides a control collection that your code can iterate over at run time.</TD></TR>
                  <TR><TH ALIGN="Left">Keywords</TH><TD>control array, component, VB.NET</TD></TR>
                  <TR><TH ALIGN="Left">Categories</TH><TD>Controls, VB.NET</TD></TR>
                </TABLE>
              </TD></TR>

              <!-- Text content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR><TD>
This example builds an extender provider that acts as a control array. You can add and remove controls from the array at design time. The array provides an event handler shared by all of the controls much as VB 6 does. It also provides a control collection that your code can iterate over at run time. For example, you can loop through the controls to set their Enabled or Visible properties.
<P>
The ButtonArrayProvider implements an ArrayIndex property for Button controls. For example, suppose a form holds a ButtonArrayProvider named ButtonArrayProvider1 and a Button named Button1. Then if you select the Button, the Properties window displays a value named "ArrayIndex on ButtonArrayProvider1."
<P>
Set this property to a value greater than -1 to add the control to the array. Set it to -1 to remove it from the array. You can right-click the property in the Properties window and select Reset to reset the value to -1.
<P>
The following code shows how the provider works. The ProvideProperty attribute tells Visual Basic the name of the property that the provider will provide for client controls.
<P>
The object raises a Click event if any of its client controls generate a Click event.
<P>
It stores information about its client controls in IndexInfo objects stored in the m_IndexInfo hash table. The GetArrayIndex and SetArrayIndex routines get and set a client control's ArrayIndex value.
<P>
See the code for additional details.
              </TD></TR>

              <!-- Code content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR>
                <TD BACKGROUND="computer_paper.jpg">
                  <PRE><FONT NAME="Courier New" POINT-SIZE="10" SIZE="2">Imports System.ComponentModel

&lt;ToolboxBitmap(GetType(ButtonArrayProvider), _
    "control_array.bmp"), _
 ProvideProperty("ArrayIndex", GetType(Button)), _
 DefaultEvent("Click")&gt; _
Public Class ButtonArrayProvider
    Inherits System.ComponentModel.Component
    Implements IExtenderProvider

    ...

    <FONT COLOR="#008000">' When the user clicks one of the buttons</FONT>
    <FONT COLOR="#008000">' in the control array, we raise this event.</FONT>
    Public Event Click(ByVal Index As Integer)

    <FONT COLOR="#008000">' Information about a button.</FONT>
    Private Class IndexInfo
        Public ClientControl As Button
        Public ArrayIndex As Integer

        <FONT COLOR="#008000">' Initialize ArrayIndex to the default value.</FONT>
        Public Sub New(ByVal client_control As Button)
            ClientControl = client_control
            ArrayIndex = -1
        End Sub

        <FONT COLOR="#008000">' Return True if ArrayIndex is the default.</FONT>
        Public Function IsDefault() As Boolean
            Return (ArrayIndex = -1)
        End Function
    End Class

    <FONT COLOR="#008000">' Information about our client controls.</FONT>
    Private m_IndexInfo As New Hashtable

    <FONT COLOR="#008000">' We can only extend buttons.</FONT>
    Public Function CanExtend(ByVal extendee As Object) As _
        Boolean Implements _
        System.ComponentModel.IExtenderProvider.CanExtend
        Return TypeOf extendee Is Button
    End Function

    <FONT COLOR="#008000">' Return this control's ArrayIndex.</FONT>
    &lt;Category("Data"), _
     DefaultValue("-1")&gt; _
    Public Function GetArrayIndex(ByVal client_control As _
        Button) As Integer
        <FONT COLOR="#008000">' Get the button's IndexInfo if it exists.</FONT>
        Return GetIndexInfo(client_control).ArrayIndex
    End Function

    <FONT COLOR="#008000">' Set this control's ArrayIndex.</FONT>
    &lt;Category("Data"), _
     DefaultValue("-1")&gt; _
    Public Sub SetArrayIndex(ByVal client_control As _
        Button, ByVal array_index As Integer)
        <FONT COLOR="#008000">' Get this control's info.</FONT>
        Dim index_info As IndexInfo = _
            GetIndexInfo(client_control)

        <FONT COLOR="#008000">' Set the new minimum value.</FONT>
        index_info.ArrayIndex = array_index

        <FONT COLOR="#008000">' Add or remove the IndexInfo if necessary.</FONT>
        AddOrRemoveIfNecessary(client_control, index_info)
    End Sub

    <FONT COLOR="#008000">' Remove the control from the array.</FONT>
    &lt;Category("Data")&gt; _
    Public Sub RemoveArrayIndex(ByVal client_control As _
        Button)
        <FONT COLOR="#008000">' Set the control's index to the default -1.</FONT>
        SetArrayIndex(client_control, -1)
    End Sub

    <FONT COLOR="#008000">' Handles client button Click events by raising our</FONT>
    <FONT COLOR="#008000">' Click event, passing it the button's index.</FONT>
    Private Sub Client_Click(ByVal sender As System.Object, _
        ByVal e As System.EventArgs)
        <FONT COLOR="#008000">' Get the client and its IndexInfo.</FONT>
        Dim client_button As Button = DirectCast(sender, _
            Button)
        Dim index_info As IndexInfo = _
            GetIndexInfo(client_button)
        RaiseEvent Click(index_info.ArrayIndex)
    End Sub

    <FONT COLOR="#008000">' Return this control's IndexInfo.</FONT>
    Private Function GetIndexInfo(ByVal client_control As _
        Button) As IndexInfo
        <FONT COLOR="#008000">' See if we have IndexInfo for this control.</FONT>
        If m_IndexInfo.Contains(client_control) Then
            <FONT COLOR="#008000">' We have IndexInfo for this control. Return it.</FONT>
            Return DirectCast(m_IndexInfo(client_control), _
                IndexInfo)
        Else
            <FONT COLOR="#008000">' We do not have IndexInfo for this control.</FONT>
            <FONT COLOR="#008000">' Return a new default IndexInfo.</FONT>
            Return New IndexInfo(client_control)
        End If
    End Function

    <FONT COLOR="#008000">' Add or remove this IndexInfo if necessary.</FONT>
    Private Sub AddOrRemoveIfNecessary(ByVal client_control _
        As Button, ByVal index_info As IndexInfo)
        <FONT COLOR="#008000">' See if the IndexInfo should be present but is not,</FONT>
        <FONT COLOR="#008000">' or should not be present but is.</FONT>
        If index_info.IsDefault &lt;&gt; Not _
            m_IndexInfo.Contains(client_control) Then
            If index_info.IsDefault Then
                <FONT COLOR="#008000">' The IndexInfo should not be present but</FONT>
                <FONT COLOR="#008000">' is.</FONT>
                m_IndexInfo.Remove(client_control)
                RemoveHandler client_control.Click, _
                    AddressOf Client_Click
            Else
                <FONT COLOR="#008000">' The IndexInfo should be present but is</FONT>
                <FONT COLOR="#008000">' not.</FONT>
                m_IndexInfo.Add(client_control, index_info)
                AddHandler client_control.Click, AddressOf _
                    Client_Click
            End If
        End If
    End Sub

    <FONT COLOR="#008000">' Return an Collection holding</FONT>
    <FONT COLOR="#008000">' the controls in the array.</FONT>
    Public Function Controls() As Collection
        <FONT COLOR="#008000">' Build the collection.</FONT>
        Dim result As New Collection
        For Each index_info As IndexInfo In _
            m_IndexInfo.Values
            result.Add(index_info.ClientControl)
        Next index_info

        <FONT COLOR="#008000">' Return the collection.</FONT>
        Return result
    End Function
End Class</FONT></PRE>
              </TD></TR>

              <!-- *************** -->
              <!-- Download button -->
              <!-- *************** -->

              <TR><TD><FONT SIZE="-2">&nbsp;</FONT></TD></TR>
              <TR><TD ALIGN="Center"><A HREF="HowTo/howto_net_control_arrray.zip"><IMG SRC="download.jpg" BORDER="0"></A></TD></TR>
              <TR><TD><FONT SIZE="-2">&nbsp;</FONT></TD></TR>

            </TABLE> <!-- End content table -->
          </TD> <!-- End content column -->

          <!-- ************** -->
          <!-- Google AdSense -->
          <!-- ************** -->
          <TD WIDTH="120" ALIGN="Right" VALIGN="Top">
            <TABLE WIDTH="140" BORDER="0" CELLSPACING="0" CELLPADDING="0">
              <TR><TD ALIGN="Right">

<script type="text/javascript"><!--
google_ad_client = "pub-6627515316741006";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_ad_channel ="3885326441";
google_color_border = ["5CAAFD","7ECFFE","00CC66","DDAADD"];
google_color_bg = ["7ECFFE","E1F3FF","99FF99","FFCCFF"];
google_color_link = ["0000FF","0000FF","0000FF","0000CC"];
google_color_url = ["008000","008000","0033FF","008000"];
google_color_text = ["000000","000000","000000","996699"];
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

              </TD></TR>
            </TABLE> <!-- End Google AdSense table -->
          </TD> <!-- End Google AdSense column -->


        </TR> <!-- End row containing menu column and content -->
      </TABLE> <!-- End table containing menu column and content -->
    </TD></TR>

    <!-- ****** -->
    <!-- Footer -->
    <!-- ****** -->
    <TR><TD WIDTH="100%">
      <TABLE WIDTH="100%" BORDER="0" BGCOLOR="#87CEFA" CELLSPACING="0" CELLPADDING="0">
        <!-- Top row -->
        <TR>
          <TD BGCOLOR="#E1F3FF" ALIGN="Right" WIDTH="16"><IMG SRC="blue_ul.jpg" WIDTH="16" HEIGHT="16"></TD>
          <TD BACKGROUND="blue_um.jpg" COLSPAN="2" ALIGN="Center"><FONT SIZE="-2">
            Copyright &copy; 1997-2003 Rocky Mountain Computer Consulting, Inc. &nbsp; All rights reserved.
          </FONT></TD>
          <TD BGCOLOR="#E1F3FF"><IMG SRC="blue_ur.jpg" WIDTH="16" HEIGHT="16"></TD>
        </TR>

        <!-- Bottom row -->
        <TR>
          <TD BGCOLOR="#E1F3FF" ALIGN="Right" WIDTH="16"><IMG SRC="blue_ll.jpg" WIDTH="16" HEIGHT="16"></TD>
          <TD BACKGROUND="blue_lm.jpg"><FONT SIZE="-2">
            &nbsp;<SCRIPT LANGUAGE=JavaScript>document.write(document.URL)</SCRIPT></FONT></TD>
          <TD BACKGROUND="blue_lm.jpg" ALIGN="Right"><FONT SIZE="-2">
            Updated <SCRIPT LANGUAGE=JavaScript>document.write(document.lastModified)</SCRIPT> &nbsp;
          </FONT></TD>
          <TD BGCOLOR="#E1F3FF"><IMG SRC="blue_lr.jpg" WIDTH="16" HEIGHT="16"></TD>
        </TR>
      </TABLE>
    </TD></TR>
  </TABLE> <!-- End table containing banner, menu column + content, and footer -->

</BODY>
</HTML>