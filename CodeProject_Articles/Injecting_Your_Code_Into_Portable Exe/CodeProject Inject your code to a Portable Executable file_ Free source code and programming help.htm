<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0052)http://www.codeproject.com/KB/system/inject2exe.aspx -->
<HTML><HEAD><TITLE>CodeProject: Inject your code to a Portable Executable file. Free source code and programming help</TITLE>
<META http-equiv=Content-Type content="text/html; charset=utf-8">
<META 
content="This article demonstrates  five steps to inject your code in a portable executable (EXE, DLL, OCX,...)  file without recompiling source code.; Author: Ashkbiz Danehkar; Section: Hardware &amp; System; Chapter: General Reading" 
name=Description>
<META 
content="VC8.0, NT4, Win2K, WinXP, Win2003, Vista, Visual Studio, Dev, ASM, Advanced,Hardware &amp; System,General Reading,Free source code, tutorials" 
name=Keywords>
<META content="The Code Project" name=Author>
<META content=General name=Rating>
<META content="index, follow" name=Robots>
<META content="1 days" name=Revisit-After><LINK 
title="CodeProject Latest articles - All topics" 
href="http://www.codeproject.com/webservices/articlerss.aspx?cat=1" 
type=application/rss+xml rel=alternate><LINK 
title="CodeProject Latest articles - MFC / C++" 
href="http://www.codeproject.com/webservices/articlerss.aspx?cat=2" 
type=application/rss+xml rel=alternate><LINK 
title="CodeProject Latest articles - C#" 
href="http://www.codeproject.com/webservices/articlerss.aspx?cat=3" 
type=application/rss+xml rel=alternate><LINK 
title="CodeProject Latest articles - ASP.NET" 
href="http://www.codeproject.com/webservices/articlerss.aspx?cat=4" 
type=application/rss+xml rel=alternate><LINK 
title="CodeProject Latest articles - .NET" 
href="http://www.codeproject.com/webservices/articlerss.aspx?cat=5" 
type=application/rss+xml rel=alternate><LINK 
title="CodeProject Latest articles - VB.NET" 
href="http://www.codeproject.com/webservices/articlerss.aspx?cat=6" 
type=application/rss+xml rel=alternate><LINK title="CodeProject Lounge Postings" 
href="http://www.codeproject.com/webservices/LoungeRSS.aspx" 
type=application/rss+xml rel=alternate><LINK title=CodeProject 
href="http://www.codeproject.com/info/OpenSearch.xml" 
type=application/opensearchdescription+xml rel=search><LINK 
href="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/CodeProject.css" 
type=text/css rel=stylesheet><LINK 
href="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/ForumClassic.css" 
type=text/css rel=stylesheet>
<SCRIPT type=text/javascript>
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</SCRIPT>

<SCRIPT type=text/javascript>
   var pageTracker = _gat._getTracker("UA-1735123-1");
   pageTracker._setDomainName("www.codeproject.com");
   pageTracker._setSessionTimeout("1200"); // 20 mins
   pageTracker._initData();
   pageTracker._trackPageview();
</SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/oncopy.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/jxs.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/bookmark.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/rateitem.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript type=text/javascript>//<![CDATA[
function ToggleMenu(itemName)
{
	var elm = document.getElementById(itemName);
	var i,others = document.getElementById('SectionMenu');
	for(i=0; i < others.childNodes.length; i++)
	{
		var other = others.childNodes[i];
		if ((other.className == 'MenuSectionBlock') && (other != elm))
			other.style.display='none';
	}
	if (elm.style.display == 'block') elm.style.display='none';
	else elm.style.display='block';
	return false;
}

//]]></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/addto.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript type=text/javascript>//<![CDATA[
function MarkAns(MemberID,MsgID,QID) {
 document.write(unescape("%3Cdiv class=\"CallOut\"%3E"));
 document.write("Was this a good answer to your question? ");
 document.write(unescape("%3Ca href=\"#xx" + MsgID.toString() + "xx\" "));
 document.write("onclick=\"RateMsg("+MemberID.toString()+", "+MsgID.toString()+",6,"+QID.toString()+");\"");
 document.write(unescape("%3E"));
 document.write(unescape("%3Cimg height=\"20\" width=\"20\" src=\"/script/Forums/Images/good.png\" alt=\"correct\" border=\"0\" align=\"absmiddle\" /%3E Yes%3C/a%3E"));
 document.write(unescape("%3Ca href=\"#xx" + MsgID.toString() + "xx\" "));
 document.write("onclick=\"RateMsg("+MemberID.toString()+","+MsgID.toString()+",7,"+QID.toString()+");\"");
 document.write(unescape("%3E"));
 document.write(unescape("%3Cimg height=\"20\" width=\"20\" src=\"/script/Forums/Images/bad.png\" alt=\"correct\" style=\"margin-left:10px\" border=\"0\" align=\"absmiddle\" /%3E No%3C/a%3E"));
 document.write(unescape("%3C/div%3E"));
}
function MsgVFrm(MemberID,MsgID,GB,gp,bp,mt){
 if(!GB)document.write("Rate this message: ");
 document.write(unescape("%3Ca href=\"#xx" + MsgID.toString() + "xx\" onclick=\"RateMsg(" + MemberID.toString() + ", " + MsgID.toString() + ","));document.write((GB?"5":"1")+unescape(",0);\"%3E"));
 if(GB) document.write(unescape("%3Cimg height=\"20\" width=\"20\" src=\"/script/Forums/Images/good.png\" alt=\"good\" border=\"0\" align=\"absmiddle\" /%3E "+gp+" "+mt+"%3C/a%3E "));
 else document.write(unescape("%3Cimg height=\"14\" width=\"14\" src=\"/script/Forums/Images/thumbs_down.gif\" alt=\"vote 1\" border=\"0\" align=\"middle\" /%3E%3C/a%3E "));
 if(GB)document.write(" &nbsp;"); else for(var i=1; i<=5;i++)
  document.write(unescape("%3Ca class=\"Frm_MHL\" href=\"#xx" + MsgID.toString() + "xx\" title=\"vote this message a " + i.toString() + "\" onclick=\"RateMsg(" + MemberID.toString() + ", " + MsgID.toString() + ", " + i.toString() + ",0)\"%3E%3Cb%3E" + i.toString() + "%3C/b%3E%3C/a%3E "));
 document.write(unescape("%3Ca href=\"#xx" + MsgID.toString() + "xx\" onclick=\"RateMsg(" + MemberID.toString() + ", " + MsgID.toString() + ","));document.write((GB?"1":"5")+unescape(",0);\"%3E"));
 if(GB)document.write(unescape("%3Cimg height=\"20\" width=\"20\" src=\"/script/Forums/Images/bad.png\" alt=\"bad\" border=\"0\" align=\"absmiddle\" /%3E "+bp+" "+mt+"%3C/a%3E"));
 else document.write(unescape("%3Cimg height=\"14\" width=\"14\" src=\"/script/Forums/Images/thumbs_up.gif\" border=\"0\" alt=\"vote 5\" align=\"middle\" /%3E%3C/a%3E "));
}

function ReportMsg(userid, msgid, score) {
 if (confirm("Are you sure you want to report this message?"))
  return RateMsg(userid, msgid, score, 0);
 else return false;
}
function RateMsg(memberid, msgid, score, questionId) {
 var req = new ActiveXObject("MSXML2.XMLHTTP");
 req.onreadystatechange = function() {
  if (req.readyState == 4){
   if (req.status == 200){
    var respText = req.responseText;
    var re = new RegExp(unescape("\%3Cdiv\%3E([^\%3C]*)\%3C/div\%3E"), "g");
    var match = re.exec(respText);
    voteStatus.innerHTML = unescape("%3Cb%3E") + (match&&match[1])?match[1]:"An error occured" + unescape("%3C/b%3E");
   } else
    voteStatus.innerHTML = unescape("%3Cb style='color:red'%3EFailed!") + req.statusText + unescape("%3C/b%3E");
  }
 }
 var voteStatus = document.getElementById("MVF" + msgid);
 if (!voteStatus) return;
 voteStatus.innerHTML = unescape("%3Cb style='color:green'%3EVoting...%3C/b%3E");
 var strAction = "/script/Forums/Vote.aspx?js=1&fmid="+memberid.toString()+"&select="+msgid.toString()+"&score="+score.toString()+"&qid="+questionId.toString();
 req.open("GET", strAction, true);
 req.send(null);
  return false;
}
//]]></SCRIPT>

<SCRIPT language=Javascript type=text/javascript>//<![CDATA[
var Selected = "-1";

function SwitchMessage(e, msgId)
{
  if (!msgId) {
    if(!e)e=window.event;
    var target=e.target?e.target:e.srcElement;
    while(target&&target.id!='DynMessLink')target=target.parentNode;
    if(!target||target.id!='DynMessLink')return;
    msgId=target.name;
  }
  if(Selected&&Selected!=""){
    var body=eval("document.getElementById('F" + Selected + "_h1')");
    if(body) body.style.display = 'none';
    var head=eval("document.getElementById('F" + Selected + "_h0')");
    if(head) head.className = head.className.replace("Sel", "UnSel");
  }
  if(Selected==msgId.toString())
    Selected="";
  else {
    Selected=msgId.toString();
    var body=eval("document.getElementById('F" + Selected + "_h1')");
    if(body){
      if(body.style.display=='none') body.style.display='';
      else body.style.display = 'none';
    }
    var head=eval("document.getElementById('F" + Selected + "_h0')");
    if (head) 
      head.className = head.className.replace("UnSel", "Sel");
    if(body&&head&&body.style.display!='none'){
      document.body.scrollTop = getRealPos(head, "Top") - document.body.clientHeight/10;
      EnsureMessageVisible(Selected, true);
    }
  }
  if (e){if(e.preventDefault)e.preventDefault;else e.returnValue=false;}
  return false;
}

//]]></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/ShortCuts.js" 
type=text/javascript></SCRIPT>
<LINK 
href="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/ForumClassicIE6.css" 
type=text/css rel=stylesheet><LINK href="/favicon.ico" type=image/ico 
rel=icon><LINK href="/favicon.ico" type=image/ico rel="shortcut icon">
<META content="MSHTML 6.00.2900.2180" name=GENERATOR></HEAD>
<BODY>
<TABLE id=ctl00_AT cellSpacing=0 cellPadding=0 border=0>
  <TBODY>
  <TR vAlign=top>
    <TD colSpan=2>
      <TABLE cellSpacing=0 cellPadding=0 border=0>
        <TBODY>
        <TR>
          <TD class=HeaderLogo><A href="http://www.codeproject.com/"><IMG 
            id=ctl00_Logo 
            style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; WIDTH: 225px; HEIGHT: 90px; BORDER-RIGHT-WIDTH: 0px" 
            alt="The Code Project" 
            src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/logo225x90.gif"></A></TD>
          <TD class=HeaderBanner align=right width="100%"><IFRAME 
            src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/ServeHTML.htm" 
            frameBorder=0 width=728 scrolling=no height=90></IFRAME></TD></TR>
        <TR>
          <TD colSpan=2>
            <TABLE class=MemberNavBar cellSpacing=0 cellPadding=5 
              width="100%"><TBODY>
              <TR>
                <TD class=SmallText style="FONT-WEIGHT: bold">5,252,917 
                  members and growing! (23,296 online)</TD>
                <TD align=right>
                  <DIV class=MemberNavBarText 
                  id=ctl00_MemberMenu_LoggedOnOptions><A 
                  id=ctl00_MemberMenu_MyProfile 
                  href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=4633957">Member 
                  4633957</A> | <A id=ctl00_MemberMenu_MySettings 
                  href="http://www.codeproject.com/script/Membership/Modify.aspx">My 
                  Settings</A> | <A id=ctl00_MemberMenu_MyCodeProject 
                  href="http://www.codeproject.com/script/Membership/MyCodeProject.aspx"><B>My 
                  CodeProject</B></A> | <A id=ctl00_MemberMenu_MyBookmarks 
                  href="http://www.codeproject.com/script/Bookmarks/List.aspx?obtid=2"><IMG 
                  height=16 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/fave.gif" 
                  width=16 align=absMiddle border=0> My Bookmarks</A> | <A 
                  id=ctl00_MemberMenu_MyArticles 
                  href="http://www.codeproject.com/script/Articles/MemberArticles.aspx?amid=4633957">My 
                  Articles</A> | <A id=ctl00_MemberMenu_Signout 
                  href="http://www.codeproject.com/script/Membership/LogOff.aspx?rp=%2fKB%2fsystem%2finject2exe.aspx">Sign 
                  out</A> </DIV></TD></TR></TBODY></TABLE></TD></TR>
        <TR>
          <TD colSpan=2>
            <TABLE class=SiteNavBar id=tblSiteToolbar cellSpacing=0 
            cellPadding=0>
              <TBODY>
              <TR>
                <TD noWrap><A href="http://www.codeproject.com/">Home</A></TD>
                <TD>&nbsp; </TD>
                <TD noWrap align=right>Current Site: </TD>
                <TD class=SelCat noWrap><A 
                  href="http://www.codeproject.com/">Main Site</A></TD>
                <TD noWrap><A href="http://java.codeproject.com/">Java</A></TD>
                <TD noWrap><A href="http://lamp.codeproject.com/">Linux Apache 
                  MySQL PHP</A></TD>
                <TD width="100%">&nbsp;</TD>
                <TD id=ctl00_TopNavBar_RightMenus>
                  <DIV id=MenuPos 
                  style="WIDTH: 380px; POSITION: relative; TOP: 1px; HEIGHT: 22px">
                  <TABLE 
                  style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; HEIGHT: 20px; BORDER-RIGHT-WIDTH: 0px" 
                  cellSpacing=0 cellPadding=0 width=380>
                    <TBODY>
                    <TR vAlign=center>
                      <TD 
                      style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" 
                      noWrap><A 
                        href="http://www.codeproject.com/info/FAQ.aspx">Help!</A></TD>
                      <TD 
                      style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" 
                      noWrap><A 
                        href="http://www.codeproject.com/script/Articles/Latest.aspx">Articles</A></TD>
                      <TD 
                      style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" 
                      noWrap><A 
                        href="http://www.codeproject.com/script/Forums/List.aspx">Message 
                        Boards</A></TD>
                      <TD 
                      style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" 
                      noWrap><A 
                        href="http://www.codeproject.com/script/Jobs/List.aspx">Job 
                        Board</A></TD>
                      <TD 
                      style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" 
                      noWrap><A 
                        href="http://www.codeproject.com/Lounge.aspx">Lounge</A></TD></TR></TBODY></TABLE></DIV></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
  <TR>
    <TD vAlign=top colSpan=2><A name=_top></A>
      <TABLE class=ArticleHeader id=ctl00_ArticleTopHeader_HeaderTable 
      cellSpacing=0 cellPadding=3 width="100%" border=0>
        <TBODY>
        <TR vAlign=top>
          <TD class=SmallText><A id=ctl00_ArticleTopHeader_ChapterLink 
            href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=7">General 
            Reading</A> » <A id=ctl00_ArticleTopHeader_SectionLink 
            href="http://www.codeproject.com/KB/system/">Hardware &amp; 
            System</A> » <A id=ctl00_ArticleTopHeader_SubsectionLink 
            href="http://www.codeproject.com/KB/system/index.aspx?#Hardware &amp; System - General">General</A> 
            <SPAN class=ArticleAdvanced 
            id=ctl00_ArticleTopHeader_SkillLevel>&nbsp;&nbsp;&nbsp; 
            Advanced</SPAN> <SPAN 
            id=ctl00_ArticleTopHeader_LicenceTerms></SPAN><BR><BR>
            <H1><SPAN class=ArticleTopTitle 
            id=ctl00_ArticleTopHeader_ArticleTitle>Inject your code to a 
            Portable Executable file</SPAN></H1><B>By <A 
            href="http://www.codeproject.com/script/Articles/MemberArticles.aspx?amid=1599836">Ashkbiz 
            Danehkar</A></B><BR><BR><SPAN class=ArticleTopDescr 
            id=ctl00_ArticleTopHeader_ArticleDescr>This article demonstrates 
            five steps to inject your code in a portable executable (EXE, DLL, 
            OCX,...) file without recompiling source code.</SPAN> </TD>
          <TD class=SmallText style="WIDTH: 210px"><SPAN 
            id=ctl00_ArticleTopHeader_ArticleAttributes>ASM, VC8.0, C++Windows, 
            NT4, Win2K, WinXP, Win2003, Vista, Visual Studio, 
            Dev</SPAN><BR><BR><SPAN style="PADDING-RIGHT: 2ex">Posted</SPAN>: 
            <B>27 Dec 2005</B><BR><SPAN 
            style="PADDING-RIGHT: 0.5ex">Updated</SPAN>: <B>27 Dec 2005</B> 
            <BR><SPAN style="PADDING-RIGHT: 3.2ex">Views</SPAN>: 
            <B>145,186</B><BR></TD></TR>
        <TR>
          <TD colSpan=2>
            <TABLE width="100%">
              <TBODY>
              <TR>
                <TD></TD>
                <TD class=SmallText style="WHITE-SPACE: nowrap" 
              align=right></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
  <TR vAlign=top>
    <TD class=LHNavBar id=ctl00_LeftNavCell>
      <DIV class=FeatureBlockHeader>Announcements</DIV>
      <DIV class="FeatureBlockContent RHFeatureBar" 
      style="PADDING-RIGHT: 0px; PADDING-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-TOP: 0px">
      <TABLE cellPadding=2>
        <TBODY>
        <TR vAlign=center>
          <TD><IMG height=24 alt=Comp 
            src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/info_24.png" 
            width=24></TD>
          <TD><A href="http://www.codeproject.com/Feature/CodeGenComp/">Code 
            Generation<BR>comp. $1,000 prize!</A></TD></TR>
        <TR vAlign=center>
          <TD><IMG height=24 alt=Comp 
            src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/coffee_24.png" 
            width=24 align=middle></TD>
          <TD><A href="http://www.codeproject.com/Zones/IBM/">Win CodeProject 
            Coffee!</A></TD></TR>
        <TR vAlign=center>
          <TD><IMG height=24 alt=Comp 
            src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/info_24.png" 
            width=24 align=middle></TD>
          <TD><A id=ctl00_Announcements_CompLink 
            href="http://www.codeproject.com/Feature/ArticleCompetition/">Monthly 
            Competition</A></TD></TR></TBODY></TABLE></DIV>
      <DIV id=SectionMenu>
      <DIV class=MenuCat>Chapters</DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter1');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=1">Desktop 
      Development</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter1 style="DISPLAY: none">
      <DIV class=MI id=Section1><A 
      href="http://www.codeproject.com/KB/buttons/">Button Controls</A></DIV>
      <DIV class=MI id=Section15><A 
      href="http://www.codeproject.com/KB/clipboard/">Clipboard</A></DIV>
      <DIV class=MI id=Section2><A 
      href="http://www.codeproject.com/KB/combobox/">Combo &amp; List 
      Boxes</A></DIV>
      <DIV class=MI id=Section67><A 
      href="http://www.codeproject.com/KB/dialog/">Dialogs and Windows</A></DIV>
      <DIV class=MI id=Section107><A 
      href="http://www.codeproject.com/KB/gadgets/">Desktop Gadgets</A></DIV>
      <DIV class=MI id=Section16><A 
      href="http://www.codeproject.com/KB/docview/">Document / View</A></DIV>
      <DIV class=MI id=Section4><A 
      href="http://www.codeproject.com/KB/edit/">Edit Controls</A></DIV>
      <DIV class=MI id=Section17><A 
      href="http://www.codeproject.com/KB/files/">Files and Folders</A></DIV>
      <DIV class=MI id=Section3><A 
      href="http://www.codeproject.com/KB/grid/">Grid &amp; Data 
      Controls</A></DIV>
      <DIV class=MI id=Section5><A 
      href="http://www.codeproject.com/KB/list/">List Controls</A></DIV>
      <DIV class=MI id=Section6><A 
      href="http://www.codeproject.com/KB/menus/">Menus</A></DIV>
      <DIV class=MI id=Section14><A 
      href="http://www.codeproject.com/KB/miscctrl/">Miscellaneous</A></DIV>
      <DIV class=MI id=Section18><A 
      href="http://www.codeproject.com/KB/printing/">Printing</A></DIV>
      <DIV class=MI id=Section95><A 
      href="http://www.codeproject.com/KB/progress/">Progress Controls</A></DIV>
      <DIV class=MI id=Section11><A 
      href="http://www.codeproject.com/KB/selection/">Selection 
      Controls</A></DIV>
      <DIV class=MI id=Section19><A 
      href="http://www.codeproject.com/KB/shell/">Shell and IE 
      programming</A></DIV>
      <DIV class=MI id=Section68><A 
      href="http://www.codeproject.com/KB/smart/">Smart Client</A></DIV>
      <DIV class=MI id=Section8><A 
      href="http://www.codeproject.com/KB/splitter/">Splitter Windows</A></DIV>
      <DIV class=MI id=Section9><A 
      href="http://www.codeproject.com/KB/static/">Static &amp; Panel 
      Controls</A></DIV>
      <DIV class=MI id=Section10><A 
      href="http://www.codeproject.com/KB/statusbar/">Status Bar</A></DIV>
      <DIV class=MI id=Section7><A 
      href="http://www.codeproject.com/KB/tabs/">Tabs &amp; Property 
      Pages</A></DIV>
      <DIV class=MI id=Section12><A 
      href="http://www.codeproject.com/KB/toolbars/">Toolbars &amp; Docking 
      windows</A></DIV>
      <DIV class=MI id=Section13><A 
      href="http://www.codeproject.com/KB/tree/">Tree Controls</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter2');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=2">Web 
      Development</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter2 style="DISPLAY: none">
      <DIV class=MI id=Section70><A 
      href="http://www.codeproject.com/KB/ajax/">Ajax and Atlas</A></DIV>
      <DIV class=MI id=Section27><A 
      href="http://www.codeproject.com/KB/applications/">Applications &amp; 
      Tools</A></DIV>
      <DIV class=MI id=Section85><A 
      href="http://www.codeproject.com/KB/asp/">ASP</A></DIV>
      <DIV class=MI id=Section89><A 
      href="http://www.codeproject.com/KB/aspnet/">ASP.NET</A></DIV>
      <DIV class=MI id=Section28><A 
      href="http://www.codeproject.com/KB/webforms/">ASP.NET Controls</A></DIV>
      <DIV class=MI id=Section38><A 
      href="http://www.codeproject.com/KB/ATL-Server/">ATL Server</A></DIV>
      <DIV class=MI id=Section29><A 
      href="http://www.codeproject.com/KB/web-cache/">Caching</A></DIV>
      <DIV class=MI id=Section91><A 
      href="http://www.codeproject.com/KB/web-image/">Charts, Graphs and 
      Images</A></DIV>
      <DIV class=MI id=Section25><A 
      href="http://www.codeproject.com/KB/scripting/">Client side 
      scripting</A></DIV>
      <DIV class=MI id=Section30><A 
      href="http://www.codeproject.com/KB/custom-controls/">Custom 
      Controls</A></DIV>
      <DIV class=MI id=Section23><A 
      href="http://www.codeproject.com/KB/HTML/">HTML / CSS</A></DIV>
      <DIV class=MI id=Section22><A 
      href="http://www.codeproject.com/KB/IP/">Internet / Network</A></DIV>
      <DIV class=MI id=Section24><A 
      href="http://www.codeproject.com/KB/ISAPI/">ISAPI</A></DIV>
      <DIV class=MI id=Section33><A 
      href="http://www.codeproject.com/KB/server-management/">Site &amp; Server 
      Management</A></DIV>
      <DIV class=MI id=Section34><A 
      href="http://www.codeproject.com/KB/session/">Session State</A></DIV>
      <DIV class=MI id=Section113><A 
      href="http://www.codeproject.com/KB/silverlight/">Silverlight</A></DIV>
      <DIV class=MI id=Section36><A 
      href="http://www.codeproject.com/KB/trace/">Trace and Logs</A></DIV>
      <DIV class=MI id=Section31><A 
      href="http://www.codeproject.com/KB/user-controls/">User 
Controls</A></DIV>
      <DIV class=MI id=Section37><A 
      href="http://www.codeproject.com/KB/validation/">Validation</A></DIV>
      <DIV class=MI id=Section35><A 
      href="http://www.codeproject.com/KB/viewstate/">View State</A></DIV>
      <DIV class=MI id=Section26><A 
      href="http://www.codeproject.com/KB/WAP/">WAP / WML</A></DIV>
      <DIV class=MI id=Section32><A 
      href="http://www.codeproject.com/KB/web-security/">Web Security</A></DIV>
      <DIV class=MI id=Section20><A 
      href="http://www.codeproject.com/KB/webservices/">Web 
      Services</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter9');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=9">Enterprise 
      Systems</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter9 style="DISPLAY: none">
      <DIV class=MI id=Section98><A 
      href="http://www.codeproject.com/KB/MCMS/">Content Management 
      Server</A></DIV>
      <DIV class=MI id=Section99><A 
      href="http://www.codeproject.com/KB/biztalk/">Microsoft BizTalk 
      Server</A></DIV>
      <DIV class=MI id=Section102><A 
      href="http://www.codeproject.com/KB/exchange/">Microsoft 
Exchange</A></DIV>
      <DIV class=MI id=Section90><A 
      href="http://www.codeproject.com/KB/office/">Office Development</A></DIV>
      <DIV class=MI id=Section101><A 
      href="http://www.codeproject.com/KB/sharepoint/">SharePoint 
      Server</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter3');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=3">Multimedia</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter3 style="DISPLAY: none">
      <DIV class=MI id=Section42><A 
      href="http://www.codeproject.com/KB/audio-video/">Audio and 
Video</A></DIV>
      <DIV class=MI id=Section44><A 
      href="http://www.codeproject.com/KB/directx/">DirectX</A></DIV>
      <DIV class=MI id=Section46><A 
      href="http://www.codeproject.com/KB/GDI/">GDI</A></DIV>
      <DIV class=MI id=Section47><A 
      href="http://www.codeproject.com/KB/GDI-plus/">GDI+</A></DIV>
      <DIV class=MI id=Section43><A 
      href="http://www.codeproject.com/KB/graphics/">General Graphics</A></DIV>
      <DIV class=MI id=Section45><A 
      href="http://www.codeproject.com/KB/openGL/">OpenGL</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter4');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=4">Database</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter4 style="DISPLAY: none">
      <DIV class=MI id=Section66><A 
      href="http://www.codeproject.com/KB/database/">Database</A></DIV>
      <DIV class=MI id=Section100><A 
      href="http://www.codeproject.com/KB/reporting-services/">SQL Reporting 
      Services</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter8');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=8">Platforms, 
      Frameworks &amp; Libraries</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter8 style="DISPLAY: none">
      <DIV class=MI id=Section83><A 
      href="http://www.codeproject.com/KB/atl/">ATL</A></DIV>
      <DIV class=MI id=Section117><A 
      href="http://www.codeproject.com/KB/MFC/">MFC</A></DIV>
      <DIV class=MI id=Section88><A 
      href="http://www.codeproject.com/KB/stl/">STL</A></DIV>
      <DIV class=MI id=Section84><A 
      href="http://www.codeproject.com/KB/wtl/">WTL</A></DIV>
      <DIV class=MI id=Section49><A 
      href="http://www.codeproject.com/KB/COM/">COM / COM+</A></DIV>
      <DIV class=MI id=Section76><A 
      href="http://www.codeproject.com/KB/dotnet/">.NET Framework</A></DIV>
      <DIV class=MI id=Section92><A 
      href="http://www.codeproject.com/KB/winsdk/">Win32/64 SDK &amp; 
      OS</A></DIV>
      <DIV class=MI id=Section108><A 
      href="http://www.codeproject.com/KB/vista/">Vista API</A></DIV>
      <DIV class=MI id=Section110><A 
      href="http://www.codeproject.com/KB/vista-security/">Vista 
      Security</A></DIV>
      <DIV class=MI id=Section82><A 
      href="http://www.codeproject.com/KB/cross-platform/">Cross 
      Platform</A></DIV>
      <DIV class=MI id=Section69><A 
      href="http://www.codeproject.com/KB/game/">Game Development</A></DIV>
      <DIV class=MI id=Section73><A 
      href="http://www.codeproject.com/KB/mobile/">Mobile Development</A></DIV>
      <DIV class=MI id=Section106><A 
      href="http://www.codeproject.com/KB/WC/">Windows CardSpace</A></DIV>
      <DIV class=MI id=Section103><A 
      href="http://www.codeproject.com/KB/WCF/">Windows Communication 
      Foundation</A></DIV>
      <DIV class=MI id=Section104><A 
      href="http://www.codeproject.com/KB/WPF/">Windows Presentation 
      Foundation</A></DIV>
      <DIV class=MI id=Section105><A 
      href="http://www.codeproject.com/KB/WF/">Windows Workflow 
      Foundation</A></DIV>
      <DIV class=MI id=Section119><A 
      href="http://www.codeproject.com/KB/library/">Libraries</A></DIV>
      <DIV class=MI id=Section122><A 
      href="http://www.codeproject.com/KB/powershell/">Windows 
      Powershell</A></DIV>
      <DIV class=MI id=Section123><A 
      href="http://www.codeproject.com/KB/linq/">LINQ</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter5');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=5">Languages</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter5 style="DISPLAY: none">
      <DIV class=MI id=Section71><A href="http://www.codeproject.com/KB/cpp/">C 
      / C++ Language</A></DIV>
      <DIV class=MI id=Section72><A 
      href="http://www.codeproject.com/KB/mcpp/">C++ / CLI</A></DIV>
      <DIV class=MI id=Section93><A 
      href="http://www.codeproject.com/KB/cs/">C#</A></DIV>
      <DIV class=MI id=Section78><A 
      href="http://www.codeproject.com/KB/msil/">MSIL</A></DIV>
      <DIV class=MI id=Section86><A 
      href="http://www.codeproject.com/KB/vbscript/">VBScript</A></DIV>
      <DIV class=MI id=Section87><A 
      href="http://www.codeproject.com/KB/vb/">VB.NET</A></DIV>
      <DIV class=MI id=Section115><A 
      href="http://www.codeproject.com/KB/vb-interop/">VB6 Interop</A></DIV>
      <DIV class=MI id=Section77><A 
      href="http://www.codeproject.com/KB/net-languages/">Other .NET 
      Languages</A></DIV>
      <DIV class=MI id=Section21><A 
      href="http://www.codeproject.com/KB/XML/">XML</A></DIV>
      <DIV class=MI id=Section96><A 
      href="http://www.codeproject.com/KB/java/">Java</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter6');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=6">General 
      Programming</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter6 style="DISPLAY: none">
      <DIV class=MI id=Section57><A 
      href="http://www.codeproject.com/KB/recipes/">Algorithms &amp; 
      Recipes</A></DIV>
      <DIV class=MI id=Section64><A 
      href="http://www.codeproject.com/KB/bugs/">Bugs &amp; 
Workarounds</A></DIV>
      <DIV class=MI id=Section79><A 
      href="http://www.codeproject.com/KB/collections/">Collections</A></DIV>
      <DIV class=MI id=Section56><A 
      href="http://www.codeproject.com/KB/security/">Cryptography &amp; 
      Security</A></DIV>
      <DIV class=MI id=Section50><A 
      href="http://www.codeproject.com/KB/datetime/">Date and Time</A></DIV>
      <DIV class=MI id=Section52><A 
      href="http://www.codeproject.com/KB/DLL/">DLLs &amp; Assemblies</A></DIV>
      <DIV class=MI id=Section80><A 
      href="http://www.codeproject.com/KB/exception/">Exception 
      Handling</A></DIV>
      <DIV class=MI id=Section81><A 
      href="http://www.codeproject.com/KB/locale/">Localisation</A></DIV>
      <DIV class=MI id=Section53><A 
      href="http://www.codeproject.com/KB/macros/">Macros and Add-ins</A></DIV>
      <DIV class=MI id=Section54><A 
      href="http://www.codeproject.com/KB/tips/">Programming Tips</A></DIV>
      <DIV class=MI id=Section55><A 
      href="http://www.codeproject.com/KB/string/">String handling</A></DIV>
      <DIV class=MI id=Section58><A 
      href="http://www.codeproject.com/KB/threads/">Threads, Processes &amp; 
      IPC</A></DIV>
      <DIV class=MI id=Section59><A 
      href="http://www.codeproject.com/KB/winhelp/">WinHelp / 
      HTMLHelp</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter10');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=10">Graphics 
      / Design</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter10 style="DISPLAY: none">
      <DIV class=MI id=Section40><A 
      href="http://www.codeproject.com/KB/expression/">Expression</A></DIV>
      <DIV class=MI id=Section114><A 
      href="http://www.codeproject.com/KB/usability/">Usability</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter11');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=11">Development 
      Lifecycle</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter11 style="DISPLAY: none">
      <DIV class=MI id=Section51><A 
      href="http://www.codeproject.com/KB/debug/">Debug Tips</A></DIV>
      <DIV class=MI id=Section39><A 
      href="http://www.codeproject.com/KB/architecture/">Design and 
      Architecture</A></DIV>
      <DIV class=MI id=Section112><A 
      href="http://www.codeproject.com/KB/install/">Installation</A></DIV>
      <DIV class=MI id=Section41><A 
      href="http://www.codeproject.com/KB/work/">Work Issues</A></DIV>
      <DIV class=MI id=Section126><A 
      href="http://www.codeproject.com/KB/codegen/">Code 
      Generation</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter7');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=7">General 
      Reading</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter7>
      <DIV class=MI id=Section60><A 
      href="http://www.codeproject.com/KB/books/">Book Chapters</A></DIV>
      <DIV class=MI id=Section61><A 
      href="http://www.codeproject.com/KB/book-reviews/">Book Reviews</A></DIV>
      <DIV class=MI id=Section109><A 
      href="http://www.codeproject.com/KB/hardware-review/">Hardware 
      Reviews</A></DIV>
      <DIV class=MI id=Section63><A 
      href="http://www.codeproject.com/KB/interviews/">Interviews</A></DIV>
      <DIV class=MI id=Section62><A 
      href="http://www.codeproject.com/KB/scrapbook/">Scrapbook</A></DIV>
      <DIV class=MIS id=Section48><A 
      href="http://www.codeproject.com/KB/system/">Hardware &amp; 
      System</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter12');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=12">Third 
      Party Products</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter12 style="DISPLAY: none">
      <DIV class=MI id=Section65><A 
      href="http://www.codeproject.com/KB/showcase/">Product Showcase</A></DIV>
      <DIV class=MI id=Section124><A 
      href="http://www.codeproject.com/KB/solution-center/">Solution 
      Center</A></DIV></DIV></DIV><BR>
      <DIV class=MenuCat>Services</DIV>
      <DIV class=MenuChapter><A 
      href="http://www.codeproject.com/script/Jobs/List.aspx">Job 
Board</A></DIV>
      <DIV class=MenuChapter><A 
      href="http://www.codeproject.com/Services/coffee.aspx">Code Project 
      Coffee</A></DIV>
      <DIV class=MenuChapter><A 
      href="http://www.codeproject.com/Services/TradePub.aspx">Free 
      Magazines</A></DIV><BR>
      <DIV class=MenuCat>Feature Zones</DIV>
      <DIV class=MenuChapter><A href="http://www.codeproject.com/Zones/IBM">IBM 
      DeveloperWorks</A></DIV>
      <DIV class=MenuChapter><A 
      href="http://www.codeproject.com/Zones/WhitePapers">WhitePapers</A></DIV>
      <DIV class=MenuChapter><A 
      href="http://www.codeproject.com/Zones/CodeGeneration">Code 
      Generation</A></DIV>
      <DIV class=MenuChapter><A 
      href="http://www.codeproject.com/Zones/QuestSQL">Quest SQL 
      Zone</A></DIV><BR>
      <DIV style="MARGIN-BOTTOM: 10px; TEXT-ALIGN: center">
      <SCRIPT type=text/javascript>document.write(unescape("%3ca%20href%3d%22http%3a%2f%2fwww.codeproject.com%2fRedir.aspx%3fadid%3d3487%26way%3dban%22%20target%3d%22_blank%22%20rel%3d%22nofollow%22%3e%3cimg%20src%3d%22http%3a%2f%2fwww.codeproject.com%2fscript%2fAnn%2fServeImg.aspx%3fFile%3d%252fscript%252fadmentor%252fimages%252fcp_daily_150x80.gif%26C%3dFalse%26id%3d3487%22%20alt%3d%22%22%20border%3d%220%22%20width%3d%22150%22%20height%3d%2280%22%3e%3c%2fa%3e"));</SCRIPT>
      </DIV><IFRAME 
      src="C:\hossam_Downloads\Portable Exe\CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files\ServeHTML(1).htm" 
      frameBorder=0 width=160 scrolling=no height=600></IFRAME></TD>
    <TD class=ArticlePane vAlign=top>
      <TABLE class=SearchHeaderBar cellSpacing=0 width="100%">
        <TBODY>
        <TR>
          <TD style="WIDTH: 60%; WHITE-SPACE: nowrap" vAlign=center 
            align=right><FORM style="MARGIN: 0px" name=Search 
            action=/info/search.aspx method=get><B>Search &nbsp;</B> <INPUT 
            class=SmallText style="WIDTH: 200px" name=artkw> <SELECT 
            class=SmallText style="FONT-WEIGHT: bold" name=sbo> <OPTION 
              value=kw selected>Articles</OPTION> <OPTION 
              value=fm>Messages</OPTION> <OPTION value=s>Jobs</OPTION></SELECT> <INPUT class=SmallText style="FONT-WEIGHT: bold" type=submit value=" Go! "> 
            &nbsp; </FORM></TD>
          <TD class=TinyText style="WHITE-SPACE: nowrap"><A 
            href="http://www.codeproject.com/info/search.aspx">Advanced 
            Search</A><BR><A 
            href="http://www.codeproject.com/script/Content/SiteMap.aspx">Sitemap</A> 
            | <A id=ctl00_SearchBarCtrl_AddToIESearchLnk 
            title="Add The Code Project to your IE search Providers" 
            onclick="window.external.AddSearchProvider('http://www.codeproject.com/info/OpenSearch.xml');return false;" 
            href="http://www.codeproject.com/">Add to IE Search</A> 
        </TD></TR></TBODY></TABLE><SPAN id=ctl00_ResultMessage></SPAN>
      <DIV id=ctl00_ArtDiv>
      <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
        <TBODY>
        <TR vAlign=top>
          <TD vAlign=top>
            <TABLE>
              <TBODY>
              <TR>
                <TD class="SmallText Bold"><IMG 
                  id=ctl00_ArticleAwards_AR_ctl01_AI 
                  style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/prize_winner.gif"></TD>
                <TD class="SmallText Bold" style="WHITE-SPACE: nowrap">Prize 
                  winner in Competition "MFC/C++ Nov 2005" 
            <I></I></TD></TR></TBODY></TABLE>
            <DIV class=SmallText><IMG style="VERTICAL-ALIGN: middle" height=16 
            alt=print 
            src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/print.gif" 
            width=16> <A id=ctl00_ArticleHeaderLinks_PrintLnk 
            href="http://www.codeproject.com/KB/system/inject2exe.aspx?display=Print">Print</A> 
            &nbsp; <IMG style="VERTICAL-ALIGN: middle" height=16 
            alt="Broken Article?" 
            src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/report.gif" 
            width=16> <A id=ctl00_ArticleHeaderLinks_BrokenLnk 
            href="http://www.codeproject.com/script/Articles/Report.aspx?aid=12532">Report 
            Article</A> &nbsp; <IMG style="VERTICAL-ALIGN: middle" alt=Watch 
            src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/watchon.png"> 
            <A class="" id=bmw_12532,2 onclick="return watchMe(12532, 2);" 
            href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=12532&amp;obtid=2&amp;bma=AddWatch" 
            name=ajaxBookmarkWatchLink>Watch</A> <SPAN class=TinyText 
            style="VISIBILITY: hidden"></SPAN><SPAN 
            id=ctl00_ArticleHeaderLinks_ArticleBmkWatch_Message></SPAN>&nbsp; 
            <IMG style="VERTICAL-ALIGN: middle" height=16 alt=Bookmark 
            src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/link.png" 
            width=16> <A class="" id=bm_12532,2 
            onclick="return bookmarkMe(12532, 2);" 
            href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=12532&amp;obtid=2&amp;bma=AddBookmark" 
            name=ajaxBookmarkLink>Bookmark</A> <SPAN class=TinyText 
            style="VISIBILITY: hidden"></SPAN><SPAN 
            id=ctl00_ArticleHeaderLinks_ArticleBmk_Message></SPAN>&nbsp; <IMG 
            style="VERTICAL-ALIGN: middle" height=16 alt=Discuss 
            src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/discuss.gif" 
            width=15> <A 
            href="http://www.codeproject.com/KB/system/inject2exe.aspx#_comments">Discuss</A> 
            &nbsp; <IMG style="VERTICAL-ALIGN: middle" height=16 
            alt="Recommend Article" 
            src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/mail.gif" 
            width=16>&nbsp;<A id=ctl00_ArticleHeaderLinks_Recommend 
            href="http://www.codeproject.com/script/common/TellFriend.aspx?obtid=2&amp;obid=12532">Send&nbsp;to&nbsp;a&nbsp;friend</A> 
            </DIV></TD>
          <TD style="WIDTH: 100px; WHITE-SPACE: nowrap; TEXT-ALIGN: right">
            <TABLE id=CurRat>
              <TBODY>
              <TR>
                <TD>
                  <TABLE>
                    <TBODY>
                    <TR>
                      <TD class=SmallText style="WHITE-SPACE: nowrap" 
                      align=right><SPAN id=ctl00_ArticleRating_VoteLabel>131 
                        votes for this Article.</SPAN></TD>
                      <TD>
                        <TABLE cellSpacing=0 cellPadding=0 border=1>
                          <TBODY>
                          <TR>
                            <TD width=20 bgColor=white height=7><IMG height=7 
                              src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/red.gif" 
                              width=20 align=center border=0></TD>
                            <TD width=20 bgColor=white height=7><IMG height=7 
                              src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/red.gif" 
                              width=20 align=center border=0></TD>
                            <TD width=20 bgColor=white height=7><IMG height=7 
                              src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/red.gif" 
                              width=20 align=center border=0></TD>
                            <TD width=20 bgColor=white height=7><IMG height=7 
                              src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/red.gif" 
                              width=20 align=center border=0></TD>
                            <TD noWrap width=20 bgColor=white height=7><IMG 
                              height=7 
                              src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/red.gif" 
                              width=17 align=center 
                      border=0></TD></TR></TBODY></TABLE></TD></TR>
                    <TR id=ctl00_ArticleRating_PopularityRow>
                      <TD class=SmallText align=right colSpan=2><A 
                        id=ctl00_ArticleRating_PopularityLnk 
                        title="Calculated as rating x Log10(# votes)" 
                        href="http://www.codeproject.com/script/Articles/TopArticles.aspx?ta_so=1">Popularity: 
                        10.31</A> <SPAN 
                        id=ctl00_ArticleRating_PopularityLbl></SPAN><SPAN 
                        id=ratingVal>Rating: <B>4.87</B> out of 
                    5</SPAN></TD></TR></TBODY></TABLE></TD>
                <TD>
                  <DIV>
                  <TABLE class=HistTable 
                  title="Voting Distribution. Recent data only">
                    <TBODY>
                    <TR>
                      <TD><IMG title="1 vote, 0.8%" height=1 
                        alt="1 vote, 0.8%" 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/pollcol.gif" 
                        width=10 border=0><BR>1</TD>
                      <TD><IMG title="1 vote, 0.8%" height=1 
                        alt="1 vote, 0.8%" 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/pollcol.gif" 
                        width=10 border=0><BR>2</TD>
                      <TD><IMG title="1 vote, 0.8%" height=1 
                        alt="1 vote, 0.8%" 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/pollcol.gif" 
                        width=10 border=0><BR>3</TD>
                      <TD><IMG title="3 votes, 2.3%" height=1 
                        alt="3 votes, 2.3%" 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/pollcol.gif" 
                        width=10 border=0><BR>4</TD>
                      <TD><IMG title="125 votes, 95.4%" height=20 
                        alt="125 votes, 95.4%" 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/pollcol.gif" 
                        width=10 
              border=0><BR>5</TD></TD></TR></TBODY></TABLE></DIV></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><SPAN 
      id=intelliTXT>
      <DIV id=contentdiv><!-- Main Page Contents Start --><!-- Article Starts -->
      <H2>Downloads</H2>
      <UL class=download>
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe.aspx#PEViewerDownloadLink">PE 
        Viewer</A> 
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe.aspx#PEMakerDownloadLink1">PE 
        Maker - Step 1</A> - Add new Section. 
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe.aspx#PEMakerDownloadLink2">PE 
        Maker - Step 2</A> - Travel towards OEP. 
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe.aspx#PEMakerDownloadLink3">PE 
        Maker - Step 3</A> - Support Import Table. 
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe.aspx#PEMakerDownloadLink4">PE 
        Maker - Step 4</A> - Support DLL and OCX. 
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe.aspx#PEMakerDownloadLink5">PE 
        Maker - Step 5</A> - Final work. 
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe.aspx#CalcEXE1TestDownloadLink">CALC.EXE 
        - test file</A> </LI></UL>
      <P><IMG height=175 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/pemaker.gif" 
      width=452></P>
      <H2>Contents</H2>
      <UL>
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe.aspx#Preface0">0. 
        Preface</A> 
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe.aspx#Prerequisite1">1. 
        Prerequisite</A> 
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe.aspx#PortableExecutablefileformat2">2. 
        Portable Executable file format</A> 
        <UL>
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#TheMSDOSdata2_1">2.1 
          The MS-DOS data</A> 
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#TheWindowsNTdata2_2">2.2 
          The Windows NT data</A> 
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#TheSectionHeadersandSections2_3">2.3 
          The Section Headers and Sections</A> </LI></UL>
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe.aspx#DebuggerDisassemblerandsomeUsefulTools3">3. 
        Debugger, Disassembler and some Useful Tools</A> 
        <UL>
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#Debuggers3_1">3.1 
          Debuggers</A> 
          <UL>
            <LI><A 
            href="http://www.codeproject.com/KB/system/inject2exe.aspx#SoftICE3_1_1">3.1.1 
            SoftICE</A> 
            <LI><A 
            href="http://www.codeproject.com/KB/system/inject2exe.aspx#OllyDbg3_1_2">3.1.2 
            OllyDbg</A> 
            <LI><A 
            href="http://www.codeproject.com/KB/system/inject2exe.aspx#Whichpartsareimportantinadebuggerinterface3_1_3">3.1.3 
            Which parts are important in a debugger interface?</A> </LI></UL>
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#Disassembler3_2">3.2 
          Disassembler</A> 
          <UL>
            <LI><A 
            href="http://www.codeproject.com/KB/system/inject2exe.aspx#Proviewdisassembler3_2_1">3.2.1 
            Proview disassembler</A> 
            <LI><A 
            href="http://www.codeproject.com/KB/system/inject2exe.aspx#W32Dasm3_2_2">3.2.2 
            W32Dasm</A> 
            <LI><A 
            href="http://www.codeproject.com/KB/system/inject2exe.aspx#IDAPro3_2_3">3.2.3 
            IDA Pro</A> </LI></UL>
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#SomeUsefulTools3_3">3.3 
          Some Useful Tools</A> 
          <UL>
            <LI><A 
            href="http://www.codeproject.com/KB/system/inject2exe.aspx#LordPEs3_3_1">3.3.1 
            LordPE</A> 
            <LI><A 
            href="http://www.codeproject.com/KB/system/inject2exe.aspx#PEiD3_3_2">3.3.2 
            PEiD</A> 
            <LI><A 
            href="http://www.codeproject.com/KB/system/inject2exe.aspx#ResourceHacker3_3_3">3.3.3 
            Resource Hacker</A> 
            <LI><A 
            href="http://www.codeproject.com/KB/system/inject2exe.aspx#WinHex3_3_4">3.3.4 
            WinHex</A> 
            <LI><A 
            href="http://www.codeproject.com/KB/system/inject2exe.aspx#CFFExplorer3_3_5">3.3.5 
            CFF Explorer</A> </LI></UL></LI></UL>
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe.aspx#AddnewsectionandChangeOEP4">4. 
        Add new section and Change OEP</A> 
        <UL>
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#RetrieveandRebuildPEfile4_1">4.1 
          Retrieve and Rebuild PE file</A> 
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#CreateDatafornewSection4_2">4.2 
          Create Data for new Section</A> 
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#SomenotesregardingcreatenewPEfile4_3">4.3 
          Some notes regarding creating a new PE file</A> 
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#SomenotesregardinglinkthisVCProject4_4">4.4 
          Some notes regarding linking this VC Project</A> </LI></UL>
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe.aspx#StoreImportantDataandReachtoOriginalOEP5">5. 
        Store Important Data and Reach Original OEP</A> 
        <UL>
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#RestorethefirstRegistersContext5_1">5.1 
          Restore the first Registers Context</A> 
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#RestoretheOriginalStack5_2">5.2 
          Restore the Original Stack</A> 
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#ApproachOEPbyStructuredExceptionHandlin5_3">5.3 
          Approach OEP by Structured Exception Handling</A> 
          <UL>
            <LI><A 
            href="http://www.codeproject.com/KB/system/inject2exe.aspx#ImplementExceptionHandler5_3_1">5.3.1 
            Implement Exception Handler</A> 
            <LI><A 
            href="http://www.codeproject.com/KB/system/inject2exe.aspx#AttainOEPbyadjustmenttheThreadContext5_3_2">5.3.2 
            Attain OEP by adjusting the Thread Context</A> </LI></UL></LI></UL>
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe.aspx#BuildanImportTableandReconstructtheOriginalImportTable6">6. 
        Build an Import Table and Reconstruct the Original Import Table</A> 
        <UL>
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#ConstructtheClientImportTable6_1">6.1 
          Construct the Client Import Table</A> 
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#UsingotherAPIfunctionsinruntime6_2">6.2 
          Using other API functions in run-time</A> 
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#FixuptheOriginalImportTable6_3">6.3 
          Fix up the Original Import Table</A> </LI></UL>
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe.aspx#SupportDLLandOCX7">7. 
        Support DLL and OCX</A> 
        <UL>
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#TwiceOEPapproach7_1">7.1 
          Twice OEP approach</A> 
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#ImplementRelocationTable7_2">7.2 
          Implement Relocation Table</A> 
          <LI><A 
          href="http://www.codeproject.com/KB/system/inject2exe.aspx#BuildaSpecialImporttable7_3">7.3 
          Build a Special Import table</A> </LI></UL>
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe.aspx#PreservetheThreadLocalStorage8">8. 
        Preserve the Thread Local Storage</A> 
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe.aspx#Injectyourcode9">9. 
        Inject your code</A> 
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe.aspx#Conclusion10">10. 
        Conclusion</A> </LI></UL>
      <H2><A name=Preface0>0 Preface</A></H2>
      <P>It might be, you demand to comprehend the ways a virus program injects 
      its procedure in to the interior of a portable executable file and 
      corrupts it, or you are interested in implementing a packer or a protector 
      for your specific intention to encrypt the data of your portable 
      executable (PE) file. This article is committed to represent a brief 
      intuition to realize the performance which is accomplished by EXE tools or 
      some kind of mal-wares.</P>
      <P>You can employ the source code of this article to create your custom 
      EXE builder. It could be used to make an EXE protector in the right way, 
      or with a wrong intention, to pullulate a virus. However, my purpose of 
      writing this article has been to gaze on the first application, so I will 
      not be responsible for the immoral usage of these methods.</P>
      <H2><A name=Prerequisite1>1 Prerequisite</A></H2>
      <P>There are no specific mandatory prerequisites to follow the topics in 
      this article. If you are familiar with debugger and also the portable file 
      format, I suggest you to drop the sections 2 and 3, the whole of these 
      sections have been made for people who don’t have any knowledge regarding 
      the EXE file format and also debuggers.</P>
      <H2><A name=PortableExecutablefileformat2>2 Portable Executable file 
      format</A></H2>
      <P>The Portable Executable file format was defined to provide the best way 
      for the Windows Operating System to execute code and also to store the 
      essential data which is needed to run a program, for example constant 
      data, variable data, import library links, and resource data. It consists 
      of MS-DOS file information, Windows NT file information, Section Headers, 
      and Section images, <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#Table1">Table 
      1</A>.</P>
      <H3><A name=TheMSDOSdata2_1>2.1 The MS-DOS data</A></H3>
      <P>These data let you remember the first days of developing the Windows 
      Operating System, the days. We were at the beginning of a way to achieve a 
      complete Operating System like <A 
      href="http://en.wikipedia.org/wiki/Windows_NT_3.51" target=_blank>Windows 
      NT 3.51</A> (I mean, <A href="http://en.wikipedia.org/wiki/Windows_3.1" 
      target=_blank>Win3.1</A>, <A 
      href="http://en.wikipedia.org/wiki/Windows_95" target=_blank>Win95</A>, <A 
      href="http://en.wikipedia.org/wiki/Windows_98" target=_blank>Win98</A> 
      were not perfect <A href="http://en.wikipedia.org/wiki/Operating_System" 
      target=_blank>OS</A>s). The MS-DOS data causes that your executable file 
      calls a function inside MS-DOS and <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/vccore98/HTML/_core_.2f.stub.asp" 
      target=_blank>the MS-DOS Stub program</A> lets it display: <B>"This 
      program can not be run in MS-DOS mode"</B> or <B>"This program can be run 
      only in Windows mode"</B>, or some things like these comments when you try 
      to run a Windows EXE file inside <A 
      href="http://en.wikipedia.org/wiki/MS-DOS" target=_blank>MS-DOS 6.0</A>, 
      where there is no footstep of Windows. Thus, this data is reserved for the 
      code to indicate these comments in the <A 
      href="http://en.wikipedia.org/wiki/MS-DOS" target=_blank>MS-DOS</A> <A 
      href="http://en.wikipedia.org/wiki/Operating_System" 
      target=_blank>operating system</A>. The most interesting part of the <A 
      href="http://en.wikipedia.org/wiki/MS-DOS" target=_blank>MS-DOS</A> data 
      is "<B>MZ</B>"! Can you believe, it refers to the name of "<A 
      href="http://en.wikipedia.org/wiki/Mark_Zbikowski" target=_blank>Mark 
      Zbikowski</A>", one of the first Microsoft programmers?</P>
      <P>To me, only the offset of the PE signature in the <A 
      href="http://en.wikipedia.org/wiki/MS-DOS" target=_blank>MS-DOS</A> data 
      is important, so I can use it to find the position of the <A 
      href="http://en.wikipedia.org/wiki/Windows_NT" target=_blank>Windows 
      NT</A> data. I just recommend you to take a look at <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#Table1">Table 
      1</A>, then observe the structure of <CODE>IMAGE_DOS_HEADER</CODE> in the 
      <I>&lt;winnt.h&gt;</I> header in the <I>&lt;Microsoft Visual Studio .net 
      path&gt;\VC7\PlatformSDK\include\</I> folder or the <I>&lt;Microsoft 
      Visual Studio 6.0 path&gt;\VC98\include\</I> folder. I do not know why the 
      Microsoft team has forgotten to provide some comment about this structure 
      in the <A href="http://msdn.microsoft.com/" target=_blank>MSDN</A> 
      library!</P><PRE lang=text>typedef struct _IMAGE_DOS_HEADER { // DOS .EXE header "MZ"
    WORD   e_magic;                // Magic number
    WORD   e_cblp;                 // Bytes on last page of file
    WORD   e_cp;                   // Pages in file
    WORD   e_crlc;                 // Relocations
    WORD   e_cparhdr;              // Size of header in paragraphs
    WORD   e_minalloc;             // Minimum extra paragraphs needed
    WORD   e_maxalloc;             // Maximum extra paragraphs needed
    WORD   e_ss;                   // Initial (relative) SS value
    WORD   e_sp;                   // Initial SP value
    WORD   e_csum;                 // Checksum
    WORD   e_ip;                   // Initial IP value
    WORD   e_cs;                   // Initial (relative) CS value
    WORD   e_lfarlc;               // File address of relocation table
    WORD   e_ovno;                 // Overlay number
    WORD   e_res[4];               // Reserved words
    WORD   e_oemid;                // OEM identifier (for e_oeminfo)
    WORD   e_oeminfo;              // OEM information; e_oemid specific
    WORD   e_res2[10];             // Reserved words
    LONG   e_lfanew;               // File address of the new exe header
  } IMAGE_DOS_HEADER, *PIMAGE_DOS_HEADER;
</PRE>
      <P><CODE>e_lfanew</CODE> is the offset which refers to the position of the 
      Windows NT data. I have provided a program to obtain the header 
      information from an EXE file and to display it to you. To use the program, 
      just try:</P>
      <P>
      <H4><A name=PEViewerDownloadLink>PE Viewer</A></H4>
      <UL class=download>
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe/peviewer.zip">Download 
        source files - 132 Kb</A> </LI></UL>
      <P><IMG height=314 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/peviewer1.gif" 
      width=491></P>
      <P><IMG height=427 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/peviewer2.gif" 
      width=588></P>
      <P><IMG height=400 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/peviewer3.gif" 
      width=597></P>
      <P>This sample is useful for the whole of this article.</P>
      <H4><A name=Table1>Table 1 - Portable Executable file format 
      structure</A></H4>
      <TABLE cellSpacing=0 cellPadding=0 border=1>
        <TBODY>
        <TR>
          <TD rowSpan=17>MS-DOS <BR>information</TD>
          <TD rowSpan=16><CODE>IMAGE_DOS_<BR>HEADER</CODE></TD>
          <TD>DOS EXE Signature</TD>
          <TD rowSpan=16><PRE lang=text>00000000  ASCII "MZ"
00000002  DW 0090
00000004  DW 0003
00000006  DW 0000
00000008  DW 0004
0000000A  DW 0000
0000000C  DW FFFF
0000000E  DW 0000
00000010  DW 00B8
00000012  DW 0000
00000014  DW 0000
00000016  DW 0000
00000018  DW 0040
0000001A  DW 0000
0000001C  DB 00
…
…
0000003B  DB 00
0000003C  DD 000000F0
</PRE></TD></TR>
        <TR>
          <TD><CODE>DOS_PartPag</CODE></TD></TR>
        <TR>
          <TD><CODE>DOS_PageCnt</CODE></TD></TR>
        <TR>
          <TD><CODE>DOS_ReloCnt</CODE></TD></TR>
        <TR>
          <TD><CODE>DOS_HdrSize</CODE></TD></TR>
        <TR>
          <TD><CODE>DOS_MinMem</CODE></TD></TR>
        <TR>
          <TD><CODE>DOS_MaxMem</CODE></TD></TR>
        <TR>
          <TD><CODE>DOS_ReloSS</CODE></TD></TR>
        <TR>
          <TD><CODE>DOS_ExeSP</CODE></TD></TR>
        <TR>
          <TD><CODE>DOS_ChkSum</CODE></TD></TR>
        <TR>
          <TD><CODE>DOS_ExeIPP</CODE></TD></TR>
        <TR>
          <TD><CODE>DOS_ReloCS</CODE></TD></TR>
        <TR>
          <TD><CODE>DOS_TablOff</CODE></TD></TR>
        <TR>
          <TD><CODE>DOS_Overlay</CODE></TD></TR>
        <TR>
          <TD><CODE>…<BR></CODE>Reserved words<CODE><BR>…</CODE></TD></TR>
        <TR>
          <TD>Offset to PE signature</TD></TR>
        <TR>
          <TD>MS-DOS Stub <BR>Program</TD>
          <TD colSpan=2><PRE lang=text>00000040  º.´.Í!¸\LÍ!This program canno
00000060  t be run in DOS mode....$.......
</PRE></TD></TR>
        <TR>
          <TD rowSpan=54>Windows NT <BR>information 
            <P><CODE>IMAGE_<BR>NT_HEADERS</CODE></P></TD>
          <TD>Signature</TD>
          <TD>PE signature (PE)</TD>
          <TD><PRE lang=text>000000F0  ASCII "PE"
</PRE></TD></TR>
        <TR>
          <TD rowSpan=7><CODE>IMAGE_<BR>FILE_HEADER</CODE></TD>
          <TD><CODE>Machine</CODE></TD>
          <TD rowSpan=7><PRE lang=text>000000F4  DW 014C
000000F6  DW 0003
000000F8  DD 3B7D8410
000000FC  DD 00000000
00000100  DD 00000000
00000104  DW 00E0
00000106  DW 010F
</PRE></TD></TR>
        <TR>
          <TD><CODE>NumberOfSections</CODE></TD></TR>
        <TR>
          <TD><CODE>TimeDateStamp</CODE></TD></TR>
        <TR>
          <TD><CODE>PointerToSymbolTable</CODE></TD></TR>
        <TR>
          <TD><CODE>NumberOfSymbols</CODE></TD></TR>
        <TR>
          <TD><CODE>SizeOfOptionalHeader</CODE></TD></TR>
        <TR>
          <TD><CODE>Characteristics</CODE></TD></TR>
        <TR>
          <TD rowSpan=46><CODE>IMAGE_<BR>OPTIONAL_<BR>HEADER32</CODE></TD>
          <TD><CODE>MagicNumber</CODE></TD>
          <TD rowSpan=30><PRE lang=text>00000108  DW 010B
0000010A  DB 07
0000010B  DB 00
0000010C  DD 00012800
00000110  DD 00009C00
00000114  DD 00000000
00000118  DD 00012475
0000011C  DD 00001000
00000120  DD 00014000
00000124  DD 01000000
00000128  DD 00001000
0000012C  DD 00000200
00000130  DW 0005
00000132  DW 0001
00000134  DW 0005
00000136  DW 0001
00000138  DW 0004
0000013A  DW 0000
0000013C  DD 00000000
00000140  DD 0001F000
00000144  DD 00000400
00000148  DD 0001D7FC
0000014C  DW 0002
0000014E  DW 8000
00000150  DD 00040000
00000154  DD 00001000
00000158  DD 00100000
0000015C  DD 00001000
00000160  DD 00000000
00000164  DD 00000010




</PRE></TD></TR>
        <TR>
          <TD><CODE>MajorLinkerVersion</CODE></TD></TR>
        <TR>
          <TD><CODE>MinorLinkerVersion</CODE></TD></TR>
        <TR>
          <TD><CODE>SizeOfCode</CODE></TD></TR>
        <TR>
          <TD><CODE>SizeOfInitializedData</CODE></TD></TR>
        <TR>
          <TD><CODE>SizeOfUninitializedData</CODE></TD></TR>
        <TR>
          <TD><CODE>AddressOfEntryPoint</CODE></TD></TR>
        <TR>
          <TD><CODE>BaseOfCode</CODE></TD></TR>
        <TR>
          <TD><CODE>BaseOfData</CODE></TD></TR>
        <TR>
          <TD><CODE>ImageBase</CODE></TD></TR>
        <TR>
          <TD><CODE>SectionAlignment</CODE></TD></TR>
        <TR>
          <TD><CODE>FileAlignment</CODE></TD></TR>
        <TR>
          <TD><CODE>MajorOSVersion</CODE></TD></TR>
        <TR>
          <TD><CODE>MinorOSVersion</CODE></TD></TR>
        <TR>
          <TD><CODE>MajorImageVersion</CODE></TD></TR>
        <TR>
          <TD><CODE>MinorImageVersion</CODE></TD></TR>
        <TR>
          <TD><CODE>MajorSubsystemVersion</CODE></TD></TR>
        <TR>
          <TD><CODE>MinorSubsystemVersion</CODE></TD></TR>
        <TR>
          <TD><CODE>Reserved</CODE></TD></TR>
        <TR>
          <TD><CODE>SizeOfImage</CODE></TD></TR>
        <TR>
          <TD><CODE>SizeOfHeaders</CODE></TD></TR>
        <TR>
          <TD><CODE>CheckSum</CODE></TD></TR>
        <TR>
          <TD><CODE>Subsystem</CODE></TD></TR>
        <TR>
          <TD><CODE>DLLCharacteristics</CODE></TD></TR>
        <TR>
          <TD><CODE>SizeOfStackReserve</CODE></TD></TR>
        <TR>
          <TD><CODE>SizeOfStackCommit</CODE></TD></TR>
        <TR>
          <TD><CODE>SizeOfHeapReserve</CODE></TD></TR>
        <TR>
          <TD><CODE>SizeOfHeapCommit</CODE></TD></TR>
        <TR>
          <TD><CODE>LoaderFlags</CODE></TD></TR>
        <TR>
          <TD><CODE>NumberOfRvaAndSizes</CODE></TD></TR>
        <TR>
          <TD rowSpan=16><CODE>IMAGE_<BR>DATA_DIRECTORY[<SPAN 
            class=code-digit>16</SPAN>]</CODE></TD>
          <TD>Export Table</TD></TR>
        <TR>
          <TD>Import Table</TD></TR>
        <TR>
          <TD>Resource Table</TD></TR>
        <TR>
          <TD>Exception Table</TD></TR>
        <TR>
          <TD>Certificate File</TD></TR>
        <TR>
          <TD>Relocation Table</TD></TR>
        <TR>
          <TD>Debug Data</TD></TR>
        <TR>
          <TD>Architecture Data</TD></TR>
        <TR>
          <TD>Global Ptr</TD></TR>
        <TR>
          <TD>TLS Table</TD></TR>
        <TR>
          <TD>Load Config Table</TD></TR>
        <TR>
          <TD>Bound Import Table</TD></TR>
        <TR>
          <TD>Import Address Table</TD></TR>
        <TR>
          <TD>Delay Import Descriptor</TD></TR>
        <TR>
          <TD>COM+ Runtime Header</TD></TR>
        <TR>
          <TD>Reserved</TD></TR>
        <TR>
          <TD rowSpan=13>Sections <BR>information</TD>
          <TD rowSpan=10><CODE>IMAGE_<BR>SECTION_<BR>HEADER[<SPAN 
            class=code-digit>0</SPAN>]</CODE></TD>
          <TD><CODE>Name[<SPAN class=code-digit>8</SPAN>]</CODE></TD>
          <TD rowSpan=10><PRE lang=text>000001E8  ASCII".text"
000001F0  DD 000126B0
000001F4  DD 00001000
000001F8  DD 00012800
000001FC  DD 00000400
00000200  DD 00000000
00000204  DD 00000000
00000208  DW 0000
0000020A  DW 0000
0000020C  DD 60000020
    CODE|EXECUTE|READ</PRE></TD></TR>
        <TR>
          <TD><CODE>VirtualSize</CODE></TD></TR>
        <TR>
          <TD><CODE>VirtualAddress</CODE></TD></TR>
        <TR>
          <TD><CODE>SizeOfRawData</CODE></TD></TR>
        <TR>
          <TD><CODE>PointerToRawData</CODE></TD></TR>
        <TR>
          <TD><CODE>PointerToRelocations</CODE></TD></TR>
        <TR>
          <TD><CODE>PointerToLineNumbers</CODE></TD></TR>
        <TR>
          <TD><CODE>NumberOfRelocations</CODE></TD></TR>
        <TR>
          <TD><CODE>NumberOfLineNumbers</CODE></TD></TR>
        <TR>
          <TD><CODE>Characteristics</CODE></TD></TR>
        <TR>
          <TD><CODE>…<BR>…<BR>…<BR>IMAGE_<BR>SECTION_<BR>HEADER[n]</CODE></TD>
          <TD colSpan=2><PRE lang=text>00000210  ASCII".data"; SECTION
00000218  DD 0000101C ; VirtualSize = 0x101C
0000021C  DD 00014000 ; VirtualAddress = 0x14000
00000220  DD 00000A00 ; SizeOfRawData = 0xA00
00000224  DD 00012C00 ; PointerToRawData = 0x12C00
00000228  DD 00000000 ; PointerToRelocations = 0x0
0000022C  DD 00000000 ; PointerToLineNumbers = 0x0
00000230  DW 0000     ; NumberOfRelocations = 0x0
00000232  DW 0000     ; NumberOfLineNumbers = 0x0
00000234  DD C0000040 ; Characteristics = 
                        INITIALIZED_DATA|READ|WRITE
00000238  ASCII".rsrc"; SECTION
00000240  DD 00008960 ; VirtualSize = 0x8960
00000244  DD 00016000 ; VirtualAddress = 0x16000
00000248  DD 00008A00 ; SizeOfRawData = 0x8A00
0000024C  DD 00013600 ; PointerToRawData = 0x13600
00000250  DD 00000000 ; PointerToRelocations = 0x0
00000254  DD 00000000 ; PointerToLineNumbers = 0x0
00000258  DW 0000     ; NumberOfRelocations = 0x0
0000025A  DW 0000     ; NumberOfLineNumbers = 0x0
0000025C  DD 40000040 ; Characteristics = 
                        INITIALIZED_DATA|READ
</PRE></TD></TR>
        <TR>
          <TD><CODE>SECTION[<SPAN class=code-digit>0</SPAN>]</CODE></TD>
          <TD colSpan=2><PRE lang=text>00000400  EA 22 DD 77 D7 23 DD 77  ê"Ýw×#Ýw
00000408  9A 18 DD 77 00 00 00 00  šÝw....
00000410  2E 1E C7 77 83 1D C7 77  .ÇwƒÇw
00000418  FF 1E C7 77 00 00 00 00  ÿÇw....
00000420  93 9F E7 77 D8 05 E8 77  “ŸçwØèw
00000428  FD A5 E7 77 AD A9 E9 77  ý¥çw&amp;shy;©éw
00000430  A3 36 E7 77 03 38 E7 77  £6çw&gt;8çw
00000438  41 E3 E6 77 60 8D E7 77  Aãæw`çw
00000440  E6 1B E6 77 2B 2A E7 77  ææw+*çw
00000448  7A 17 E6 77 79 C8 E6 77  zæwyÈæw
00000450  14 1B E7 77 C1 30 E7 77  çwÁ0çw
…
</PRE></TD></TR>
        <TR>
          <TD><CODE>…<BR>…<BR>…<BR>SECTION[n]</CODE></TD>
          <TD colSpan=2><PRE lang=text>…
0001BF00  63 00 2E 00 63 00 68 00  c...c.h.
0001BF08  6D 00 0A 00 43 00 61 00  m...C.a.
0001BF10  6C 00 63 00 75 00 6C 00  l.c.u.l.
0001BF18  61 00 74 00 6F 00 72 00  a.t.o.r.
0001BF20  11 00 4E 00 6F 00 74 00  .N.o.t.
0001BF28  20 00 45 00 6E 00 6F 00   .E.n.o.
0001BF30  75 00 67 00 68 00 20 00  u.g.h. .
0001BF38  4D 00 65 00 6D 00 6F 00  M.e.m.o.
0001BF40  72 00 79 00 00 00 00 00  r.y.....
0001BF48  00 00 00 00 00 00 00 00  ........
0001BF50  00 00 00 00 00 00 00 00  ........
0001BF58  00 00 00 00 00 00 00 00  ........
0001BF60  00 00 00 00 00 00 00 00  ........
0001BF68  00 00 00 00 00 00 00 00  ........
0001BF70  00 00 00 00 00 00 00 00  ........
0001BF78  00 00 00 00 00 00 00 00  ........
</PRE></TD></TR></TBODY></TABLE>
      <H3><A name=TheWindowsNTdata2_2>2.2 The Windows NT data</A></H3>
      <P>As mentioned in the preceding section, <CODE>e_lfanew</CODE> storage in 
      the MS-DOS data structure refers to the location of the Windows NT 
      information. Hence, if you assume that the <CODE>pMem</CODE> pointer 
      relates the start point of the memory space for a selected portable 
      executable file, you can retrieve the MS-DOS header and also the Windows 
      NT headers by the following lines, which you also can perceive in the <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#PEViewerDownloadLink">PE 
      viewer</A> sample (<I>pelib.cpp</I>, 
      <CODE>PEStructure::OpenFileName()</CODE>):</P><PRE lang=c++>IMAGE_DOS_HEADER        image_dos_header;
IMAGE_NT_HEADERS        image_nt_headers;
PCHAR pMem;
…
memcpy(&amp;image_dos_header, pMem, 
       <SPAN class=code-keyword>sizeof</SPAN>(IMAGE_DOS_HEADER));
memcpy(&amp;image_nt_headers,
       pMem+image_dos_header.e_lfanew, 
       <SPAN class=code-keyword>sizeof</SPAN>(IMAGE_NT_HEADERS));</PRE>
      <P>It seems to be very simple, the retrieval of the headers information. I 
      recommend inspecting the MSDN library regarding the <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/image_nt_headers_str.asp" 
      target=_blank><CODE>IMAGE_NT_HEADERS</CODE></A> structure definition. It 
      makes comprehensible to grasp what the image NT header maintains to 
      execute a code inside the Windows NT OS. Now, you are conversant with the 
      Windows NT structure, it consists of the <FONT color=green>"PE"</FONT> 
      Signature, the <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/image_file_header_str.asp" 
      target=_blank>File Header</A>, and the <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/image_optional_header_str.asp" 
      target=_blank>Optional Header</A>. Do not forget to take a glimpse at 
      their comments in the <A href="http://msdn.microsoft.com/" 
      target=_blank>MSDN</A> Library and besides in <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#Table1">Table 
      1</A>.</P>
      <P>One the whole, I consider merely, on the most circumstances, the 
      following cells of the <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/image_nt_headers_str.asp" 
      target=_blank><CODE>IMAGE_NT_HEADERS</CODE></A> structure:</P><PRE lang=c++>FileHeader-<SPAN class=code-keyword>&gt;</SPAN>NumberOfSections
OptionalHeader-<SPAN class=code-keyword>&gt;</SPAN>AddressOfEntryPoint
OptionalHeader-<SPAN class=code-keyword>&gt;</SPAN>ImageBase
OptionalHeader-<SPAN class=code-keyword>&gt;</SPAN>SectionAlignment
OptionalHeader-<SPAN class=code-keyword>&gt;</SPAN>FileAlignment
OptionalHeader-<SPAN class=code-keyword>&gt;</SPAN>SizeOfImage
OptionalHeader-<SPAN class=code-keyword>&gt;</SPAN>
  DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT]-<SPAN class=code-keyword>&gt;</SPAN>VirtualAddress
OptionalHeader-<SPAN class=code-keyword>&gt;</SPAN>DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT]-<SPAN class=code-keyword>&gt;</SPAN>Size</PRE>
      <P>You can observe clearly, the main purpose of these values, and their 
      role when the internal virtual memory space allocated for an EXE file by 
      the Windows OS is fully allocated, if you pay attention to their 
      explanations in <A href="http://msdn.microsoft.com/" 
      target=_blank>MSDN</A> library, so I am not going to repeat the MSDN 
      annotations here.</P>
      <P>I should mention a brief comment regarding the PE data directories, or 
      <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/image_optional_header_str.asp" 
      target=_blank><CODE>OptionalHeader</CODE></A>-&gt; <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/image_data_directory_str.asp" 
      target=_blank><CODE>DataDirectory[]</CODE></A>, as I think there are a few 
      aspects of interest concerning them. When you come to survey the Optional 
      header through the Windows NT information, you will find that there are 
      <I>16</I> directories at the end of the Optional Header, where you can 
      find the consecutive directories, including their Relative Virtual Address 
      and Size. I just mention here, the notes from <I>&lt;winnt.h&gt;</I> to 
      clarify these information:</P><PRE lang=c++><SPAN class=code-preprocessor>#define</SPAN> IMAGE_DIRECTORY_ENTRY_EXPORT          <SPAN class=code-digit>0</SPAN>   <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Export Directory
</SPAN><SPAN class=code-preprocessor>#define</SPAN> IMAGE_DIRECTORY_ENTRY_IMPORT          <SPAN class=code-digit>1</SPAN>   <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Import Directory
</SPAN><SPAN class=code-preprocessor>#define</SPAN> IMAGE_DIRECTORY_ENTRY_RESOURCE        <SPAN class=code-digit>2</SPAN>   <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Resource Directory
</SPAN><SPAN class=code-preprocessor>#define</SPAN> IMAGE_DIRECTORY_ENTRY_EXCEPTION       <SPAN class=code-digit>3</SPAN>   <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Exception Directory
</SPAN><SPAN class=code-preprocessor>#define</SPAN> IMAGE_DIRECTORY_ENTRY_SECURITY        <SPAN class=code-digit>4</SPAN>   <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Security Directory
</SPAN><SPAN class=code-preprocessor>#define</SPAN> IMAGE_DIRECTORY_ENTRY_BASERELOC       <SPAN class=code-digit>5</SPAN>   <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Base Relocation Table
</SPAN><SPAN class=code-preprocessor>#define</SPAN> IMAGE_DIRECTORY_ENTRY_DEBUG           <SPAN class=code-digit>6</SPAN>   <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Debug Directory
</SPAN><SPAN class=code-preprocessor>#define</SPAN> IMAGE_DIRECTORY_ENTRY_ARCHITECTURE    <SPAN class=code-digit>7</SPAN>   <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Architecture Specific Data
</SPAN><SPAN class=code-preprocessor>#define</SPAN> IMAGE_DIRECTORY_ENTRY_GLOBALPTR       <SPAN class=code-digit>8</SPAN>   <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> RVA of GP
</SPAN><SPAN class=code-preprocessor>#define</SPAN> IMAGE_DIRECTORY_ENTRY_TLS             <SPAN class=code-digit>9</SPAN>   <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> TLS Directory
</SPAN><SPAN class=code-preprocessor>#define</SPAN> IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG    <SPAN class=code-digit>10</SPAN>   <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Load Configuration Directory
</SPAN><SPAN class=code-preprocessor>#define</SPAN> IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT   <SPAN class=code-digit>11</SPAN>   <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Bound Import Directory in headers
</SPAN><SPAN class=code-preprocessor>#define</SPAN> IMAGE_DIRECTORY_ENTRY_IAT            <SPAN class=code-digit>12</SPAN>   <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Import Address Table
</SPAN><SPAN class=code-preprocessor>#define</SPAN> IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT   <SPAN class=code-digit>13</SPAN>   <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Delay Load Import Descriptors
</SPAN><SPAN class=code-preprocessor>#define</SPAN> IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR <SPAN class=code-digit>14</SPAN>   <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> COM Runtime descriptor</SPAN></PRE>
      <P>The last one (15) was reserved for use in future; I have not yet seen 
      any purpose to use it even in PE64.</P>
      <P>For instance, if you desire to perceive the relative virtual address 
      (RVA) and the size of the resource data, it is enough to retrieve them by: 
      </P><PRE lang=c++>DWORD dwRVA = image_nt_headers.OptionalHeader-<SPAN class=code-keyword>&gt;</SPAN>
  DataDirectory[IMAGE_DIRECTORY_ENTRY_RESOURCE]-<SPAN class=code-keyword>&gt;</SPAN>VirtualAddress;
DWORD dwSize = image_nt_headers.OptionalHeader-<SPAN class=code-keyword>&gt;</SPAN>
  DataDirectory[IMAGE_DIRECTORY_ENTRY_RESOURCE]-<SPAN class=code-keyword>&gt;</SPAN>Size;</PRE>
      <P>To comprehend more regarding the significance of data directories, I 
      forward you to section 3.4.3, <A 
      href="http://www.microsoft.com/whdc/system/platform/firmware/PECOFF.mspx" 
      target=_blank>Microsoft Portable Executable and the Common Object File 
      Format Specification</A> document by Microsoft, and furthermore section 6 
      of this document, where you discern the various types of sections and 
      their applications. We will discuss the section's advantage 
      subsequently.</P>
      <H3><A name=TheSectionHeadersandSections2_3>2.3 The Section Headers and 
      Sections</A></H3>
      <P>We currently observe how the portable executable files declare the 
      location and the size of a section on a disk storage file and inside the 
      virtual memory space allocated for the program with <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/image_nt_headers_str.asp" 
      target=_blank><CODE>IMAGE_NT_HEADERS</CODE></A>-&gt; <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/image_optional_header_str.asp" 
      target=_blank><CODE>OptionalHeader</CODE></A>-&gt;<CODE>SizeOfImage</CODE> 
      by the Windows task manager, as well the characteristics to demonstrate 
      the type of the section. To understand better the Section header as my 
      previous declaration, I suggest having a short gape on the <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/image_section_header_str.asp" 
      target=_blank><CODE>IMAGE_SECTION_HEADER</CODE></A> structure definition 
      in the MSDN library. For an EXE packer developer, 
      <CODE>VirtualSize</CODE>, <CODE>VirtualAddress</CODE>, 
      <CODE>SizeOfRawData</CODE>, <CODE>PointerToRawData</CODE>, and 
      <CODE>Characteristics</CODE> cells have significant rules. While 
      developing an EXE packer, you should be clever enough to play with them. 
      There are somethings to be noted while you modify them; you should take 
      care to align the <CODE>VirtualSize</CODE> and <CODE>VirtualAddress</CODE> 
      according to <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/image_optional_header_str.asp" 
      target=_blank><CODE>OptionalHeader</CODE></A>-&gt;<CODE>SectionAlignment</CODE>, 
      as well as <CODE>SizeOfRawData</CODE> and <CODE>PointerToRawData</CODE> in 
      line with <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/image_optional_header_str.asp" 
      target=_blank><CODE>OptionalHeader</CODE></A>-&gt;<CODE>FileAlignment</CODE>. 
      Otherwise, you will corrupt your target EXE file and it will never run. 
      Regarding <CODE>Characteristics</CODE>, I pay attention mostly to 
      establish a section by <CODE>IMAGE_SCN_MEM_READ</CODE> | 
      <CODE>IMAGE_SCN_MEM_WRITE</CODE> | 
      <CODE>IMAGE_SCN_CNT_INITIALIZED_DATA</CODE>, I prefer my new section has 
      ability to initialize such data during running process; such as import 
      table; besides, I need it to be able to modify itself by the loader with 
      my settings in the section characteristics to read- and writeable.</P>
      <P>Moreover, you should pay attention to the section names, you can know 
      the purpose of each section by its name. I will just forward you to 
      section 6: <A 
      href="http://www.microsoft.com/whdc/system/platform/firmware/PECOFF.mspx" 
      target=_blank>Microsoft Portable Executable and the Common Object File 
      Format Specification</A> documents. I believe, it represents the totality 
      of sections by their names, <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#TabLe2">Table 
      2</A>.</P>
      <H4><A name=Table2>Table 2 - Section names</A></H4>
      <TABLE cellSpacing=0 cellPadding=0 border=1>
        <TBODY>
        <TR>
          <TD><FONT color=green>".text"</FONT></TD>
          <TD>Code Section</TD></TR>
        <TR>
          <TD><FONT color=green>"CODE"</FONT></TD>
          <TD>Code Section of file linked by Borland Delphi or Borland 
          Pascal</TD></TR>
        <TR>
          <TD><FONT color=green>".data"</FONT></TD>
          <TD>Data Section</TD></TR>
        <TR>
          <TD><FONT color=green>"DATA"</FONT></TD>
          <TD>Data Section of file linked by Borland Delphi or Borland 
          Pascal</TD></TR>
        <TR>
          <TD><FONT color=green>".rdata"</FONT></TD>
          <TD>Section for Constant Data </TD></TR>
        <TR>
          <TD><FONT color=green>".idata"</FONT></TD>
          <TD>Import Table</TD></TR>
        <TR>
          <TD><FONT color=green>".edata" </FONT></TD>
          <TD>Export Table</TD></TR>
        <TR>
          <TD><FONT color=green>".tls"</FONT></TD>
          <TD>TLS Table</TD></TR>
        <TR>
          <TD><FONT color=green>".reloc"</FONT></TD>
          <TD>Relocation Information</TD></TR>
        <TR>
          <TD><FONT color=green>".rsrc"</FONT></TD>
          <TD>Resource Information</TD></TR></TBODY></TABLE>
      <P>To comprehend the section headers and also the sections, you can run 
      the sample <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#PEViewerDownloadLink">PE 
      viewer</A>. By this PE viewer, you only can realize the application of the 
      section headers in a file image, so to observe the main significance in 
      the Virtual Memory, you should try to load a PE file by a debugger, and 
      the next section represents the main idea of using the virtual address and 
      –size in the virtual memory by using a debugger. The last note is about <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/image_nt_headers_str.asp" 
      target=_blank><CODE>IMAGE_NT_HEADERS</CODE></A>-&gt; <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/image_file_header_str.asp" 
      target=_blank><CODE>FileHeader</CODE></A>-&gt;<CODE><SPAN 
      class=code-keyword>&lt;</SPAN>CODE<SPAN 
      class=code-keyword>&gt;</SPAN>NumberOfSections</CODE></CODE>, that 
      provides a number of sections in a PE file, do not forget to adjust it 
      whenever you remove or add some sections to a PE file, I am talking about 
      section injection!</P>
      <H2><A name=DebuggerDisassemblerandsomeUsefulTools3>3 Debugger, 
      Disassembler and some Useful Tools</A></H2>
      <P>In this part, you will become familiar with the necessary and essential 
      equipments to develop your PE tools.</P>
      <H3><A name=Debuggers3_1>3.1 Debuggers</A></H3>
      <P>The first essential prerequisite, to become a PE tools developer, is to 
      have enough experience with bug tracer tools. Furthermore, you should know 
      most of the assembly instructions. To me, the Intel documents are the best 
      references. You can obtain them from the Intel site for IA-32, and on top 
      of that IA-64; the future belongs to IA-64 CPUs, Windows XP 64-bit, and 
      also PE64!</P>
      <UL>
        <LI><A 
        href="http://www.intel.com/design/pentium4/manuals/index_new.htm#1" 
        target=_blank>IA-32 Intel Architecture Software Developer’s Manuals</A>. 

        <LI><A 
        href="http://www.intel.com/software/products/compilers/docs/linux/ref/asm_lan_lx.htm#cover.htm" 
        target=_blank>Intel Itanium Architecture Assembly Language Reference 
        Guide</A>. 
        <LI><A 
        href="http://www.intel.com/cd/ids/developer/asmo-na/eng/19415.htm" 
        target=_blank>The Intel Itanium Processor Developer Resource Guide</A>. 
        </LI></UL>
      <P>To trace a PE file, <A href="http://en.wikipedia.org/wiki/SoftICE" 
      target=_blank>SoftICE</A> by <A href="http://www.compuware.com/" 
      target=_blank>Compuware Corporation</A>, I knew it also as named <A 
      href="http://en.wikipedia.org/wiki/Numega" target=_blank>NuMega</A> when I 
      was at high school, is the best <A 
      href="http://en.wikipedia.org/wiki/Debugger" target=_blank>debugger</A> in 
      the world. It implements process tracing by using <A 
      href="http://en.wikipedia.org/wiki/Kernel_mode" target=_blank>kernel 
      mode</A> method debugging without applying Windows debugging <A 
      href="http://en.wikipedia.org/wiki/Application_programming_interface" 
      target=_blank>application programming interface</A> (API) functions. In 
      addition, I am going to introduce one perfect debugger in <A 
      href="http://en.wikipedia.org/wiki/User_mode" target=_blank>user mode</A> 
      level. It utilizes the <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/debugging_reference.asp" 
      target=_blank>Windows debugging API</A> to trace a PE file and also 
      attaches itself to an active <A 
      href="http://en.wikipedia.org/wiki/Computer_process" 
      target=_blank>process</A>. These <A 
      href="http://en.wikipedia.org/wiki/Application_programming_interface" 
      target=_blank>API</A> functions have been provided by Microsoft teams, 
      inside the Windows Kernel32 library, to trace a specific process, by using 
      Microsoft tools, or perhaps, to make your own debugger! Some of those <A 
      href="http://en.wikipedia.org/wiki/Application_programming_interface" 
      target=_blank>API</A> functions inlude: <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/createthread.asp" 
      target=_blank><CODE>CreateThread()</CODE></A>, <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/createprocess.asp" 
      target=_blank><CODE>CreateProcess()</CODE></A>, <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/openprocess.asp" 
      target=_blank><CODE>OpenProcess()</CODE></A>, <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/debugactiveprocess.asp" 
      target=_blank><CODE>DebugActiveProcess()</CODE></A>, <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/getthreadcontext.asp" 
      target=_blank><CODE>GetThreadContext()</CODE></A>, <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/setthreadcontext.asp" 
      target=_blank><CODE>SetThreadContext()</CODE></A>, <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/continuedebugevent.asp" 
      target=_blank><CODE>ContinueDebugEvent()</CODE></A>, <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/debugbreak.asp" 
      target=_blank><CODE>DebugBreak()</CODE></A>, <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/readprocessmemory.asp" 
      target=_blank><CODE>ReadProcessMemory()</CODE></A>, <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/writeprocessmemory.asp" 
      target=_blank><CODE>WriteProcessMemory()</CODE></A>, <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/suspendthread.asp" 
      target=_blank><CODE>SuspendThread()</A></CODE>, and <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/resumethread.asp" 
      target=_blank><CODE>ResumeThread()</CODE></A>.</P>
      <H3><A name=SoftICE3_1_1>3.1.1 SoftICE</A></H3>
      <P>It was in 1987; Frank Grossman and Jim Moskun decided to establish a 
      company called <A href="http://en.wikipedia.org/wiki/Numega" 
      target=_blank>NuMega Technologies</A> in Nashua, NH, in order to develop 
      some equipments to trace and test the reliability of Microsoft Windows 
      software programs. Now, it is a part of <A 
      href="http://en.wikipedia.org/wiki/Compuware" target=_blank>Compuware 
      Corporation</A> and its product has participated to accelerate the 
      reliability in Windows software, and additionally in Windows driver 
      developments. Currently, everyone knows the Compuware DriverStudio which 
      is used to establish an environment for implementing the elaboration of a 
      kernel driver or a system file by aiding the <A 
      href="http://www.microsoft.com/whdc/ddk/winddk.mspx" target=_blank>Windows 
      Driver Development Kit (DDK)</A>. It bypasses the involvement of DDK to 
      implement a portable executable file of kernel level for a Windows system 
      software developer. For us, only one instrument of DriverStudio is 
      important, <A href="http://en.wikipedia.org/wiki/SoftICE" 
      target=_blank>SoftICE</A>, this debugger can be used to trace every 
      portable executable file, a PE file for user mode level or a PE file for 
      kernel mode level.</P>
      <H4><A name=Figure1>Figure 1 - SoftICE Window</A></H4>
      <TABLE cellSpacing=0 cellPadding=0 border=1>
        <TBODY bgColor=black color="gray">
        <TR>
          <TD><FONT color=gray><FONT color=#00ccff>EAX=00000000 
            </FONT>EBX=7FFDD000<FONT color=#00ccff> ECX=0007FFB0 
            EDX=7C90EB94</FONT> ESI=FFFFFFFF<BR>EDI=7C919738 <FONT 
            color=#00ccff>EBP=0007FFF0 ESP=0007FFC4 EIP=010119E0</FONT> o d i s 
            <FONT color=#00ccff>z </FONT>a <FONT color=#00ccff>p</FONT> 
            c<BR>CS=0008 DS=0023 SS=0010 ES=0023 FS=0030 GS=0000</FONT> <FONT 
            color=#00ccff>SS:0007FFC4=87C816D4F</FONT> </TD></TR>
        <TR>
          <TD><FONT color=gray>0023:01013000 00 00 00 00 00 00 00 00-00 00 00 
            00 00 00 00 00 ................<BR>0023:01013010 01 00 00 00 20 00 
            00 00-0A 00 00 00 0A 00 00 00 ................<BR>0023:01013020 20 
            00 00 00 00 00 00 00-53 63 69 43 61 6C 63 00 
            ........SciCalc.<BR>0023:01013030 00 00 00 00 00 00 00 00-62 61 63 
            6B 67 72 6F 75 ........backgrou<BR>0023:01013040 6E 64 00 00 00 00 
            00 00-2E 00 00 00 00 00 00 00 nd..............<BR></FONT></TD></TR>
        <TR>
          <TD><FONT color=gray>0010:0007FFC4 4F 6D 81 7C 38 07 91 7C-FF FF FF 
            FF 00 90 FD 7F Om |8 ‘| . <BR>0010:0007FFD4 ED A6 54 80 C8 FF 07 
            00-E8 B4 F5 81 FF FF FF FF T . <BR>0010:0007FFE4 F3 99 83 7C 58 6D 
            81 7C-00 00 00 00 00 00 00 00 Xm |........ <BR>0010:0007FFF4 00 00 
            00 00 E0 19 01 01-00 00 00 00 00 00 00 00 .... .... 
<BR></FONT></TD></TR>
        <TR>
          <TD><FONT color=gray><FONT color=#00ccff>010119E0 PUSH 
            EBP</FONT><BR>010119E1 MOV EBP,ESP<BR>010119E3 PUSH -1<BR>010119E5 
            PUSH 01001570<BR>010119EA PUSH 01011D60<BR>010119EF MOV EAX,DWORD 
            PTR FS:[0]<BR>010119F5 PUSH EAX<BR>010119F6 MOV DWORD PTR 
            FS:[0],ESP<BR>010119FD ADD ESP,-68<BR>01011A00 PUSH EBX<BR>01011A01 
            PUSH ESI<BR>01011A02 PUSH EDI<BR>01011A03 MOV DWORD PTR 
            SS:[EBP-18],ESP<BR>01011A06 MOV DWORD PTR 
        SS:[EBP-4],0<BR></FONT></TD></TR>
        <TR>
          <TD><FONT color=#808080>:_</FONT><FONT 
          color=gray><BR><BR><BR></FONT></TD></TR></TBODY></TABLE>
      <H3><A name=OllyDbg3_1_2>3.1.2 OllyDbg</A></H3>
      <P>It was about 4 years ago, that I first saw this debugger by chance. For 
      me, it was the best choice, I was not so wealthy to purchase SoftICE, and 
      at that time, SoftICE only had good functions for <A 
      href="http://en.wikipedia.org/wiki/DOS" target=_blank>DOS</A>, <A 
      href="http://en.wikipedia.org/wiki/Windows_98" target=_blank>Windows 
      98</A>, and <A href="http://en.wikipedia.org/wiki/Windows_2000" 
      target=_blank>Windows 2000</A>. I found that this debugger supported all 
      kinds of Windows versions. Therefore, I started to learn it very fast, and 
      now it is my favorite debugger for the Windows OS. It is a debugger that 
      can be used to trace all kinds of portable executable files except a <A 
      href="http://en.wikipedia.org/wiki/Common_Language_Infrastructure" 
      target=_blank>Common Language Infrastructure (CLI)</A> file format in user 
      mode level, by using the <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/debugging_reference.asp" 
      target=_blank>Windows debugging API</A>. <B>Oleh Yuschuk</B>, the author, 
      is one of worthiest software developers I have seen in my life. He is a 
      Ukrainian who now lives in Germany. I should mention here that his 
      debugger is the best choice for hacker and cracker parties around the 
      world! It is a freeware! You can try it from <A 
      href="http://www.ollydbg.de/" target=_blank>OllyDbg Homepage</A>.</P>
      <H4><A name=Figure2>Figure 2 - OllyDbg CPU Window</A></H4><!--<TABLE cellSpacing=0 width=600 cellPadding=0 border=1>
<TBODY>
<TR>
<TD><PRE lang=text>010119E0
010119E1
010119E3
010119E5
010119EA
010119EF
010119F5
010119F6
010119FD
01011A00
01011A01
01011A02
01011A03
01011A06
01011A0D
01011A0F
01011A15
01011A18
01011A22
01011A2C
01011A32
01011A38
01011A3A
01011A40
01011A46
01011A48
01011A4D
01011A4F
01011A55
01011A5A
01011A5F
01011A61
</PRE></TD>
<TD><PRE lang=text>$ 55
. 8BEC
. 6A FF
. 68 70150001
. 68 601D0101
. 64:A1 00000000
. 50
. 64:8925 000000
. 83C4 98
. 53
. 56
. 57
. 8965 E8
. C745 FC 0000000
. 6A 02
. FF15 B8100001
. 83C4 04
. C705 783F0101 F
. C705 7C3F0101 F
. FF15 BC100001
. 8B0D 743F0101
. 8908
. FF15 C0100001
. 8B15 703F0101
. 8910
. A1 C4100001
. 8B08
. 890D 803F0101
. E8 F6020000
. A1 F0390101
. 85C0
. 75 0E
</PRE></TD>
<TD valign=top><PRE lang=asm><span class="code-keyword">PUSH</span> EBP
<span class="code-keyword">MOV</span> EBP,ESP
<span class="code-keyword">PUSH</span> -1
<span class="code-keyword">PUSH</span> CALC.<span class="code-digit">01001570</span>
<span class="code-keyword">PUSH</span> <span class="code-keyword">JMP</span>.&amp;MSVCRT._except_handler3 
<span class="code-keyword">MOV</span> EAX,DWORD <span class="code-keyword">PTR</span> FS:[<span class="code-digit">0</span>]
<span class="code-keyword">PUSH</span> <span class="code-keyword">EAX</span>
<span class="code-keyword">MOV</span> <span class="code-keyword">DWORD</span> <span class="code-keyword">PTR</span> FS:[<span class="code-digit">0</span>],ESP
<span class="code-keyword">ADD</span> ESP,-68
<span class="code-keyword">PUSH</span> EBX
<span class="code-keyword">PUSH</span> <span class="code-keyword">ESI</span>
<span class="code-keyword">PUSH</span> <span class="code-keyword">EDI</span>
<span class="code-keyword">MOV</span> <span class="code-keyword">DWORD</span> <span class="code-keyword">PTR</span> SS:[EBP-18],ESP
<span class="code-keyword">MOV</span> <span class="code-keyword">DWORD</span> <span class="code-keyword">PTR</span> SS:[EBP-4],0
<span class="code-keyword">PUSH</span> <span class="code-digit">2</span>
<span class="code-keyword">CALL</span> <span class="code-keyword">DWORD</span> <span class="code-keyword">PTR</span> DS:[&amp;MSVCRT.__set_app_ty
<span class="code-keyword">ADD</span> ESP,4
<span class="code-keyword">MOV</span> <span class="code-keyword">DWORD</span> <span class="code-keyword">PTR</span> DS:[1013F78],-1
<span class="code-keyword">MOV</span> <span class="code-keyword">DWORD</span> <span class="code-keyword">PTR</span> DS:[1013F7C],-1
<span class="code-keyword">CALL</span> <span class="code-keyword">DWORD</span> <span class="code-keyword">PTR</span> DS:[&amp;MSVCRT.__p__fmode] 
<span class="code-keyword">MOV</span> ECX, <span class="code-keyword">DWORD</span> <span class="code-keyword">PTR</span> DS:[1013F74]
<span class="code-keyword">MOV</span> <span class="code-keyword">DWORD</span> <span class="code-keyword">PTR</span> DS:[<span class="code-keyword">EAX</span>],ECX
<span class="code-keyword">CALL</span> <span class="code-keyword">DWORD</span> <span class="code-keyword">PTR</span> DS:[&amp;MSVCRT.__p__commode
<span class="code-keyword">MOV</span> EDX, <span class="code-keyword">DWORD</span> <span class="code-keyword">PTR</span> DS:[1013F70]
<span class="code-keyword">MOV</span> <span class="code-keyword">DWORD</span> <span class="code-keyword">PTR</span> DS:[<span class="code-keyword">EAX</span>],EDX
<span class="code-keyword">MOV</span> EAX,DWORD <span class="code-keyword">PTR</span> DS:[&amp;MSVCRT._adjust_f
<span class="code-keyword">MOV</span> ECX,DWORD <span class="code-keyword">PTR</span> DS:[<span class="code-keyword">EAX</span>]
<span class="code-keyword">MOV</span> <span class="code-keyword">DWORD</span> <span class="code-keyword">PTR</span> DS:[1013F80],ECX
<span class="code-keyword">CALL</span> CALC.01011D50
<span class="code-keyword">MOV</span> EAX, <span class="code-keyword">DWORD</span> <span class="code-keyword">PTR</span> DS:[10139F0]
<span class="code-keyword">TEST</span> EAX,EAX
<span class="code-keyword">JNZ</span> <span class="code-keyword">SHORT</span> CALC.01011A71
</PRE></TD>
<TD rowSpan=2 valign=top><PRE lang=asm><span class="code-keyword">EAX</span> <span class="code-digit">00000000</span> 
<span class="code-keyword">ECX</span> 0007FFB0
EDX 7C90EB94 ntdll.KiFastSystemCallRet
EBX 7FFD8000
ESP 0007FFC4
EBP 0007FFF0
<span class="code-keyword">ESI</span> FFFFFFFF
<span class="code-keyword">EDI</span> 7C910738 ntdll.7C910738
EIP 010119E0 CALC.ModuleEntryPoint
C <span class="code-digit">0</span>  ES <span class="code-digit">0023</span> 32bit <span class="code-digit">0</span>(FFFFFFFF)
P <span class="code-digit">1</span>  CS 001B 32bit <span class="code-digit">0</span>(FFFFFFFF)
A <span class="code-digit">0</span>  SS <span class="code-digit">0023</span> 32bit <span class="code-digit">0</span>(FFFFFFFF)
Z <span class="code-digit">1</span>  <span class="code-keyword">DS</span> <span class="code-digit">0023</span> 32bit <span class="code-digit">0</span>(FFFFFFFF)
S <span class="code-digit">0</span>  FS 003B 32bit 7FFDF000(FFF)
T <span class="code-digit">0</span>  GS <span class="code-digit">0000</span> NULL
D <span class="code-digit">0</span>
O <span class="code-digit">0</span>  LastErr ERROR_ALREADY_EXISTS (000000B7)
EFL <span class="code-digit">00000246</span> (NO,NB,E,BE,NS,PE,GE,LE)
ST0 empty -UNORM BBB0 <span class="code-digit">01050104</span> <span class="code-digit">00000000</span>
ST1 empty <span class="code-digit">0</span>.<span class="code-digit">0</span>
ST2 empty <span class="code-digit">0</span>.<span class="code-digit">0</span>
ST3 empty <span class="code-digit">0</span>.<span class="code-digit">0</span>
ST4 empty <span class="code-digit">0</span>.<span class="code-digit">0</span>
ST5 empty <span class="code-digit">0</span>.<span class="code-digit">0</span>
ST6 empty <span class="code-digit">1</span>.<span class="code-digit">0000000000000000000</span>
ST7 empty <span class="code-digit">1</span>.<span class="code-digit">0000000000000000000</span> 
               <span class="code-digit">3</span> <span class="code-digit">2</span> <span class="code-digit">1</span> <span class="code-digit">0</span>      E S P U O Z D I
FST <span class="code-digit">4020</span>  Cond <span class="code-digit">1</span> <span class="code-digit">0</span> <span class="code-digit">0</span> <span class="code-digit">0</span>  Err <span class="code-digit">0</span> <span class="code-digit">0</span> <span class="code-digit">1</span> <span class="code-digit">0</span> <span class="code-digit">0</span> <span class="code-digit">0</span> <span class="code-digit">0</span> <span class="code-digit">0</span>
FCW 027F  Prec NEAR,53  Mask    <span class="code-digit">1</span> <span class="code-digit">1</span> <span class="code-digit">1</span> <span class="code-digit">1</span> <span class="code-digit">1</span> <span class="code-digit">1</span>
       
    
     
</PRE></TD></TR>
<TR>
<TD colspan=3>EBP=0007FFF0</TD></TR>
<TR>
<TD valign=top colSpan=3><PRE lang=text>01013000  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
01013010  01 00 00 00 20 00 00 00 0A 00 00 00 0A 00 00 00  ................
01013020  20 00 00 00 00 00 00 00 53 63 69 43 61 6C 63 00  ........SciCalc.
01013030  00 00 00 00 00 00 00 00 62 61 63 6B 67 72 6F 75  ........backgrou
01013040  6E 64 00 00 00 00 00 00 2E 00 00 00 00 00 00 00  nd..............
01013050  30 00 00 00 FF FF FF FF 01 00 00 00 00 00 00 00  0...     .......
01013060  00 00 57 00 58 00 56 01 5C 02 5D 02 07 03 59 03  ..W.X.V \ ]   Y 
01013070  5E 03 5A 03 5B 03 5F 04 00 00 00 00 FF FF FF FF    Z [ _ ....
01013080  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF                  
01013090  00 00 00 00 00 00 00 00 84 15 00 01 00 00 00 00  ........  . ....
010130A0  2E 4B 00 00 00 00 00 00 00 00 FF 00 50 00 00 00  .K........ .P...
010130B0  FF 00 00 00 51 00 00 00 FF 00 00 00 52 00 00 00   ...Q... ...R...
010130C0  FF 00 00 00 53 00 00 00 00 00 FF 00 54 00 00 00   ...S..... .T...
010130D0  00 00 FF 00 55 00 00 00 FF 00 00 00 56 00 00 00  .. .U... ...V...
010130E0  FF 00 00 00 57 00 00 00 FF 00 00 00 58 00 00 00   ...W... ...X...

</PRE></TD>
<TD valign=top><PRE lang=text>0007FFC4  7C816D4F  RETURN to kernel32.7C816D4F
0007FFC8  7C910738  ntdll.7C910738
0007FFCC  FFFFFFFF
0007FFD0  7FFD8000
0007FFD4  8054A6ED
0007FFD8  0007FFC8
0007FFDC  82574DA8
0007FFE0  FFFFFFFF  End of SEH chain
0007FFE4  7C8399F3  SE handler
0007FFE8  7C816D58  kernel32.7C816D58
0007FFEC  00000000
0007FFF0  00000000
0007FFF4  00000000
0007FFF8  010119E0  CALC.ModuleEntryPoint
0007FFFC  00000000

</PRE></TD></TR>
</TBODY>
</TABLE>-->
      <P><A title="Click to enlarge" 
      href="http://www.codeproject.com/KB/system/inject2exe/screenshot.jpg" 
      target=_blank><IMG height=542 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/screenshot_small.jpg" 
      width=600 border=0></A></P>
      <H3><A name=Whichpartsareimportantinadebuggerinterface3_1_3>3.1.3 Which 
      parts are important in a debugger interface?</A></H3>
      <P>I have introduced two debuggers without talking about how you can 
      employ them, and also which parts you should pay attention more. Regarding 
      using debuggers, I refer you to their instructions in help documents. 
      However, I want to explain shortly the important parts of a debugger; of 
      course, I am talking about low-level debuggers, or in other words, 
      machine-language debuggers of the x86 CPU families.</P>
      <P>All of low-level debuggers consist of the following subdivisions:</P>
      <OL>
        <LI>Registers viewer. 
        <P>
        <TABLE cellSpacing=0 cellPadding=0 width=280 border=1>
          <TBODY>
          <TR>
            <TD align=middle><FONT color=gray>EAX</FONT></TD></TR>
          <TR>
            <TD align=middle><FONT color=gray>ECX</FONT></TD></TR>
          <TR>
            <TD align=middle><FONT color=gray>EDX</FONT></TD></TR>
          <TR>
            <TD align=middle><FONT color=gray>EBX</FONT></TD></TR>
          <TR>
            <TD align=middle><FONT color=gray>ESP</FONT></TD></TR>
          <TR>
            <TD align=middle><FONT color=gray>EBP</FONT></TD></TR>
          <TR>
            <TD align=middle><FONT color=gray>ESI</FONT></TD></TR>
          <TR>
            <TD align=middle><FONT color=gray>EDI</FONT></TD></TR>
          <TR>
            <TD align=middle><FONT color=gray>EIP</FONT></TD></TR>
          <TR>
            <TD>
              <P align=center><FONT color=#808080>o</FONT><FONT color=gray> d t 
              s z a p c</FONT></P></TD></TR></TBODY></TABLE></P>
        <LI>Disassembler or Code viewer. 
        <P>
        <TABLE cellSpacing=0 cellPadding=0 width=560 border=1>
          <TBODY>
          <TR>
            <TD><PRE lang=asm>010119E0 <SPAN class=code-keyword>PUSH</SPAN> EBP
010119E1 <SPAN class=code-keyword>MOV</SPAN> EBP,ESP
010119E3 <SPAN class=code-keyword>PUSH</SPAN> -1
010119E5 <SPAN class=code-keyword>PUSH</SPAN> <SPAN class=code-digit>01001570</SPAN>
010119EA <SPAN class=code-keyword>PUSH</SPAN> 01011D60
010119EF <SPAN class=code-keyword>MOV</SPAN> EAX,DWORD <SPAN class=code-keyword>PTR</SPAN> FS:[<SPAN class=code-digit>0</SPAN>]
010119F5 <SPAN class=code-keyword>PUSH</SPAN> <SPAN class=code-keyword>EAX</SPAN>
010119F6 <SPAN class=code-keyword>MOV</SPAN> <SPAN class=code-keyword>DWORD</SPAN> <SPAN class=code-keyword>PTR</SPAN> FS:[<SPAN class=code-digit>0</SPAN>],ESP
010119FD <SPAN class=code-keyword>ADD</SPAN> ESP,-68
01011A00 <SPAN class=code-keyword>PUSH</SPAN> EBX
01011A01 <SPAN class=code-keyword>PUSH</SPAN> <SPAN class=code-keyword>ESI</SPAN>
01011A02 <SPAN class=code-keyword>PUSH</SPAN> <SPAN class=code-keyword>EDI</SPAN>
01011A03 <SPAN class=code-keyword>MOV</SPAN> <SPAN class=code-keyword>DWORD</SPAN> <SPAN class=code-keyword>PTR</SPAN> SS:[EBP-18],ESP
01011A06 <SPAN class=code-keyword>MOV</SPAN> <SPAN class=code-keyword>DWORD</SPAN> <SPAN class=code-keyword>PTR</SPAN> SS:[EBP-4],0 </PRE></TD></TR></TBODY></TABLE></P>
        <LI>Memory watcher. 
        <P>
        <TABLE cellSpacing=0 cellPadding=0 width=560 border=1>
          <TBODY>
          <TR>
            <TD><FONT color=gray>0023:01013000 00 00 00 00 00 00 00 00-00 00 
              00 00 00 00 00 00 ................<BR>0023:01013010 01 00 00 00 20 
              00 00 00-0A 00 00 00 0A 00 00 00 ................<BR>0023:01013020 
              20 00 00 00 00 00 00 00-53 63 69 43 61 6C 63 00 
              ........SciCalc.<BR>0023:01013030 00 00 00 00 00 00 00 00-62 61 63 
              6B 67 72 6F 75 ........backgrou<BR>0023:01013040 6E 64 00 00 00 00 
              00 00-2E 00 00 00 00 00 00 00 nd.............. 
          </FONT></TD></TR></TBODY></TABLE></P>
        <LI>Stack viewer. 
        <P>
        <TABLE cellSpacing=0 cellPadding=0 width=560 border=1>
          <TBODY>
          <TR>
            <TD><FONT color=gray>0010:0007FFC4 4F 6D 81 7C 38 07 91 7C-FF FF 
              FF FF 00 90 FD 7F Om |8 ‘| . <BR>0010:0007FFD4 ED A6 54 80 C8 FF 
              07 00-E8 B4 F5 81 FF FF FF FF T . <BR>0010:0007FFE4 F3 99 83 7C 58 
              6D 81 7C-00 00 00 00 00 00 00 00 Xm |........<BR>0010:0007FFF4 00 
              00 00 00 E0 19 01 01-00 00 00 00 00 00 00 00 .... .... 
          </FONT></TD></TR></TBODY></TABLE></P>
        <LI>Command line, command buttons, or shortcut keys to follow the 
        debugging process. 
        <P>
        <TABLE cellSpacing=0 cellPadding=0 width=560 border=1>
          <TBODY>
          <TR>
            <TD align=middle>Command</TD>
            <TD align=middle>SoftICE</TD>
            <TD align=middle>OllyDbg</TD></TR>
          <TR>
            <TD align=middle>Run</TD>
            <TD align=middle>F5</TD>
            <TD align=middle>F9</TD></TR>
          <TR>
            <TD align=middle>Step Into</TD>
            <TD align=middle>F11</TD>
            <TD align=middle>F7</TD></TR>
          <TR>
            <TD align=middle>Step Over</TD>
            <TD align=middle>F10</TD>
            <TD align=middle>F8</TD></TR>
          <TR>
            <TD align=middle>Set Break Point</TD>
            <TD align=middle>F8</TD>
            <TD align=middle>F2</TD></TR></TBODY></TABLE></P></LI></OL>
      <P>You can compare <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#Figure1">Figure 
      1</A> and <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#Figure2">Figure 
      2</A> to distinguish the difference between SoftICE and OllyDbg. When you 
      want to trace a PE file, you should mostly consider these five 
      subdivisions. Furthermore, every debugger comprises of some other useful 
      parts; you should discover them by yourself.</P>
      <H3><A name=Disassembler3_2>3.2 Disassembler</A></H3>
      <P>We can consider OllyDbg and SoftICE as excellent disassemblers, but I 
      also want to introduce another disassembler tool which is famous in the 
      reverse engineering world.</P>
      <H3><A name=Proviewdisassembler3_2_1>3.2.1 Proview disassembler</A></H3>
      <P><A 
      href="http://community.reverse-engineering.net/viewforum.php?f=50&amp;sid=a77c210bc1030dd395452bb7e1f67439" 
      target=_blank>Proview</A> or <A 
      href="http://pvdasm.reverse-engineering.net/" target=_blank>PVDasm</A> is 
      an admirable disassembler by the <A 
      href="http://community.reverse-engineering.net/" 
      target=_blank>Reverse-Engineering-Community</A>; it is still under 
      development and bug fixing. You can find its disassmbler source engine and 
      employ it to create your own disassembler.</P>
      <H3><A name=W32Dasm3_2_2>3.2.2 W32Dasm</A></H3>
      <P><A 
      href="http://www.softpedia.com/get/Programming/Debuggers-Decompilers-Dissasemblers/WDASM.shtml" 
      target=_blank>W32DASM</A> can disassemble both 16 and 32 bit executable 
      file formats. In addition to its disassembling ability, you can employ it 
      to analyze import, export and resource data directories data.</P>
      <H3><A name=IDAPro3_2_3>3.2.3 IDA Pro</A></H3>
      <P>All reverse-engineering experts know that <A 
      href="http://www.datarescue.com/idabase/idaproc.htm" target=_blank>IDA 
      Pro</A> can be used to investigate, not only x86 instructions, but that of 
      various kinds of CPU types like AVR, PIC, and etc. It can illustrate the 
      assembly source of a portable executable file by using colored graphics 
      and tables, and is very useful for any newbie in this area. Furthermore, 
      it has the capability to trace an executable file inside the user mode 
      level in the same way as OllyDbg.</P>
      <H3><A name=SomeUsefulTools3_3>3.3 Some Useful Tools</A></H3>
      <P>A good PE tools developer is conversant with the tools which save his 
      time, so I recommend to select some appropriate instruments to investigate 
      the base information under a portable executable file.</P>
      <H3><A name=LordPEs3_3_1>3.3.1 LordPE</A></H3>
      <P><A 
      href="http://www.softpedia.com/get/Programming/File-Editors/LordPE.shtml" 
      target=_blank>LordPE</A> by <A 
      href="http://scifi.pages.at/yoda9k/aboutme.htm" target=_blank>y0da</A> is 
      still the first choice to retrieve PE file information with the 
      possibility to modify them.</P>
      <P><IMG height=206 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/lordpe.gif" 
      width=441></P>
      <H3><A name=PEiD3_3_2>3.3.2 PEiD</A></H3>
      <P><A href="http://peid.has.it/" target=_blank>PE iDentifier </A>is 
      valuable to identify the type of compilers, packers, and cryptors of PE 
      files. As of now, it can detect more than 500 different signature types of 
      PE files.</P>
      <P><IMG height=166 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/peid.gif" 
      width=296></P>
      <H3><A name=ResourceHacker3_3_3>3.3.3 Resource Hacker</A></H3>
      <P><A href="http://www.angusj.com/resourcehacker/" target=_blank>Resource 
      Hacker </A>can be employed to modify resource directory information; icon, 
      menu, version info, string table, and etc.</P>
      <P><IMG height=141 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/resourcehacker.gif" 
      width=191></P>
      <H3><A name=WinHex3_3_4>3.3.4 WinHex</A></H3>
      <P><A href="http://www.winhex.com/winhex/index-m.html" 
      target=_blank>WinHex</A>, it is clear what you can do with this tool.</P>
      <P><IMG height=230 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/winhex.gif" 
      width=329></P>
      <H3><A name=CFFExplorer3_3_5>3.3.5 CFF Explorer</A></H3>
      <P>Eventually, <A href="http://www.pmode.net/CFF.php" target=_blank>CFF 
      Explorer </A>by <A href="http://www.pmode.net/USERS/116/UserInfo.xml" 
      target=_blank>Ntoskrnl </A>is what you wish to have as a PE Utility tool 
      in your dream; it supports PE32/64, PE rebuild included <A 
      href="http://en.wikipedia.org/wiki/Common_Language_Infrastructure" 
      target=_blank>Common Language Infrastructure (CLI)</A> file, in other 
      words, the <A href="http://en.wikipedia.org/wiki/Microsoft_.NET" 
      target=_blank>.NET file</A>, a resource modifier, and much more facilities 
      which can not be found in others, just try and discover every unimaginable 
      option by hand.</P>
      <P><IMG height=217 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/cffexplorer.gif" 
      width=301></P>
      <H2><A name=AddnewsectionandChangeOEP4>4 Add new section and Change 
      OEP</A></H2>
      <P>We are ready to do the first step of making our project. So I have 
      provided a library to add a new section and rebuild the portable 
      executable file. Before starting, I like you get familiar with the headers 
      of a PE file, by using <A href="http://www.ollydbg.de/" 
      target=_blank>OllyDbg</A>. You should first open a PE file, that pops up a 
      menu, <B>View-&gt;Executable file</B>, again get a popup menu 
      <B>Special-&gt;PE header</B>. And you will observe a scene similar to <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#Figure3">Figure 
      3</A>. Now, come to Main Menu <B>View-&gt;Memory</B>, try to distinguish 
      the sections inside the <B>Memory map</B> window.</P>
      <H4><A name=Figure3>Figure 3</A></H4>
      <TABLE cellSpacing=0 cellPadding=0 border=1>
        <TBODY>
        <TR>
          <TD><FONT color=gray><PRE lang=text>00000000
00000002
00000004
00000006
00000008
0000000A
0000000C
0000000E
00000010
00000012
00000014
00000016
00000018
0000001A
0000001C
0000001D
0000001E
0000001F
00000020
00000021
00000022
00000023
00000024
00000025
00000026
00000027
00000028
00000029
0000002A
0000002B
0000002C
0000002D
0000002E
0000002F
00000030
00000031
00000032
00000033
00000034
00000035
00000036
00000037
00000038
00000039
0000003A
0000003B
0000003C
</PRE></FONT></TD>
          <TD><PRE lang=text> 4D 5A
 9000
 0300
 0000
 0400
 0000
 FFFF
 0000
 B800
 0000
 0000
 0000
 4000
 0000
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 00
 F0000000  
</PRE></TD>
          <TD><PRE lang=text> ASCII "MZ"
 DW 0090
 DW 0003
 DW 0000
 DW 0004
 DW 0000
 DW FFFF
 DW 0000
 DW 00B8
 DW 0000
 DW 0000
 DW 0000
 DW 0040
 DW 0000
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DB 00
 DD 000000F0 
</PRE></TD>
          <TD><PRE lang=text> DOS EXE Signature
 DOS_PartPag = 90 (144.)
 DOS_PageCnt = 3
 DOS_ReloCnt = 0
 DOS_HdrSize = 4
 DOS_MinMem = 0
 DOS_MaxMem = FFFF (65535.)
 DOS_ReloSS = 0
 DOS_ExeSP = B8
 DOS_ChkSum = 0
 DOS_ExeIP = 0
 DOS_ReloCS = 0
 DOS_TablOff = 40
 DOS_Overlay = 0
































 Offset to PE signature</PRE></TD></TR></TBODY></TABLE>
      <P>I want to explain how we can plainly change the Offset of Entry Point 
      (OEP) in our <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#CalcEXE1TestDownloadLink">sample 
      file</A>, <I>CALC.EXE</I> of Windows XP. First, by using a PE Tool, and 
      also using our PE Viewer, we find OEP, <CODE>0x00012475</CODE>, and Image 
      Base, <CODE>0x01000000</CODE>. This value of OEP is the Relative Virtual 
      Address, so the Image Base value is used to convert it to the Virtual 
      Address.</P>
      <TABLE cellSpacing=0 cellPadding=0 width=450 border=1>
        <TBODY>
        <TR>
          <TD>
            <P><B>Virtual_Address = Image_Base + 
          Relative_Virtual_Address</B></P></TD></TR></TBODY></TABLE><PRE lang=c++>DWORD OEP_RVA = image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>OptionalHeader.AddressOfEntryPoint ; 
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment> OEP_RVA = 0x00012475
</SPAN>DWORD OEP_VA = image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>OptionalHeader.ImageBase + OEP_RVA ; 
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment> OEP_VA = 0x01000000 + 0x00012475 = 0x01012475</SPAN></PRE>
      <H4><A name=PEMakerDownloadLink1>PE Maker - Step 1</A></H4>
      <UL class=download>
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe/pemaker1.zip" 
        target=_blank>Download source files - 54.7 Kb</A> </LI></UL>
      <H4><A name=CalcEXE1TestDownloadLink>CALC.EXE - test file</A></H4>
      <UL class=download>
        <LI><A href="http://www.codeproject.com/KB/system/inject2exe/test1.zip" 
        target=_blank>Download test PE file - 49.5 Kb</A> </LI></UL>
      <P><CODE>DynLoader()</CODE>, in <I>loader.cpp</I>, is reserved for the 
      data of the new section, in other words, the <B>Loader</B>.</P>
      <H4><A name=DynLoaderStep1>DynLoader Step 1</A></H4><PRE lang=c++><SPAN class=code-keyword>__stdcall</SPAN> <SPAN class=code-keyword>void</SPAN> DynLoader()
{
_asm
{
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>    DWORD_TYPE(DYN_LOADER_START_MAGIC)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>    MOV EAX,01012475h <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> &lt;&lt; Original OEP
</SPAN>    JMP EAX
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>    DWORD_TYPE(DYN_LOADER_END_MAGIC)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>}
}
</PRE>
      <P>Unfortunately, this source can only be applied for the <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#CalcEXE1TestDownloadLink">sample 
      test file</A>. We should complete it by saving the value of the original 
      OEP in the new section, and use it to reach the real OEP. I have 
      accomplished it in Step 2 (Section 5).</P>
      <H3><A name=RetrieveandRebuildPEfile4_1>4.1 Retrieve and Rebuild PE 
      file</A></H3>
      <P>I have made a simple class library to recover PE information and to use 
      it in a new PE file.</P>
      <H4><A name=CPELibraryClass1>CPELibrary Class Step 1</A></H4><PRE lang=c++><SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------------------------------------
</SPAN><SPAN class=code-keyword>class</SPAN> CPELibrary 
{
<SPAN class=code-keyword>private</SPAN>:
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN>    PCHAR                   pMem;
    DWORD                   dwFileSize;
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN><SPAN class=code-keyword>protected</SPAN>:
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN>    PIMAGE_DOS_HEADER       image_dos_header;
    PCHAR                   pDosStub;
    DWORD                   dwDosStubSize, dwDosStubOffset;
    PIMAGE_NT_HEADERS       image_nt_headers;
    PIMAGE_SECTION_HEADER   image_section_header[MAX_SECTION_NUM];
    PCHAR                   image_section[MAX_SECTION_NUM];
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN><SPAN class=code-keyword>protected</SPAN>:
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN>    DWORD PEAlign(DWORD dwTarNum,DWORD dwAlignTo);
    <SPAN class=code-keyword>void</SPAN> AlignmentSections();
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN>    DWORD Offset2RVA(DWORD dwRO);
    DWORD RVA2Offset(DWORD dwRVA);
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN>    PIMAGE_SECTION_HEADER ImageRVA2Section(DWORD dwRVA);
    PIMAGE_SECTION_HEADER ImageOffset2Section(DWORD dwRO);
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN>    DWORD ImageOffset2SectionNum(DWORD dwRVA);
    PIMAGE_SECTION_HEADER AddNewSection(<SPAN class=code-keyword>char</SPAN>* szName,DWORD dwSize);
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN><SPAN class=code-keyword>public</SPAN>:
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN>    CPELibrary();
    ~CPELibrary();
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN>    <SPAN class=code-keyword>void</SPAN> OpenFile(<SPAN class=code-keyword>char</SPAN>* FileName);
    <SPAN class=code-keyword>void</SPAN> SaveFile(<SPAN class=code-keyword>char</SPAN>* FileName);    
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN>};</PRE>
      <P>By <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#Table1">Table 
      1</A>, the usage of <CODE>image_dos_header</CODE>, <CODE>pDosStub</CODE>, 
      <CODE>image_nt_headers</CODE>, <CODE>image_section_header</CODE> 
      [<CODE>MAX_SECTION_NUM</CODE>], and 
      <CODE>image_section</CODE>[<CODE>MAX_SECTION_NUM</CODE>] is clear. We use 
      <CODE>OpenFile()</CODE> and <CODE>SaveFile()</CODE> to retrieve and 
      rebuild a PE file. Furthermore, <CODE>AddNewSection()</CODE> is employed 
      to create the new section, the important step.</P>
      <H3><A name=CreateDatafornewSection4_2>4.2 Create Data for new 
      Section</A></H3>
      <P>In <I>pecrypt.cpp</I>, I have represented another class, 
      <CODE>CPECryptor</CODE>, to comprise the data of the new section. 
      Nevertheless, the data of the new section is created by 
      <CODE>DynLoader()</CODE> in <I>loader.cpp</I>, <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#DynLoaderStep1">DynLoader 
      Step 1</A>. We use the <CODE>CPECryptor</CODE> class to enter this data in 
      to the new section, and also some other stuff.</P>
      <H4><A name=CPECryptorClass1>CPECryptor Class Step 1</A></H4><PRE lang=c++><SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------------------------------------
</SPAN><SPAN class=code-keyword>class</SPAN> CPECryptor: <SPAN class=code-keyword>public</SPAN> CPELibrary
{
<SPAN class=code-keyword>private</SPAN>:
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------------
</SPAN>    PCHAR pNewSection;
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------------
</SPAN>    DWORD GetFunctionVA(<SPAN class=code-keyword>void</SPAN>* FuncName);
    <SPAN class=code-keyword>void</SPAN>* ReturnToBytePtr(<SPAN class=code-keyword>void</SPAN>* FuncName, DWORD findstr);
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------------
</SPAN><SPAN class=code-keyword>protected</SPAN>:
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------------
</SPAN><SPAN class=code-keyword>public</SPAN>:    
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------------
</SPAN>    <SPAN class=code-keyword>void</SPAN> CryptFile(<SPAN class=code-keyword>int</SPAN>(<SPAN class=code-keyword>__cdecl</SPAN> *callback) (<SPAN class=code-keyword>unsigned</SPAN> <SPAN class=code-keyword>int</SPAN>, <SPAN class=code-keyword>unsigned</SPAN> <SPAN class=code-keyword>int</SPAN>));
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------------
</SPAN>};
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------------------------------------</SPAN></PRE>
      <H3><A name=SomenotesregardingcreatenewPEfile4_3>4.3 Some notes regarding 
      creating a new PE file</A></H3>
      <UL>
        <LI>Align the <CODE>VirtualAddress</CODE> and the 
        <CODE>VirtualSize</CODE> of each section by 
        <CODE>SectionAlignment</CODE>: <PRE lang=c++>image_section_header[i]-<SPAN class=code-keyword>&gt;</SPAN>VirtualAddress=
    PEAlign(image_section_header[i]-<SPAN class=code-keyword>&gt;</SPAN>VirtualAddress,
    image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>OptionalHeader.SectionAlignment);

image_section_header[i]-<SPAN class=code-keyword>&gt;</SPAN>Misc.VirtualSize=
    PEAlign(image_section_header[i]-<SPAN class=code-keyword>&gt;</SPAN>Misc.VirtualSize,
    image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>OptionalHeader.SectionAlignment);</PRE>
        <LI>Align the <CODE>PointerToRawData</CODE> and the 
        <CODE>SizeOfRawData</CODE> of each section by 
        <CODE>FileAlignment</CODE>: <PRE lang=c++>image_section_header[i]-<SPAN class=code-keyword>&gt;</SPAN>PointerToRawData =
    PEAlign(image_section_header[i]-<SPAN class=code-keyword>&gt;</SPAN>PointerToRawData,
            image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>OptionalHeader.FileAlignment);

image_section_header[i]-<SPAN class=code-keyword>&gt;</SPAN>SizeOfRawData =
    PEAlign(image_section_header[i]-<SPAN class=code-keyword>&gt;</SPAN>SizeOfRawData,
            image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>OptionalHeader.FileAlignment);</PRE>
        <LI>Correct the <CODE>SizeofImage</CODE> by the virtual size and the 
        virtual address of the last section: <PRE lang=c++>image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>OptionalHeader.SizeOfImage = 
          image_section_header[LastSection]-<SPAN class=code-keyword>&gt;</SPAN>VirtualAddress +
          image_section_header[LastSection]-<SPAN class=code-keyword>&gt;</SPAN>Misc.VirtualSize;</PRE>
        <LI>Set the Bound Import Directory header to zero, as this directory is 
        not very important to execute a PE file: <PRE lang=c++>image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>
  OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT].
  VirtualAddress = <SPAN class=code-digit>0</SPAN>;
image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>
  OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT].Size = <SPAN class=code-digit>0</SPAN>;</PRE></LI></UL>
      <H3><A name=SomenotesregardinglinkthisVCProject4_4>4.4 Some notes 
      regarding linking this VC Project</A></H3>
      <UL>
        <LI>Set <I>Linker-&gt;General-&gt;Enable Incremental Linking</I> to 
        <B>No (/INCREMENTAL:NO)</B>. 
        <P><IMG height=130 
        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/linktip1.gif" 
        width=520></P>
        <P>You can comprehend the difference between incremental link and 
        no-incremental link by looking at the following picture:</P>
        <P><IMG height=130 
        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/incremental_link.gif" 
        width=415></P>
        <P>To acquire the virtual address of <CODE>DynLoader()</CODE>, we obtain 
        the virtual address of <CODE lang=asm><SPAN 
        class=code-keyword>JMP</SPAN> pemaker.DynLoader</CODE> in the 
        incremental link, but by no-incremental link, the real virtual address 
        is gained by the following code:</P><PRE lang=c++>DWORD dwVA= (DWORD) DynLoader;</PRE>
        <P>This setting is more critical in the incremental link when you try to 
        find the beginning and ending of the <B>Loader</B>, 
        <CODE>DynLoader()</CODE>, by 
        <CODE>CPECryptor::ReturnToBytePtr()</CODE>:</P><PRE lang=c++><SPAN class=code-keyword>void</SPAN>* CPECryptor::ReturnToBytePtr(<SPAN class=code-keyword>void</SPAN>* FuncName, DWORD findstr)
{
    <SPAN class=code-keyword>void</SPAN>* tmpd;
    <SPAN class=code-keyword>__asm</SPAN>
   {
        mov eax, FuncName
        jmp df
hjg:    inc eax
df:     mov ebx, [eax]
        cmp ebx, findstr
        jnz hjg
        mov tmpd, eax
    }
    <SPAN class=code-keyword>return</SPAN> tmpd;
}</PRE></LI></UL>
      <H2><A name=StoreImportantDataandReachtoOriginalOEP5>5 Store Important 
      Data and Reach Original OEP</A></H2>
      <P>Right now, we save the Original OEP and also the Image Base in order to 
      reach to the virtual address of OEP. I have reserved a free space at the 
      end of <CODE>DynLoader()</CODE> to store them, <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#DynLoaderStep2">DynLoader 
      Step 2</A>.</P>
      <H4><A name=PEMakerDownloadLink2>PE Maker - Step 2</A></H4>
      <UL class=download>
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe/pemaker2.zip">Download 
        source files - 58.3 Kb</A> </LI></UL>
      <H4><A name=DynLoaderStep2>DynLoader Step 2</A></H4><PRE lang=c++><SPAN class=code-keyword>__stdcall</SPAN> <SPAN class=code-keyword>void</SPAN> DynLoader()
{
_asm
{
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>    DWORD_TYPE(DYN_LOADER_START_MAGIC)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>Main_0:
    PUSHAD
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> get base ebp
</SPAN>    CALL Main_1
Main_1:    
    POP EBP
    SUB EBP,OFFSET Main_1
    MOV EAX,DWORD PTR [EBP+_RO_dwImageBase]
    ADD EAX,DWORD PTR [EBP+_RO_dwOrgEntryPoint]
    PUSH EAX
    RETN <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> &gt;&gt; JMP to Original OEP
</SPAN><SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>    DWORD_TYPE(DYN_LOADER_START_DATA1)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>_RO_dwImageBase:                DWORD_TYPE(0xCCCCCCCC)
_RO_dwOrgEntryPoint:            DWORD_TYPE(0xCCCCCCCC)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>    DWORD_TYPE(DYN_LOADER_END_MAGIC)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>}
}</PRE>
      <P>The new function, <CODE>CPECryptor::CopyData1()</CODE>, will implement 
      the copy of the Image Base value and the Offset of Entry Point value into 
      8 bytes of free space in the loader.</P>
      <H3><A name=RestorethefirstRegistersContext5_1>5.1 Restore the first 
      Registers Context</A></H3>
      <P>It is important to recover the Original Context of the thread. We have 
      not yet done it in the <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#DynLoaderStep2">DynLoader 
      Step 2</A> source code. We can modify the source of 
      <CODE>DynLoader()</CODE> to repossess the first Context.</P><PRE lang=c++><SPAN class=code-keyword>__stdcall</SPAN> <SPAN class=code-keyword>void</SPAN> DynLoader()
{
_asm
{
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>    DWORD_TYPE(DYN_LOADER_START_MAGIC)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>Main_0:
    PUSHAD<SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Save the registers context in stack
</SPAN>    CALL Main_1
Main_1:    
    POP EBP<SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Get Base EBP
</SPAN>    SUB EBP,OFFSET Main_1
    MOV EAX,DWORD PTR [EBP+_RO_dwImageBase]
    ADD EAX,DWORD PTR [EBP+_RO_dwOrgEntryPoint]
    MOV DWORD PTR [ESP+1Ch],EAX <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> pStack.Eax &lt;- EAX
</SPAN>    POPAD <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Restore the first registers context from stack
</SPAN>    PUSH EAX
    XOR  EAX, EAX
    RETN <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> &gt;&gt; JMP to Original OEP
</SPAN><SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>    DWORD_TYPE(DYN_LOADER_START_DATA1)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>_RO_dwImageBase:                DWORD_TYPE(0xCCCCCCCC)
_RO_dwOrgEntryPoint:            DWORD_TYPE(0xCCCCCCCC)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>    DWORD_TYPE(DYN_LOADER_END_MAGIC)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>}
}</PRE>
      <H3><A name=RestoretheOriginalStack5_2>5.2 Restore the Original 
      Stack</A></H3>
      <P>We can also recover the original stack by setting the value of the 
      beginning stack + <CODE>0x34</CODE> to the Original OEP, but it is not 
      very important. Nevertheless, in the following code, I have accomplished 
      the loader code by a simple trick to reach OEP in addition to redecorating 
      the stack. You can observe the implementation by tracing using <A 
      href="http://www.ollydbg.de/" target=_blank>OllyDbg</A> or SoftICE.</P><PRE lang=c++><SPAN class=code-keyword>__stdcall</SPAN> <SPAN class=code-keyword>void</SPAN> DynLoader()
{
_asm
{
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>    DWORD_TYPE(DYN_LOADER_START_MAGIC)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>Main_0:
    PUSHAD <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Save the registers context in stack
</SPAN>    CALL Main_1
Main_1:    
    POP EBP
    SUB EBP,OFFSET Main_1
    MOV EAX,DWORD PTR [EBP+_RO_dwImageBase]
    ADD EAX,DWORD PTR [EBP+_RO_dwOrgEntryPoint]
    MOV DWORD PTR [ESP+54h],EAX <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> pStack.Eip &lt;- EAX
</SPAN>    POPAD <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Restore the first registers context from stack
</SPAN>    CALL _OEP_Jump
    DWORD_TYPE(0xCCCCCCCC)
_OEP_Jump:
    PUSH EBP
    MOV EBP,ESP
    MOV EAX,DWORD PTR [ESP+3Ch] <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> EAX &lt;- pStack.Eip
</SPAN>    MOV DWORD PTR [ESP+4h],EAX  <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> _OEP_Jump RETURN pointer &lt;- EAX
</SPAN>    XOR EAX,EAX
    LEAVE
    RETN
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>    DWORD_TYPE(DYN_LOADER_START_DATA1)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>_RO_dwImageBase:                DWORD_TYPE(0xCCCCCCCC)
_RO_dwOrgEntryPoint:            DWORD_TYPE(0xCCCCCCCC)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>    DWORD_TYPE(DYN_LOADER_END_MAGIC)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>}
}
</PRE>
      <H3><A name=ApproachOEPbyStructuredExceptionHandlin5_3>5.3 Approach OEP by 
      Structured Exception Handling</A></H3>
      <P>An exception is generated when a program falls into a fault code 
      execution and an error happens, so in such a special condition, the 
      program immediately jumps to a function called the exception handler from 
      exception handler list of the <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#ThreadInformationBlock">Thread 
      Information Block</A>.</P>
      <P>The next example of a <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/vccelng/htm/key_s-z_4.asp" 
      target=_blank><CODE><SPAN 
      class=code-keyword>try</SPAN></CODE>-<CODE>except</CODE> statement</A> in 
      C++ clarifies the operation of <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/about_structured_exception_handling.asp" 
      target=_blank>structured exception handling</A>. Besides the assembly code 
      of this code, it elucidates the structured exception handler installation, 
      the raise of an exception, and the exception handler function.</P><PRE lang=c++><SPAN class=code-preprocessor>#include</SPAN><SPAN class=code-preprocessor> <SPAN class=code-string>"</SPAN><SPAN class=code-string>stdafx.h"</SPAN>
</SPAN><SPAN class=code-preprocessor>#include</SPAN><SPAN class=code-preprocessor> <SPAN class=code-string>"</SPAN><SPAN class=code-string>windows.h"</SPAN>
</SPAN>
<SPAN class=code-keyword>void</SPAN> RAISE_AN_EXCEPTION()
{    
_asm
{
    INT <SPAN class=code-digit>3</SPAN>
    INT <SPAN class=code-digit>3</SPAN>
    INT <SPAN class=code-digit>3</SPAN>
    INT <SPAN class=code-digit>3</SPAN>
}
}

<SPAN class=code-keyword>int</SPAN> _tmain(<SPAN class=code-keyword>int</SPAN> argc, _TCHAR* argv[])
{
    <SPAN class=code-keyword>__try</SPAN>
    {
        <SPAN class=code-keyword>__try</SPAN>{
            printf(<SPAN class=code-string>"</SPAN><SPAN class=code-string>1: Raise an Exception\n"</SPAN>);
            RAISE_AN_EXCEPTION();
        }
        <SPAN class=code-keyword>__finally</SPAN>
        {
            printf(<SPAN class=code-string>"</SPAN><SPAN class=code-string>2: In Finally\n"</SPAN>);
        }
    }
    <SPAN class=code-keyword>__except</SPAN>( printf(<SPAN class=code-string>"</SPAN><SPAN class=code-string>3: In Filter\n"</SPAN>), EXCEPTION_EXECUTE_HANDLER )
    {
        printf(<SPAN class=code-string>"</SPAN><SPAN class=code-string>4: In Exception Handler\n"</SPAN>);
    }
    <SPAN class=code-keyword>return</SPAN> <SPAN class=code-digit>0</SPAN>;
}</PRE><PRE lang=text><B>; main()</B>
00401000: PUSH EBP
00401001: MOV EBP,ESP
00401003: PUSH -1
00401005: PUSH 00407160
<B>; __try {</B>
; the structured exception handler (SEH) installation 
0040100A: PUSH _except_handler3  
0040100F: MOV EAX,DWORD PTR FS:[0]
00401015: PUSH EAX
00401016: MOV DWORD PTR FS:[0],ESP
0040101D: SUB ESP,8
00401020: PUSH EBX
00401021: PUSH ESI
00401022: PUSH EDI
00401023: MOV DWORD PTR SS:[EBP-18],ESP
<B>;     __try {</B>
00401026: XOR ESI,ESI
00401028: MOV DWORD PTR SS:[EBP-4],ESI
0040102B: MOV DWORD PTR SS:[EBP-4],1
00401032: PUSH OFFSET "1: Raise an Exception"
00401037: CALL printf
0040103C: ADD ESP,4
; the raise a exception, INT 3 exception
; RAISE_AN_EXCEPTION()
0040103F: INT3      
00401040: INT3
00401041: INT3
00401042: INT3
<B>;     } __finally {</B>
00401043: MOV DWORD PTR SS:[EBP-4],ESI
00401046: CALL 0040104D
0040104B: JMP 00401080
0040104D: PUSH OFFSET "2: In Finally"
00401052: CALL printf
00401057: ADD ESP,4
0040105A: RETN
<B>;     }</B>
<B>; }</B>
<B>; __except( </B>
0040105B: JMP 00401080
0040105D: PUSH OFFSET "3: In Filter"
00401062: CALL printf
00401067: ADD ESP,4
0040106A: MOV EAX,1 ; EXCEPTION_EXECUTE_HANDLER = 1
0040106F: RETN
<B>;     , EXCEPTION_EXECUTE_HANDLER )</B>
<B>; {</B>
; the exception handler funtion
00401070: MOV ESP,DWORD PTR SS:[EBP-18]
00401073: PUSH OFFSET "4: In Exception Handler"
00401078: CALL printf
0040107D: ADD ESP,4
<B>; }</B>
00401080: MOV DWORD PTR SS:[EBP-4],-1
0040108C: XOR EAX,EAX
; restore previous SEH
0040108E: MOV ECX,DWORD PTR SS:[EBP-10]
00401091: MOV DWORD PTR FS:[0],ECX
00401098: POP EDI
00401099: POP ESI
0040109A: POP EBX
0040109B: MOV ESP,EBP
0040109D: POP EBP
0040109E: RETN</PRE>
      <P>Make a Win32 console project, and link and run the preceding C++ code, 
      to perceive the result:</P>
      <TABLE cellSpacing=0 cellPadding=0 width=400 border=1>
        <TBODY bgColor=black color="gray">
        <TR>
          <TD><FONT color=white><B>1: Raise an Exception<BR>3: In Filter<BR>2: 
            In Finally<BR>4: In Exception 
          Handler<BR>_<BR><BR><BR><BR></B></FONT></TD></TR></TBODY></TABLE>
      <P>This program runs the exception expression, <CODE>printf(<SPAN 
      class=code-string>"</SPAN><SPAN class=code-string>3: In 
      Filter\n"</SPAN>);</CODE>, when an exception happens, in this example the 
      <CODE>INT <SPAN class=code-digit>3</SPAN></CODE> exception. You can employ 
      other kinds of exception too. In <A href="http://www.ollydbg.de/" 
      target=_blank>OllyDbg</A>, <B>Debugging options-&gt;Exceptions</B>, you 
      can see a short list of different types of exceptions.</P>
      <P><IMG height=200 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/ollydbg_exceptions.gif" 
      width=280></P>
      <H3><A name=ImplementExceptionHandler5_3_1>5.3.1 Implement Exception 
      Handler</A></H3>
      <P>We desire to construct a structured exception handler in order to reach 
      OEP. Now, I think you have distinguished the SEH installation, the 
      exception raise, and the exception expression filter, by foregoing the 
      assembly code. To establish our exception handler approach, we need to 
      comprise the following codes:</P>
      <UL>
        <LI><B>SEH installation</B>: <PRE lang=asm>    <SPAN class=code-keyword>LEA</SPAN> EAX,[EBP+_except_handler1_OEP_Jump]
    <SPAN class=code-keyword>PUSH</SPAN> <SPAN class=code-keyword>EAX</SPAN>
    <SPAN class=code-keyword>PUSH</SPAN> <SPAN class=code-keyword>DWORD</SPAN> <SPAN class=code-keyword>PTR</SPAN> FS:[<SPAN class=code-digit>0</SPAN>]
    <SPAN class=code-keyword>MOV</SPAN> <SPAN class=code-keyword>DWORD</SPAN> <SPAN class=code-keyword>PTR</SPAN> FS:[<SPAN class=code-digit>0</SPAN>],ESP</PRE>
        <LI><B>An Exception Raise</B>: <PRE lang=text>    INT 3</PRE>
        <LI><B>Exception handler expression filter</B>: <PRE lang=asm>_except_handler1_OEP_Jump:
    <SPAN class=code-keyword>PUSH</SPAN> EBP
    <SPAN class=code-keyword>MOV</SPAN> EBP,ESP
    ...
    <SPAN class=code-keyword>MOV</SPAN> EAX, EXCEPTION_CONTINUE_SEARCH // EXCEPTION_CONTINUE_SEARCH = <SPAN class=code-digit>0</SPAN>
    LEAVE
    RETN</PRE></LI></UL>
      <P>So we yearn for making the ensuing C++ code in assembly language to 
      inaugurate our engine to approach the Offset of Entry Point by SEH.</P><PRE lang=c++><SPAN class=code-keyword>__try</SPAN> <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> SEH installation
</SPAN>{
    <SPAN class=code-keyword>__asm</SPAN> 
    {
        INT <SPAN class=code-digit>3</SPAN> <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> An Exception Raise
</SPAN>    }
}
<SPAN class=code-keyword>__except</SPAN>( ..., EXCEPTION_CONTINUE_SEARCH ){}
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Exception handler expression filter</SPAN></PRE>
      <P>In assembly code...</P><PRE lang=asm>    <SPAN class=code-comment>;</SPAN><SPAN class=code-comment> ----------------------------------------------------
</SPAN>    <SPAN class=code-comment>;</SPAN><SPAN class=code-comment> the structured exception handler (SEH) installation
</SPAN>    <B><SPAN class=code-comment>;</SPAN><SPAN class=code-comment> __try {</B>
</SPAN>    <SPAN class=code-keyword>LEA</SPAN> EAX,[EBP+_except_handler1_OEP_Jump]
    <SPAN class=code-keyword>PUSH</SPAN> <SPAN class=code-keyword>EAX</SPAN>
    <SPAN class=code-keyword>PUSH</SPAN> <SPAN class=code-keyword>DWORD</SPAN> <SPAN class=code-keyword>PTR</SPAN> FS:[<SPAN class=code-digit>0</SPAN>]
    <SPAN class=code-keyword>MOV</SPAN> <SPAN class=code-keyword>DWORD</SPAN> <SPAN class=code-keyword>PTR</SPAN> FS:[<SPAN class=code-digit>0</SPAN>],ESP
    <SPAN class=code-comment>;</SPAN><SPAN class=code-comment> ----------------------------------------------------
</SPAN>    <SPAN class=code-comment>;</SPAN><SPAN class=code-comment> the raise a INT 3 exception
</SPAN>    INT <SPAN class=code-digit>3</SPAN>
    INT <SPAN class=code-digit>3</SPAN>
    INT <SPAN class=code-digit>3</SPAN>
    INT <SPAN class=code-digit>3</SPAN>
    <B><SPAN class=code-comment>;</SPAN><SPAN class=code-comment> }
</SPAN>    <SPAN class=code-comment>;</SPAN><SPAN class=code-comment> __except( ... </B>
</SPAN>    <SPAN class=code-comment>;</SPAN><SPAN class=code-comment> ----------------------------------------------------
</SPAN>    <SPAN class=code-comment>;</SPAN><SPAN class=code-comment> exception handler expression filter
</SPAN>_except_handler1_OEP_Jump:
    <SPAN class=code-keyword>PUSH</SPAN> EBP
    <SPAN class=code-keyword>MOV</SPAN> EBP,ESP
    ... 
    <SPAN class=code-keyword>MOV</SPAN> EAX, EXCEPTION_CONTINUE_SEARCH <SPAN class=code-comment>;</SPAN><SPAN class=code-comment> EXCEPTION_CONTINUE_SEARCH = 0
</SPAN>    LEAVE
    RETN
    <B><SPAN class=code-comment>;</SPAN><SPAN class=code-comment> , EXCEPTION_CONTINUE_SEARCH ) { }</B></SPAN></PRE>
      <P>The exception value, <CODE><SPAN 
      class=code-keyword>__except</SPAN>(..., Value)</CODE>, determines how the 
      exception is handled, it can have three values, 1, 0, -1. To understand 
      them, refer to the <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/vccelng/htm/key_s-z_4.asp" 
      target=_blank><CODE><SPAN 
      class=code-keyword>try</SPAN></CODE>-<CODE>except</CODE> statement</A> 
      description in the MSDN library. We set it to 
      <CODE>EXCEPTION_CONTINUE_SEARCH (<SPAN class=code-digit>0</SPAN>)</CODE>, 
      not to run the exception handler function, therefore by this value, the 
      exception is not recognized, is simply ignored, and the thread continues 
      its code-execution.</P>
      <H4>How the SEH installation is implemented</H4>
      <P>As you perceived from the illustrated code, the SEH installation is 
      done by the FS segment register. Microsoft Windows 32 bit uses the FS 
      segment register as a pointer to the data block of the main thread. The 
      first <FONT color=blue>0x1C</FONT> bytes comprise the information of the 
      <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#ThreadInformationBlock">Thread 
      Information Block (TIB)</A>. Therefore, <CODE lang=asm>FS:[00h]</CODE> 
      refers to <CODE>ExceptionList</CODE> of the main thread, <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#Table3">Table 
      3</A>. In our code, we have pushed the pointer to 
      <CODE>_except_handler1_OEP_Jump</CODE> in the stack and changed the value 
      of <CODE>ExceptionList</CODE>, <CODE lang=asm>FS:[00h]</CODE>, to the 
      beginning of the stack, <CODE lang=asm>ESP</CODE>.</P>
      <H4><A name=ThreadInformationBlock>Thread Information Block (TIB)</A></H4><PRE lang=c++><SPAN class=code-keyword>typedef</SPAN> <SPAN class=code-keyword>struct</SPAN> _NT_TIB32 {
    DWORD ExceptionList;
    DWORD StackBase;
    DWORD StackLimit;
    DWORD SubSystemTib;
    <SPAN class=code-keyword>union</SPAN> {
        DWORD FiberData;
        DWORD Version;
    };
    DWORD ArbitraryUserPointer;
    DWORD Self;
} NT_TIB32, *PNT_TIB32;</PRE>
      <H4><A name=Table3>Table 3 - FS segment register and Thread Information 
      Block</A></H4>
      <TABLE cellSpacing=0 cellPadding=0 border=1>
        <TBODY>
        <TR>
          <TD align=middle><FONT color=blue>DWORD PTR FS:[00h]</FONT></TD>
          <TD align=middle>ExceptionList</TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>DWORD PTR FS:[04h]</FONT></TD>
          <TD align=middle>StackBase</TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>DWORD PTR FS:[08h]</FONT></TD>
          <TD align=middle>StackLimit</TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>DWORD PTR FS:[0Ch]</FONT></TD>
          <TD align=middle>SubSystemTib</TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>DWORD PTR FS:[10h]</FONT></TD>
          <TD align=middle>FiberData / Version</TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>DWORD PTR FS:[14h]</FONT></TD>
          <TD align=middle>ArbitraryUserPointer</TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>DWORD PTR FS:[18h]</FONT></TD>
          <TD align=middle>Self</TD></TR></TBODY></TABLE>
      <H3><A name=AttainOEPbyadjustmenttheThreadContext5_3_2>5.3.2 Attain OEP by 
      adjusting the Thread Context </A></H3>
      <P>In this part, we effectuate our performance by accomplishing the OEP 
      approach. We change the Context of the thread and ignore every simple 
      exception handling, and let the thread continue the execution, but in the 
      original OEP!</P>
      <P>When an exception happens, the context of the processor during the time 
      of the exception is saved in the stack. By <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/exception_pointers_str.asp" 
      target=_blank><CODE>EXCEPTION_POINTERS</CODE></A>, we have access to the 
      pointer of <CODE>ContextRecord</CODE>. The <CODE>ContextRecord</CODE> has 
      the <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/debug/base/context_str.asp" 
      target=_blank><CODE>CONTEXT</CODE></A> data structure,<A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#Table4"> Table 
      4</A>, this is the thread context during the exception time. When we 
      ignore the exception by <CODE>EXCEPTION_CONTINUE_SEARCH (<SPAN 
      class=code-digit>0</SPAN>)</CODE>, the instruction pointer as well the 
      context will be set to <CODE>ContextRecord</CODE> in order to return to 
      the previous condition. Therefore, if we change the <CODE 
      lang=asm>Eip</CODE> of the <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#Win32ThreadContextstructure">Win32 
      Thread Context</A> to the Original Offset of Entry Point, it will come 
      clearly into OEP. </P><PRE lang=asm>    <SPAN class=code-keyword>MOV</SPAN> EAX, ContextRecord
    <SPAN class=code-keyword>MOV</SPAN> EDI, dwOEP                   <SPAN class=code-comment>;</SPAN><SPAN class=code-comment> EAX &lt;- dwOEP
</SPAN>    <SPAN class=code-keyword>MOV</SPAN> <SPAN class=code-keyword>DWORD</SPAN> <SPAN class=code-keyword>PTR</SPAN> DS:[EAX+0B8h], <SPAN class=code-keyword>EDI</SPAN> <SPAN class=code-comment>;</SPAN><SPAN class=code-comment> pContext.Eip &lt;- EAX</SPAN></PRE>
      <H4><A name=Win32ThreadContextstructure>Win32 Thread Context 
      structure</A></H4><PRE lang=c++><SPAN class=code-preprocessor>#define</SPAN> MAXIMUM_SUPPORTED_EXTENSION     <SPAN class=code-digit>512</SPAN>

<SPAN class=code-keyword>typedef</SPAN> <SPAN class=code-keyword>struct</SPAN> _CONTEXT {
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN>    DWORD ContextFlags;
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN>    DWORD   Dr0;
    DWORD   Dr1;
    DWORD   Dr2;
    DWORD   Dr3;
    DWORD   Dr6;
    DWORD   Dr7;
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN>    FLOATING_SAVE_AREA FloatSave;
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN>    DWORD   SegGs;
    DWORD   SegFs;
    DWORD   SegEs;
    DWORD   SegDs;
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN>    DWORD   Edi;
    DWORD   Esi;
    DWORD   Ebx;
    DWORD   Edx;
    DWORD   Ecx;
    DWORD   Eax;
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN>    DWORD   Ebp;
    DWORD   Eip;
    DWORD   SegCs;
    DWORD   EFlags;
    DWORD   Esp;
    DWORD   SegSs;
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>-----------------------------------------
</SPAN>    <SPAN class=code-SDKkeyword>BYTE</SPAN>    ExtendedRegisters[MAXIMUM_SUPPORTED_EXTENSION];
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------------
</SPAN>} CONTEXT, 
*LPCONTEXT;</PRE>
      <H4><A name=Table4>Table 4 - CONTEXT</A></H4>
      <TABLE cellSpacing=0 cellPadding=0 width=200 border=1>
        <TBODY>
        <TR>
          <TD align=middle height=35>Context Flags</TD>
          <TD align=middle height=35><FONT color=blue>0x00000000</FONT></TD>
          <TD align=middle colSpan=2 height=35><CODE>ContextFlags</CODE></TD></TR>
        <TR>
          <TD align=middle rowSpan=6>
            <P>Context Debug Registers</P></TD>
          <TD align=middle><FONT color=blue>0x00000004</FONT></TD>
          <TD align=middle colSpan=2><CODE>Dr0</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x00000008</FONT></TD>
          <TD align=middle colSpan=2><CODE>Dr1</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x0000000C</FONT></TD>
          <TD align=middle colSpan=2><CODE>Dr2</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x00000010</FONT></TD>
          <TD align=middle colSpan=2><CODE>Dr3</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x00000014</FONT></TD>
          <TD align=middle colSpan=2><CODE>Dr6</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x00000018</FONT></TD>
          <TD align=middle colSpan=2><CODE>Dr7</CODE></TD></TR>
        <TR>
          <TD align=middle rowSpan=9>
            <P>Context Floating Point</P></TD>
          <TD align=middle><FONT color=blue>0x0000001C</FONT></TD>
          <TD align=middle rowSpan=9><CODE>FloatSave</CODE></TD>
          <TD align=middle><CODE>StatusWord</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x00000020</FONT></TD>
          <TD align=middle><CODE>StatusWord</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x00000024</FONT></TD>
          <TD align=middle><CODE>TagWord</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x00000028</FONT></TD>
          <TD align=middle><CODE>ErrorOffset</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x0000002C</FONT></TD>
          <TD align=middle><CODE>ErrorSelector</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x00000030</FONT></TD>
          <TD align=middle><CODE>DataOffset</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x00000034</FONT></TD>
          <TD align=middle><CODE>DataSelector</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT 
            color=blue>0x00000038<BR>...<BR>0x00000087</FONT></TD>
          <TD align=middle><CODE>RegisterArea</CODE> [<FONT 
            color=blue>0x50</FONT>]</TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x00000088</FONT></TD>
          <TD align=middle><CODE>Cr0NpxState</CODE></TD></TR>
        <TR>
          <TD align=middle rowSpan=4>Context Segments</TD>
          <TD align=middle><FONT color=blue>0x0000008C</FONT></TD>
          <TD align=middle colSpan=2><CODE>SegGs</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x00000090</FONT></TD>
          <TD align=middle colSpan=2><CODE>SegFs</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x00000094</FONT></TD>
          <TD align=middle colSpan=2><CODE>SegEs</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x00000098</FONT></TD>
          <TD align=middle colSpan=2><CODE>SegDs</CODE></TD></TR>
        <TR>
          <TD align=middle rowSpan=6>Context Integer</TD>
          <TD align=middle><FONT color=blue>0x0000009C</FONT></TD>
          <TD align=middle colSpan=2><CODE lang=asm><SPAN 
            class=code-keyword>Edi</SPAN></CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x000000A0</FONT></TD>
          <TD align=middle colSpan=2><CODE lang=asm><SPAN 
            class=code-keyword>Esi</SPAN></CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x000000A4</FONT></TD>
          <TD align=middle colSpan=2><CODE lang=asm>Ebx</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x000000A8</FONT></TD>
          <TD align=middle colSpan=2><CODE lang=asm>Edx</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x000000AC</FONT></TD>
          <TD align=middle colSpan=2><CODE lang=asm><SPAN 
            class=code-keyword>Ecx</SPAN></CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x000000B0</FONT></TD>
          <TD align=middle colSpan=2><CODE lang=asm><SPAN 
            class=code-keyword>Eax</SPAN></CODE></TD></TR>
        <TR>
          <TD align=middle rowSpan=6>Context Control</TD>
          <TD align=middle><FONT color=blue>0x000000B4</FONT></TD>
          <TD align=middle colSpan=2><CODE lang=asm>Ebp</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x000000B8</FONT></TD>
          <TD align=middle colSpan=2><CODE lang=asm>Eip</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x000000BC</FONT></TD>
          <TD align=middle colSpan=2><CODE lang=asm>SegCs</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x000000C0</FONT></TD>
          <TD align=middle colSpan=2><CODE lang=asm>EFlags</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x000000C4</FONT></TD>
          <TD align=middle colSpan=2><CODE lang=asm>Esp</CODE></TD></TR>
        <TR>
          <TD align=middle><FONT color=blue>0x000000C8</FONT></TD>
          <TD align=middle colSpan=2><CODE lang=asm>SegSs</CODE></TD></TR>
        <TR>
          <TD align=middle>Context Extended Registers</TD>
          <TD align=middle>
            <P align=center><FONT 
            color=blue>0x000000CC<BR>...<BR>0x000002CB</FONT></P></TD>
          <TD align=middle colSpan=2><CODE>ExtendedRegisters</CODE>[<FONT 
            color=blue>0x200</FONT>]</TD></TR></TBODY></TABLE>
      <P>By the following code, we have accomplished the main purpose of coming 
      to OEP by the structured exception handler:</P><PRE lang=c++><SPAN class=code-keyword>__stdcall</SPAN> <SPAN class=code-keyword>void</SPAN> DynLoader()
{
_asm
{
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>    DWORD_TYPE(DYN_LOADER_START_MAGIC)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>Main_0:
    PUSHAD  <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Save the registers context in stack
</SPAN>    CALL Main_1
Main_1:    
    POP EBP
    SUB EBP,OFFSET Main_1 <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Get Base EBP
</SPAN>    MOV EAX,DWORD PTR [EBP+_RO_dwImageBase]
    ADD EAX,DWORD PTR [EBP+_RO_dwOrgEntryPoint]
    MOV DWORD PTR [ESP+10h],EAX    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> pStack.Ebx &lt;- EAX
</SPAN>    LEA EAX,[EBP+_except_handler1_OEP_Jump]
    MOV DWORD PTR [ESP+1Ch],EAX    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> pStack.Eax &lt;- EAX
</SPAN>    POPAD  <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Restore the first registers context from stack
</SPAN>    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------------------------
</SPAN>    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> the structured exception handler (SEH) installation 
</SPAN>    PUSH EAX
    XOR  EAX, EAX
    PUSH DWORD PTR FS:[<SPAN class=code-digit>0</SPAN>]        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> NT_TIB32.ExceptionList
</SPAN>    MOV DWORD PTR FS:[<SPAN class=code-digit>0</SPAN>],ESP    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> NT_TIB32.ExceptionList &lt;-ESP
</SPAN>    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------------------------
</SPAN>    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> the raise a INT 3 exception
</SPAN>    DWORD_TYPE(0xCCCCCCCC)
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>--------------------------------------------------------
</SPAN><SPAN class=code-comment>//</SPAN><SPAN class=code-comment> -------- exception handler expression filter ----------
</SPAN>_except_handler1_OEP_Jump:
    PUSH EBP
    MOV EBP,ESP
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>------------------------------
</SPAN>    MOV EAX,DWORD PTR SS:[EBP+010h]    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> PCONTEXT: pContext &lt;- EAX
</SPAN>    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>==============================
</SPAN>    PUSH EDI
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> restore original SEH
</SPAN>    MOV EDI,DWORD PTR DS:[EAX+0C4h]    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> pContext.Esp
</SPAN>    PUSH DWORD PTR DS:[EDI]
    POP DWORD PTR FS:[<SPAN class=code-digit>0</SPAN>]
    ADD DWORD PTR DS:[EAX+0C4h],<SPAN class=code-digit>8</SPAN>    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> pContext.Esp
</SPAN>    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>------------------------------
</SPAN>    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> set the Eip to the OEP
</SPAN>    MOV EDI,DWORD PTR DS:[EAX+0A4h] <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> EAX &lt;- pContext.Ebx
</SPAN>    MOV DWORD PTR DS:[EAX+0B8h],EDI <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> pContext.Eip &lt;- EAX
</SPAN>    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>------------------------------
</SPAN>    POP EDI
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>==============================
</SPAN>    MOV EAX, EXCEPTION_CONTINUE_SEARCH
    LEAVE
    RETN
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>    DWORD_TYPE(DYN_LOADER_START_DATA1)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>_RO_dwImageBase:                DWORD_TYPE(0xCCCCCCCC)
_RO_dwOrgEntryPoint:            DWORD_TYPE(0xCCCCCCCC)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>    DWORD_TYPE(DYN_LOADER_END_MAGIC)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------
</SPAN>}
}</PRE>
      <H2><A name=BuildanImportTableandReconstructtheOriginalImportTable6>6 
      Build an Import Table and Reconstruct the Original Import Table</A></H2>
      <P>To use the Windows <A 
      href="http://en.wikipedia.org/wiki/Microsoft_Dynamic_Link_Library" 
      target=_blank>dynamic link library (DLL)</A> in Windows application 
      programming, there are two ways:</P>
      <UL>
        <LI><B>Using Windows libraries by additional dependencies</B>: 
        <P><IMG height=160 
        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/dependencies.gif" 
        width=550></P>
        <LI><B>Using Windows dynamic link libraries in run-time</B>: <PRE lang=c++><SPAN class=code-comment>//</SPAN><SPAN class=code-comment> DLL function signature
</SPAN><SPAN class=code-keyword>typedef</SPAN> HGLOBAL (*importFunction_GlobalAlloc)(UINT, SIZE_T);
...
importFunction_GlobalAlloc __GlobalAlloc;

<SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Load DLL file
</SPAN>HINSTANCE hinstLib = LoadLibrary(<SPAN class=code-string>"</SPAN><SPAN class=code-string>Kernel32.dll"</SPAN>);
<SPAN class=code-keyword>if</SPAN> (hinstLib == NULL)
{
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Error - unable to load DLL
</SPAN>}

<SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Get function pointer
</SPAN>__GlobalAlloc = 
    (importFunction_GlobalAlloc)GetProcAddress(hinstLib,  
                                         <SPAN class=code-string>"</SPAN><SPAN class=code-string>GlobalAlloc"</SPAN>);
<SPAN class=code-keyword>if</SPAN> (addNumbers == NULL) 
{
     <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Error - unable to find DLL function
</SPAN>}

FreeLibrary(hinstLib);</PRE></LI></UL>
      <P>When you make a Windows application project, the linker includes at 
      least <I>kernel32.dll</I> in the base dependencies of your project. 
      Without <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/loadlibrary.asp" 
      target=_blank><CODE>LoadLibrary()</CODE></A> and <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/getprocaddress.asp" 
      target=_blank><CODE>GetProcAddress()</CODE></A> of <I>Kernel32.dll</I>, we 
      can not load a DLL in run-time. The dependencies information is stored in 
      the import table section. By <A 
      href="http://www.microsoft.com/resources/documentation/Windows/XP/all/reskit/en-us/Default.asp?url=/resources/documentation/Windows/XP/all/reskit/en-us/prmb_tol_kewf.asp" 
      target=_blank>Dependency Walker</A>, it is not so difficult to observe the 
      DLL module and the functions which are imported into a PE file.</P>
      <P><IMG height=352 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/dependency_walker.gif" 
      width=480></P>
      <P>We attempt to establish our custom import table to conduct our project. 
      Furthermore, we have to fix up the original import table at the end in 
      order to run the real code of the program.</P>
      <H4><A name=PEMakerDownloadLink3>PE Maker - Step 3</A></H4>
      <UL class=download>
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe/pemaker3.zip">Download 
        source files - 65.4 Kb</A> </LI></UL>
      <H3><A name=ConstructtheClientImportTable6_1>6.1 Construct the Client 
      Import Table</A></H3>
      <P>I strongly advise you to read the section 6.4 of the <A 
      href="http://www.microsoft.com/whdc/system/platform/firmware/PECOFF.mspx" 
      target=_blank>Microsoft Portable Executable and the Common Object File 
      Format Specification</A> document. This section contains the principal 
      information to comprehend the import table performance.</P>
      <P>The import table data is accessible by a second data directory of the 
      optional header from PE headers, so you can access it by using the 
      following code:</P><PRE lang=c++>DWORD dwVirtualAddress = image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>
  OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].VirtualAddress;
DWORD dwSize = image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>
  OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].Size;</PRE>
      <P>The <CODE>VirtualAddress</CODE> refers to structures by 
      <CODE>IMAGE_IMPORT_DESCRIPTOR</CODE>. This structure contains the pointer 
      to the imported DLL name and the relative virtual address of the first 
      thunk.</P><PRE lang=c++><SPAN class=code-keyword>typedef</SPAN> <SPAN class=code-keyword>struct</SPAN> _IMAGE_IMPORT_DESCRIPTOR {
    <SPAN class=code-keyword>union</SPAN> {
        DWORD   Characteristics;
        DWORD   OriginalFirstThunk;
    };
    DWORD   TimeDateStamp;
    DWORD   ForwarderChain;
    DWORD   Name;         <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> the imported DLL name
</SPAN>    DWORD   FirstThunk;   <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> the relative virtual address of the first thunk
</SPAN>} IMAGE_IMPORT_DESCRIPTOR, *PIMAGE_IMPORT_DESCRIPTOR;</PRE>
      <P>When a program is running, the Windows task manager sets the thunks by 
      the virtual address of the function. The virtual address is found by the 
      name of the function. At first, the thunks hold the relative virtual 
      address of the function name, <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#Table5">Table 
      5</A>; during execution, they are fixed up by the virtual address of the 
      functions, <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#Table6">Table 
      6</A>.</P>
      <H4><A name=Table5>Table 5 - The Import Table in file image</A></H4>
      <TABLE cellSpacing=0 cellPadding=0 border=1>
        <TBODY>
        <TR>
          <TD rowSpan=8><CODE>IMAGE_IMPORT_<BR>DESCRIPTOR[<SPAN 
            class=code-digit>0</SPAN>]</CODE></TD>
          <TD><CODE>OriginalFirstThunk</CODE></TD>
          <TD colSpan=2 rowSpan=3></TD>
          <TD colSpan=2 rowSpan=4></TD></TR>
        <TR>
          <TD><CODE>TimeDateStamp</CODE></TD></TR>
        <TR>
          <TD><CODE>ForwarderChain</CODE></TD></TR>
        <TR>
          <TD><CODE>Name_RVA</CODE></TD>
          <TD>------&gt;</TD>
          <TD><FONT color=brown>"kernel32.dll"<FONT 
          color=blue>,0</FONT></FONT></TD></TR>
        <TR>
          <TD><CODE>FirstThunk_RVA</CODE></TD>
          <TD>------&gt;</TD>
          <TD><CODE>proc_1_name_RVA</CODE></TD>
          <TD>------&gt;</TD>
          <TD><FONT color=blue>0,0,</FONT><FONT 
            color=brown>"LoadLibraryA"</FONT><FONT color=blue>,0</FONT></TD></TR>
        <TR>
          <TD colSpan=2 rowSpan=3></TD>
          <TD><CODE>proc_2_name_RVA</CODE></TD>
          <TD>------&gt;</TD>
          <TD><FONT color=blue>0,0,</FONT><FONT 
            color=brown>"GetProcAddress"</FONT><FONT color=blue>,0</FONT></TD></TR>
        <TR>
          <TD><CODE>proc_3_name_RVA</CODE></TD>
          <TD>------&gt;</TD>
          <TD><FONT color=blue>0,0,</FONT><FONT 
            color=brown>"GetModuleHandleA"</FONT><FONT 
color=blue>,0</FONT></TD></TR>
        <TR>
          <TD>...</TD>
          <TD></TD>
          <TD></TD></TR>
        <TR>
          <TD><CODE>IMAGE_IMPORT_<BR>DESCRIPTOR[<SPAN 
            class=code-digit>1</SPAN>]</CODE></TD>
          <TD colSpan=5></TD></TR>
        <TR>
          <TD><CODE>...</CODE></TD>
          <TD colSpan=5></TD></TR>
        <TR>
          <TD><CODE>IMAGE_IMPORT_<BR>DESCRIPTOR[n]</CODE></TD>
          <TD colSpan=5></TD></TR></TBODY></TABLE>
      <H4><A name=Table6>Table 6 - The Import Table in virtual memory</A></H4>
      <TABLE cellSpacing=0 cellPadding=0 border=1>
        <TBODY>
        <TR>
          <TD rowSpan=8><CODE>IMAGE_IMPORT_DESCRIPTOR[<SPAN 
            class=code-digit>0</SPAN>]</CODE></TD>
          <TD><CODE>OriginalFirstThunk</CODE></TD>
          <TD colSpan=2 rowSpan=3></TD></TR>
        <TR>
          <TD><CODE>TimeDateStamp</CODE></TD></TR>
        <TR>
          <TD><CODE>ForwarderChain</CODE></TD></TR>
        <TR>
          <TD><CODE>Name_RVA</CODE></TD>
          <TD><CODE>------<SPAN class=code-keyword>&gt;</SPAN></CODE></TD>
          <TD><FONT color=brown>"kernel32.dll"<FONT 
          color=blue>,0</FONT></FONT></TD></TR>
        <TR>
          <TD><CODE>FirstThunk_RVA</CODE></TD>
          <TD><CODE>------<SPAN class=code-keyword>&gt;</SPAN></CODE></TD>
          <TD><CODE>proc_1_VA</CODE></TD></TR>
        <TR>
          <TD colSpan=2 rowSpan=3></TD>
          <TD><CODE>proc_2_VA</CODE></TD></TR>
        <TR>
          <TD><CODE>proc_3_VA</CODE></TD></TR>
        <TR>
          <TD><CODE>...</CODE></TD></TR>
        <TR>
          <TD><CODE>IMAGE_IMPORT_DESCRIPTOR[<SPAN 
            class=code-digit>1</SPAN>]</CODE></TD>
          <TD colSpan=3></TD></TR>
        <TR>
          <TD><CODE>...</CODE></TD>
          <TD colSpan=3></TD></TR>
        <TR>
          <TD><CODE>IMAGE_IMPORT_DESCRIPTOR[n]</CODE></TD>
          <TD colSpan=3></TD></TR></TBODY></TABLE>
      <P>We want to make a simple import table to import 
      <CODE>LoadLibrary()</CODE>, and <CODE>GetProcAddress()</CODE> from 
      <I>Kernel32.dll</I>. We need these two essential API functions to cover 
      other API functions in run-time. The following assembly code shows how 
      easily we can reach our solution:</P><PRE lang=text>0101F000: 
00000000 ; OriginalFirstThunk
0101F004: 00000000 ; TimeDateStamp
0101F008: 00000000 ; ForwarderChain
0101F00C: 0001F034 ; Name;       ImageBase + 0001F034 -&gt; 0101F034 -&gt; "Kernel32.dll",0
0101F010: 0001F028 ; FirstThunk; ImageBase + 0001F028 -&gt; 0101F028
0101F014: 00000000
0101F018: 00000000
0101F01C: 00000000
0101F020: 00000000
0101F024: 00000000
0101F028: 0001F041 ; ImageBase + 0001F041 -&gt; 0101F041 -&gt; 0,0,"LoadLibraryA",0
0101F02C: 0001F050 ; ImageBase + 0001F050 -&gt; 0101F050 -&gt; 0,0,"GetProcAddress",0
0101F030: 00000000
0101F034: 'K' 'e' 'r' 'n' 'e' 'l' '3' '2' '.' 'd' 'l' 'l' 00
0001F041: 00 00 'L' 'o' 'a' 'd' 'L' 'i' 'b' 'r' 'a' 'r' 'y' 'A' 
00
0001F050: 00 00 'G' 'e' 't' 'P' 'r' 'o' 'c' 'A' 'd' 'd' 'r' 'e' 's' 's'
 00</PRE>
      <P>After running...</P><PRE lang=text>0101F000: 
00000000 ; OriginalFirstThunk
0101F004: 00000000 ; TimeDateStamp
0101F008: 00000000 ; ForwarderChain
0101F00C: 0001F034 ; Name;       ImageBase + 0001F034 -&gt; 0101F034 -&gt; "Kernel32.dll",0
0101F010: 0001F028 ; FirstThunk; ImageBase + 0001F028 -&gt; 0101F028
0101F014: 00000000
0101F018: 00000000
0101F01C: 00000000
0101F020: 00000000
0101F024: 00000000
0101F028: 7C801D77 ; -&gt; Kernel32.LoadLibrary()
0101F02C: 7C80AC28 ; -&gt; Kernel32.GetProcAddress()
0101F030: 00000000
0101F034: 'K' 'e' 'r' 'n' 'e' 'l' '3' '2' '.' 'd' 'l' 'l' 
00
0001F041: 00 00 'L' 'o' 'a' 'd' 'L' 'i' 'b' 'r' 'a' 'r' 'y' 'A'
 00
0001F050: 00 00 'G' 'e' 't' 'P' 'r' 'o' 'c' 'A' 'd' 'd' 'r' 'e' 's' 's'
 00</PRE>
      <P>I have prepared a class library to make every import table by using a 
      client string table. The <CODE>CITMaker</CODE> class library in 
      <I>itmaker.h</I>, it will build an import table by 
      <CODE>sz_IT_EXE_strings</CODE> and also the relative virtual address of 
      the import table.</P><PRE lang=c++><SPAN class=code-keyword>static</SPAN> <SPAN class=code-keyword>const</SPAN> <SPAN class=code-keyword>char</SPAN> *sz_IT_EXE_strings[]=
{
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>Kernel32.dll"</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>LoadLibraryA"</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>GetProcAddress"</SPAN>,
    <SPAN class=code-digit>0</SPAN>,,
    <SPAN class=code-digit>0</SPAN>,
};</PRE>
      <P>We subsequently employ this class library to establish an import table 
      to support DLLs and OCXs, so this is a general library to present all 
      possible import tables easily. The next step is clarified in the following 
      code.</P><PRE lang=c++>CITMaker *ImportTableMaker = <SPAN class=code-keyword>new</SPAN> CITMaker( IMPORT_TABLE_EXE );
...
pimage_section_header=AddNewSection( <SPAN class=code-string>"</SPAN><SPAN class=code-string>.xxx"</SPAN>, dwNewSectionSize );
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment> build import table by the current virtual address
</SPAN>ImportTableMaker-<SPAN class=code-keyword>&gt;</SPAN>Build
( pimage_section_header-<SPAN class=code-keyword>&gt;</SPAN>VirtualAddress ); 
memcpy( pNewSection, ImportTableMaker-<SPAN class=code-keyword>&gt;</SPAN>pMem, 
ImportTableMaker-<SPAN class=code-keyword>&gt;</SPAN>dwSize );
...
memcpy( image_section[image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>FileHeader.NumberOfSections-<SPAN class=code-digit>1</SPAN>], 
        pNewSection, 
        dwNewSectionSize );
...
image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>OptionalHeader.
  DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].VirtualAddress 
  = pimage_section_header-<SPAN class=code-keyword>&gt;</SPAN>VirtualAddress;
image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>OptionalHeader.
  DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].Size 
  = ImportTableMaker-<SPAN class=code-keyword>&gt;</SPAN>dwSize;
...
<SPAN class=code-keyword>delete</SPAN> ImportTableMaker;</PRE>
      <P>The import table is copied at the beginning of the new section, and the 
      relevant data directory is adjusted to the relative virtual address of the 
      new section and the size of the new import table</P>
      <H3><A name=UsingotherAPIfunctionsinruntime6_2>6.2 Using other API 
      functions in run-time</A></H3>
      <P>At this time, we can load other DLLs and find the process address of 
      other functions by using <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/loadlibrary.asp" 
      target=_blank><CODE>LoadLibrary()</CODE></A> and <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/getprocaddress.asp" 
      target=_blank><CODE>GetProcAddress()</CODE></A>:</P><PRE lang=text>lea edi, @"Kernel32.dll"
//-------------------
push edi
mov eax,offset _p_LoadLibrary
call [ebp+eax] //LoadLibrary(lpLibFileName);
//-------------------
mov esi,eax    // esi -&gt; hModule
lea edi, @"GetModuleHandleA"
//-------------------
push edi
push esi
mov eax,offset _p_GetProcAddress
call [ebp+eax] //GetModuleHandle=GetProcAddress(hModule, lpProcName);
//--------------------</PRE>
      <P>I want to have a complete imported function table similar in 
      performance done in a real EXE file. If you look inside a PE file, you 
      will discover that an API call is done by an indirection jump through the 
      virtual address of the API function:</P>
      <H4>JMP DWORD PTR [XXXXXXXX]</H4><PRE lang=text>...
0101F028: 7C801D77      ; Virtual Address of kernel32.LoadLibrary()
...
0101F120: JMP DWORD PTR [0101F028]
...
0101F230: CALL 0101F120 ;  JMP to kernel32.LoadLibrary
...</PRE>
      <P>It makes it easy to expand the other part of our project by this 
      performance, so we construct two data tables: first for API virtual 
      addresses, and the second for the <CODE lang=asms>JMP 
      [XXXXXXXX]</CODE>.</P><PRE lang=c++><SPAN class=code-preprocessor>#define</SPAN> __jmp_api               byte_type(0xFF) byte_type(0x25)
<SPAN class=code-keyword>__asm</SPAN>
{
...
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------------------------------------
</SPAN>_p_GetModuleHandle:             dword_type(0xCCCCCCCC)
_p_VirtualProtect:              dword_type(0xCCCCCCCC)
_p_GetModuleFileName:           dword_type(0xCCCCCCCC)
_p_CreateFile:                  dword_type(0xCCCCCCCC)
_p_GlobalAlloc:                 dword_type(0xCCCCCCCC)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------------------------------------
</SPAN>_jmp_GetModuleHandle:           __jmp_api   dword_type(0xCCCCCCCC)
_jmp_VirtualProtect:            __jmp_api   dword_type(0xCCCCCCCC)
_jmp_GetModuleFileName:         __jmp_api   dword_type(0xCCCCCCCC)
_jmp_CreateFile:                __jmp_api   dword_type(0xCCCCCCCC)
_jmp_GlobalAlloc:               __jmp_api   dword_type(0xCCCCCCCC)
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----------------------------------------------------------------
</SPAN>...
}</PRE>
      <P>In the succeeding code, we has concluded our ambition to install a 
      custom internal import table! (We can not call it import table.)</P><PRE lang=text>    ...
    lea edi,[ebp+_p_szKernel32]
    lea ebx,[ebp+_p_GetModuleHandle]
    lea ecx,[ebp+_jmp_GetModuleHandle]
    add ecx,02h
_api_get_lib_address_loop:
        push ecx
        push edi
        mov eax,offset _p_LoadLibrary
        call [ebp+eax]    //LoadLibrary(lpLibFileName);
        pop ecx
        mov esi,eax       // esi -&gt; hModule
        push edi
        call __strlen
        add esp,04h
        add edi,eax
_api_get_proc_address_loop:
            push ecx
            push edi
            push esi
            mov eax,offset _p_GetProcAddress
            call [ebp+eax]//GetModuleHandle=GetProcAddress(hModule, lpProcName);
            pop ecx
            mov [ebx],eax
            mov [ecx],ebx // JMP DWORD PTR [XXXXXXXX] 
            add ebx,04h
            add ecx,06h
            push edi
            call __strlen
            add esp,04h
            add edi,eax
            mov al,byte ptr [edi]
        test al,al
        jnz _api_get_proc_address_loop
        inc edi
        mov al,byte ptr [edi]
    test al,al
    jnz _api_get_lib_address_loop
    ...</PRE>
      <H3><A name=FixuptheOriginalImportTable6_3>6.3 Fix up the Original Import 
      Table</A></H3>
      <P>In order to run the program again, we should fix up the thunks of the 
      actual import table, otherwise we have a corrupted target PE file. Our 
      code must correct all of the thunks the same as <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#Table5">Table 
      5</A> to <A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#Table6">Table 
      6</A>. Once more, <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/loadlibrary.asp" 
      target=_blank><CODE>LoadLibrary()</CODE></A> and <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/getprocaddress.asp" 
      target=_blank><CODE>GetProcAddress()</CODE></A> aid us in our effort to 
      reach our intention.</P><PRE lang=text>    ...
    mov ebx,[ebp+_p_dwImportVirtualAddress]
    test ebx,ebx
    jz _it_fixup_end
    mov esi,[ebp+_p_dwImageBase]
    add ebx,esi                   // dwImageBase + dwImportVirtualAddress
_it_fixup_get_lib_address_loop:
        mov eax,[ebx+00Ch]        // image_import_descriptor.Name
        test eax,eax
        jz _it_fixup_end
        
        mov ecx,[ebx+010h]        // image_import_descriptor.FirstThunk
        add ecx,esi
        mov [ebp+_p_dwThunk],ecx // dwThunk
        mov ecx,[ebx]             // image_import_descriptor.Characteristics
        test ecx,ecx
        jnz _it_fixup_table
            mov ecx,[ebx+010h]
_it_fixup_table:
        add ecx,esi
        mov [ebp+_p_dwHintName],ecx // dwHintName
        add eax,esi  // image_import_descriptor.Name + dwImageBase = ModuleName
        push eax  // lpLibFileName
        mov eax,offset _p_LoadLibrary
        call [ebp+eax]             // LoadLibrary(lpLibFileName);

        test eax,eax
        jz _it_fixup_end
        mov edi,eax
_it_fixup_get_proc_address_loop:
            mov ecx,[ebp+_p_dwHintName] // dwHintName
            mov edx,[ecx]            // image_thunk_data.Ordinal
            test edx,edx
            jz _it_fixup_next_module
            test edx,080000000h      // .IF( import by ordinal )
            jz _it_fixup_by_name
                and edx,07FFFFFFFh   // get ordinal
                jmp _it_fixup_get_addr
_it_fixup_by_name:
            add edx,esi  // image_thunk_data.Ordinal + dwImageBase = OrdinalName
            inc edx
            inc edx                  // OrdinalName.Name
_it_fixup_get_addr:
            push edx //lpProcName
            push edi                 // hModule                        
            mov eax,offset _p_GetProcAddress
            call [ebp+eax] // GetProcAddress(hModule, lpProcName);

            mov ecx,[ebp+_p_dwThunk] // dwThunk
            mov [ecx],eax  // correction the thunk
            // dwThunk =&gt; next dwThunk
            add dword ptr [ebp+_p_dwThunk], 004h
            // dwHintName =&gt; next dwHintName
            add dword ptr [ebp+_p_dwHintName],004h
        jmp _it_fixup_get_proc_address_loop
_it_fixup_next_module:
        add ebx,014h      // sizeof(IMAGE_IMPORT_DESCRIPTOR)
    jmp _it_fixup_get_lib_address_loop
_it_fixup_end:
    ...</PRE>
      <H2><A name=SupportDLLandOCX7>7 Support DLL and OCX</A></H2>
      <P>Now, we intend to include the <A 
      href="http://en.wikipedia.org/wiki/Microsoft_Dynamic_Link_Library" 
      target=_blank>dynamic link library (DLL)</A> and <A 
      href="http://en.wikipedia.org/wiki/OCX" target=_blank>OLE-ActiveX 
      Control</A> in our PE builder project. Supporting them is very easy if we 
      pay attention to the two time arrival into the Offset of Entry Point, the 
      relocation table implementation, and the client import table.</P>
      <H4><A name=PEMakerDownloadLink4>PE Maker - Step 4</A></H4>
      <UL class=download>
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe/pemaker4.zip">Download 
        source files - 68.6 Kb</A> </LI></UL>
      <H3><A name=TwiceOEPapproach7_1>7.1 Twice OEP approach</A></H3>
      <P>The Offset of Entry Point of a DLL file or an OCX file is touched by 
      the main program atleast twice:</P>
      <UL>
        <LI><B>Constructor</B>: 
        <P>When a DLL is loaded by <A 
        href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/loadlibrary.asp" 
        target=_blank><CODE>LoadLibrary()</CODE></A>, or an OCX is registered by 
        using <A 
        href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/loadlibrary.asp" 
        target=_blank><CODE>LoadLibrary()</CODE></A> and <A 
        href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/getprocaddress.asp" 
        target=_blank><CODE>GetProcAddress()</CODE></A> through calling <A 
        href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/com/html/4442206b-b2ad-47d7-8add-18002c44c5a2.asp" 
        target=_blank><CODE>DllRegisterServer()</CODE></A>, the first of the OEP 
        arrival is done.</P><PRE lang=c++>hinstDLL = LoadLibrary( <SPAN class=code-string>"</SPAN><SPAN class=code-string>test1.dll"</SPAN> );</PRE><PRE lang=c++>hinstOCX = LoadLibrary( <SPAN class=code-string>"</SPAN><SPAN class=code-string>test1.ocx"</SPAN> );
_DllRegisterServer = GetProcAddress( hinstOCX, <SPAN class=code-string>"</SPAN><SPAN class=code-string>DllRegisterServer"</SPAN> );
_DllRegisterServer(); <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> ocx register</SPAN></PRE>
        <LI><B>Destructor</B>: 
        <P>When the main program frees the library usage by <A 
        href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/freelibrary.asp" 
        target=_blank><CODE>FreeLibrary()</CODE></A>, the second OEP arrival 
        happens.</P><PRE lang=c++>FreeLibrary( hinstDLL );</PRE><PRE lang=c++>FreeLibrary( hinstOCX );</PRE></LI></UL>
      <P>To perform this, I have employed a trick, that causes in the second 
      time again, the instruction pointer (EIP) traveling towards the original 
      OEP by the structured exception handler.</P><PRE lang=text>_main_0:
    pushad  // save the registers context in stack
    call _main_1
_main_1:    
    pop ebp
    sub ebp,offset _main_1 // get base ebp
    //---------------- support dll, ocx  -----------------
_support_dll_0: 
    jmp _support_dll_1 // nop; nop; // &lt;&lt; trick // in the second time OEP
    jmp _support_dll_2
_support_dll_1:
    //----------------------------------------------------
    
    ...
    
    //---------------- support dll, ocx  1 ---------------
    mov edi,[ebp+_p_dwImageBase]
    add edi,[edi+03Ch]// edi -&gt; IMAGE_NT_HEADERS
    mov ax,word ptr [edi+016h]// edi -&gt; image_nt_headers-&gt;FileHeader.Characteristics
    test ax,IMAGE_FILE_DLL
    jz _support_dll_2
        mov ax, 9090h // &lt;&lt; trick
        mov word ptr [ebp+_support_dll_0],ax
_support_dll_2:
    //----------------------------------------------------
    ...
    into OEP by SEH ...</PRE>
      <P>I hope you have caught the trick in the preceding code, but this is not 
      all of it, we have problem in <CODE>ImageBase</CODE>, when the library has 
      been loaded in different image bases by the main program. We should write 
      some code to find the real image base and store it to use forward.</P><PRE lang=text>    mov eax,[esp+24h] // the real imagebase
    mov ebx,[esp+30h] // oep
    cmp eax,ebx
    ja _no_dll_pe_file_0
        cmp word ptr [eax],IMAGE_DOS_SIGNATURE
        jne _no_dll_pe_file_0
            mov [ebp+_p_dwImageBase],eax
_no_dll_pe_file_0:</PRE>
      <P>This code finds the real image base by investigating the stack 
      information. By using the real image base and the formal image base, we 
      should correct all memory calls inside the image program!! Don't be 
      afraid, it will be done simply by the relocating the table 
information.</P>
      <H3><A name=ImplementRelocationTable7_2>7.2 Implement Relocation 
      Table</A></H3>
      <P>To understand the relocation table better, you can take a look at the 
      section 6.6 of <A 
      href="http://www.microsoft.com/whdc/system/platform/firmware/PECOFF.mspx" 
      target=_blank>Microsoft Portable Executable and Common Object File Format 
      Specification</A> document. The relocation table contains many packages to 
      relocate the information related to the virtual address inside the virtual 
      memory image. Each package comprise of a 8 bytes header to exhibit the 
      base virtual address and the number of data, demonstrated by the 
      <CODE>IMAGE_BASE_RELOCATION</CODE> data structure.</P><PRE lang=c++><SPAN class=code-keyword>typedef</SPAN> <SPAN class=code-keyword>struct</SPAN> _IMAGE_BASE_RELOCATION {
    DWORD   VirtualAddress;
    DWORD   SizeOfBlock;
} IMAGE_BASE_RELOCATION, *PIMAGE_BASE_RELOCATION;</PRE>
      <H4><A name=Table7>Table 7 - The Relocation Table</A></H4>
      <TABLE cellSpacing=0 cellPadding=0 border=1>
        <TBODY>
        <TR>
          <TD align=middle rowSpan=7>Block[1]</TD>
          <TD align=middle colSpan=4>VirtualAddress</TD></TR>
        <TR>
          <TD align=middle colSpan=4>SizeOfBlock</TD></TR>
        <TR>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD></TR>
        <TR>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD></TR>
        <TR>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD></TR>
        <TR>
          <TD align=middle>...</TD>
          <TD align=middle>...</TD>
          <TD align=middle>...</TD>
          <TD align=middle>...</TD></TR>
        <TR>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD>
          <TD align=middle>00</TD>
          <TD align=middle>00</TD></TR>
        <TR>
          <TD align=middle rowSpan=7>Block[2]</TD>
          <TD align=middle colSpan=4>VirtualAddress</TD></TR>
        <TR>
          <TD align=middle colSpan=4>SizeOfBlock</TD></TR>
        <TR>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD></TR>
        <TR>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD></TR>
        <TR>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD></TR>
        <TR>
          <TD align=middle>...</TD>
          <TD align=middle>...</TD>
          <TD align=middle>...</TD>
          <TD align=middle>...</TD></TR>
        <TR>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD>
          <TD align=middle>00</TD>
          <TD align=middle>00</TD></TR>
        <TR>
          <TD align=middle>...</TD>
          <TD align=middle colSpan=4>
            <P>
            <P>... 
            <P></P></TD></TR>
        <TR>
          <TD align=middle rowSpan=7>Block[n]</TD>
          <TD align=middle colSpan=4>VirtualAddress</TD></TR>
        <TR>
          <TD align=middle colSpan=4>SizeOfBlock</TD></TR>
        <TR>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD></TR>
        <TR>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD></TR>
        <TR>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD></TR>
        <TR>
          <TD align=middle>...</TD>
          <TD align=middle>...</TD>
          <TD align=middle>...</TD>
          <TD align=middle>...</TD></TR>
        <TR>
          <TD align=middle>type:4</TD>
          <TD align=middle>offset:12</TD>
          <TD align=middle>00</TD>
          <TD align=middle>00</TD></TR></TBODY></TABLE>
      <P><A 
      href="http://www.codeproject.com/KB/system/inject2exe.aspx#Table7">Table 
      7</A> illustrates the main idea of the relocation table. Furthermore, you 
      can upload a DLL or an OCX file in <A href="http://www.ollydbg.de/" 
      target=_blank>OllyDbg</A> to observe the relocation table, the 
      <I>".reloc"</I> section through <I>Memory map window</I>. By the way, we 
      find the position of the relocation table by using the following code in 
      our project:</P><PRE lang=c++>DWORD dwVirtualAddress = image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>
  OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC].
  VirtualAddress;
DWORD dwSize = image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>
  OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC].Size;</PRE>
      <P>By OllyDbg, we have the same as the following for the <I>".reloc"</I> 
      section, by using the Long Hex viewer mode. In this example, the base 
      virtual address is <B>0x1000</B> and the size of the block is 
      <B>0x184</B>.</P><PRE lang=text>008E1000 : 00001000  00000184  30163000  30403028
008E1010 : 30683054  308C3080  30AC309C  30D830CC
008E1020 : 30E030DC  30E830E4  30F030EC  310030F4
008E1030 : 3120310D  315F3150  31A431A0  31C031A8
008E1040 : 31D031CC  31F431EC  31FC31F8  32043200
008E1050 : 320C3208  32143210  324C322C  32583254
008E1060 : 3260325C  32683264  3270326C  32B03274</PRE>
      <P>It relocates the data in the subsequent virtual addresses:</P><PRE lang=c++>0x1000 + 0x0000 = 0x1000
0x1000 + 0x0016 = 0x1016
0x1000 + 0x0028 = 0x1028
0x1000 + 0x0040 = 0x1040
0x1000 + 0x0054 = 0x1054
...</PRE>
      <P>Each package performs the relocation by using consecutive 4 bytes form 
      its internal information. The first byte refers to the type of relocation 
      and the next three bytes are the offset which must be used with the base 
      virtual address and the image base to correct the image information.</P>
      <TABLE cellSpacing=0 cellPadding=0 border=1>
        <TBODY>
        <TR>
          <TD align=middle width=30>type</TD>
          <TD align=middle colSpan=3>offset</TD></TR>
        <TR>
          <TD align=middle><FONT color=#0000ff>03</FONT></TD>
          <TD align=middle><FONT color=blue>00</FONT></TD>
          <TD align=middle><FONT color=blue>00</FONT></TD>
          <TD align=middle><FONT color=blue>00</FONT></TD></TR></TBODY></TABLE>
      <H4>What is the type</H4>
      <P>The type can be one of the following values:</P>
      <UL>
        <LI><CODE>IMAGE_REL_BASED_ABSOLUTE (<SPAN 
        class=code-digit>0</SPAN>)</CODE>: no effect. 
        <LI><CODE>IMAGE_REL_BASED_HIGH (<SPAN class=code-digit>1</SPAN>)</CODE>: 
        relocate by the high 16 bytes of the base virtual address and the 
        offset. 
        <LI><CODE>IMAGE_REL_BASED_LOW (<SPAN class=code-digit>2</SPAN>)</CODE>: 
        relocate by the low 16 bytes of the base virtual address and the offset. 

        <LI><CODE>IMAGE_REL_BASED_HIGHLOW (<SPAN 
        class=code-digit>3</SPAN>)</CODE>: relocate by the base virtual address 
        and the offset. </LI></UL>
      <H4>What is done in the relocation?</H4>
      <P>By relocation, some values inside the virtual memory are corrected 
      according to the current image base by the <I>".reloc"</I> section 
      packages.</P>
      <TABLE cellSpacing=0 cellPadding=0 border=1>
        <TBODY>
        <TR>
          <TD align=middle><B>delta_ImageBase = current_ImageBase - 
            image_nt_headers-&gt;OptionalHeader.ImageBase</B></TD></TR></TBODY></TABLE><PRE lang=c++>mem[ current_ImageBase + 0x1000 ] = 
   mem[ current_ImageBase + 0x1000 ] + delta_ImageBase ;
mem[ current_ImageBase + 0x1016 ] = 
   mem[ current_ImageBase + 0x1016 ] + delta_ImageBase ;
mem[ current_ImageBase + 0x1028 ] = 
   mem[ current_ImageBase + 0x1028 ] + delta_ImageBase ;
mem[ current_ImageBase + 0x1040 ] = 
   mem[ current_ImageBase + 0x1040 ] + delta_ImageBase ;
mem[ current_ImageBase + 0x1054 ] = 
  mem[ current_ImageBase + 0x1054 ] + delta_ImageBase ;
...</PRE>
      <P>I have employed the following code from Morphine packer to implement 
      the relocation.</P><PRE lang=text>    ...
_reloc_fixup:
    mov eax,[ebp+_p_dwImageBase]
    mov edx,eax
    mov ebx,eax
    add ebx,[ebx+3Ch] // edi -&gt; IMAGE_NT_HEADERS
    mov ebx,[ebx+034h]// edx -&gt;image_nt_headers-&gt;OptionalHeader.ImageBase
    sub edx,ebx // edx -&gt; reloc_correction // delta_ImageBase
    je _reloc_fixup_end
    mov ebx,[ebp+_p_dwRelocationVirtualAddress]
    test ebx,ebx
    jz _reloc_fixup_end
    add ebx,eax
_reloc_fixup_block:
    mov eax,[ebx+004h]          //ImageBaseRelocation.SizeOfBlock
    test eax,eax
    jz _reloc_fixup_end
    lea ecx,[eax-008h]
    shr ecx,001h
    lea edi,[ebx+008h]
_reloc_fixup_do_entry:
        movzx eax,word ptr [edi]//Entry
        push edx
        mov edx,eax
        shr eax,00Ch            //Type = Entry &gt;&gt; 12
        mov esi,[ebp+_p_dwImageBase]//ImageBase
        and dx,00FFFh
        add esi,[ebx]
        add esi,edx
        pop edx
_reloc_fixup_HIGH:              // IMAGE_REL_BASED_HIGH  
        dec eax
        jnz _reloc_fixup_LOW
            mov eax,edx
            shr eax,010h        //HIWORD(Delta)
            jmp _reloc_fixup_LOW_fixup        
_reloc_fixup_LOW:               // IMAGE_REL_BASED_LOW 
            dec eax
        jnz _reloc_fixup_HIGHLOW
        movzx eax,dx            //LOWORD(Delta)
_reloc_fixup_LOW_fixup:
            add word ptr [esi],ax// mem[x] = mem[x] + delta_ImageBase
        jmp _reloc_fixup_next_entry
_reloc_fixup_HIGHLOW:           // IMAGE_REL_BASED_HIGHLOW
            dec eax
        jnz _reloc_fixup_next_entry
        add [esi],edx           // mem[x] = mem[x] + delta_ImageBase
_reloc_fixup_next_entry:
        inc edi
        inc edi                 //Entry++
        loop _reloc_fixup_do_entry
_reloc_fixup_next_base:
    add ebx,[ebx+004h]
    jmp _reloc_fixup_block
_reloc_fixup_end:
    ...</PRE>
      <H3><A name=BuildaSpecialImporttable7_3>7.3 Build a Special Import 
      table</A></H3>
      <P>In order to support the <A href="http://en.wikipedia.org/wiki/OCX" 
      target=_blank>OLE-ActiveX Control</A> registration, we should present an 
      appropriate import table to our target OCX and DLL file.</P>
      <P>Therefore, I have established an import table by the following 
      string:</P><PRE lang=c++><SPAN class=code-keyword>const</SPAN> <SPAN class=code-keyword>char</SPAN> *sz_IT_OCX_strings[]=
{
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>Kernel32.dll"</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>LoadLibraryA"</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>GetProcAddress"</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>GetModuleHandleA"</SPAN>,
    <SPAN class=code-digit>0</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>User32.dll"</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>GetKeyboardType"</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>WindowFromPoint"</SPAN>,
    <SPAN class=code-digit>0</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>AdvApi32.dll"</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>RegQueryValueExA"</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>RegSetValueExA"</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>StartServiceA"</SPAN>,
    <SPAN class=code-digit>0</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>Oleaut32.dll"</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>SysFreeString"</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>CreateErrorInfo"</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>SafeArrayPtrOfIndex"</SPAN>,
    <SPAN class=code-digit>0</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>Gdi32.dll"</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>UnrealizeObject"</SPAN>,
    <SPAN class=code-digit>0</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>Ole32.dll"</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>CreateStreamOnHGlobal"</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>IsEqualGUID"</SPAN>,
    <SPAN class=code-digit>0</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>ComCtl32.dll"</SPAN>,
    <SPAN class=code-string>"</SPAN><SPAN class=code-string>ImageList_SetIconSize"</SPAN>,
    <SPAN class=code-digit>0</SPAN>,
    <SPAN class=code-digit>0</SPAN>,
};</PRE>
      <P>Without these API functions, the library can not be loaded, and 
      moreover the <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/com/html/4442206b-b2ad-47d7-8add-18002c44c5a2.asp" 
      target=_blank><CODE>DllregisterServer()</CODE></A> and <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/com/html/b71137a7-284e-4521-a3b2-9dad9c9d3c54.asp" 
      target=_blank><CODE>DllUregisterServer()</CODE></A> will not operate.</A> 
      In <CODE>CPECryptor::CryptFile</CODE>, I have distinguished between EXE 
      files and DLL files in the initialization of the new import table object 
      during creation:</P><PRE lang=c++><SPAN class=code-keyword>if</SPAN>(( image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>FileHeader.Characteristics 
             &amp; IMAGE_FILE_DLL ) == IMAGE_FILE_DLL )
{
    ImportTableMaker = <SPAN class=code-keyword>new</SPAN> CITMaker( IMPORT_TABLE_OCX );
}
<SPAN class=code-keyword>else</SPAN>
{
    ImportTableMaker = <SPAN class=code-keyword>new</SPAN> CITMaker( IMPORT_TABLE_EXE );
}</PRE>
      <H2><A name=PreservetheThreadLocalStorage8>8 Preserve the Thread Local 
      Storage</A></H2>
      <P>By using Thread Local Storage (TLS), a program is able to execute a 
      multithreaded process, this performance mostly is used by <A 
      href="http://www.borland.com/" target=_blank>Borland</A> linkers: <A 
      href="http://www.borland.com/us/products/delphi/index.html" 
      target=_blank>Delphi</A> and <A 
      href="http://www.borland.com/us/products/cbuilder/index.html" 
      target=_blank>C++ Builder</A>. When you pack a PE file, you should take 
      care to keep clean the TLS, otherwise, your packer will not support 
      Borland Delphi and C++ Builder linked EXE files. To comprehend TLS, I 
      refer you to section 6.7 of the <A 
      href="http://www.microsoft.com/whdc/system/platform/firmware/PECOFF.mspx" 
      target=_blank>Microsoft Portable Executable and Common Object File Format 
      Specification</A> document, you can observe the TLS structure by 
      <CODE>IMAGE_TLS_DIRECTORY32</CODE> in <I>winnt.h</I>.</P><PRE lang=c++><SPAN class=code-keyword>typedef</SPAN> <SPAN class=code-keyword>struct</SPAN> _IMAGE_TLS_DIRECTORY32 {
    DWORD   StartAddressOfRawData;
    DWORD   EndAddressOfRawData;
    DWORD   AddressOfIndex;
    DWORD   AddressOfCallBacks;
    DWORD   SizeOfZeroFill;
    DWORD   Characteristics;
} IMAGE_TLS_DIRECTORY32, * PIMAGE_TLS_DIRECTORY32;</PRE>
      <P>To keep safe the TLS directory, I have copied it in a special place 
      inside the loader:</P><PRE lang=text>...
_tls_dwStartAddressOfRawData:   dword_type(0xCCCCCCCC)
_tls_dwEndAddressOfRawData:     dword_type(0xCCCCCCCC)
_tls_dwAddressOfIndex:          dword_type(0xCCCCCCCC)
_tls_dwAddressOfCallBacks:      dword_type(0xCCCCCCCC)
_tls_dwSizeOfZeroFill:          dword_type(0xCCCCCCCC)
_tls_dwCharacteristics:         dword_type(0xCCCCCCCC)
...</PRE>
      <P>It is necessary to correct the TLS directory entry in the Optional 
      Header:</P><PRE lang=c++><SPAN class=code-keyword>if</SPAN>(image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>
  OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_TLS].
  VirtualAddress!=0)
{
    memcpy(&amp;pDataTable-<SPAN class=code-keyword>&gt;</SPAN>image_tls_directory,
           image_tls_directory,
           <SPAN class=code-keyword>sizeof</SPAN>(IMAGE_TLS_DIRECTORY32));    
    dwOffset=DWORD(pData1)-DWORD(pNewSection);
    dwOffset+=sizeof(t_DATA_1)-<SPAN class=code-keyword>sizeof</SPAN>(IMAGE_TLS_DIRECTORY32);
    image_nt_headers-<SPAN class=code-keyword>&gt;</SPAN>
      OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_TLS].
      VirtualAddress=dwVirtualAddress + dwOffset;
}</PRE>
      <H2><A name=Injectyourcode9>9 Inject your code</A></H2>
      <P>We are ready to place our code inside the new section. Our code is a 
      "Hello World!" message by <A 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/winui/winui/windowsuserinterface/windowing/dialogboxes/dialogboxreference/dialogboxfunctions/messagebox.asp" 
      target=_blank><CODE>MessageBox()</CODE></A> from <I>user32.dll</I>.</P><PRE lang=asm>    ...
    <SPAN class=code-keyword>push</SPAN> MB_OK | MB_ICONINFORMATION
    <SPAN class=code-keyword>lea</SPAN> eax,[ebp+_p_szCaption]
    <SPAN class=code-keyword>push</SPAN> <SPAN class=code-keyword>eax</SPAN>
    <SPAN class=code-keyword>lea</SPAN> eax,[ebp+_p_szText]
    <SPAN class=code-keyword>push</SPAN> <SPAN class=code-keyword>eax</SPAN>
    <SPAN class=code-keyword>push</SPAN> NULL
    <SPAN class=code-keyword>call</SPAN> _jmp_MessageBox
    // MessageBox(NULL, szText, szCaption, MB_OK | MB_ICONINFORMATION) <SPAN class=code-comment>;</SPAN><SPAN class=code-comment>
</SPAN>    ...</PRE>
      <H4><A name=PEMakerDownloadLink5>PE Maker - Step 5</A></H4>
      <UL class=download>
        <LI><A 
        href="http://www.codeproject.com/KB/system/inject2exe/pemaker5.zip">Download 
        source files - 71.7 Kb</A> </LI></UL>
      <P><IMG height=119 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/helloworld.gif" 
      width=146></P>
      <H2><A name=Conclusion10>10 Conclusion</A></H2>
      <P>By this article, you have perceived how easily we can inject code to a 
      portable executable file. You can complete the code by using the source of 
      other packers, create a packer in the same way as <A 
      href="http://yodap.sourceforge.net/" target=_blank>Yoda's Protector</A>, 
      and make your packer undetectable by mixing up with <A 
      href="http://www.hxdef.org/download.php" target=_blank>Morphine</A> source 
      code. I hope that you have enjoyed this brief discussion of one part of 
      the reverse engineering field. See you again in the next discussion!</P><!-- Article Ends --><!-- Main Page Contents End --></DIV></SPAN>
      <FORM id=aspnetForm 
      style="PADDING-RIGHT: 0px; PADDING-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-TOP: 0px" 
      name=aspnetForm action=inject2exe.aspx method=post>
      <DIV><INPUT id=__VIEWSTATE type=hidden 
      value=/wEPDwULLTEwMDUyNjYzMjhkZBxu14VRk3eoEYaPbp/0te9eaCu9 
      name=__VIEWSTATE> </DIV>
      <H2>License</H2>
      <DIV id=ctl00_LicenseTerms>
      <P>This article has no explicit license attached to it but may contain 
      usage terms in the article text or the download files themselves. If in 
      doubt please contact the author via the discussion board below.</P>
      <P>A list of licenses authors might use can be found <A 
      href="http://www.codeproject.com/info/Licenses.aspx">here</A></P></DIV>
      <H2>About the Author</H2>
      <TABLE cellSpacing=5 cellPadding=0 width="100%" border=0>
        <TBODY>
        <TR vAlign=top>
          <TD id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberPhotoTable 
          style="WIDTH: 155px" vAlign=top><B><A 
            id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberProfileLink 
            href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=1599836">Ashkbiz 
            Danehkar</A></B><BR><BR>
            <CENTER><IMG id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberPhoto 
            style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" 
            src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/{BABD49A1-25D7-4303-ADE7-800FC6561D3D}.jpg"></CENTER><BR><SPAN 
            class=SmallText 
            id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberType></SPAN></TD>
          <TD><BR>
            <TABLE>
              <TBODY>
              <TR id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_jobTitleRow>
                <TD class=SmallText noWrap>Occupation: </TD>
                <TD width="100%"><SPAN class=SmallText 
                  id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberJobTitle>Software 
                  Developer</SPAN></TD></TR>
              <TR id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_locationRow>
                <TD class=SmallText>Location: </TD>
                <TD width="100%"><SPAN class=SmallText 
                  id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberLocation><IMG 
                  height=11 alt=Germany 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/DE.gif" 
                  width=16> 
      Germany</SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><BR>
      <TABLE id=ctl00_PopularArticlesRow cellSpacing=0 cellPadding=0 
      width="100%" border=0>
        <TBODY>
        <TR vAlign=top>
          <TD style="WIDTH: 100%">
            <H2>Other popular Hardware &amp; System articles:</H2>
            <UL>
              <LI><A 
              href="http://www.codeproject.com/KB/system/xyntservice.aspx">Start 
              Your Windows Programs From An NT Service</A>
              <DIV class=SmallText>Make your MFC, VB and other Windows programs 
              behave like NT services.</DIV>
              <LI><A 
              href="http://www.codeproject.com/KB/system/serial.aspx">Serial 
              library for C++</A>
              <DIV class=SmallText>A high-performance, complete and compact 
              serial library for C++</DIV>
              <LI><A 
              href="http://www.codeproject.com/KB/system/driverdev.aspx">Driver 
              Development Part 1: Introduction to Drivers</A>
              <DIV class=SmallText>This article will go into the basics of 
              creating a simple driver.</DIV>
              <LI><A 
              href="http://www.codeproject.com/KB/system/hooksys.aspx">API 
              hooking revealed</A>
              <DIV class=SmallText>The article demonstrates how to build a user 
              mode Win32 API spying system</DIV>
              <LI><A 
              href="http://www.codeproject.com/KB/system/NoDeleteDelay.aspx">Eliminating 
              Explorer's delay when deleting an in-use file</A>
              <DIV class=SmallText>How to track down and patch an annoyance in 
              Windows Explorer's code.</DIV></LI></UL>
            <H2></H2></TD>
          <TD>
            <SCRIPT type=text/javascript>document.write(unescape("%3ca%20href%3d%22http%3a%2f%2fwww.codeproject.com%2fRedir.aspx%3fadid%3d6421%26way%3dban%22%20target%3d%22_blank%22%20rel%3d%22nofollow%22%3e%3cimg%20src%3d%22http%3a%2f%2fwww.codeproject.com%2fscript%2fAnn%2fServeImg.aspx%3fFile%3d%252fscript%252fadmentor%252fimages%252f300x250.png%26C%3dFalse%26id%3d6421%22%20alt%3d%22%22%20border%3d%220%22%20width%3d%22300%22%20height%3d%22250%22%3e%3c%2fa%3e"));</SCRIPT>
          </TD></TR></TBODY></TABLE>
      <DIV id=ctl00_AddTo_AddTo style="MARGIN: 10px">
      <SCRIPT language=JavaScript type=text/javascript>
var addtoMethod=1;
var AddURL = document.location.href;
var AddTitle = escape(document.title);
DrawLinks(100, 0, "SmallText Bold", "AddTo") 
</SCRIPT>
      </DIV>
      <TABLE class=RatingBar id=ctl00_RateArticleRow cellSpacing=0 cellPadding=0 
      width="100%" border=0>
        <TBODY>
        <TR>
          <TD><A 
            href="http://www.codeproject.com/KB/system/inject2exe.aspx#_top">Article 
            Top</A></TD>
          <TD align=right>
            <TABLE cellSpacing=0 cellPadding=0 width="100%">
              <TBODY>
              <TR>
                <TD id=ctl00_RateArticle_VoteResultDiv noWrap align=right 
                width="100%"><SPAN id=voteRes></SPAN><IMG id=loaderImg 
                  style="DISPLAY: none" height=16 alt=loading... 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/ajax-loader.gif" 
                  width=16> </TD>
                <TD class=SmallText id=voteTbl style="WHITE-SPACE: nowrap" 
                align=right>
                  <TABLE>
                    <TBODY>
                    <TR>
                      <TD id=ctl00_RateArticle_RateText 
                      style="PADDING-RIGHT: 5px; WHITE-SPACE: nowrap"><I><B>Rate 
                        this Article for us!</B></I></TD>
                      <TD id=ctl00_RateArticle_StartForm 
                        align=right><I>&nbsp;&nbsp;Poor</I></TD>
                      <TD id=ctl00_RateArticle_VoteFormDiv 
                      style="WHITE-SPACE: nowrap" align=left>
                        <TABLE id=ctl00_RateArticle_VoteRBL border=0>
                          <TBODY>
                          <TR>
                            <TD><INPUT id=ctl00_RateArticle_VoteRBL_0 
                              type=radio value=1 
                            name=ctl00$RateArticle$VoteRBL></TD>
                            <TD><INPUT id=ctl00_RateArticle_VoteRBL_1 
                              type=radio value=2 
                            name=ctl00$RateArticle$VoteRBL></TD>
                            <TD><INPUT id=ctl00_RateArticle_VoteRBL_2 
                              type=radio value=3 
                            name=ctl00$RateArticle$VoteRBL></TD>
                            <TD><INPUT id=ctl00_RateArticle_VoteRBL_3 
                              type=radio value=4 
                            name=ctl00$RateArticle$VoteRBL></TD>
                            <TD><INPUT id=ctl00_RateArticle_VoteRBL_4 
                              type=radio value=5 
                            name=ctl00$RateArticle$VoteRBL></TD></TR></TBODY></TABLE></TD>
                      <TD id=ctl00_RateArticle_EndForm noWrap 
                        align=left><I>Excellent</I> <INPUT class=FormButton id=ctl00_RateArticle_SubmitRateBtn onclick="return rateItem(12532,2);" type=submit value=Vote name=ctl00$RateArticle$SubmitRateBtn> 
                      </TD>
                      <TD><SPAN 
                    id=ctl00_RateArticle_ErrorMessage></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
      <DIV><INPUT id=__EVENTVALIDATION type=hidden 
      value=/wEWCAKzxKXqAQLAlMXDBwLBlMXDBwLClMXDBwLDlMXDBwLElMXDBwLP+++tCwK5upDkC2DGzQbdfFC5+QzHOQYdl/myMeS9 
      name=__EVENTVALIDATION> </DIV></FORM>
      <DIV 
      style="PADDING-RIGHT: 10px; PADDING-LEFT: 10px; PADDING-BOTTOM: 10px; OVERFLOW: hidden; PADDING-TOP: 10px; WHITE-SPACE: nowrap; TEXT-ALIGN: center">
      <SCRIPT type=text/javascript>document.write(unescape("%3ca%20href%3d%22http%3a%2f%2fwww.codeproject.com%2fRedir.aspx%3fadid%3d6287%26way%3dban%22%20target%3d%22_blank%22%20rel%3d%22nofollow%22%3e%3cimg%20src%3d%22http%3a%2f%2fwww.codeproject.com%2fscript%2fAnn%2fServeImg.aspx%3fFile%3d%252fscript%252fadmentor%252fimages%252fWholeTomato_AutoSuggest_468x60_Original_newfont.gif%26C%3dFalse%26id%3d6287%22%20alt%3d%22The%20intellisense%20upgrade%20for%20Visual%20Studio%20.NET%20-%20make%20your%20IDE%20as%20smart%20as%20you.%22%20border%3d%220%22%20width%3d%22468%22%20height%3d%2260%22%3e%3c%2fa%3e"));</SCRIPT>
      <IFRAME src="res://C:\WINDOWS\system32\shdoclc.dll/dnserror.htm" 
      frameBorder=0 width=300 scrolling=no height=60></IFRAME></DIV><A 
      name=_comments></A><!-- Forum Start -->
      <DIV id=_MessageBoard onclick="return SwitchMessage(event, null)">
      <TABLE class=Frm_MainTable id=ForumTable cellSpacing=0 cellPadding=0>
        <TBODY>
        <TR>
          <TD>
            <FORM 
            style="PADDING-RIGHT: 0px; PADDING-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-TOP: 0px" 
            action=/script/Forums/SetOptions.aspx?floc=%2fKB%2fsystem%2finject2exe.aspx&amp;fid=250020 
            method=get><INPUT type=hidden value=250020 name=fid><INPUT 
            type=hidden 
            value=?floc=%2fKB%2fsystem%2finject2exe.aspx&amp;fid=250020 
            name=currentQS><INPUT type=hidden value=/KB/system/inject2exe.aspx 
            name=floc>
            <TABLE cellSpacing=0 cellPadding=3 width="100%" border=0>
              <TBODY>
              <TR class=Frm_HeaderRow1>
                <TD style="WHITE-SPACE: nowrap"><IMG height=16 alt=FAQ 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/forum_faq.gif" 
                  width=16 align=middle border=0>&nbsp;<A 
                  href="http://www.codeproject.com/script/Forums/FAQ.aspx"><B>FAQ</B></A>&nbsp;</TD>
                <TD style="WHITE-SPACE: nowrap; TEXT-ALIGN: right">Noise 
                  Tolerance<SELECT class=Frm_DropDown size=1 name=noise> 
                    <OPTION value=1>Very High</OPTION><OPTION 
                    value=2>High</OPTION><OPTION value=3 
                    selected>Medium</OPTION><OPTION value=4>Low</OPTION><OPTION 
                    value=5>Very Low</OPTION></SELECT></TD>
                <TD style="WHITE-SPACE: nowrap; TEXT-ALIGN: right" 
                  colSpan=2><IMG height=15 alt=Search 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/forum_search.gif" 
                  width=16 align=top border=0>&nbsp;<A 
                  href="http://www.codeproject.com/script/Forums/Search.aspx?fid=250020">Search 
                  Messages</A>&nbsp;</TD>
                <TD style="TEXT-ALIGN: right"><INPUT class=Frm_Button type=submit value="Set Options" name=submit></TD></TR>
              <TR class=Frm_HeaderRow2>
                <TD style="WIDTH: 100%">&nbsp;</TD>
                <TD 
                  style="WHITE-SPACE: nowrap; TEXT-ALIGN: right">Layout<SELECT 
                  class=Frm_DropDown size=1 name=view> <OPTION value=Quick 
                    selected>Normal</OPTION><OPTION value=Topic>Expand Root 
                    Messages</OPTION><OPTION value=Expanded>Expand All 
                    Messages</OPTION><OPTION value=Thread>Thread 
                    View</OPTION><OPTION value=Normal>No Javascript 
                    (slow)</OPTION><OPTION value=Preview>No Javascript 
                    Preview</OPTION></SELECT>&nbsp;&nbsp;</TD>
                <TD style="WHITE-SPACE: nowrap">Per page<SELECT 
                  class=Frm_DropDown size=1 name=mpp> <OPTION 
                    value=10>10</OPTION><OPTION value=25 
                    selected>25</OPTION><OPTION 
                  value=50>50</OPTION></SELECT>&nbsp;&nbsp;</TD>
                <TD colSpan=2>&nbsp;</TD></TR></TBODY></TABLE></FORM></TD></TR>
        <TR>
          <TD><A name=xx0xx></A>
            <TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
              <TBODY>
              <TR class=Frm_NavigationBar>
                <TD><IMG height=16 alt=new 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/forum_newmsg.gif" 
                  width=16 align=top border=0><A class=Frm_HL 
                  title="Create a new message thread" 
                  href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;floc=/KB/system/inject2exe.aspx" 
                  target=_top name=Frm_HoverNL><B>New Message</B></A></TD>
                <TD>Msgs 1 to 25 of 69 (Total in Forum: 69) (<A 
                  href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020">Refresh</A>)</TD>
                <TD style="WHITE-SPACE: nowrap; TEXT-ALIGN: right"><SPAN 
                  class=Frm_HL>First</SPAN><SPAN class=Frm_HL>Prev</SPAN><A 
                  class=Frm_HL 
                  href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;fr=26#xx0xx" 
                  name=Frm_HoverNL>Next</A></TD></TR></TBODY></TABLE></TD></TR>
        <TR>
          <TD>
            <TABLE class=Frm_MsgTable cellSpacing=0 cellPadding=0 width="100%" 
            border=0><!-- Column Headers -->
              <TBODY>
              <TR class=Frm_ColumnHeaders>
                <TD style="WIDTH: 100%">
                  <TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
                    <TBODY>
                    <TR>
                      <TD>Subject&nbsp;</TD>
                      <TD class=Frm_MsgAuthor>&nbsp;Author&nbsp;</TD>
                      <TD 
              class=Frm_MsgDate>Date&nbsp;</TD></TR></TBODY></TABLE></TD></TR>
              <TR>
                <TD><IMG height=5 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F2550053_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2550053xx></A><IMG height=16 alt=General 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=2550053#xx2550053xx" 
                        name=2550053>HexEdit has PE template [modified]</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=12099">Andrew 
                        Phillips</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">2:33 13 
                        May '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2550053_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Nice article.<BR><BR>I did notice 
                                that you mentioned the WinHex hex editor. I have 
                                not used it but I think HexEdit has a definite 
                                advantage in this area because of it's advanced 
                                templates. The templates let you analyze and 
                                describe very complicated file formats. For 
                                example, there is a template for PE (EXE/DLL) 
                                files. It does many things that dedicated 
                                programs (like PEview.exe etc) can't do like 
                                show individual bits, allow you to change fields 
                                (using a drop-list of appropriate values for 
                                ENUM fields), etc.<BR><BR>The free version of 
                                HexEdit (2.5F) can be obtained from <A 
                                href="http://www.hexedit.com/">http://www.hexedit.com/</A>. 
                                The PE template only supports IMPORT, EXPORT and 
                                RESOURCE tables currently but it is easy to add 
                                more. <BR><BR>
                                <DIV class=ForumSig>Andrew 
                                Phillips<BR>http://www.hexedit.com<BR>andrew @ 
                                hexedit.com</DIV><BR>
                                <DIV class=ForumMod>modified on Tuesday, May 13, 
                                2008 5:39 AM</DIV><BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2550053&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2550053&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=2550053">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=2550053">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=2550053&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2550053 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(12099,2550053,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=F2611129_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=34><A 
                        name=xx2611129xx></A><IMG height=16 alt=General 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=2611129#xx2611129xx" 
                        name=2611129>Re: HexEdit has PE template</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=3968794">skinui</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">20:36 
                        24 Jun '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2611129_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 34px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>study <BR><BR>
                                <DIV 
                                class=ForumSig>http://www.skinui.com</DIV><BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2611129&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2611129&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=2550053">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=2611129">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=2611129&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2611129 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(3968794,2611129,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F2456141_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2456141xx></A><IMG height=16 alt=General 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=2456141#xx2456141xx" 
                        name=2456141>Greate!!</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=4859570">xx0boy</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">1:42 7 
                        Mar '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2456141_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD 
                                colSpan=2>?????????,????????PE?????????,???????????vc????????????,??????????????,??!???????????????vc??,????PE???????,??????xx00boy@163.com,??,xx???????????,<BR>??!!!! 
                                <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2456141&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2456141&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=2456141">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=2456141">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=2456141&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2456141 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(4859570,2456141,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F2415199_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2415199xx></A><IMG height=16 alt=General 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=2415199#xx2415199xx" 
                        name=2415199>resize the code section</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=2151276">zon_cpp</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">1:03 5 
                        Feb '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2415199_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>hi!<BR>can i resize the code 
                                section of a PE file?<BR>for example: i want to 
                                add 100 bytes(fill with 0x90) end of the code 
                                section.<BR>i change values of "SizeOfRawData" 
                                and "VirtualSize" for Code Section header. and i 
                                change values of "PointerToRawData" and 
                                "VirtualAddress" for next sections.<BR>but the 
                                new PE file don't execute. <BR><BR>
                                <DIV 
                                class=ForumSig>Zo.Naderi-Iran</DIV><BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2415199&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2415199&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=2415199">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=2415199">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=2415199&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2415199 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(2151276,2415199,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F2412755_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2412755xx></A><IMG height=16 alt=Question 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_question.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=2412755#xx2412755xx" 
                        name=2412755>how to run exe in a panel or groupbox 
                        control in vb.net</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=3876137">kk_upadhyay</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">4:10 2 
                        Feb '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2412755_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>hi,<BR><BR>i am making an 
                                application in vb.net.<BR>i want to run an exe 
                                in the panel or groupbox in the particular 
                                form.<BR>i am able to run exe within the form 
                                but how can i run it with in the panel of a 
                                particular form. <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2412755&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2412755&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=2412755">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=2412755">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=2412755&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2412755 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(3876137,2412755,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F2390033_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2390033xx></A><IMG height=16 alt=General 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=2390033#xx2390033xx" 
                        name=2390033>to disable incremental linking in Delphi 
                        project</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=2151276">zon_cpp</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">23:32 
                        14 Jan '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2390033_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>how do i disable "incremental 
                                linking" in my delphi project? <BR><BR>
                                <DIV 
                                class=ForumSig>Zo.Naderi-Iran</DIV><BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2390033&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2390033&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=2390033">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=2390033">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=2390033&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2390033 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(2151276,2390033,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=F2390340_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=34><A 
                        name=xx2390340xx></A><IMG height=16 alt=General 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=2390340#xx2390340xx" 
                        name=2390340>Re: to disable incremental linking in 
                        Delphi project</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=2151276">zon_cpp</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">4:11 15 
                        Jan '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2390340_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 34px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>excuse me.<BR>we don't need "to 
                                disable incremental linking" in Delphi project. 
                                becuase in delphi, function name is its address 
                                <BR><BR>
                                <DIV 
                                class=ForumSig>Zo.Naderi-Iran</DIV><BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2390340&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2390340&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=2390033">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=2390340">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=2390340&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2390340 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(2151276,2390340,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd LoVote Rt HdUnSel " id=F2345981_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2345981xx></A><IMG height=16 alt=Question 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_question.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=2345981#xx2345981xx" 
                        name=2345981>How can I inject the exe at run 
time?</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=3818827">code_discuss</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">0:00 4 
                        Dec '07 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2345981_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Greate article.<BR><BR>But your 
                                solution changes the binary exe file. So my 
                                question is can I inject the exe in memory at 
                                run time? the exe binary file will be intact. 
                                <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2345981&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2345981&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=2345981">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=2345981">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=2345981&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2345981 
                                style="WHITE-SPACE: nowrap">1.20/5 (2 votes)
                                <SCRIPT type=text/javascript>
												MsgVFrm(3818827,2345981,false,"","","");
											</SCRIPT>
                                 
                        </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F2235881_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2235881xx></A><IMG height=16 alt=General 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=2235881#xx2235881xx" 
                        name=2235881>new exe and old exe</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=2151276">zon_cpp</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">0:49 20 
                        Sep '07 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2235881_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Hi!<BR>in an exe, the address of 
                                code section is 0x409000 (for example).<BR>i 
                                inject my loader in this exe, and new exe run 
                                correctly and there isn't any possible.<BR>i 
                                change some codes in code section of exe, and in 
                                my loader, i undo this work(i change the some 
                                codes to main code in loader). then my exe 
                                execute correctly.<BR>but i have a question: 
                                when the exe (old exe) is running, then i run my 
                                exe (new exe). loader of new exe writes some 
                                data (to change some codes to achieve main code) 
                                in code section. why dosn't this work (to change 
                                some code) do in code section of old exe? whiles 
                                code section addresses of old and new exe are 
                                same 0x409000 <BR><BR>
                                <DIV 
                                class=ForumSig>Zo.Naderi-Iran</DIV><BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2235881&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2235881&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=2235881">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=2235881">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=2235881&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2235881 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(2151276,2235881,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd LoVote Rt HdUnSel " id=F1998963_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx1998963xx></A><IMG height=16 alt=General 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=1998963#xx1998963xx" 
                        name=1998963>Without PE Maker</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=1332810">ERLN</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">4:20 20 
                        Apr '07 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F1998963_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>I have Visual C++ 6.0.<BR><BR>Is 
                                it possible to write some custom data inside the 
                                executable section.?<BR>(it may be any 
                                section)<BR><BR>Whenever Executable executed it 
                                has to refer that data and then proceed like 
                                that. <BR><BR>Some times executable modify the 
                                custom data and write to the 
                                executable.<BR><BR><BR>Is is possible in the 
                                progaramming itself. ?<BR><BR>Everything should 
                                present in single executable 
                                file.<BR><BR><BR>Simply I need to protect 
                                executable protection based on some data. 
                                <BR><BR>RLN Simha<BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1998963&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1998963&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=1998963">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=1998963">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=1998963&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF1998963 
                                style="WHITE-SPACE: nowrap">2.00/5 (1 vote)
                                <SCRIPT type=text/javascript>
												MsgVFrm(1332810,1998963,false,"","","");
											</SCRIPT>
                                 
                        </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F1989330_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx1989330xx></A><IMG height=16 alt=General 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=1989330#xx1989330xx" 
                        name=1989330>new apis to import table</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=2062976">suriw2</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">8:59 14 
                        Apr '07 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F1989330_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>HI, i have a problem - i'm able to 
                                add new section to PE file, also to change an 
                                entry point, but i don't know how to 'fill' the 
                                new code section i need to import new api (like 
                                messagebox) into table and then insert code like 
                                'call messagebox "my text"' to my new section.. 
                                i dont know how to ADD new entries to import 
                                table and also i don't know how in asm call the 
                                new api.. (and also where am i supposed to save 
                                my string "my text") ... the program is for 
                                school and it may infect specific .exe with 
                                calling a messagebox as first... please 
                                help<BR><BR>please write on mail: 
                                vl4dik@gmail.com <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1989330&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1989330&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=1989330">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=1989330">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=1989330&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF1989330 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(2062976,1989330,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F1950682_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx1950682xx></A><IMG height=16 alt=General 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=1950682#xx1950682xx" 
                        name=1950682>Problems during compilation</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=3943233">p_maroun</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">19:32 
                        20 Mar '07 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F1950682_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2><IMG title=Smile 
                                src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/smiley_smile.gif" 
                                align=top>Hi,<BR>First of all i want to 
                                congratulate you for the work you have done and 
                                many thanks for the advices you gave about the 
                                PE MAKER. Besides i would like to know how to 
                                compile the source files you putted on the page 
                                because when iam trying to build it, it 
                                generates 60 errors.<BR><BR>here's the origins 
                                of the 
                                errors:<BR><BR>Compiling...<BR>loader.cpp<BR>c:\documents 
                                and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.h(39) 
                                : error C2062: type 'void' 
                                unexpected<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(41) 
                                : error C2062: type 'void' 
                                unexpected<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(62) 
                                : error C2062: type 'void' 
                                unexpected<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(63) 
                                : error C2143: syntax error : missing ';' before 
                                '{'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(63) 
                                : error C2447: '{' : missing function header 
                                (old-style formal list?)<BR>c:\documents and 
                                settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(84) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(85) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(95) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(96) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(96) 
                                : error C2041: illegal digit '8' for base 
                                '8'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(99) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(104) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(137) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(154) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(155) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(162) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(174) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(176) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(196) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(196) 
                                : error C2041: illegal digit '8' for base 
                                '8'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(201) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(223) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(224) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(232) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(235) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(235) 
                                : error C2041: illegal digit '8' for base 
                                '8'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(236) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(237) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(237) 
                                : error C2041: illegal digit '8' for base 
                                '8'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(242) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(245) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(255) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(279) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(302) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(306) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(312) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(329) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(329) 
                                : error C2041: illegal digit '8' for base 
                                '8'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(331) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(345) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(346) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(349) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(360) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(372) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(385) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(386) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(389) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(406) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(410) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(413) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(416) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.cpp(417) 
                                : error C2059: syntax error : 'bad suffix on 
                                number'<BR>pecrypt.cpp<BR>c:\documents and 
                                settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\loader.h(39) 
                                : error C2062: type 'void' 
                                unexpected<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\pecrypt.cpp(100) 
                                : error C2065: 'DynLoader' : undeclared 
                                identifier<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\pecrypt.cpp(100) 
                                : error C2514: 'DWORD' : class has no 
                                constructors<BR>c:\program files\microsoft 
                                visual studio 
                                8\vc\platformsdk\include\windef.h(151) : see 
                                declaration of 'DWORD'<BR>c:\documents and 
                                settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\pecrypt.cpp(101) 
                                : error C2514: 'DWORD' : class has no 
                                constructors<BR>c:\program files\microsoft 
                                visual studio 
                                8\vc\platformsdk\include\windef.h(151) : see 
                                declaration of 'DWORD'<BR>c:\documents and 
                                settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\pecrypt.cpp(101) 
                                : warning C4311: '' : pointer truncation from 
                                'PCHAR' to 'DWORD'<BR>c:\documents and 
                                settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\pecrypt.cpp(174) 
                                : warning C4311: '' : pointer truncation from 
                                'PCHAR' to 'DWORD'<BR>c:\documents and 
                                settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\pecrypt.cpp(174) 
                                : warning C4311: '' : pointer truncation from 
                                'PCHAR' to 'DWORD'<BR>c:\documents and 
                                settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\pecrypt.cpp(187) 
                                : warning C4267: '+=' : conversion from 'size_t' 
                                to 'DWORD', possible loss of 
                                data<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\pecrypt.cpp(195) 
                                : warning C4267: '+=' : conversion from 'size_t' 
                                to 'DWORD', possible loss of 
                                data<BR>pelib.cpp<BR>c:\documents and 
                                settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\pelib.cpp(90) 
                                : error C2065: 'i' : undeclared 
                                identifier<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\pelib.cpp(90) 
                                : error C2227: left of '-&gt;VirtualAddress' 
                                must point to class/struct/union/generic 
                                type<BR>c:\documents and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\pelib.cpp(91) 
                                : error C2227: left of '-&gt;Misc' must point to 
                                class/struct/union/generic type<BR>c:\documents 
                                and settings\pm 
                                force\bureau\pemaker5\pemaker5\pemaker\pelib.cpp(91) 
                                : error C2228: left of '.VirtualSize' must have 
                                class/struct/union<BR>Generating 
                                Code...<BR><BR>If you can explain it to me it 
                                would be very kind of you.<BR><BR>Best 
                                Regards,<BR><BR>A Student. <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1950682&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1950682&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=1950682">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=1950682">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=1950682&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF1950682 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(3943233,1950682,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=F1978146_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=34><A 
                        name=xx1978146xx></A><IMG height=16 alt=General 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=1978146#xx1978146xx" 
                        name=1978146>Re: Problems during compilation</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=1599836">Ashkbiz 
                        Danehkar</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">10:06 6 
                        Apr '07 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F1978146_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 34px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Use Visual Studio 2003 or higher 
                                version to compile... <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1978146&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1978146&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=1950682">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=1978146">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=1978146&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF1978146 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(1599836,1978146,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=F2008784_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=52><A 
                        name=xx2008784xx></A><IMG height=16 alt=Question 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_question.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=2008784#xx2008784xx" 
                        name=2008784>Re: Problems during compilation</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=1732238">raghunathan 
                        srinivasan</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">15:32 
                        26 Apr '07 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2008784_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 52px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Hi,<BR><BR>I am using Visual 
                                Studio 2005 professional edition. I seem to be 
                                having a similar problem as well. the errors 
                                are: <BR><BR><BR>Error 1 error C2062: type 
                                'void' unexpected 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.h 39 
                                <BR>Error 2 error C2062: type 'void' unexpected 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                41 <BR>Error 3 error C2062: type 'void' 
                                unexpected 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                62 <BR>Error 4 error C2143: syntax error : 
                                missing ';' before '{' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                63 <BR>Error 5 error C2447: '{' : missing 
                                function header (old-style formal list?) 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                63 <BR>Error 6 error C2059: syntax error : 'bad 
                                suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                84 <BR>Error 7 error C2059: syntax error : 'bad 
                                suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                85 <BR>Error 8 error C2059: syntax error : 'bad 
                                suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                95 <BR>Error 9 error C2059: syntax error : 'bad 
                                suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                96 <BR>Error 10 error C2041: illegal digit '8' 
                                for base '8' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                96 <BR>Error 11 error C2059: syntax error : 'bad 
                                suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                99 <BR>Error 12 error C2059: syntax error : 'bad 
                                suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                104 <BR>Error 13 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                137 <BR>Error 14 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                154 <BR>Error 15 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                155 <BR>Error 16 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                162 <BR>Error 17 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                174 <BR>Error 18 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                176 <BR>Error 19 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                196 <BR>Error 20 error C2041: illegal digit '8' 
                                for base '8' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                196 <BR>Error 21 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                201 <BR>Error 22 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                223 <BR>Error 23 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                224 <BR>Error 24 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                232 <BR>Error 25 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                235 <BR>Error 26 error C2041: illegal digit '8' 
                                for base '8' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                235 <BR>Error 27 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                236 <BR>Error 28 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                237 <BR>Error 29 error C2041: illegal digit '8' 
                                for base '8' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                237 <BR>Error 30 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                242 <BR>Error 31 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                245 <BR>Error 32 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                255 <BR>Error 33 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                279 <BR>Error 34 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                302 <BR>Error 35 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                306 <BR>Error 36 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                312 <BR>Error 37 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                329 <BR>Error 38 error C2041: illegal digit '8' 
                                for base '8' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                329 <BR>Error 39 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                331 <BR>Error 40 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                345 <BR>Error 41 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                346 <BR>Error 42 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                349 <BR>Error 43 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                360 <BR>Error 44 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                372 <BR>Error 45 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                385 <BR>Error 46 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                386 <BR>Error 47 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                389 <BR>Error 48 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                406 <BR>Error 49 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                410 <BR>Error 50 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                413 <BR>Error 51 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                416 <BR>Error 52 error C2059: syntax error : 
                                'bad suffix on number' 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.cpp 
                                417 <BR>Error 53 error C2062: type 'void' 
                                unexpected 
                                f:\thesis\pemaker5\pemaker5\pemaker\loader.h 39 
                                <BR>Error 54 error C2065: 'DynLoader' : 
                                undeclared identifier 
                                f:\thesis\pemaker5\pemaker5\pemaker\pecrypt.cpp 
                                100 <BR>Error 55 error C2514: 'DWORD' : class 
                                has no constructors 
                                f:\thesis\pemaker5\pemaker5\pemaker\pecrypt.cpp 
                                100 <BR>Error 56 error C2514: 'DWORD' : class 
                                has no constructors 
                                f:\thesis\pemaker5\pemaker5\pemaker\pecrypt.cpp 
                                101 <BR>Warning 57 warning C4311: 
                                '<FUNCTION-STYLE-CAST>' : pointer truncation 
                                from 'PCHAR' to 'DWORD' 
                                f:\thesis\pemaker5\pemaker5\pemaker\pecrypt.cpp 
                                101 <BR>Warning 58 warning C4311: 
                                '<FUNCTION-STYLE-CAST>' : pointer truncation 
                                from 'PCHAR' to 'DWORD' 
                                f:\thesis\pemaker5\pemaker5\pemaker\pecrypt.cpp 
                                174 <BR>Warning 59 warning C4311: 
                                '<FUNCTION-STYLE-CAST>' : pointer truncation 
                                from 'PCHAR' to 'DWORD' 
                                f:\thesis\pemaker5\pemaker5\pemaker\pecrypt.cpp 
                                174 <BR>Warning 60 warning C4267: '+=' : 
                                conversion from 'size_t' to 'DWORD', possible 
                                loss of data 
                                f:\thesis\pemaker5\pemaker5\pemaker\pecrypt.cpp 
                                187 <BR>Warning 61 warning C4267: '+=' : 
                                conversion from 'size_t' to 'DWORD', possible 
                                loss of data 
                                f:\thesis\pemaker5\pemaker5\pemaker\pecrypt.cpp 
                                195 <BR>Error 62 error C2065: 'i' : undeclared 
                                identifier 
                                f:\thesis\pemaker5\pemaker5\pemaker\pelib.cpp 90 
                                <BR>Error 63 error C2227: left of 
                                '-&gt;VirtualAddress' must point to 
                                class/struct/union/generic type 
                                f:\thesis\pemaker5\pemaker5\pemaker\pelib.cpp 90 
                                <BR>Error 64 error C2227: left of '-&gt;Misc' 
                                must point to class/struct/union/generic type 
                                f:\thesis\pemaker5\pemaker5\pemaker\pelib.cpp 91 
                                <BR>Error 65 error C2228: left of '.VirtualSize' 
                                must have class/struct/union 
                                f:\thesis\pemaker5\pemaker5\pemaker\pelib.cpp 91 
                                <BR><BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2008784&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2008784&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=1950682">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=2008784">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=2008784&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2008784 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(1732238,2008784,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd LoVote HdUnSel " id=F2008802_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=70><A 
                        name=xx2008802xx></A><IMG height=16 alt=Answer 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_answer.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=2008802#xx2008802xx" 
                        name=2008802>Re: Problems during compilation</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=1599836">Ashkbiz 
                        Danehkar</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">15:59 
                        26 Apr '07 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2008802_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 70px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>I have compiled them using Visual 
                                Studio 2003. Try to find the correct headers and 
                                compile them. <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2008802&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=2008802&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=1950682">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=2008802">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=2008802&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2008802 
                                style="WHITE-SPACE: nowrap">1.50/5 (2 votes)
                                <SCRIPT type=text/javascript>
												MsgVFrm(1599836,2008802,false,"","","");
											</SCRIPT>
                                 
                        </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd LoVote Rt HdUnSel " id=F1719085_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx1719085xx></A><IMG height=16 alt=Question 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_question.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=1719085#xx1719085xx" 
                        name=1719085>In Windows XP ,Make Advapi32.dll Reboot 
                        Error!!!!!! Why????</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=3104431">jiwenxiangjiwenxiang</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">23:12 
                        18 Oct '06 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F1719085_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>In Windows XP ,Make Advapi32.dll 
                                Reboot Error!!!!!! Why???? <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1719085&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1719085&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=1719085">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=1719085">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=1719085&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF1719085 
                                style="WHITE-SPACE: nowrap">1.00/5 (1 vote)
                                <SCRIPT type=text/javascript>
												MsgVFrm(3104431,1719085,false,"","","");
											</SCRIPT>
                                 
                        </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F1673640_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx1673640xx></A><IMG height=16 alt=Question 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_question.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=1673640#xx1673640xx" 
                        name=1673640>Works 75% of time?</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=1787201">mike_f1</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">8:48 18 
                        Sep '06 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F1673640_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Excellent tutorial, its helped me 
                                learn a lot about PE files, assembly and how 
                                they work. <BR><BR>It works in *almost* all 
                                application I have tried it with but in 2 
                                aplications (business finance applications) I 
                                have found the code injects ok and the 
                                messagebox is displayed but the program then 
                                crashes. Running it through OllyDbg it seems in 
                                some case the code at the OEP is correct but 
                                malformed. e.g. instead of this (as it should be 
                                at the OEP):<BR><BR><PRE>9C          PUSHFD<BR>60          PUSHFD<BR>60          PUSHFD<BR>E8 00000000 CALL exename.004018A6</PRE><BR><BR>It 
                                displays:<BR><BR><PRE>9C         DB 9C<BR>60         DB 60<BR>60         DB 60<BR>E8         DB E8<BR>00         DB 00<BR>00         DB 00<BR>00         DB 00<BR>00         DB 00</PRE><BR><BR>These 
                                commands aren't correct, despite the hex being 
                                correct, and the program crashes.<BR><BR>What 
                                could be causing this? Are there any paticular 
                                programs where this injector code won't 
                                work?<BR><BR>Thanks,<BR>Mike <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1673640&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1673640&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=1673640">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=1673640">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=1673640&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF1673640 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(1787201,1673640,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=F1978169_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=34><A 
                        name=xx1978169xx></A><IMG height=16 alt=Answer 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_answer.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=1978169#xx1978169xx" 
                        name=1978169>Re: Works 75% of time?</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=1599836">Ashkbiz 
                        Danehkar</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">10:19 6 
                        Apr '07 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F1978169_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 34px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>I think the most "business finance 
                                applications" are written in .net application. 
                                If you inject to them, the inject code will 
                                work, but the entire of executable file will be 
                                corrupted... injection to "dot net" technology 
                                is different form native windows application. 
                                Indeed, ".net" applications are code which run 
                                inside a virtual machine similar to Java 
                                engine... <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1978169&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1978169&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=1673640">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=1978169">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=1978169&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF1978169 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(1599836,1978169,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd LoVote Rt HdUnSel " id=F1666549_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx1666549xx></A><IMG height=16 alt=General 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=1666549#xx1666549xx" 
                        name=1666549>ocx to exe</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=2926098">Rinu_Raj</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">22:35 
                        12 Sep '06 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F1666549_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Can u please tell me what all we 
                                have to do to convert an .ocx to .exe 
                                <BR><BR>Regards<BR>RinuRaj<BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1666549&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1666549&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=1666549">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=1666549">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=1666549&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF1666549 
                                style="WHITE-SPACE: nowrap">1.17/5 (3 votes)
                                <SCRIPT type=text/javascript>
												MsgVFrm(2926098,1666549,false,"","","");
											</SCRIPT>
                                 
                        </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F1653490_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx1653490xx></A><IMG height=16 alt=Question 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_question.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=1653490#xx1653490xx" 
                        name=1653490>a small question of _except_handler 
                        [modified]</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=2017966">sandrain_zeq</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">7:03 3 
                        Sep '06 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F1653490_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2><IMG title=Smile 
                                src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/smiley_smile.gif" 
                                align=top>Great Article!<BR>Your codes works 
                                fine on my machine, but when I inject a exe file 
                                such as calc.exe twice or more times, the 
                                original codes were never executed!:(After 
                                tracing the codes by using ollydbg, I find it is 
                                the _except_handler that makes this. To be 
                                honest, I do not know the reason of restoring 
                                original SEH in our _except_handler, but the 
                                fact is that FS:[0] will be (FFFFFFFF) when we 
                                push it to stack at the second round (that is 
                                when the first injected code were executed). So 
                                I just remark out following codes in 
                                _except_handler:<BR><BR>// restore original 
                                SEH<BR>MOV EDI,DWORD PTR DS:[EAX+0C4h] // 
                                pContext.Esp<BR>PUSH DWORD PTR DS:[EDI]<BR>POP 
                                DWORD PTR FS:[0]<BR>ADD DWORD PTR 
                                DS:[EAX+0C4h],8 // pContext.Esp<BR><BR><BR>ha! 
                                It works fine!<IMG title=Smile 
                                src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/smiley_smile.gif" 
                                align=top><BR>So what's the original purpose of 
                                these codes?<IMG title=Confused 
                                src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/smiley_confused.gif" 
                                align=top> <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1653490&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1653490&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=1653490">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=1653490">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=1653490&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF1653490 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(2017966,1653490,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=F1978158_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=34><A 
                        name=xx1978158xx></A><IMG height=16 alt=Answer 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_answer.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=1978158#xx1978158xx" 
                        name=1978158>Re: a small question of 
                      _except_handler</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=1599836">Ashkbiz 
                        Danehkar</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">10:13 6 
                        Apr '07 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F1978158_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 34px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2><BR>
                                <BLOCKQUOTE class=FQ>
                                <DIV class=FQA>sandrain_zeq wrote:</DIV>Your 
                                codes works fine on my machine, but when I 
                                inject a exe file such as calc.exe twice or more 
                                times, the original codes were never 
                                executed!</BLOCKQUOTE><BR><BR>In twice 
                                injection, you will corrupt Import Table in this 
                                sample code...<BR><BR><BR>
                                <BLOCKQUOTE class=FQ>
                                <DIV class=FQA>sandrain_zeq wrote:</DIV>To be 
                                honest, I do not know the reason of 
                                restoring...<BR>So what's the original purpose 
                                of these codes?<BR></BLOCKQUOTE><BR><BR>I think 
                                I have explained it in "5.3 Approach OEP by 
                                Structured Exception Handling".<BR>It is a code 
                                to retrieve original Stack point. Remember after 
                                using SEH, the stack point will be changed, and 
                                you have to correct it to avoid other 
                                consequences...<BR><BR><BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1978158&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1978158&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=1653490">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=1978158">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=1978158&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF1978158 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(1599836,1978158,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F1633149_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx1633149xx></A><IMG height=16 alt=News 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_news.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=1633149#xx1633149xx" 
                        name=1633149>Great Article</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=1271411">sony_synco</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">10:03 
                        19 Aug '06 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F1633149_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>It's a wonderfull article <IMG 
                                title="D'Oh!" 
                                src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/smiley_doh.gif" 
                                align=top> .. thanks for taking time . My 5 
                                <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1633149&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1633149&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=1633149">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=1633149">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=1633149&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF1633149 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(1271411,1633149,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F1611929_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx1611929xx></A><IMG height=16 alt=Question 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_question.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=1611929#xx1611929xx" 
                        name=1611929>a little question [modified]</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=113987">fixacc</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">19:31 4 
                        Aug '06 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F1611929_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD 
                                colSpan=2>........<BR>_reloc_fixup_block:<BR>mov 
                                eax,[ebx+004h]//ImageBaseRelocation.SizeOfBlock<BR>test 
                                eax,eax<BR>jz _reloc_fixup_end<BR>lea 
                                ecx,[eax-008h]//ImageBaseRelocation.SizeOfBlock 
                                - sizeof (TImageBaseRelocation)<BR>shr ecx,001h 
                                //WORD((ImageBaseRelocation.SizeOfBlock 
                                -sizeof(TImageBaseRelocation)) / 
                                sizeof(Word))<BR>lea edi,[ebx+008h] 
                                <BR>...........<BR><BR>eax contains the length 
                                of current relocation block(including 8-byte 
                                long<BR>block header),and eax-008h equals the 
                                length of relocation items in byte.<BR><BR>what 
                                is the following statement trying to 
                                get?<BR><BR>lea 
                                ecx,[eax-008h]//ImageBaseRelocation.SizeOfBlock 
                                - sizeof(TImageBaseRelocation)<BR><BR><IMG 
                                title=Sniff 
                                src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/smiley_sniff.gif" 
                                align=top><BR><BR><BR><BR><BR>-- modified at 
                                22:33 Friday 4th August, 2006 <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1611929&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1611929&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=1611929">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=1611929">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=1611929&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF1611929 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(113987,1611929,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F1576946_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx1576946xx></A><IMG height=16 alt=General 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=1576946#xx1576946xx" 
                        name=1576946>exe Resource Editor</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=314986">Grey|Pixels</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">21:21 
                        13 Jul '06 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F1576946_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Hi Ashkbiz,<BR>Here's a tool to 
                                directly edit resources in an EXE. You've 
                                probably heard of it: XN Resource 
                                Editor.<BR>http://www.wilsonc.demon.co.uk/d10resourceeditor.htm<BR><BR>This 
                                looks like a great article. Need sometime to go 
                                through all this. Thanks. <BR><BR>Contact me at 
                                agnel.kurian at gmail.com<BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1576946&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1576946&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=1576946">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=1576946">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=1576946&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF1576946 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT type=text/javascript>
												MsgVFrm(314986,1576946,false,"","","");
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd LoVote Rt HdUnSel " id=F1547695_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx1547695xx></A><IMG height=16 alt=General 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;select=1547695#xx1547695xx" 
                        name=1547695>pe maker create a type_win32 virus</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=2151276">zoncpp25</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">22:47 
                        24 Jun '06 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F1547695_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>hello!<BR>thanks for your 
                                article.<BR>but, why the kaspersky (a anti 
                                virus) detects a pe file is created by pe maker 
                                program,as a type_win32 virus? 
                                <BR><BR>Zo.Naderi-Iran<BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1547695&amp;floc=/KB/system/inject2exe.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=250020&amp;select=1547695&amp;floc=/KB/system/inject2exe.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;tid=1547695">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=250020&amp;msg=1547695">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=1547695&amp;obtid=3&amp;bma=AddBookmark">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF1547695 
                                style="WHITE-SPACE: nowrap">1.50/5 (2 votes)
                                <SCRIPT type=text/javascript>
												MsgVFrm(2151276,1547695,false,"","","");
											</SCRIPT>
                                 
                        </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR>
                <TD><IMG height=5 alt="" 
                  src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/t.gif" 
                  width=1 border=0></TD></TR></TBODY></TABLE></TD></TR>
        <TR>
          <TD>
            <TABLE cellSpacing=0 cellPadding=2 width="100%">
              <TBODY>
              <TR class=Frm_Footer>
                <TD>Last Visit: Wednesday, June 25, 2008 9:10 AM &nbsp; &nbsp; 
                  Last Update:Thursday, June 26, 2008 1:40 AM</TD>
                <TD style="WHITE-SPACE: nowrap; TEXT-ALIGN: right"><B>1</B><A 
                  class=Frm_HL 
                  href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;fr=26#xx0xx" 
                  name=Frm_HoverNL>2</A> <A class=Frm_HL 
                  href="http://www.codeproject.com/KB/system/inject2exe.aspx?fid=250020&amp;fr=26#xx0xx" 
                  name=Frm_HoverNL>Next 
      »</A></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></DIV>
      <P class=SmallText><IMG height=16 alt=General 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_general.gif" 
      width=16 align=top> General &nbsp;&nbsp; <IMG height=16 alt=News 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_news.gif" 
      width=16 align=top> News &nbsp;&nbsp; <IMG height=16 alt=Question 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_question.gif" 
      width=16 align=top> Question &nbsp;&nbsp; <IMG height=16 alt=Answer 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_answer.gif" 
      width=16 align=top> Answer &nbsp;&nbsp; <IMG height=16 alt=Joke 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_joke.gif" 
      width=16 align=top> Joke &nbsp;&nbsp; <IMG height=16 alt=Rant 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_rant.gif" 
      width=16 align=top> Rant &nbsp;&nbsp; <IMG height=16 alt=Admin 
      src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/msg_admin.gif" 
      width=16 align=top> Admin &nbsp;&nbsp; </P><!-- Forum End --></DIV>
      <TABLE width="100%">
        <TBODY>
        <TR vAlign=top>
          <TD class=TinyText align=left><A id=ctl00_PermaLink 
            href="http://www.codeproject.com/script/Articles/Article.aspx?aid=12532">PermaLink</A> 
            | <A id=ctl00_PrivacyLink 
            href="http://www.codeproject.com/info/privacy.aspx">Privacy </A>| <A 
            id=ctl00_TermsOfUseLink 
            href="http://www.codeproject.com/info/TermsOfUse.aspx">Terms of 
            Use</A> <BR>Last Updated: 27 Dec 2005<BR>Editor: <A 
            id=ctl00_ArticleEditor 
            href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=28970">Smitha 
            Vijayan</A><BR></TD>
          <TD class=TinyText vAlign=top align=right>Copyright 2005 by Ashkbiz 
            Danehkar<BR>Everything else Copyright © <A 
            href="mailto:webmaster@codeproject.com">CodeProject</A>, 1999-2008 
            <BR>Web20 | <A id=ctl00_AdvertiseLink 
            href="http://www.codeproject.com/info/MediaKit.aspx">Advertise on 
            the Code Project </A></TD></TR></TBODY></TABLE>
      <CENTER></CENTER></TD></TR>
  <TR>
    <TD align=middle colSpan=2></TD></TR></TBODY></TABLE><BR>
<SCRIPT language=Javascript type=text/javascript>//<![CDATA[
if (document.all) try {window.attachEvent("oncopy",copyCode);}catch(e){};
//]]></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/TogglePre.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/menu132_com.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject Inject your code to a Portable Executable file_ Free source code and programming help_files/TopNavBar.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript type=text/javascript>//<![CDATA[
new HVMenu(new menu_NavbarConfig());
//]]></SCRIPT>
</BODY></HTML>
