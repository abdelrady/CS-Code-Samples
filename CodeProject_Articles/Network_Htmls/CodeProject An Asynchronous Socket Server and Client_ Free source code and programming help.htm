<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0063)http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx -->
<HTML><HEAD><TITLE>CodeProject: An Asynchronous Socket Server and Client. Free source code and programming help</TITLE>
<META http-equiv=Content-Type content="text/html; charset=utf-8">
<META 
content="An asynchronous socket server and client with encryption and compression.; Author: Andre Azevedo; Section: Internet / Network; Chapter: Web Development" 
name=Description>
<META 
content=".NET 2.0, WinXP, Win2003, VS2005, C#, Dev, Intermediate,Internet / Network,Web Development,Free source code, tutorials" 
name=Keywords>
<META content="The Code Project" name=Author>
<META content=General name=Rating>
<META content="index, follow" name=Robots>
<META content="1 days" name=Revisit-After><LINK 
title="CodeProject Lounge Postings" 
href="http://www.codeproject.com/webservices/LoungeRSS.aspx" 
type=application/rss+xml rel=alternate><LINK 
title="CodeProject Latest articles - All topics" 
href="http://www.codeproject.com/webservices/articlerss.aspx?cat=1" 
type=application/rss+xml rel=alternate><LINK 
title="CodeProject Latest articles - MFC / C++" 
href="http://www.codeproject.com/webservices/articlerss.aspx?cat=2" 
type=application/rss+xml rel=alternate><LINK 
title="CodeProject Latest articles - C#" 
href="http://www.codeproject.com/webservices/articlerss.aspx?cat=3" 
type=application/rss+xml rel=alternate><LINK 
title="CodeProject Latest articles - ASP.NET" 
href="http://www.codeproject.com/webservices/articlerss.aspx?cat=4" 
type=application/rss+xml rel=alternate><LINK 
title="CodeProject Latest articles - .NET" 
href="http://www.codeproject.com/webservices/articlerss.aspx?cat=5" 
type=application/rss+xml rel=alternate><LINK 
title="CodeProject Latest articles - VB.NET" 
href="http://www.codeproject.com/webservices/articlerss.aspx?cat=6" 
type=application/rss+xml rel=alternate><LINK title=CodeProject 
href="http://www.codeproject.com/info/OpenSearch.xml" 
type=application/opensearchdescription+xml rel=search><LINK 
href="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/CodeProject.css" 
type=text/css rel=stylesheet><LINK 
href="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/ForumClassic.css" 
type=text/css rel=stylesheet>
<SCRIPT type=text/javascript>
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</SCRIPT>

<SCRIPT type=text/javascript>
   var pageTracker = _gat._getTracker("UA-1735123-1");
   pageTracker._setDomainName("www.codeproject.com");
   pageTracker._setSessionTimeout("1200"); // 20 mins
   pageTracker._initData();
   pageTracker._trackPageview();
</SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/oncopy.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/jxs.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/bookmark.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/rateitem.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript type=text/javascript>//<![CDATA[
function ToggleMenu(itemName)
{
	var elm = document.getElementById(itemName);
	var i,others = document.getElementById('SectionMenu');
	for(i=0; i < others.childNodes.length; i++)
	{
		var other = others.childNodes[i];
		if ((other.className == 'MenuSectionBlock') && (other != elm))
			other.style.display='none';
	}
	if (elm.style.display == 'block') elm.style.display='none';
	else elm.style.display='block';
	return false;
}

//]]></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/addto.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript type=text/javascript>//<![CDATA[
var Selected = "-1";

function SwitchMessage(e, msgId)
{
  if (!msgId) {
    if(!e)e=window.event;
    var target=e.target?e.target:e.srcElement;
    while(target&&target.id!='DynMessLink')target=target.parentNode;
    if(!target||target.id!='DynMessLink')return;
    msgId=target.name;
  }
  if(Selected&&Selected!=""){
    var body=eval("document.getElementById('F" + Selected + "_h1')");
    if(body) body.style.display = 'none';
    var head=eval("document.getElementById('F" + Selected + "_h0')");
    if(head) head.className = head.className.replace("Sel", "UnSel");
  }
  if(Selected==msgId.toString())
    Selected="";
  else {
    Selected=msgId.toString();
    var body=eval("document.getElementById('F" + Selected + "_h1')");
    if(body){
      if(body.style.display=='none') body.style.display='';
      else body.style.display = 'none';
    }
    var head=eval("document.getElementById('F" + Selected + "_h0')");
    if (head) 
      head.className = head.className.replace("UnSel", "Sel");
    if(body&&head&&body.style.display!='none'){
      document.body.scrollTop = getRealPos(head, "Top") - document.body.clientHeight/10;
      EnsureMessageVisible(Selected, true);
    }
  }
  if (e){if(e.preventDefault)e.preventDefault;else e.returnValue=false;}
  return false;
}

//]]></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/ShortCuts.js" 
type=text/javascript></SCRIPT>
<LINK 
href="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/ForumClassicIE6.css" 
type=text/css rel=stylesheet><LINK href="/favicon.ico" type=image/ico 
rel=icon><LINK href="/favicon.ico" type=image/ico rel="shortcut icon">
<META content="MSHTML 6.00.2900.2180" name=GENERATOR></HEAD>
<BODY>
<TABLE id=ctl00_AT cellSpacing=0 cellPadding=0 border=0>
  <TBODY>
  <TR vAlign=top>
    <TD colSpan=2>
      <TABLE cellSpacing=0 cellPadding=0 border=0>
        <TBODY>
        <TR>
          <TD class=HeaderLogo><A href="http://www.codeproject.com/"><IMG 
            id=ctl00_Logo 
            style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; WIDTH: 225px; HEIGHT: 90px; BORDER-RIGHT-WIDTH: 0px" 
            alt="The Code Project" 
            src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/logo225x90.gif"></A></TD>
          <TD class=HeaderBanner align=right width="100%"><IFRAME 
            src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/ServeThirdParty.htm" 
            frameBorder=0 width=728 scrolling=no height=90></IFRAME></TD></TR>
        <TR>
          <TD colSpan=2>
            <TABLE class=MemberNavBar cellSpacing=0 cellPadding=5 
              width="100%"><TBODY>
              <TR>
                <TD class=SmallText style="FONT-WEIGHT: bold">5,147,610 
                  members and growing! (18,382 online)</TD>
                <TD align=right>
                  <DIV class=MemberNavBarText 
                  id=ctl00_MemberMenu_LoggedOffOptions 
                  style="PADDING-RIGHT: 0px; PADDING-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-TOP: 0px"><A 
                  name=SignUp></A>
                  <FORM id=subForm 
                  style="PADDING-RIGHT: 0px; PADDING-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-TOP: 0px" 
                  name=subForm 
                  action=/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx 
                  method=post>Email <INPUT class=SmallText id=Email 
                  style="WIDTH: 100px" name=Email> Password <INPUT 
                  class=SmallText id=Password style="WIDTH: 60px" type=password 
                  name=Password> <INPUT class=FormButton type=submit value="Sign in">
                  <SCRIPT type=text/javascript>
function Join(){document.location.href='/script/Membership/Modify.aspx';return false;}
document.write('<input type="button" class="FormButton" onclick="return Join();" value="Join"');
document.write('<input type="hidden" name="fld_quicksign" value="true" />');
</SCRIPT>
                   <INPUT id=RememberMeCheck type=checkbox CHECKED name=cookie> 
                  <LABEL for=RememberMeCheck>Remember me?</LABEL>&nbsp; <A 
                  id=ctl00_MemberMenu_SendPassword 
                  href="http://www.codeproject.com/script/Membership/SendPassword.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx"><IMG 
                  height=16 alt=help 
                  src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/help.gif" 
                  width=16 align=middle border=0>Lost your password?</A> 
                  </FORM></DIV></TD></TR></TBODY></TABLE></TD></TR>
        <TR>
          <TD colSpan=2>
            <TABLE class=SiteNavBar id=tblSiteToolbar cellSpacing=0 
            cellPadding=0>
              <TBODY>
              <TR>
                <TD noWrap><A href="http://www.codeproject.com/">Home</A></TD>
                <TD>&nbsp; </TD>
                <TD noWrap>Current Site: </TD>
                <TD class=SelCat noWrap><A 
                  href="http://www.codeproject.com/">C++/.NET</A></TD>
                <TD noWrap><A href="http://java.codeproject.com/">Java</A></TD>
                <TD noWrap><A href="http://lamp.codeproject.com/">LAMP</A></TD>
                <TD width="100%">&nbsp;</TD>
                <TD id=ctl00_TopNavBar_RightMenus><!--380-->
                  <DIV id=MenuPos 
                  style="WIDTH: 305px; POSITION: relative; TOP: 1px; HEIGHT: 22px">
                  <TABLE 
                  style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; HEIGHT: 20px; BORDER-RIGHT-WIDTH: 0px" 
                  cellSpacing=0 cellPadding=0 width=305>
                    <TBODY>
                    <TR vAlign=center>
                      <TD 
                      style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" 
                      noWrap><A 
                        href="http://www.codeproject.com/info/FAQ.aspx">Help!</A></TD>
                      <TD 
                      style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" 
                      noWrap><A 
                        href="http://www.codeproject.com/script/Articles/Latest.aspx">Articles</A></TD>
                      <TD 
                      style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" 
                      noWrap><A 
                        href="http://www.codeproject.com/script/Forums/List.aspx">Message 
                        Boards</A></TD>
                      <TD 
                      style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" 
                      noWrap><A 
                        href="http://www.codeproject.com/Lounge.aspx">Lounge</A></TD></TR></TBODY></TABLE></DIV></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
  <TR>
    <TD vAlign=top colSpan=2><A name=_top></A>
      <TABLE class=ArticleHeader id=ctl00_ArticleTopHeader_HeaderTable 
      cellSpacing=0 cellPadding=3 width="100%" border=0>
        <TBODY>
        <TR vAlign=top>
          <TD class=SmallText><A id=ctl00_ArticleTopHeader_ChapterLink 
            href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=2">Web 
            Development</A> » <A id=ctl00_ArticleTopHeader_SectionLink 
            href="http://www.codeproject.com/KB/IP/">Internet / Network</A> » <A 
            id=ctl00_ArticleTopHeader_SubsectionLink 
            href="http://www.codeproject.com/KB/IP/index.aspx?#Internet / Network - Client/Server Development">Client/Server 
            Development</A> <SPAN class=ArticleIntermediate 
            id=ctl00_ArticleTopHeader_SkillLevel>&nbsp;&nbsp;&nbsp; 
            Intermediate</SPAN> <SPAN class=SmallText 
            id=ctl00_ArticleTopHeader_LicenceTerms 
            style="MARGIN-LEFT: 40px">License: <A 
            href="http://www.codeproject.com/info/cpol10.aspx">The Code Project 
            Open License (CPOL)</A></SPAN> <BR><BR>
            <H1><SPAN class=ArticleTopTitle 
            id=ctl00_ArticleTopHeader_ArticleTitle>An Asynchronous Socket Server 
            and Client</SPAN></H1><B>By <A 
            href="http://www.codeproject.com/script/Articles/MemberArticles.aspx?amid=912732">Andre 
            Azevedo</A></B><BR><BR><SPAN class=ArticleTopDescr 
            id=ctl00_ArticleTopHeader_ArticleDescr>An asynchronous socket server 
            and client with encryption and compression.</SPAN> </TD>
          <TD class=SmallText style="WIDTH: 210px"><SPAN 
            id=ctl00_ArticleTopHeader_ArticleAttributes>C#Windows, .NET, .NET 
            2.0, WinXP, Win2003VS2005, VS, Dev</SPAN><BR><BR><SPAN 
            style="PADDING-RIGHT: 2ex">Posted</SPAN>: <B>18 May 
            2006</B><BR><SPAN style="PADDING-RIGHT: 0.5ex">Updated</SPAN>: <B>7 
            Sep 2007</B> <BR><SPAN style="PADDING-RIGHT: 3.2ex">Views</SPAN>: 
            <B>273,317</B><BR></TD></TR>
        <TR>
          <TD colSpan=2>
            <TABLE width="100%">
              <TBODY>
              <TR>
                <TD></TD>
                <TD class=SmallText style="WHITE-SPACE: nowrap" 
              align=right></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
  <TR vAlign=top>
    <TD class=LHNavBar id=ctl00_LeftNavCell>
      <DIV style="PADDING-TOP: 5px; TEXT-ALIGN: center"><IFRAME 
      src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\ServeThirdParty(1).htm" 
      frameBorder=0 width=150 scrolling=no height=80></IFRAME></DIV>
      <DIV class=FeatureBlockHeader>Announcements</DIV>
      <DIV class="FeatureBlockContent RHFeatureBar">
      <DIV style="MARGIN-TOP: 0px; MARGIN-BOTTOM: 3px"><IMG 
      style="FLOAT: left; MARGIN-LEFT: 6px; MARGIN-RIGHT: 6px" height=16 
      alt=Comp 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/coffee.gif" 
      width=16> <A href="http://www.codeproject.com/Zones/IBM/">Win CodeProject 
      Coffee!</A></DIV>
      <DIV style="PADDING-TOP: 0px"><IMG 
      style="FLOAT: left; MARGIN-LEFT: 8px; MARGIN-RIGHT: 9px" height=20 
      alt=Comp 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/prize_winner.gif" 
      width=10> <A id=ctl00_Announcements_CompLink 
      href="http://www.codeproject.com/Feature/ArticleCompetition/">Monthly 
      Competition</A><BR clear=all>
      <DIV style="PADDING-BOTTOM: 5px; PADDING-TOP: 3px"><IMG 
      style="PADDING-RIGHT: 10px; FLOAT: left; MARGIN-LEFT: 7px; MARGIN-RIGHT: 8px" 
      height=16 alt=Staff 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/staff_sm.gif" 
      width=12> <A href="http://www.codeproject.com/info/jobs/">We're 
      Hiring</A></DIV></DIV></DIV>
      <DIV class=MenuCat>Services</DIV>
      <DIV class=MenuChapter><A 
      href="http://www.codeproject.com/Services/coffee.aspx">Code Project 
      Coffee</A></DIV>
      <DIV class=MenuChapter><A 
      href="http://www.codeproject.com/Services/TradePub.aspx">Free 
      Magazines</A></DIV><BR>
      <DIV id=SectionMenu>
      <DIV class=MenuCat>Chapters</DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter1');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=1">Desktop 
      Development</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter1 style="DISPLAY: none">
      <DIV class=MI id=Section1><A 
      href="http://www.codeproject.com/KB/buttons/">Button Controls</A></DIV>
      <DIV class=MI id=Section15><A 
      href="http://www.codeproject.com/KB/clipboard/">Clipboard</A></DIV>
      <DIV class=MI id=Section2><A 
      href="http://www.codeproject.com/KB/combobox/">Combo &amp; List 
      Boxes</A></DIV>
      <DIV class=MI id=Section67><A 
      href="http://www.codeproject.com/KB/dialog/">Dialogs and Windows</A></DIV>
      <DIV class=MI id=Section107><A 
      href="http://www.codeproject.com/KB/gadgets/">Desktop Gadgets</A></DIV>
      <DIV class=MI id=Section16><A 
      href="http://www.codeproject.com/KB/docview/">Document / View</A></DIV>
      <DIV class=MI id=Section4><A 
      href="http://www.codeproject.com/KB/edit/">Edit Controls</A></DIV>
      <DIV class=MI id=Section17><A 
      href="http://www.codeproject.com/KB/files/">Files and Folders</A></DIV>
      <DIV class=MI id=Section3><A 
      href="http://www.codeproject.com/KB/grid/">Grid &amp; Data 
      Controls</A></DIV>
      <DIV class=MI id=Section5><A 
      href="http://www.codeproject.com/KB/list/">List Controls</A></DIV>
      <DIV class=MI id=Section6><A 
      href="http://www.codeproject.com/KB/menus/">Menus</A></DIV>
      <DIV class=MI id=Section14><A 
      href="http://www.codeproject.com/KB/miscctrl/">Miscellaneous</A></DIV>
      <DIV class=MI id=Section18><A 
      href="http://www.codeproject.com/KB/printing/">Printing</A></DIV>
      <DIV class=MI id=Section95><A 
      href="http://www.codeproject.com/KB/progress/">Progress Controls</A></DIV>
      <DIV class=MI id=Section11><A 
      href="http://www.codeproject.com/KB/selection/">Selection 
      Controls</A></DIV>
      <DIV class=MI id=Section19><A 
      href="http://www.codeproject.com/KB/shell/">Shell and IE 
      programming</A></DIV>
      <DIV class=MI id=Section68><A 
      href="http://www.codeproject.com/KB/smart/">Smart Client</A></DIV>
      <DIV class=MI id=Section8><A 
      href="http://www.codeproject.com/KB/splitter/">Splitter Windows</A></DIV>
      <DIV class=MI id=Section9><A 
      href="http://www.codeproject.com/KB/static/">Static &amp; Panel 
      Controls</A></DIV>
      <DIV class=MI id=Section10><A 
      href="http://www.codeproject.com/KB/statusbar/">Status Bar</A></DIV>
      <DIV class=MI id=Section7><A 
      href="http://www.codeproject.com/KB/tabs/">Tabs &amp; Property 
      Pages</A></DIV>
      <DIV class=MI id=Section12><A 
      href="http://www.codeproject.com/KB/toolbars/">Toolbars &amp; Docking 
      windows</A></DIV>
      <DIV class=MI id=Section13><A 
      href="http://www.codeproject.com/KB/tree/">Tree Controls</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter2');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=2">Web 
      Development</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter2>
      <DIV class=MI id=Section70><A 
      href="http://www.codeproject.com/KB/ajax/">Ajax and Atlas</A></DIV>
      <DIV class=MI id=Section27><A 
      href="http://www.codeproject.com/KB/applications/">Applications &amp; 
      Tools</A></DIV>
      <DIV class=MI id=Section85><A 
      href="http://www.codeproject.com/KB/asp/">ASP</A></DIV>
      <DIV class=MI id=Section89><A 
      href="http://www.codeproject.com/KB/aspnet/">ASP.NET</A></DIV>
      <DIV class=MI id=Section28><A 
      href="http://www.codeproject.com/KB/webforms/">ASP.NET Controls</A></DIV>
      <DIV class=MI id=Section38><A 
      href="http://www.codeproject.com/KB/ATL-Server/">ATL Server</A></DIV>
      <DIV class=MI id=Section29><A 
      href="http://www.codeproject.com/KB/web-cache/">Caching</A></DIV>
      <DIV class=MI id=Section91><A 
      href="http://www.codeproject.com/KB/web-image/">Charts, Graphs and 
      Images</A></DIV>
      <DIV class=MI id=Section25><A 
      href="http://www.codeproject.com/KB/scripting/">Client side 
      scripting</A></DIV>
      <DIV class=MI id=Section30><A 
      href="http://www.codeproject.com/KB/custom-controls/">Custom 
      Controls</A></DIV>
      <DIV class=MI id=Section23><A 
      href="http://www.codeproject.com/KB/HTML/">HTML / CSS</A></DIV>
      <DIV class=MIS id=Section22><A 
      href="http://www.codeproject.com/KB/IP/">Internet / Network</A></DIV>
      <DIV class=MI id=Section24><A 
      href="http://www.codeproject.com/KB/ISAPI/">ISAPI</A></DIV>
      <DIV class=MI id=Section33><A 
      href="http://www.codeproject.com/KB/server-management/">Site &amp; Server 
      Management</A></DIV>
      <DIV class=MI id=Section34><A 
      href="http://www.codeproject.com/KB/session/">Session State</A></DIV>
      <DIV class=MI id=Section113><A 
      href="http://www.codeproject.com/KB/silverlight/">Silverlight</A></DIV>
      <DIV class=MI id=Section36><A 
      href="http://www.codeproject.com/KB/trace/">Trace and Logs</A></DIV>
      <DIV class=MI id=Section31><A 
      href="http://www.codeproject.com/KB/user-controls/">User 
Controls</A></DIV>
      <DIV class=MI id=Section37><A 
      href="http://www.codeproject.com/KB/validation/">Validation</A></DIV>
      <DIV class=MI id=Section35><A 
      href="http://www.codeproject.com/KB/viewstate/">View State</A></DIV>
      <DIV class=MI id=Section26><A 
      href="http://www.codeproject.com/KB/WAP/">WAP / WML</A></DIV>
      <DIV class=MI id=Section32><A 
      href="http://www.codeproject.com/KB/web-security/">Web Security</A></DIV>
      <DIV class=MI id=Section20><A 
      href="http://www.codeproject.com/KB/webservices/">Web 
      Services</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter9');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=9">Enterprise 
      Systems</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter9 style="DISPLAY: none">
      <DIV class=MI id=Section98><A 
      href="http://www.codeproject.com/KB/MCMS/">Content Management 
      Server</A></DIV>
      <DIV class=MI id=Section99><A 
      href="http://www.codeproject.com/KB/biztalk/">Microsoft BizTalk 
      Server</A></DIV>
      <DIV class=MI id=Section102><A 
      href="http://www.codeproject.com/KB/exchange/">Microsoft 
Exchange</A></DIV>
      <DIV class=MI id=Section90><A 
      href="http://www.codeproject.com/KB/office/">Office Development</A></DIV>
      <DIV class=MI id=Section101><A 
      href="http://www.codeproject.com/KB/sharepoint/">SharePoint 
      Server</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter3');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=3">Multimedia</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter3 style="DISPLAY: none">
      <DIV class=MI id=Section42><A 
      href="http://www.codeproject.com/KB/audio-video/">Audio and 
Video</A></DIV>
      <DIV class=MI id=Section44><A 
      href="http://www.codeproject.com/KB/directx/">DirectX</A></DIV>
      <DIV class=MI id=Section46><A 
      href="http://www.codeproject.com/KB/GDI/">GDI</A></DIV>
      <DIV class=MI id=Section47><A 
      href="http://www.codeproject.com/KB/GDI-plus/">GDI+</A></DIV>
      <DIV class=MI id=Section43><A 
      href="http://www.codeproject.com/KB/graphics/">General Graphics</A></DIV>
      <DIV class=MI id=Section45><A 
      href="http://www.codeproject.com/KB/openGL/">OpenGL</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter4');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=4">Database</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter4 style="DISPLAY: none">
      <DIV class=MI id=Section66><A 
      href="http://www.codeproject.com/KB/database/">Database</A></DIV>
      <DIV class=MI id=Section100><A 
      href="http://www.codeproject.com/KB/reporting-services/">SQL Reporting 
      Services</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter8');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=8">Platforms, 
      Frameworks &amp; Libraries</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter8 style="DISPLAY: none">
      <DIV class=MI id=Section83><A 
      href="http://www.codeproject.com/KB/atl/">ATL</A></DIV>
      <DIV class=MI id=Section117><A 
      href="http://www.codeproject.com/KB/MFC/">MFC</A></DIV>
      <DIV class=MI id=Section88><A 
      href="http://www.codeproject.com/KB/stl/">STL</A></DIV>
      <DIV class=MI id=Section84><A 
      href="http://www.codeproject.com/KB/wtl/">WTL</A></DIV>
      <DIV class=MI id=Section49><A 
      href="http://www.codeproject.com/KB/COM/">COM / COM+</A></DIV>
      <DIV class=MI id=Section76><A 
      href="http://www.codeproject.com/KB/dotnet/">.NET Framework</A></DIV>
      <DIV class=MI id=Section92><A 
      href="http://www.codeproject.com/KB/winsdk/">Win32/64 SDK &amp; 
      OS</A></DIV>
      <DIV class=MI id=Section108><A 
      href="http://www.codeproject.com/KB/vista/">Vista API</A></DIV>
      <DIV class=MI id=Section110><A 
      href="http://www.codeproject.com/KB/vista-security/">Vista 
      Security</A></DIV>
      <DIV class=MI id=Section82><A 
      href="http://www.codeproject.com/KB/cross-platform/">Cross 
      Platform</A></DIV>
      <DIV class=MI id=Section69><A 
      href="http://www.codeproject.com/KB/game/">Game Development</A></DIV>
      <DIV class=MI id=Section73><A 
      href="http://www.codeproject.com/KB/mobile/">Mobile Development</A></DIV>
      <DIV class=MI id=Section106><A 
      href="http://www.codeproject.com/KB/WC/">Windows CardSpace</A></DIV>
      <DIV class=MI id=Section103><A 
      href="http://www.codeproject.com/KB/WCF/">Windows Communication 
      Foundation</A></DIV>
      <DIV class=MI id=Section104><A 
      href="http://www.codeproject.com/KB/WPF/">Windows Presentation 
      Foundation</A></DIV>
      <DIV class=MI id=Section105><A 
      href="http://www.codeproject.com/KB/WF/">Windows Workflow 
      Foundation</A></DIV>
      <DIV class=MI id=Section119><A 
      href="http://www.codeproject.com/KB/library/">Libraries</A></DIV>
      <DIV class=MI id=Section122><A 
      href="http://www.codeproject.com/KB/powershell/">Windows 
      Powershell</A></DIV>
      <DIV class=MI id=Section123><A 
      href="http://www.codeproject.com/KB/linq/">LINQ</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter5');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=5">Languages</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter5 style="DISPLAY: none">
      <DIV class=MI id=Section71><A href="http://www.codeproject.com/KB/cpp/">C 
      / C++ Language</A></DIV>
      <DIV class=MI id=Section72><A 
      href="http://www.codeproject.com/KB/mcpp/">C++ / CLI</A></DIV>
      <DIV class=MI id=Section93><A 
      href="http://www.codeproject.com/KB/cs/">C#</A></DIV>
      <DIV class=MI id=Section78><A 
      href="http://www.codeproject.com/KB/msil/">MSIL</A></DIV>
      <DIV class=MI id=Section86><A 
      href="http://www.codeproject.com/KB/vbscript/">VBScript</A></DIV>
      <DIV class=MI id=Section87><A 
      href="http://www.codeproject.com/KB/vb/">VB.NET</A></DIV>
      <DIV class=MI id=Section115><A 
      href="http://www.codeproject.com/KB/vb-interop/">VB6 Interop</A></DIV>
      <DIV class=MI id=Section77><A 
      href="http://www.codeproject.com/KB/net-languages/">Other .NET 
      Languages</A></DIV>
      <DIV class=MI id=Section21><A 
      href="http://www.codeproject.com/KB/XML/">XML</A></DIV>
      <DIV class=MI id=Section96><A 
      href="http://www.codeproject.com/KB/java/">Java</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter6');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=6">General 
      Programming</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter6 style="DISPLAY: none">
      <DIV class=MI id=Section57><A 
      href="http://www.codeproject.com/KB/recipes/">Algorithms &amp; 
      Recipes</A></DIV>
      <DIV class=MI id=Section64><A 
      href="http://www.codeproject.com/KB/bugs/">Bugs &amp; 
Workarounds</A></DIV>
      <DIV class=MI id=Section79><A 
      href="http://www.codeproject.com/KB/collections/">Collections</A></DIV>
      <DIV class=MI id=Section56><A 
      href="http://www.codeproject.com/KB/security/">Cryptography &amp; 
      Security</A></DIV>
      <DIV class=MI id=Section50><A 
      href="http://www.codeproject.com/KB/datetime/">Date and Time</A></DIV>
      <DIV class=MI id=Section52><A 
      href="http://www.codeproject.com/KB/DLL/">DLLs &amp; Assemblies</A></DIV>
      <DIV class=MI id=Section80><A 
      href="http://www.codeproject.com/KB/exception/">Exception 
      Handling</A></DIV>
      <DIV class=MI id=Section81><A 
      href="http://www.codeproject.com/KB/locale/">Localisation</A></DIV>
      <DIV class=MI id=Section53><A 
      href="http://www.codeproject.com/KB/macros/">Macros and Add-ins</A></DIV>
      <DIV class=MI id=Section54><A 
      href="http://www.codeproject.com/KB/tips/">Programming Tips</A></DIV>
      <DIV class=MI id=Section55><A 
      href="http://www.codeproject.com/KB/string/">String handling</A></DIV>
      <DIV class=MI id=Section58><A 
      href="http://www.codeproject.com/KB/threads/">Threads, Processes &amp; 
      IPC</A></DIV>
      <DIV class=MI id=Section59><A 
      href="http://www.codeproject.com/KB/winhelp/">WinHelp / 
      HTMLHelp</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter10');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=10">Graphics 
      / Design</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter10 style="DISPLAY: none">
      <DIV class=MI id=Section40><A 
      href="http://www.codeproject.com/KB/expression/">Expression</A></DIV>
      <DIV class=MI id=Section114><A 
      href="http://www.codeproject.com/KB/usability/">Usability</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter11');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=11">Development 
      Lifecycle</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter11 style="DISPLAY: none">
      <DIV class=MI id=Section51><A 
      href="http://www.codeproject.com/KB/debug/">Debug Tips</A></DIV>
      <DIV class=MI id=Section39><A 
      href="http://www.codeproject.com/KB/architecture/">Design and 
      Architecture</A></DIV>
      <DIV class=MI id=Section112><A 
      href="http://www.codeproject.com/KB/install/">Installation</A></DIV>
      <DIV class=MI id=Section41><A 
      href="http://www.codeproject.com/KB/work/">Work Issues</A></DIV>
      <DIV class=MI id=Section126><A 
      href="http://www.codeproject.com/KB/codegen/">Code 
      Generation</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter7');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=7">General 
      Reading</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter7 style="DISPLAY: none">
      <DIV class=MI id=Section60><A 
      href="http://www.codeproject.com/KB/books/">Book Chapters</A></DIV>
      <DIV class=MI id=Section61><A 
      href="http://www.codeproject.com/KB/book-reviews/">Book Reviews</A></DIV>
      <DIV class=MI id=Section109><A 
      href="http://www.codeproject.com/KB/hardware-review/">Hardware 
      Reviews</A></DIV>
      <DIV class=MI id=Section63><A 
      href="http://www.codeproject.com/KB/interviews/">Interviews</A></DIV>
      <DIV class=MI id=Section62><A 
      href="http://www.codeproject.com/KB/scrapbook/">Scrapbook</A></DIV>
      <DIV class=MI id=Section48><A 
      href="http://www.codeproject.com/KB/system/">Hardware &amp; 
      System</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter12');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=12">Third 
      Party Products</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter12 style="DISPLAY: none">
      <DIV class=MI id=Section65><A 
      href="http://www.codeproject.com/KB/showcase/">Product Showcase</A></DIV>
      <DIV class=MI id=Section124><A 
      href="http://www.codeproject.com/KB/solution-center/">Solution 
      Center</A></DIV></DIV></DIV><BR>
      <DIV class=MenuCat>Feature Zones</DIV>
      <DIV class=MenuChapter><A href="http://www.codeproject.com/Zones/IBM">IBM 
      DeveloperWorks</A></DIV>
      <DIV class=MenuChapter><A 
      href="http://www.codeproject.com/Zones/WhitePapers">WhitePapers</A></DIV>
      <DIV class=MenuChapter><A 
      href="http://www.codeproject.com/Zones/CodeGeneration">Code 
      Generation</A></DIV>
      <DIV class=MenuChapter><A 
      href="http://www.codeproject.com/Zones/QuestSQL">Quest SQL 
      Zone</A></DIV><BR><IFRAME 
      src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\ServeThirdParty(2).htm" 
      frameBorder=0 width=160 scrolling=no height=600></IFRAME><IMG height=1 
      alt="" 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/t.gif" 
      width=160> </TD>
    <TD class=ArticlePane vAlign=top>
      <TABLE class=SearchHeaderBar cellSpacing=0 width="100%">
        <TBODY>
        <TR>
          <TD style="WIDTH: 60%; WHITE-SPACE: nowrap" vAlign=center 
            align=right><FORM style="MARGIN: 0px" name=Search 
            action=/info/search.aspx method=get><B>Search &nbsp;</B> <INPUT 
            class=SmallText style="WIDTH: 200px" name=artkw> <SELECT 
            class=SmallText style="FONT-WEIGHT: bold" name=sbo> <OPTION 
              value=kw selected>Articles</OPTION> <OPTION 
              value=fm>Messages</OPTION></SELECT> <INPUT class=SmallText style="FONT-WEIGHT: bold" type=submit value=" Go! "> 
            &nbsp; </FORM></TD>
          <TD class=TinyText style="WHITE-SPACE: nowrap"><A 
            href="http://www.codeproject.com/info/search.aspx">Advanced 
            Search</A><BR><A 
            href="http://www.codeproject.com/script/Content/SiteMap.aspx">Sitemap</A> 
            | <A id=ctl00_SearchBarCtrl_AddToIESearchLnk 
            title="Add The Code Project to your IE search Providers" 
            onclick="window.external.AddSearchProvider('http://www.codeproject.com/info/OpenSearch.xml');return false;" 
            href="http://www.codeproject.com/">Add to IE Search</A> 
        </TD></TR></TBODY></TABLE><SPAN id=ctl00_ResultMessage></SPAN>
      <DIV id=ctl00_ArtDiv>
      <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
        <TBODY>
        <TR vAlign=top>
          <TD vAlign=top>
            <TABLE>
              <TBODY>
              <TR>
                <TD class="SmallText Bold"><IMG 
                  id=ctl00_ArticleAwards_AR_ctl01_AI 
                  style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" 
                  src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/prize_winner.gif"></TD>
                <TD class="SmallText Bold" style="WHITE-SPACE: nowrap">Prize 
                  winner in Competition "C# Apr 2006" 
<I></I></TD></TR></TBODY></TABLE>
            <DIV class=SmallText><IMG style="VERTICAL-ALIGN: middle" height=16 
            alt=print 
            src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/print.gif" 
            width=16> <A id=ctl00_ArticleHeaderLinks_PrintLnk 
            href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?display=Print">Print</A> 
            &nbsp; <IMG style="VERTICAL-ALIGN: middle" height=16 
            alt="Broken Article?" 
            src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/report.gif" 
            width=16> <A id=ctl00_ArticleHeaderLinks_BrokenLnk 
            href="http://www.codeproject.com/script/Articles/Report.aspx?aid=14155">Report 
            Article</A> &nbsp; &nbsp; &nbsp; <IMG style="VERTICAL-ALIGN: middle" 
            height=16 alt=Discuss 
            src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/discuss.gif" 
            width=15> <A 
            href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx#_comments">Discuss</A> 
            &nbsp; <IMG style="VERTICAL-ALIGN: middle" height=16 
            alt="Recommend Article" 
            src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/mail.gif" 
            width=16>&nbsp;<A id=ctl00_ArticleHeaderLinks_Recommend 
            href="http://www.codeproject.com/script/common/TellFriend.aspx?obtid=2&amp;obid=14155">Send&nbsp;to&nbsp;a&nbsp;friend</A> 
            </DIV></TD>
          <TD style="WIDTH: 100px; WHITE-SPACE: nowrap; TEXT-ALIGN: right">
            <TABLE id=CurRat>
              <TBODY>
              <TR>
                <TD>
                  <TABLE>
                    <TBODY>
                    <TR>
                      <TD class=SmallText style="WHITE-SPACE: nowrap" 
                      align=right><SPAN id=ctl00_ArticleRating_VoteLabel>177 
                        votes for this Article.</SPAN></TD>
                      <TD>
                        <TABLE cellSpacing=0 cellPadding=0 border=1>
                          <TBODY>
                          <TR>
                            <TD width=20 bgColor=white height=7><IMG height=7 
                              src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/red.gif" 
                              width=20 align=center border=0></TD>
                            <TD width=20 bgColor=white height=7><IMG height=7 
                              src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/red.gif" 
                              width=20 align=center border=0></TD>
                            <TD width=20 bgColor=white height=7><IMG height=7 
                              src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/red.gif" 
                              width=20 align=center border=0></TD>
                            <TD width=20 bgColor=white height=7><IMG height=7 
                              src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/red.gif" 
                              width=20 align=center border=0></TD>
                            <TD noWrap width=20 bgColor=white height=7><IMG 
                              height=7 
                              src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/red.gif" 
                              width=16 align=center 
                      border=0></TD></TR></TBODY></TABLE></TD></TR>
                    <TR id=ctl00_ArticleRating_PopularityRow>
                      <TD class=SmallText align=right colSpan=2><A 
                        id=ctl00_ArticleRating_PopularityLnk 
                        title="Calculated as rating x Log10(# votes)" 
                        href="http://www.codeproject.com/script/Articles/TopArticles.aspx?ta_so=1">Popularity: 
                        10.82</A> <SPAN 
                        id=ctl00_ArticleRating_PopularityLbl></SPAN><SPAN 
                        id=ratingVal>Rating: <B>4.81</B> out of 
                    5</SPAN></TD></TR></TBODY></TABLE></TD>
                <TD>
                  <DIV>
                  <TABLE class=HistTable 
                  title="Voting Distribution. Recent data only">
                    <TBODY>
                    <TR>
                      <TD><IMG title="4 votes, 2.3%" height=1 
                        alt="4 votes, 2.3%" src="" width=10 border=0><BR>1</TD>
                      <TD><IMG title="0 votes, 0.0%" height=1 
                        alt="0 votes, 0.0%" src="" width=10 border=0><BR>2</TD>
                      <TD><IMG title="4 votes, 2.3%" height=1 
                        alt="4 votes, 2.3%" src="" width=10 border=0><BR>3</TD>
                      <TD><IMG title="10 votes, 5.6%" height=1 
                        alt="10 votes, 5.6%" 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/pollcol.gif" 
                        width=10 border=0><BR>4</TD>
                      <TD><IMG title="159 votes, 89.8%" height=20 
                        alt="159 votes, 89.8%" 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/pollcol.gif" 
                        width=10 
              border=0><BR>5</TD></TD></TR></TBODY></TABLE></DIV></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><SPAN 
      id=intelliTXT>
      <DIV id=contentdiv><!-- Main Page Contents Start --><!-- Article Starts -->
      <UL class=download>
        <LI><A 
        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien/AsyncSocketServerandClient.zip">Download 
        source and demo project - 195.1 KB</A> </LI></UL><IMG height=460 
      alt="Article screenshot" 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/Article.jpg" 
      width=553 border=0> 
      <H2>Introduction</H2>
      <P>I've been working with sockets since 2000, using Delphi 5.0 and some 
      third-party libraries <A href="http://synapse.ararat.cz/" 
      target=_blank>(Synapse)</A>. My very first socket application just copied 
      files between many clients and one server. The client app checks a folder 
      to see if files exist, asks the server where to copy the files in the 
      network and, after copying the files, flags the database record indicating 
      that a file has been moved. The server listens to the client connections, 
      and both exchange XML messages indicating the state of each file copy. 
      Synapse is a blocking socket implementation, and I needed a thread pooling 
      mechanism that works like an HTTP server, because I couldn't keep the 
      connection open (one thread per connection). My solution was to use some 
      IOCP functions to pool the client requests <A 
      href="http://synapse.ararat.cz/files/contrib/IocpPool.zip" 
      target=_blank>(code)</A> and close the connection after the message 
      exchange was terminated.</P>
      <P>Now, using C#, I decided to write a socket server and client library 
      that helps me to only have to think about the message exchange (the 
      process) and let .NET do the hard job. So, I needed the following 
      features:</P>
      <UL>
        <LI>Asynchronous processing 
        <LI>Some encryption and compression capabilities 
        <LI>Encapsulate the socket, and encrypt the services in the interfaces 
        and separate them from the host implementation </LI></UL>
      <H2>Socket Connection</H2><A title="Click to enlarge" 
      href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien/socketconnection.JPG" 
      target=_blank><IMG height=227 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/socketconnection_small.jpg" 
      width=600 border=0></A> 
      <P>The <CODE>ISocketConnection</CODE> is the base interface for the socket 
      connections, and describes all the connection properties and the methods. 
      The <CODE>ConnectionID</CODE> property defines a unique connection ID 
      using a GUID string. The <CODE>CustomData</CODE> property defines a custom 
      object that can be associated with the connection. The <CODE>Header</CODE> 
      property is the socket service header used in each message that is 
      encapsulated in a packet message. Only messages with a defined header will 
      be accepted. The <CODE>LocalEndPoint</CODE> and 
      <CODE>RemoteEndPoint</CODE> are the socket IP end points used in the 
      connection. <CODE>SocketHandle</CODE> is the socket handle given by the 
      OS.</P>
      <P>The <CODE>IClientSocketConnection</CODE> and 
      <CODE>IServerSocketConnection</CODE> inherit the 
      <CODE>ISocketConnection</CODE>, and each one has special functions. The 
      <CODE>IClientSocketConnection</CODE> can reconnect to the server using the 
      <CODE>BeginReconnect</CODE> method, and the 
      <CODE>IServerSocketConnection</CODE> can communicate with other 
      connections in the server host using the <CODE>BeginSendTo</CODE> and 
      <CODE>BeginSendToAll</CODE> methods, and can get the 
      <CODE>ConnectionId</CODE> using the <CODE>GetConnectionById</CODE> method. 
      Every connection knows the host, the encryption, the compression type, and 
      can send, receive, and disconnect itself from the other part. This 
      interface is used in the <CODE>ISocketService</CODE> interface to allow 
      the user to interact with socket connections.</P><IMG height=183 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/BaseSocketConnection.jpg" 
      width=600 border=0> 
      <P>Internally, in the library implementation, all the connection 
      interfaces are created using the base connection implementations: 
      <CODE>BaseSocketConnection</CODE>, <CODE>ClientSocketConnection</CODE>, 
      and <CODE>ServerSocketConnection</CODE>.</P>
      <H2>Socket Service</H2><IMG height=165 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/socketservice.jpg" 
      width=600 border=0> 
      <P>The <CODE>ISocketService</CODE> describes the connection events. These 
      events are fired by the host, and have a <CODE>ConnectionEventArgs</CODE> 
      argument which has an <CODE>ISocketConnection</CODE> that identifies the 
      connection. In the <CODE>OnReceived</CODE> and <CODE>OnSent</CODE> events, 
      a <CODE>MessageEventArgs</CODE> is passed, which has the sent or received 
      array of bytes. In the <CODE>OnDisconnected</CODE> event, a 
      <CODE>DisconnectedEventArgs</CODE> is passed; the <CODE>Exception</CODE> 
      property indicates if the disconnection has been caused by an 
      exception.</P>
      <P>Here is an example of a <CODE>ISocketService</CODE> implementation:</P><PRE lang=cs><SPAN class=code-keyword>public</SPAN> <SPAN class=code-keyword>class</SPAN> SimpleEchoService : ISocketService
{
    <SPAN class=code-keyword>public</SPAN> <SPAN class=code-keyword>void</SPAN> OnConnected(ConnectionEventArgs e)
    {
        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Check the host!
</SPAN>        <SPAN class=code-keyword>if</SPAN> (e.Connection.HostType == HostType.htServer)
        {
            <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Enqueue receive!
</SPAN>            e.Connection.BeginReceive();
        }
        <SPAN class=code-keyword>else</SPAN>
        {
            <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Enqueue send a custom message!
</SPAN>            <SPAN class=code-keyword>byte</SPAN>[] b =
              GetMessage(e.Connection.SocketHandle.ToInt32());
            e.Connection.BeginSend(b);
        }
    }

    <SPAN class=code-keyword>public</SPAN> <SPAN class=code-keyword>void</SPAN> OnSent(MessageEventArgs e)
    {
        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Check the host. In this case both start a receive!
</SPAN>        <SPAN class=code-keyword>if</SPAN> (e.Connection.HostType == HostType.htServer)
        {
            <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Enqueue receive!
</SPAN>            e.Connection.BeginReceive();
        }
        <SPAN class=code-keyword>else</SPAN>
        {
            <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Enqueue receive!
</SPAN>            e.Connection.BeginReceive();
        }
    }

    <SPAN class=code-keyword>public</SPAN> <SPAN class=code-keyword>override</SPAN> <SPAN class=code-keyword>void</SPAN> OnReceived(MessageEventArgs e)
    {
        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Check the host!
</SPAN>        <SPAN class=code-keyword>if</SPAN> (e.Connection.HostType == HostType.htServer)
        {
            <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- If server, send the data buffer received!
</SPAN>            <SPAN class=code-keyword>byte</SPAN>[] b = e.Buffer;
            e.Connection.BeginSend(b);
        }
        <SPAN class=code-keyword>else</SPAN>
        {
            <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- If client, generate another
</SPAN>            <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- custom message and send it!
</SPAN>            <SPAN class=code-keyword>byte</SPAN>[] b = GetMessage(e.Connection.SocketHandle.ToInt32());
            e.Connection.BeginSend(b);
        }
    }

    <SPAN class=code-keyword>public</SPAN> <SPAN class=code-keyword>override</SPAN> <SPAN class=code-keyword>void</SPAN> OnDisconnected(DisconnectedEventArgs e)
    {
        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Check the host!
</SPAN>        <SPAN class=code-keyword>if</SPAN> (e.Connection.HostType == HostType.htServer)
        {
            <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Nothing!
</SPAN>        }
        <SPAN class=code-keyword>else</SPAN>
        {
            <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Reconnect with server!
</SPAN>            e.Connection.AsClientConnection().BeginReconnect();
        }
    }
}</PRE>
      <P>The <CODE>ISocketService</CODE> implementation can be done in the same 
      host assembly, or another assembly referenced by the host. This allows the 
      user to separate the host implementation from the socket service, helping 
      the administration in a server or a domain.</P>
      <H2>Connection Host</H2><IMG height=349 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/basehost.jpg" 
      width=475 border=0> 
      <P>With the <CODE>ISocketService</CODE> created, you need to host the 
      service and the service connections. Both the server and the client host 
      have the same parent class, <CODE>BaseSocketConnectionHost</CODE>, which 
      keeps a list of connections, encrypts and compresses the data buffers, 
      enqueues the service requests and ensures that all data buffer has been 
      sent or received, checks messages headers, and checks for idle 
      connections. The <CODE>CheckTimeoutTimer</CODE>, periodically, at 
      <CODE>IdleCheckInterval</CODE>, checks if the connections become idle, 
      using the <CODE>IdleTimeOutValue</CODE> as the idle timeout. 
      <CODE>Header</CODE> is the socket service header used by the host. 
      <CODE>HostType</CODE> indicates if a host is a server or a client host. 
      <CODE>SocketBufferSize</CODE> defines the size of the socket send and 
      receive buffer. <CODE>SocketService</CODE> is the instance of 
      <CODE>ISocketService</CODE> that drives the message exchange between the 
      connections.</P>
      <H3>Encrypt and Compress</H3><IMG height=174 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/cryptutils.jpg" 
      width=572 border=0> 
      <P>Every time you send and receive messages, the host checks if the data 
      must be encrypted and/or compressed, and this work is made by the 
      <CODE>CryptUtils</CODE> static class. The 
      <CODE>CreateSymmetricAlgoritm</CODE> creates an 
      <CODE>ISymmetricAlgoritm</CODE> based on the <CODE>encryptType</CODE> 
      parameter. The <CODE>DecryptData</CODE> and 
      <CODE>DecryptDataForAuthenticate</CODE> are used, respectively, to decrypt 
      the received message and check the hash sign on the authenticate 
      procedure. The <CODE>EncryptData</CODE> and 
      <CODE>EncryptDataForAuthenticate</CODE>, respectively, encrypt the data to 
      be sent and sign the authenticated message.</P><IMG height=265 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/messageBuffer.jpg" 
      width=523 border=0> 
      <P>The encrypted data buffer is labelled with the service header and the 
      data buffer length, becoming a packet buffer. This packet buffer is 
      controlled by the <CODE>MessageBuffer</CODE> class that keeps information 
      about the packet buffer offset, length, the remaining bytes, and the raw 
      buffer.</P>
      <H3>Enqueuing requests</H3>
      <P>Every time you call <CODE>BeginReceive</CODE> or <CODE>BeginSend</CODE> 
      in <CODE>ISocketService</CODE>, the host checks if some request has been 
      initiated. If a request is in process, the host enqueues the request. If 
      not, it fires the request.</P>
      <H4>Send request</H4>
      <P>In the <CODE>BeginSend</CODE> method, the following enqueuing is 
      used:</P><PRE lang=cs><SPAN class=code-keyword>internal</SPAN> <SPAN class=code-keyword>void</SPAN> BeginSend(BaseSocketConnection connection, <SPAN class=code-keyword>byte</SPAN>[] buffer)
{
...
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Check Queue!
</SPAN>    <SPAN class=code-keyword>lock</SPAN> (connection.WriteQueue)
    {

        <SPAN class=code-keyword>if</SPAN> (connection.WriteQueueHasItems)
        {
            <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- If the connection is sending, enqueue the message!
</SPAN>            connection.WriteQueue.Enqueue(writeMessage);
        }
        <SPAN class=code-keyword>else</SPAN>
        {

            <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- If the connection is not sending, send the message!
</SPAN>            connection.WriteQueueHasItems = <SPAN class=code-keyword>true</SPAN>;

...</PRE>
      <P>When the message is sent, in the send callback, the host checks the 
      queue again and initiates another send process, if needed:</P><PRE lang=cs><SPAN class=code-keyword>private</SPAN> <SPAN class=code-keyword>void</SPAN> BeginSendCallback(IAsyncResult ar)
{
    ...
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Check Queue!
</SPAN>    <SPAN class=code-keyword>lock</SPAN> (connection.WriteQueue)
    {

        <SPAN class=code-keyword>if</SPAN> (connection.WriteQueue.Count &gt; <SPAN class=code-digit>0</SPAN>)
        {

            <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- If has items, send it!
</SPAN>            MessageBuffer dequeueWriteMessage =
                          connection.WriteQueue.Dequeue();
            ...

        }
        <SPAN class=code-keyword>else</SPAN>
        {
            connection.WriteQueueHasItems = <SPAN class=code-keyword>false</SPAN>;
        }

    }
...</PRE>
      <H4>Receive request</H4>
      <P>The same technique applies to the receive method: all the calls to 
      <CODE>BeginReceive</CODE> are enqueued if the receive method is in action. 
      If no receive process was initiated, the host starts to receive:</P><PRE lang=cs lsng="cs"><SPAN class=code-keyword>internal</SPAN> <SPAN class=code-keyword>void</SPAN> BeginReceive(BaseSocketConnection connection)
{
    ...
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Check Queue!
</SPAN>    <SPAN class=code-keyword>lock</SPAN> (connection.SyncReadCount)
    {

        <SPAN class=code-keyword>if</SPAN> (connection.ReadCanEnqueue)
        {

            <SPAN class=code-keyword>if</SPAN> (connection.ReadCount == <SPAN class=code-digit>0</SPAN>)
            {

                <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- if the connection is not receiving, start the receive!
</SPAN>                MessageBuffer readMessage = <SPAN class=code-keyword>new</SPAN> MessageBuffer
                            (FSocketBufferSize);

                ...

            }

            <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Increase the read count!
</SPAN>            connection.ReadCount++;

        }

    }
    ...</PRE>
      <P>After that, when the message is received and parsed in the receive 
      callback, the host checks the read queue again, and initiates another 
      receive process, if needed:</P><PRE lang=cs><SPAN class=code-keyword>private</SPAN> <SPAN class=code-keyword>void</SPAN> BeginReadCallback(IAsyncResult ar)
{
    ...
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Check Queue!
</SPAN>    <SPAN class=code-keyword>lock</SPAN> (connection.SyncReadCount)
    {

        connection.ReadCount--;

        <SPAN class=code-keyword>if</SPAN> (connection.ReadCount &gt; <SPAN class=code-digit>0</SPAN>)
        {

            <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- if the read queue has items, start to receive!
</SPAN>            ...

        }

    }
    ...</PRE>
      <H3>Ensure send and receive</H3>
      <P>To ensure that all data buffer is sent, the 
      <CODE>BaseSocketConnectionHost</CODE> checks the bytes sent, and compares 
      it to the <CODE>MessageBuffer</CODE> class. It continues to send the 
      remaining bytes till all the data buffer is sent:</P><PRE lang=cs><SPAN class=code-keyword>private</SPAN> <SPAN class=code-keyword>void</SPAN> BeginSendCallback(IAsyncResult ar)
{
...
    <SPAN class=code-keyword>byte</SPAN>[] sent = <SPAN class=code-keyword>null</SPAN>;
    <SPAN class=code-keyword>int</SPAN> writeBytes = .EndSend(ar);

    <SPAN class=code-keyword>if</SPAN> (writeBytes &lt; writeMessage.PacketBuffer.Length)
    {
        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Continue to send until all bytes are sent!
</SPAN>        writeMessage.PacketOffSet += writeBytes;
        .BeginSend(writeMessage.PacketBuffer, writeMessage.PacketOffSet,
                   writeMessage.PacketRemaining, SocketFlags.None ...);
    }
    <SPAN class=code-keyword>else</SPAN>
    {
        sent = <SPAN class=code-keyword>new</SPAN> <SPAN class=code-keyword>byte</SPAN>[writeMessage.RawBuffer.Length];
        Array.Copy(writeMessage.RawBuffer, <SPAN class=code-digit>0</SPAN>, sent, <SPAN class=code-digit>0</SPAN>, 
                    writeMessage.RawBuffer.Length);
        FireOnSent(connection, sent);
    }
}</PRE>
      <P>The same approach is used in the receive data buffers because, to read 
      data, a <CODE>MessageBuffer</CODE> is used as the read buffer. When the 
      receive callback is called, it continues to read till all the bytes in the 
      message are read:</P><PRE lang=cs><SPAN class=code-keyword>private</SPAN> <SPAN class=code-keyword>void</SPAN> BeginReadCallback(IAsyncResult ar)
{
    ...
    CallbackData callbackData = (CallbackData)ar.AsyncState;

    connection = callbackData.Connection;
    readMessage = callbackData.Buffer;

    <SPAN class=code-keyword>int</SPAN> readBytes = <SPAN class=code-digit>0</SPAN>;
    ...
    readBytes = .EndReceive(ar);
    ...

    <SPAN class=code-keyword>if</SPAN> (readBytes &gt; <SPAN class=code-digit>0</SPAN>)
    {
        ...
        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Has bytes!
</SPAN>        ...
        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Process received data!
</SPAN>        readMessage.PacketOffSet += readBytes;
        ...

        <SPAN class=code-keyword>if</SPAN> (readSocket)
        {


            <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Read More!
</SPAN>            .BeginReceive(readMessage.PacketBuffer,
                          readMessage.PacketOffSet,
                          readMessage.PacketRemaining,
                          SocketFlags.None, ...);
        }
    }
    ...</PRE>
      <H3>Check message header</H3>
      <P>If the socket service uses some header, all the send and receive 
      processes need to create a packet message indicating the header and the 
      message length. This packet label is created using the following 
      structure:</P><IMG height=153 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/label.jpg" 
      width=580 border=0> 
      <P>The first label's part is the socket service header. The header is an 
      array of bytes of any length, and you need some advice here: if you choose 
      a very small header, maybe you can have a message with the same array of 
      bytes somewhere, and the host will lose the sequence. If you choose a very 
      long array of bytes, the host can spend the processor's time to verify if 
      the message header is equal to the socket service. The second part is the 
      packet message length. This length is calculated adding the raw message 
      data buffer length, encrypted and/or compressed, plus the header 
      length.</P>
      <H4>Sending packets</H4>
      <P>As said before, every time you send messages, the host checks if the 
      data must be encrypted and/or compressed, and, if you choose to use some 
      header, the raw buffer is controlled by the <CODE>MessageBuffer</CODE> 
      class. This class is created using the <CODE>GetPacketMessage</CODE> 
      <CODE><SPAN class=code-keyword>static</SPAN></CODE> method:</P><PRE lang=cs><SPAN class=code-keyword>public</SPAN> <SPAN class=code-keyword>static</SPAN> MessageBuffer GetPacketMessage(
       BaseSocketConnection connection, <SPAN class=code-keyword>ref</SPAN> <SPAN class=code-keyword>byte</SPAN>[] buffer)
{

    <SPAN class=code-keyword>byte</SPAN>[] workBuffer = <SPAN class=code-keyword>null</SPAN>;

    workBuffer = CryptUtils.EncryptData(connection, buffer);

    <SPAN class=code-keyword>if</SPAN> (connection.Header != <SPAN class=code-keyword>null</SPAN> &amp;&amp; connection.Header.Length &gt;= <SPAN class=code-digit>0</SPAN>)
    {
        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Need header!
</SPAN>        <SPAN class=code-keyword>int</SPAN> headerSize = connection.Header.Length + <SPAN class=code-digit>2</SPAN>;
        <SPAN class=code-keyword>byte</SPAN>[] result = <SPAN class=code-keyword>new</SPAN> <SPAN class=code-keyword>byte</SPAN>[workBuffer.Length + headerSize];

        <SPAN class=code-keyword>int</SPAN> messageLength = result.Length;

        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Header!
</SPAN>        <SPAN class=code-keyword>for</SPAN> (<SPAN class=code-keyword>int</SPAN> i = <SPAN class=code-digit>0</SPAN>; i &lt; connection.Header.Length; i++)
        {
            result[i] = connection.Header[i];
        }

        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Length!
</SPAN>        result[connection.Header.Length] =
           Convert.ToByte((messageLength &amp; 0xFF00) &gt;&gt; <SPAN class=code-digit>8</SPAN>);
        result[connection.Header.Length + <SPAN class=code-digit>1</SPAN>] =
           Convert.ToByte(messageLength &amp; 0xFF);

        Array.Copy(workBuffer, <SPAN class=code-digit>0</SPAN>, result,
                   headerSize, workBuffer.Length);

        <SPAN class=code-keyword>return</SPAN> <SPAN class=code-keyword>new</SPAN> MessageBuffer(<SPAN class=code-keyword>ref</SPAN> buffer, <SPAN class=code-keyword>ref</SPAN> result);

    }
    <SPAN class=code-keyword>else</SPAN>
    {
        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- No header!
</SPAN>        <SPAN class=code-keyword>return</SPAN> <SPAN class=code-keyword>new</SPAN> MessageBuffer(<SPAN class=code-keyword>ref</SPAN> buffer, <SPAN class=code-keyword>ref</SPAN> workBuffer);
    }
}</PRE>
      <H4>Receiving packets</H4>
      <P>The receive process, if you're using some socket service header, needs 
      to check the header, and continues to read bytes till all the packet 
      message is received. This process is executed in the read callback:</P><PRE lang=cs><SPAN class=code-keyword>private</SPAN> <SPAN class=code-keyword>void</SPAN> BeginReadCallback(IAsyncResult ar)
{
...

    <SPAN class=code-keyword>byte</SPAN>[] received = <SPAN class=code-keyword>null</SPAN>
    <SPAN class=code-keyword>byte</SPAN>[] rawBuffer = <SPAN class=code-keyword>null</SPAN>;
    <SPAN class=code-keyword>byte</SPAN>[] connectionHeader = connection.Header;

    readMessage.PacketOffSet += readBytes;

    <SPAN class=code-keyword>if</SPAN> ((connectionHeader != <SPAN class=code-keyword>null</SPAN>) &amp;&amp; (connectionHeader.Length &gt; <SPAN class=code-digit>0</SPAN>))
    {

        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Message with header!
</SPAN>        <SPAN class=code-keyword>int</SPAN> headerSize = connectionHeader.Length + <SPAN class=code-digit>2</SPAN>;

        <SPAN class=code-keyword>bool</SPAN> readPacket = <SPAN class=code-keyword>false</SPAN>;
        <SPAN class=code-keyword>bool</SPAN> readSocket = <SPAN class=code-keyword>false</SPAN>;

        <SPAN class=code-keyword>do</SPAN>
        {
            connection.LastAction = DateTime.Now;

            <SPAN class=code-keyword>if</SPAN> (readMessage.PacketOffSet &gt; headerSize)
            {
                <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Has Header!
</SPAN>                <SPAN class=code-keyword>for</SPAN> (<SPAN class=code-keyword>int</SPAN> i = <SPAN class=code-digit>0</SPAN>; i &lt; connectionHeader.Length; i++)
                {
                    <SPAN class=code-keyword>if</SPAN> (connectionHeader[i] != readMessage.PacketBuffer[i])
                    {
                        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Bad Header!
</SPAN>                        <SPAN class=code-keyword>throw</SPAN> <SPAN class=code-keyword>new</SPAN> BadHeaderException(
                          <SPAN class=code-string>"</SPAN><SPAN class=code-string>Message header is different from Host header."</SPAN>);
                    }
                }

                <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Get Length!
</SPAN>                <SPAN class=code-keyword>int</SPAN> messageLength =
                  (readMessage.PacketBuffer[connectionHeader.Length] &lt;&lt; <SPAN class=code-digit>8</SPAN>) +
                  readMessage.PacketBuffer[connectionHeader.Length + <SPAN class=code-digit>1</SPAN>];

                <SPAN class=code-keyword>if</SPAN> (messageLength &gt; FMessageBufferSize)
                {
                    <SPAN class=code-keyword>throw</SPAN> <SPAN class=code-keyword>new</SPAN> MessageLengthException(<SPAN class=code-string>"</SPAN><SPAN class=code-string>Message "</SPAN> +
                      <SPAN class=code-string>"</SPAN><SPAN class=code-string>length is greater than Host maximum message length."</SPAN>);
                }

                <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Check Length!
</SPAN>                <SPAN class=code-keyword>if</SPAN> (messageLength == readMessage.PacketOffSet)
                {
                    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Equal -&gt; Get rawBuffer!
</SPAN>                    rawBuffer =
                      readMessage.GetRawBuffer(messageLength, headerSize);

                    readPacket = <SPAN class=code-keyword>false</SPAN>;
                    readSocket = <SPAN class=code-keyword>false</SPAN>;
                }
                <SPAN class=code-keyword>else</SPAN>
                {
                    <SPAN class=code-keyword>if</SPAN> (messageLength &lt; readMessage.PacketOffSet)
                    {
                        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Less -&gt; Get rawBuffer and fire event!
</SPAN>                        rawBuffer =
                          readMessage.GetRawBuffer(messageLength, headerSize);

                        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Decrypt!
</SPAN>                        rawBuffer = CryptUtils.DecryptData(connection,
                                    <SPAN class=code-keyword>ref</SPAN> rawBuffer, FMessageBufferSize);

                        readPacket = <SPAN class=code-keyword>true</SPAN>;
                        readSocket = <SPAN class=code-keyword>false</SPAN>;

                        received = <SPAN class=code-keyword>new</SPAN> <SPAN class=code-keyword>byte</SPAN>[rawBuffer.Length];
                        Array.Copy(rawBuffer, <SPAN class=code-digit>0</SPAN>, received, <SPAN class=code-digit>0</SPAN>, 
                            rawBuffer.Length);
                        FireOnReceived(connection, received, <SPAN class=code-keyword>false</SPAN>);
                    }
                    <SPAN class=code-keyword>else</SPAN>
                    {
                        <SPAN class=code-keyword>if</SPAN> (messageLength &gt; readMessage.PacketOffSet)
                        {
                            <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Greater -&gt; Read Socket!
</SPAN>                            <SPAN class=code-keyword>if</SPAN> (messageLength &gt; readMessage.PacketLength)
                            {
                                readMessage.Resize(messageLength);
                            }

                            readPacket = <SPAN class=code-keyword>false</SPAN>;
                            readSocket = <SPAN class=code-keyword>true</SPAN>;
                        }
                    }
                }
            }
            <SPAN class=code-keyword>else</SPAN>
            {
                <SPAN class=code-keyword>if</SPAN> (readMessage.PacketRemaining &lt; headerSize)
                {
                    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Adjust room for more!
</SPAN>                    readMessage.Resize(readMessage.PacketLength + headerSize);
                }

                readPacket = <SPAN class=code-keyword>false</SPAN>;
                readSocket = <SPAN class=code-keyword>true</SPAN>;
            }

        } <SPAN class=code-keyword>while</SPAN> (readPacket);

        <SPAN class=code-keyword>if</SPAN> (readSocket)
        {
            <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Read More!
</SPAN>            ...
            .BeginReceive(readMessage.PacketBuffer, readMessage.PacketOffSet,
                          readMessage.PacketRemaining, SocketFlags.None, ...);
            ...
        }
    }
    <SPAN class=code-keyword>else</SPAN>
    {
        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Message with no header!
</SPAN>        rawBuffer = readMessage.GetRawBuffer(readBytes, <SPAN class=code-digit>0</SPAN>);
    }

    <SPAN class=code-keyword>if</SPAN> (rawBuffer != <SPAN class=code-keyword>null</SPAN>)
    {
        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Decrypt!
</SPAN>        rawBuffer = CryptUtils.DecryptData(connection,
                    <SPAN class=code-keyword>ref</SPAN> rawBuffer, FMessageBufferSize);

        received = <SPAN class=code-keyword>new</SPAN> <SPAN class=code-keyword>byte</SPAN>[rawBuffer.Length];
        Array.Copy(rawBuffer, <SPAN class=code-digit>0</SPAN>, received, <SPAN class=code-digit>0</SPAN>, rawBuffer.Length);
        FireOnReceived(connection, received, <SPAN class=code-keyword>true</SPAN>);

        readMessage.Resize(FSocketBufferSize);
...</PRE>
      <P>The read callback method first checks if the connection has some header 
      and, if not, just gets the raw buffer and continues. If the connection has 
      some header, the method needs to check the message header against the 
      socket service header. Before doing that, it checks if the packet message 
      length is greater than the connection header length, to ensure that it can 
      parse the total message length. If not, it reads some bytes. After 
      checking the header, the method parses the message length, and checks with 
      the packet length. If the length is equal, it gets the raw buffer and 
      terminates the loop. If the message length is less than that of the packet 
      message, we have the message plus some data. So, the method gets the raw 
      buffer and continues to read using the same <CODE>MessageBuffer</CODE> 
      class. If the length of the message is greater than that of the packet 
      message, before reading some data, it just resizes the packet buffer to 
      the message size, ensuring enough room for more read bytes.</P>
      <H3>Checking idle connections</H3>
      <P>Using the <CODE>BeginSend</CODE> and <CODE>BeginReceive</CODE> methods 
      of <CODE>ISocketConnection</CODE> doesn't return some 
      <CODE>IAsyncResult</CODE> to know if the method was completed or not 
      allowing disconnection after some timeout value. To prevent this, the 
      <CODE>BaseSocketConnectionHost</CODE> has a 
      <CODE>System.Threading.Timer</CODE> that periodically checks the 
      <CODE>LastAction</CODE> property of <CODE>BaseSocketConnection</CODE>. If 
      <CODE>LastAction</CODE> is greater than the idle timeout, the connection 
      is closed.</P>
      <H2>Crypto Service</H2><IMG height=130 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/cryptoservice.jpg" 
      width=600 border=0> 
      <P>The <CODE>ICryptoService</CODE> describes the authentication methods 
      fired when the connection is made to the other part. The 
      <CODE>OnSymmetricAuthenticate</CODE> method is fired when 
      <CODE>EncryptType.etRijndael</CODE> or 
      <CODE>EncryptType.etTripleDES</CODE> is used, and 
      <CODE>OnSSLXXXXAuthentication</CODE> is fired when 
      <CODE>EncryptType.etSSL</CODE> is used. Like <CODE>ISocketService</CODE>, 
      the <CODE>ICryptService</CODE> can be done in the same host assembly, or 
      another assembly referenced by the host, so you can have one 
      <CODE>ICryptoService</CODE> implementation used in many 
      <CODE>ISocketService</CODE> implementations.</P>
      <H3>SSL authentication</H3>
      <P>There's a new stream class called <CODE>SslStream</CODE> in .NET 2.0 
      which can authenticate SSL streams. The <CODE>SslStream</CODE>'s 
      constructor accepts a <CODE>NetworkStream</CODE> class, and this stream is 
      created using the <CODE>Socket</CODE> class. So, using 
      <CODE>SslStream</CODE>, you can send and receive data buffers using socket 
      connections.</P>
      <H4>Server authentication</H4>
      <P>The <CODE>SslStream</CODE> authentication is done in both the client 
      and the server, but each one has different parameters. In the server side, 
      you need to pass a certificate using the <CODE>X509Certificate2</CODE> 
      class, either finding in the certificate store using 
      <CODE>X509Store</CODE>, or by creating it from a certification file 
      (<EM>.cer</EM>). Also, you can request a client authentication and check 
      the certificate's revocation. The following code is an example of an SSL 
      server authentication using <CODE>ICryptService</CODE>:</P><PRE lang=cs><SPAN class=code-keyword>public</SPAN> <SPAN class=code-keyword>void</SPAN> OnSSLServerAuthenticate(<SPAN class=code-keyword>out</SPAN> X509Certificate2 certificate,
               <SPAN class=code-keyword>out</SPAN> <SPAN class=code-keyword>bool</SPAN> clientAuthenticate, <SPAN class=code-keyword>ref</SPAN> <SPAN class=code-keyword>bool</SPAN> checkRevocation)
{
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Set server certificate, client
</SPAN>    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- authentication and certificate revocation!
</SPAN>    X509Store store = <SPAN class=code-keyword>new</SPAN> X509Store(StoreName.My,
                      StoreLocation.LocalMachine);
    store.Open(OpenFlags.ReadOnly);

    X509Certificate2Collection certs =
      store.Certificates.Find(X509FindType.FindBySubjectName,
      <SPAN class=code-string>"</SPAN><SPAN class=code-string>ALAZ Library"</SPAN>, <SPAN class=code-keyword>false</SPAN>);
    certificate = certs[<SPAN class=code-digit>0</SPAN>];

    clientAuthenticate = <SPAN class=code-keyword>false</SPAN>;
    checkRevocation = <SPAN class=code-keyword>false</SPAN>;

    store.Close();
}</PRE>
      <H4>Client authentication</H4>
      <P>On the client side of the SSL authentication, you need to pass the host 
      name of the server certificate, and if this name doesn't match, the 
      authentication fails. You can pass a client certificate collection using 
      <CODE>X509Certificate2Collection</CODE>. If the server doesn't request a 
      client authentication, you don't need to pass the collection but, if the 
      server requests it, you can find the certificates using 
      <CODE>X509Store</CODE>. You can also request a client certificate's 
      revocation. This is an example of SSL client authentication in 
      <CODE>ICryptoService</CODE>:</P><PRE lang=cs><SPAN class=code-keyword>public</SPAN> <SPAN class=code-keyword>void</SPAN> OnSSLClientAuthenticate(<SPAN class=code-keyword>out</SPAN> <SPAN class=code-keyword>string</SPAN> serverName,
            <SPAN class=code-keyword>ref</SPAN> X509Certificate2Collection certs, <SPAN class=code-keyword>ref</SPAN> <SPAN class=code-keyword>bool</SPAN> checkRevocation)
{
    serverName = <SPAN class=code-string>"</SPAN><SPAN class=code-string>ALAZ Library"</SPAN>;
    <SPAN class=code-comment>/*</SPAN><SPAN class=code-comment>
    //----- Using client certificate!
    X509Store store = new X509Store(StoreName.My,
                      StoreLocation.LocalMachine);
    store.Open(OpenFlags.ReadOnly);

    certs = store.Certificates.Find(
            X509FindType.FindBySubjectName,
            serverName, true);
    checkRevocation = false;

    store.Close();
    */</SPAN>
}</PRE>
      <H4>Certificates</H4>
      <P>To create certificates, you can use the <EM>MakeCert.exe</EM> tool 
      found in .NET, and there's a lot of information available about it. You 
      can take a look at <A 
      href="http://blogs.technet.com/jhoward/archive/2005/02/02/365323.aspx" 
      target=_blank>John Howard</A>'s page, this <A 
      href="http://www.mcse.ms/archive113-2005-5-1638636.html" target=_blank>MS 
      post</A>, and <A href="http://www.leastprivilege.com/">this 
      website</A>.</P>
      <H3>Symmetric authentication</H3>
      <P>To implement some symmetric encryption and authentication in this 
      library, I decided to put a <A 
      href="http://www.eggheadcafe.com/aspnet_answers/NETsecurity/Mar2006/post26035603.asp" 
      target=_blank>post</A> in Microsoft newsgroups. Unfortunately, for the 
      post, but luckily for the knowledge sharing (many thanks to Joe Kaplan, 
      Dominick Baier, and Valery Pryamikov), I decided to use <A 
      href="http://spaces.msn.com/staceyw/PersonalSpace.aspx?_c11_BlogPart_p=1&amp;_c11_BlogPart_handle=cns!F4A38E96E598161E!348&amp;_c11_BlogPart_FullView=1&amp;_c=BlogPart" 
      target=_blank>William Stacey's</A> implementation example <STRONG>"A 
      generic method to send secure messages using an exchanged session 
      key"</STRONG>. In this code, the symmetric key used in the session is 
      encrypted and signed using RSA key pairs, and the client part needs to 
      know the encrypted server's public key, meaning that this key isn't 
      received from the server in the authentication process. Both the client 
      and the server need to know this key through a manual process. To ensure 
      this, the <CODE>OnSymmetricAuthenticate</CODE> needs a 
      <CODE>RSACryptoServiceProvider</CODE> class providing the key pair for 
      encryption. You can fill the <CODE>RSACryptoServiceProvider</CODE> from an 
      XML string, a file, a <CODE>CspParameters</CODE> class, or a certificate. 
      Here is an example of symmetric authentication:</P><PRE lang=cs><SPAN class=code-keyword>public</SPAN> <SPAN class=code-keyword>void</SPAN> OnSymmetricAuthenticate(HostType hostType,
            <SPAN class=code-keyword>out</SPAN> RSACryptoServiceProvider serverKey)
{
    <SPAN class=code-comment>/*</SPAN><SPAN class=code-comment>
       * A RSACryptoServiceProvider is needed to encrypt and send session key.
       * In server side you need public and private key to decrypt session key.
       * In client side you need only public key to encrypt session key.
       *
       * You can create a RSACryptoServiceProvider from a string
       * (file, registry), a CspParameters or a certificate.
    */</SPAN>

    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Using string!
</SPAN>    <SPAN class=code-comment>/*</SPAN><SPAN class=code-comment>
    serverKey = new RSACryptoServiceProvider();
    serverKey.FromXMLString("XML key string");
    */</SPAN>

    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Using CspParameters!
</SPAN>    CspParameters param = <SPAN class=code-keyword>new</SPAN> CspParameters();
    param.KeyContainerName = <SPAN class=code-string>"</SPAN><SPAN class=code-string>ALAZ_ECHO_SERVICE"</SPAN>;
    serverKey = <SPAN class=code-keyword>new</SPAN> RSACryptoServiceProvider(param);

    <SPAN class=code-comment>/*</SPAN><SPAN class=code-comment>
    //----- Using Certificate Store!
    X509Store store = new X509Store(StoreName.My,
                      StoreLocation.LocalMachine);
    store.Open(OpenFlags.ReadOnly);

    X509Certificate2 certificate = store.Certificates.Find(
                     X509FindType.FindBySubjectName,
                     "ALAZ Library", true)[0];
    serverKey = new RSACryptoServiceProvider();

    if (hostType == HostType.htClient)
    {
        //----- In client only public key is needed!
        serverKey = (RSACryptoServiceProvider)certificate.PublicKey.Key;
    }
    else
    {
        //----- In server, both public and private key is needed!
        serverKey.FromXmlString(certificate.PrivateKey.ToXmlString(true));
    }

    store.Close();
    */</SPAN>
}</PRE>
      <H4>The authentication message</H4><IMG height=160 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/authmessage.jpg" 
      width=187 border=0> 
      <P>The symmetric authentication uses the <CODE>AuthMessage</CODE> 
      structure to exchange session keys between the client and the server. The 
      <CODE>SessionKey</CODE> and <CODE>SessionIV</CODE> properties are, 
      respectively, the symmetric key and the initialization vector of the 
      algorithm. The <CODE>Sign</CODE> property is the hash code generated by 
      the client using the sign <CODE>RSACryptoServiceProvider</CODE> class 
      created internally, and its public key is exchanged using the 
      <CODE>SourceKey</CODE> property. This internal sign key pair is necessary 
      to sign the <CODE>AuthMessage</CODE>, and the server can ensure that the 
      <CODE>AuthMessage</CODE> is accurate. This process is done using the 
      following code:</P>
      <H4>Client side</H4><PRE lang=cs>...
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Sign Message!
</SPAN><SPAN class=code-keyword>private</SPAN> <SPAN class=code-keyword>byte</SPAN>[] signMessage = <SPAN class=code-keyword>new</SPAN> <SPAN class=code-keyword>byte</SPAN>[]
                         { &lt;sign message array of bytes <SPAN class=code-keyword>for</SPAN> authentication&gt; };
...
<SPAN class=code-keyword>protected</SPAN> <SPAN class=code-keyword>virtual</SPAN> <SPAN class=code-keyword>void</SPAN> InitializeConnection(BaseSocketConnection connection)
{
...

<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Symmetric!
</SPAN><SPAN class=code-keyword>if</SPAN> (connection.EncryptType == EncryptType.etRijndael ||
    connection.EncryptType == EncryptType.etTripleDES)
{
    <SPAN class=code-keyword>if</SPAN> (FHost.HostType == HostType.htClient)
    {
        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Get RSA provider!
</SPAN>        RSACryptoServiceProvider serverPublicKey;
        RSACryptoServiceProvider clientPrivateKey =
                                <SPAN class=code-keyword>new</SPAN> RSACryptoServiceProvider();

        FCryptoService.OnSymmetricAuthenticate(FHost.HostType,
                                          <SPAN class=code-keyword>out</SPAN> serverPublicKey);

        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Generates symmetric algorithm!
</SPAN>        SymmetricAlgorithm sa =
          CryptUtils.CreateSymmetricAlgoritm(connection.EncryptType);
        sa.GenerateIV();
        sa.GenerateKey();

        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Adjust connection cryptors!
</SPAN>        connection.Encryptor = sa.CreateEncryptor();
        connection.Decryptor = sa.CreateDecryptor();

        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Create authenticate structure!
</SPAN>        AuthMessage am = <SPAN class=code-keyword>new</SPAN> AuthMessage();
        am.SessionIV = serverPublicKey.Encrypt(sa.IV, <SPAN class=code-keyword>false</SPAN>);
        am.SessionKey = serverPublicKey.Encrypt(sa.Key, <SPAN class=code-keyword>false</SPAN>);
        am.SourceKey =
          CryptUtils.EncryptDataForAuthenticate(sa,
          Encoding.UTF8.GetBytes(clientPrivateKey.ToXmlString(<SPAN class=code-keyword>false</SPAN>)),
          PaddingMode.ISO10126);

        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Sign message with am.SourceKey,
</SPAN>        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- am.SessionKey and signMessage!
</SPAN>        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Need to use PaddingMode.PKCS7 in sign!
</SPAN>        MemoryStream m = <SPAN class=code-keyword>new</SPAN> MemoryStream();
        m.Write(am.SourceKey, <SPAN class=code-digit>0</SPAN>, am.SourceKey.Length);
        m.Write(am.SessionKey, <SPAN class=code-digit>0</SPAN>, am.SessionKey.Length);
        m.Write(signMessage, <SPAN class=code-digit>0</SPAN>, signMessage.Length);

        am.Sign = clientPrivateKey.SignData(
                  CryptUtils.EncryptDataForAuthenticate(sa,
                  m.ToArray(), PaddingMode.PKCS7),
                  <SPAN class=code-keyword>new</SPAN> SHA1CryptoServiceProvider());

        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Serialize authentication message!
</SPAN>        XmlSerializer xml = <SPAN class=code-keyword>new</SPAN> XmlSerializer(<SPAN class=code-keyword>typeof</SPAN>(AuthMessage));
        m.SetLength(<SPAN class=code-digit>0</SPAN>);
        xml.Serialize(m, am);

        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Send structure!
</SPAN>        MessageBuffer mb = <SPAN class=code-keyword>new</SPAN> MessageBuffer(<SPAN class=code-digit>0</SPAN>);
        mb.PacketBuffer =
          Encoding.Default.GetBytes(Convert.ToBase64String(m.ToArray()));
        connection.Socket.BeginSend(
            mb.PacketBuffer, mb.PacketOffSet,
            mb.PacketRemaining, SocketFlags.None,
            <SPAN class=code-keyword>new</SPAN> AsyncCallback(InitializeConnectionSendCallback),
            <SPAN class=code-keyword>new</SPAN> CallbackData(connection, mb));

        m.Dispose();
        am.SessionIV.Initialize();
        am.SessionKey.Initialize();
        serverPublicKey.Clear();
        clientPrivateKey.Clear();
    }
...
}</PRE>
      <P>On the client side of the symmetric authentication, the 
      <CODE>OnSymmetricAuthenticate</CODE> is called, getting the 
      <CODE>RSACryptoServiceProvider</CODE> to encrypt the session key generated 
      by the <CODE>CryptUtils.CreateSymmetricAlgoritm</CODE> method. The 
      <CODE>AuthMessage</CODE> is filled with the encrypted session key, session 
      IV, and the sign public key. To sign the message, the 
      <CODE>SourceKey</CODE>, <CODE>SessionKey</CODE>, and 
      <CODE>signMessage</CODE> are used, and the resulting hash is assigned to 
      the <CODE>Sign</CODE> property.</P>
      <H4>Server side</H4><PRE lang=cs><SPAN class=code-keyword>protected</SPAN> <SPAN class=code-keyword>virtual</SPAN> <SPAN class=code-keyword>void</SPAN> InitializeConnection(BaseSocketConnection connection)
{
...
    <SPAN class=code-keyword>if</SPAN> (FHost.HostType == HostType.htClient)
    {
    ...
    }
    <SPAN class=code-keyword>else</SPAN>
    {
        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Create empty authenticate structure!
</SPAN>        MessageBuffer mb = <SPAN class=code-keyword>new</SPAN> MessageBuffer(<SPAN class=code-digit>8192</SPAN>);

        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Start receive structure!
</SPAN>        connection.Socket.BeginReceive(mb.PacketBuffer, mb.PacketOffSet,
                 mb.PacketRemaining, SocketFlags.None,
                 <SPAN class=code-keyword>new</SPAN> AsyncCallback(InitializeConnectionReceiveCallback), ...);
    }
}

<SPAN class=code-keyword>private</SPAN> <SPAN class=code-keyword>void</SPAN> InitializeConnectionReceiveCallback(IAsyncResult ar)
{
...

<SPAN class=code-keyword>bool</SPAN> readSocket = <SPAN class=code-keyword>true</SPAN>;
<SPAN class=code-keyword>int</SPAN> readBytes = ....EndReceive(ar);

<SPAN class=code-keyword>if</SPAN> (readBytes &gt; <SPAN class=code-digit>0</SPAN>)
{

    readMessage.PacketOffSet += readBytes;
    <SPAN class=code-keyword>byte</SPAN>[] message = <SPAN class=code-keyword>null</SPAN>;

    <SPAN class=code-keyword>try</SPAN>
    {
        message = Convert.FromBase64String(
          Encoding.Default.GetString(readMessage.PacketBuffer,
          <SPAN class=code-digit>0</SPAN>, readMessage.PacketOffSet));
    }
    <SPAN class=code-keyword>catch</SPAN> (FormatException)
    {
        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Base64 transformation error!
</SPAN>    }

    <SPAN class=code-keyword>if</SPAN> ((message != <SPAN class=code-keyword>null</SPAN>) &amp;&amp;
       (Encoding.Default.GetString(message).Contains(<SPAN class=code-string>"</SPAN><SPAN class=code-string>&lt;/AuthMessage&gt;"</SPAN>)))
    {

        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Get RSA provider!
</SPAN>        RSACryptoServiceProvider serverPrivateKey;
        RSACryptoServiceProvider clientPublicKey =
                    <SPAN class=code-keyword>new</SPAN> RSACryptoServiceProvider();

        FCryptoService.OnSymmetricAuthenticate(FHost.HostType,
                                         <SPAN class=code-keyword>out</SPAN> serverPrivateKey);

        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Deserialize authentication message!
</SPAN>        MemoryStream m = <SPAN class=code-keyword>new</SPAN> MemoryStream();
        m.Write(message, <SPAN class=code-digit>0</SPAN>, message.Length);
        m.Position = <SPAN class=code-digit>0</SPAN>;

        XmlSerializer xml = <SPAN class=code-keyword>new</SPAN> XmlSerializer(<SPAN class=code-keyword>typeof</SPAN>(AuthMessage));
        AuthMessage am = (AuthMessage)xml.Deserialize(m);

        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Generates symmetric algorithm!
</SPAN>        SymmetricAlgorithm sa =
          CryptUtils.CreateSymmetricAlgoritm(connection.EncryptType);
        sa.Key = serverPrivateKey.Decrypt(am.SessionKey, <SPAN class=code-keyword>false</SPAN>);
        sa.IV = serverPrivateKey.Decrypt(am.SessionIV, <SPAN class=code-keyword>false</SPAN>);

        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Adjust connection cryptors!
</SPAN>        connection.Encryptor = sa.CreateEncryptor();
        connection.Decryptor = sa.CreateDecryptor();

        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Verify sign!
</SPAN>        clientPublicKey.FromXmlString(Encoding.UTF8.GetString(
                        CryptUtils.DecryptDataForAuthenticate(sa,
                        am.SourceKey, PaddingMode.ISO10126)));

        m.SetLength(<SPAN class=code-digit>0</SPAN>);
        m.Write(am.SourceKey, <SPAN class=code-digit>0</SPAN>, am.SourceKey.Length);
        m.Write(am.SessionKey, <SPAN class=code-digit>0</SPAN>, am.SessionKey.Length);
        m.Write(signMessage, <SPAN class=code-digit>0</SPAN>, signMessage.Length);

        <SPAN class=code-keyword>if</SPAN> (!clientPublicKey.VerifyData(
             CryptUtils.EncryptDataForAuthenticate(sa, m.ToArray(),
             PaddingMode.PKCS7),
             <SPAN class=code-keyword>new</SPAN> SHA1CryptoServiceProvider(), am.Sign))
        {
            <SPAN class=code-keyword>throw</SPAN> <SPAN class=code-keyword>new</SPAN>
              SymmetricAuthenticationException(<SPAN class=code-string>"</SPAN><SPAN class=code-string>Symmetric sign error."</SPAN>);
        }

        readSocket = <SPAN class=code-keyword>false</SPAN>;


        m.Dispose();
        am.SessionIV.Initialize();
        am.SessionKey.Initialize();
        serverPrivateKey.Clear();
        clientPublicKey.Clear();

        FHost.FireOnConnected(connection);

    }

    <SPAN class=code-keyword>if</SPAN> (readSocket)
    {
        ....BeginReceive(readMessage.PacketBuffer,
                         readMessage.PacketOffSet,
                         readMessage.PacketRemaining,
                         SocketFlags.None,
                         <SPAN class=code-keyword>new</SPAN> AsyncCallback(
                           InitializeConnectionReceiveCallback), ...);
    }

}</PRE>
      <P>On the server side of the symmetric authentication, a 
      <CODE>MessageBuffer</CODE> is used to receive the socket buffer. The read 
      callback method continues to read till a completed 
      <CODE>AuthMessage</CODE> is received. With this message, the method calls 
      the <CODE>OnSymmetricAuthenticate</CODE> to get the 
      <CODE>RSACryptoServiceProvider</CODE> to decrypt the session key, session 
      IV, and the sign public key. With all the keys decrypted, the method 
      verifies the <CODE>Sign</CODE> property to ensure that the 
      <CODE>AuthMessage</CODE> is accurate, using the <CODE>SourceKey</CODE>, 
      <CODE>SessionKey</CODE>, and <CODE>signMessage</CODE>.</P>
      <H2>Connection Creator</H2><IMG height=281 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/basecreator.jpg" 
      width=547 border=0> 
      <P>Although <CODE>BaseSocketConnectionHost</CODE> can manage 
      <CODE>ISocketConnection</CODE> connections, it cannot create them. This 
      job is made by <CODE>BaseSocketConnectionCreator</CODE> which creates and 
      initializes <CODE>ISocketConnection</CODE>s. The 
      <CODE>CompressionType</CODE> and <CODE>EncryptType</CODE> properties 
      define, respectively, the compression and the encryption types that will 
      be used in the connection. The <CODE>CryptoService</CODE> defines the 
      <CODE>ICrytoService</CODE> instance used to initialize the connection, if 
      needed. The <CODE>Host</CODE> property defines the host of the 
      <CODE>BaseSocketConnectionCreator</CODE>; it can be a server or a client 
      host. The <CODE>LocalEndPoint</CODE> defines the socket IP end point used 
      in the connection, and it can have different behavior depending on the 
      type of the creator.</P>
      <H2>SocketServer and SocketListener</H2><IMG height=299 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/server_listener.jpg" 
      width=600 border=0> 
      <P>The <CODE>SocketServer</CODE> and <CODE>SocketListener</CODE> are the 
      classes needed to create a socket server. <CODE>SocketServer</CODE> is 
      derived from <CODE>BaseSocketConnectionHost</CODE>, and manages 
      <CODE>ISocketConnections</CODE>. The <CODE>SocketListener</CODE> is 
      derived from <CODE>BaseSocketConnectionCreator</CODE>, and listens for 
      incoming connections, accepts a connection, and creates a new 
      <CODE>ISocketConnection</CODE> to be used. A <CODE>SocketServer</CODE> can 
      have as many <CODE>SocketListener</CODE>s attached as required, each one 
      assigned to a local port to listen.</P>
      <H3>SocketServer constructor and methods</H3><A title="Click to enlarge" 
      href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien/socketserver.JPG" 
      target=_blank><IMG height=134 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/socketserver_small.jpg" 
      width=600 border=0></A> 
      <P>In the <CODE>SocketServer</CODE> constructor, the 
      <CODE>socketService</CODE> parameter defines the 
      <CODE>ISocketService</CODE> instance used by the server. The header 
      parameters define the array of bytes used in the message header exchange. 
      The <CODE>socketBufferSize</CODE> adjusts the socket buffer size. The 
      <CODE>messageBufferSize</CODE> defines the maximum message size of the 
      service. The <CODE>idleCheckInterval</CODE> indicates the interval for 
      idle connections checking, in milliseconds. The 
      <CODE>idleTimeoutValue</CODE> defines the timeout, in milliseconds, to be 
      compared to each connection <CODE>LastAction</CODE> property.</P>
      <P>To add <CODE>SocketListener</CODE> items in <CODE>SocketServer</CODE>, 
      the method <CODE>AddListener</CODE> must be used. The 
      <CODE>localEndPoint</CODE> parameter defines the local socket IP endpoint 
      used to listen to connections. The <CODE>encryptType</CODE> and 
      <CODE>compressionType</CODE> defines, respectively, the encryption and 
      compression methods used in the new accepted connection. The 
      <CODE>cryptoService</CODE> defines the <CODE>ICryptoService</CODE> used to 
      authenticate the encryption method chosen. The <CODE>backLog</CODE> limits 
      the listen queue of the OS socket to the defined number, and 
      <CODE>acceptThreads</CODE> sets the calling number of the socket's 
      <CODE>BeginAccept</CODE> to increase the accepted performance.</P>
      <H4>HostThreadPool</H4><IMG height=234 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/threadpool.jpg" 
      width=595 border=0> 
      <P>This library uses asynchronous socket communication which, in turn, 
      uses the .NET <CODE>ThreadPool</CODE>. In the .NET 2.0 
      <CODE>ThreadPool</CODE>, the thread number can be controlled using the 
      <CODE>SetMaxThreads</CODE> and <CODE>SetMinThreads</CODE> methods, and I 
      think there are a lot of improvements in this class. But, if you don't 
      want to use the .NET class, you can use a managed thread pool called 
      <CODE>HostThreadPool</CODE>, very similar to <A 
      href="http://www.gotdotnet.com/Community/UserSamples/Details.aspx?SampleGuid=bf59c98e-d708-4f8e-9795-8bae1825c3b6" 
      target=_blank>Stephen Toub's ManagedThreadPool</A>. 
      <CODE>HostThreadPool</CODE> uses a list of managed threads that keeps 
      increasing as more enqueueing tasks are provided. To use this class 
      instead of the .NET <CODE>ThreadPool</CODE> in <CODE>SocketServer</CODE>, 
      just set the <CODE>minThreads</CODE> and <CODE>maxThreads</CODE> 
      constructor parameters to non-zero numbers.</P>
      <P>Here are some examples of using <CODE>SocketServer</CODE> and 
      <CODE>SocketListener</CODE>:</P><PRE lang=cs><SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Simple server!
</SPAN>SocketServer server = <SPAN class=code-keyword>new</SPAN> SocketServer(<SPAN class=code-keyword>new</SPAN> SimpleEchoService());
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Simple listener!
</SPAN>server.AddListener(<SPAN class=code-keyword>new</SPAN> IPEndPoint(IPAddress.Any, <SPAN class=code-digit>8087</SPAN>));
server.Start();
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Server with header!
</SPAN>SocketServer server = <SPAN class=code-keyword>new</SPAN> SocketServer(<SPAN class=code-keyword>new</SPAN> SimpleEchoService(),
                      <SPAN class=code-keyword>new</SPAN> <SPAN class=code-keyword>byte</SPAN>[] { 0xFF, 0xFE, 0xFD });
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Listener with simple encryption!
</SPAN>server.AddListener(<SPAN class=code-keyword>new</SPAN> IPEndPoint(IPAddress.Any, <SPAN class=code-digit>8087</SPAN>),
       EncryptType.etBase64, CompressionType.ctNone, <SPAN class=code-keyword>null</SPAN>);
server.Start();
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Server with header and buffer
</SPAN><SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- sizes, no hostthreadpool and idle check setting!
</SPAN>SocketServer server = <SPAN class=code-keyword>new</SPAN> SocketServer(<SPAN class=code-keyword>new</SPAN> SimpleEchoService(),
                      <SPAN class=code-keyword>new</SPAN> <SPAN class=code-keyword>byte</SPAN>[] { 0xFF, 0xFE, 0xFD },
                      <SPAN class=code-digit>2048</SPAN>, <SPAN class=code-digit>8192</SPAN>, <SPAN class=code-digit>0</SPAN>, <SPAN class=code-digit>0</SPAN>, <SPAN class=code-digit>60000</SPAN>, <SPAN class=code-digit>30000</SPAN>);
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- More than one listener each one with different listen port number!
</SPAN>server.AddListener(<SPAN class=code-keyword>new</SPAN> IPEndPoint(IPAddress.Any, <SPAN class=code-digit>8087</SPAN>));
server.AddListener(<SPAN class=code-keyword>new</SPAN> IPEndPoint(IPAddress.Any, <SPAN class=code-digit>8088</SPAN>),
                   EncryptType.etBase64, CompressionType.ctNone, <SPAN class=code-keyword>null</SPAN>);
server.AddListener(<SPAN class=code-keyword>new</SPAN> IPEndPoint(IPAddress.Any, <SPAN class=code-digit>8089</SPAN>),
                   EncryptType.etRijndael, CompressionType.ctGZIP,
                   <SPAN class=code-keyword>new</SPAN> SimpleEchoCryptService(), <SPAN class=code-digit>50</SPAN>, <SPAN class=code-digit>10</SPAN>);
server.AddListener(<SPAN class=code-keyword>new</SPAN> IPEndPoint(IPAddress.Any, <SPAN class=code-digit>8090</SPAN>),
                   EncryptType.etSSL, CompressionType.ctNone,
                   <SPAN class=code-keyword>new</SPAN> SimpleEchoCryptService());
server.Start();</PRE>
      <H2>SocketClient and SocketConnector</H2><IMG height=280 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/client_connector.jpg" 
      width=600 border=0> 
      <P>The <CODE>SocketClient</CODE> and <CODE>SocketConnector</CODE> are the 
      classes needed to create a socket client. <CODE>SocketClient</CODE> is 
      derived from <CODE>BaseSocketConnectionHost</CODE> and, like 
      <CODE>SocketServer</CODE>, manages <CODE>ISocketConnections</CODE>. The 
      <CODE>SocketConnector</CODE> is derived from 
      <CODE>BaseSocketConnectionCreator</CODE>, and it connects with the socket 
      server and creates a new <CODE>ISocketConnection</CODE> to be used. A 
      <CODE>SocketClient</CODE> can have as many <CODE>SocketConnector</CODE>s 
      attached as required, each one connecting to a socket server, and they can 
      be assigned to a local address and a local port to start the 
      connection.</P>
      <H3>SocketClient constructor and methods</H3><A title="Click to enlarge" 
      href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien/socketclient.JPG" 
      target=_blank><IMG height=117 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/socketclient_small.jpg" 
      width=600 border=0></A> 
      <P>The <CODE>SocketClient</CODE> constructor has the same parameter 
      signature as the <CODE>SocketServer</CODE> class. To add 
      <CODE>SocketConnector</CODE> items in <CODE>SocketClient</CODE>, the 
      method <CODE>AddConnector</CODE> must be used. The 
      <CODE>remoteEndPoint</CODE> parameter defines the remote socket IP 
      endpoint used for the connection. The <CODE>encryptType</CODE> and 
      <CODE>compressionType</CODE> define, respectively, the encryption and 
      compression methods used in the new connection. The 
      <CODE>cryptoService</CODE> defines the <CODE>ICryptoService</CODE> used to 
      authenticate the encrypted method chosen. The 
      <CODE>reconnectAttempts</CODE> and <CODE>reconnectAttemptInterval</CODE> 
      define, respectively, the number of reconnect attempts when using 
      <CODE>BeginReconnect</CODE> method and the time interval to reconnect. The 
      <CODE>localEndPoint</CODE> defines the local socket IP endpoint used to 
      start the connection process to the remote endpoint.</P>
      <P>Here are some examples of using <CODE>SocketClient</CODE> and 
      <CODE>SocketConnector</CODE>:</P><PRE lang=cs><SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Simple client!
</SPAN>SocketClient client = <SPAN class=code-keyword>new</SPAN> SocketClient(<SPAN class=code-keyword>new</SPAN> SimpleEchoService());
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Simple connector!
</SPAN>client.AddConnector(<SPAN class=code-keyword>new</SPAN> IPEndPoint(IPAddress.Parse(<SPAN class=code-string>"</SPAN><SPAN class=code-string>10.10.1.1"</SPAN>), <SPAN class=code-digit>8087</SPAN>));
client.Start();
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Client with header!
</SPAN>SocketClient client = <SPAN class=code-keyword>new</SPAN> SocketClient(<SPAN class=code-keyword>new</SPAN> SimpleEchoService(),
                      <SPAN class=code-keyword>new</SPAN> <SPAN class=code-keyword>byte</SPAN>[] { 0xFF, 0xFE, 0xFD });
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Connector with simple encryption!
</SPAN>client.AddConnector(<SPAN class=code-keyword>new</SPAN> IPEndPoint(IPAddress.Parse(<SPAN class=code-string>"</SPAN><SPAN class=code-string>10.10.1.1"</SPAN>), <SPAN class=code-digit>8087</SPAN>),
                    EncryptType.etBase64, CompressionType.ctNone, <SPAN class=code-keyword>null</SPAN>);
client.Start();
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Client with header and buffer sizes,
</SPAN><SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- no hostthreadpool and idle check setting!
</SPAN>SocketClient client = <SPAN class=code-keyword>new</SPAN> SocketClient(<SPAN class=code-keyword>new</SPAN> SimpleEchoService(),
                      <SPAN class=code-keyword>new</SPAN> <SPAN class=code-keyword>byte</SPAN>[] { 0xFF, 0xFE, 0xFD },
                      <SPAN class=code-digit>2048</SPAN>, <SPAN class=code-digit>8192</SPAN>, <SPAN class=code-digit>0</SPAN>, <SPAN class=code-digit>0</SPAN>, <SPAN class=code-digit>60000</SPAN>, <SPAN class=code-digit>30000</SPAN>);
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Connector with encryption and reconnect!
</SPAN>client.AddConnector(<SPAN class=code-keyword>new</SPAN> IPEndPoint(IPAddress.Parse(<SPAN class=code-string>"</SPAN><SPAN class=code-string>10.10.1.1"</SPAN>), <SPAN class=code-digit>8087</SPAN>),
                    EncryptType.etSSL, CompressionType.ctGZIP,
                    <SPAN class=code-keyword>new</SPAN> SimpleEchoCryptService(),
                    <SPAN class=code-digit>5</SPAN>, <SPAN class=code-digit>30000</SPAN>);
client.Start();
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Client with header and buffer sizes,
</SPAN><SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- using hostthreadpool and idle check setting!
</SPAN>SocketClient client = <SPAN class=code-keyword>new</SPAN> SocketClient(<SPAN class=code-keyword>new</SPAN> SimpleEchoService(),
                      <SPAN class=code-keyword>new</SPAN> <SPAN class=code-keyword>byte</SPAN>[] { 0xFF, 0xFE, 0xFD },
                      <SPAN class=code-digit>4096</SPAN>, <SPAN class=code-digit>8192</SPAN>, <SPAN class=code-digit>5</SPAN>, <SPAN class=code-digit>50</SPAN>, <SPAN class=code-digit>60000</SPAN>, <SPAN class=code-digit>30000</SPAN>);
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Connector with encryption, reconnect and local endpoint!
</SPAN>client.AddConnector(<SPAN class=code-keyword>new</SPAN> IPEndPoint(IPAddress.Parse(<SPAN class=code-string>"</SPAN><SPAN class=code-string>10.10.1.1"</SPAN>), <SPAN class=code-digit>8087</SPAN>),
                    EncryptType.etSSL, CompressionType.ctGZIP,
                    <SPAN class=code-keyword>new</SPAN> SimpleEchoCryptService(),
                    <SPAN class=code-digit>5</SPAN>, <SPAN class=code-digit>30000</SPAN>,
                    <SPAN class=code-keyword>new</SPAN> IPEndPoint(IPAddress.Parse(<SPAN class=code-string>"</SPAN><SPAN class=code-string>10.10.3.1"</SPAN>), <SPAN class=code-digit>2000</SPAN>));
client.Start();
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- Simple client!
</SPAN>SocketClient client = <SPAN class=code-keyword>new</SPAN> SocketClient(<SPAN class=code-keyword>new</SPAN> SimpleEchoService());
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>----- More than one connector each one with different remote socket servers!
</SPAN>client.AddConnector(<SPAN class=code-keyword>new</SPAN> IPEndPoint(IPAddress.Parse(<SPAN class=code-string>"</SPAN><SPAN class=code-string>10.10.1.1"</SPAN>), <SPAN class=code-digit>8087</SPAN>));
client.AddConnector(<SPAN class=code-keyword>new</SPAN> IPEndPoint(IPAddress.Parse(<SPAN class=code-string>"</SPAN><SPAN class=code-string>10.10.1.2"</SPAN>), <SPAN class=code-digit>8088</SPAN>),
                    EncryptType.etBase64, CompressionType.ctNone, <SPAN class=code-keyword>null</SPAN>);
client.AddConnector(<SPAN class=code-keyword>new</SPAN> IPEndPoint(IPAddress.Parse(<SPAN class=code-string>"</SPAN><SPAN class=code-string>10.10.1.3"</SPAN>), <SPAN class=code-digit>8089</SPAN>),
                    EncryptType.etRijndael, CompressionType.ctGZIP,
                    <SPAN class=code-keyword>new</SPAN> SimpleEchoCryptService());
client.AddConnector(<SPAN class=code-keyword>new</SPAN> IPEndPoint(IPAddress.Parse(<SPAN class=code-string>"</SPAN><SPAN class=code-string>10.10.1.4"</SPAN>), <SPAN class=code-digit>8090</SPAN>),
                    EncryptType.etSSL, CompressionType.ctNone,
                    <SPAN class=code-keyword>new</SPAN> SimpleEchoCryptService(),
                    <SPAN class=code-digit>5</SPAN>, <SPAN class=code-digit>30000</SPAN>,
                    <SPAN class=code-keyword>new</SPAN> IPEndPoint(IPAddress.Parse(<SPAN class=code-string>"</SPAN><SPAN class=code-string>10.10.3.1"</SPAN>), <SPAN class=code-digit>2000</SPAN>));
client.Start();</PRE>
      <H2>Echo demo project</H2>
      <P>There's an <CODE>Echo</CODE> demo project available in the article 
      download file, using <STRONG>Console</STRONG>, <STRONG>Windows 
      Forms</STRONG>, and <STRONG>Windows Service</STRONG> hosts and clients, 
      and all them use the same <CODE>EchoSocketService</CODE> and 
      <CODE>EchoCryptService</CODE>. The demos are divided by their type as 
      follows:</P>
      <H3>Hosts</H3>
      <UL>
        <LI>Console 
        <OL>
          <LI><CODE>EchoConsoleClient </CODE>
          <LI><CODE>EchoConsoleServer </CODE></LI></OL>
        <LI>Windows Forms 
        <OL>
          <LI><CODE>EchoFormClient </CODE>
          <LI><CODE>EchoFormServer </CODE>
          <LI><CODE>Echo<SPAN class=code-keyword>&lt;</SPAN>code<SPAN 
          class=code-keyword>&gt;</SPAN></CODE>Form </CODE />(Forms template) 
          </LI></OL>
        <LI>Windows Service 
        <OL>
          <LI><CODE>EchoWindowsServiceServer </CODE></LI></OL></LI></UL>
      <H3>Services</H3>
      <UL>
        <LI><CODE>EchoSocketService </CODE>
        <LI><CODE>EchoCryptService </CODE></LI></UL>
      <H2>Conclusion</H2>
      <P>There's a lot going on here, and I think this library can help anyone 
      who wants to write asynchronous sockets with encryption and compression. 
      Any comments will be appreciated.</P>
      <H2>History</H2>
      <UL>
        <LI><STRONG>May 15, 2006:</STRONG> Initial version 
        <LI><STRONG>May 19, 2006:</STRONG> Some English text corrections (sorry, 
        I'm still learning!), and rechecking the demo sources 
        <LI><STRONG>June 06, 2006:</STRONG> Version 1.2 with the following 
        changes: 
        <UL>
          <LI>Minor bugs fixed 
          <LI>All "Sended" changed to "Sent" (thanks vmihalj) 
          <LI><CODE>ReadCanEnqueue</CODE> now works correctly and with 
          <CODE>HostThreadPool</CODE> (thanks PunCha) 
          <LI>Added <CODE>reconnectAttempts</CODE> and 
          <CODE>reconnectAttemptInterval</CODE> to allow client connection 
          reconnects as many times as is needed in a timed interval (thanks 
          Tobias Hertkorn) </LI></UL>
        <LI><STRONG>April 01, 2007:</STRONG> Version 1.3 with the following 
        changes: 
        <UL>
          <LI>Fixed <CODE>rawbuffer = null</CODE> 
          <LI>Fixed <CODE>BeginAcceptCallback</CODE>: stops accepting if 
          exception occurs 
          <LI>Fixed <CODE>BeginSendCallback</CODE>: <CODE>PacketRemaining 
          </CODE>bytes should be used 
          <LI>Socket config section added in demos 
          <LI>New message size (64K) 
          <LI><CODE>HosThreadPool </CODE>removed 
          <LI>Header changed to Delimiter property with new delimiter options: 
          <OL>
            <LI><CODE>dtNone</CODE>: No message delimiter 
            <LI><CODE>dtPacketHeader</CODE>: Version 1.2 backward 
            <LI><CODE>dtMessageTailExcludeOnReceive</CODE>: Use custom delimiter 
            at end of message (Exclude delimiter on receiving) 
            <LI><CODE>dtMessageTailIncludeOnReceive</CODE>: Use custom delimiter 
            at end of message (Include delimiter on receiving) </LI></OL>
          <LI>New connection object properties/methods: 
          <OL>
            <LI>Nagle, Linger and TTL Algorithm options 
            <LI>Host and Creator </LI></OL>
          <LI>Encrypt sign message in service class 
          <LI>Exception event in service class 
          <LI>New Creator name property </LI></UL>
        <LI><STRONG>July 22, 2007:</STRONG> Version 1.4 with the following 
        changes: 
        <UL>
          <LI>Connection initialize procedures executing in same thread (not 
          queued in <CODE>ThreadPool</CODE>) 
          <LI>Connection disconnect now checks windows version and executes the 
          correct disconnect procedure 
          <LI>Connection Active checking for <CODE>Disposed </CODE>
          <LI><CODE>CheckSocketConnections</CODE> disposed check fixed 
          <LI><CODE>CryptUtils</CODE> <CODE>Flush() </CODE>method included 
          <LI>Client Connection <CODE>BeginConnect() </CODE>exception fixed 
          <LI>Server Connection <CODE>BeginSendToAll </CODE>array buffer fixed 
          <LI>New <CODE>SocketClientSync </CODE>class for synchronous using 
          (WinForms demo included) </LI></UL>
        <LI><STRONG>September 5, 2007:</STRONG> Version 1.5 with the following 
        changes: 
        <UL>
          <LI><CODE>SocketClient </CODE>with proxy authentication (SOCKS5, Basic 
          HTTP) 
          <LI><CODE>BeginRead </CODE>bug fixed (<CODE>messagetail</CODE>) 
          <LI><CODE>BeginDisconnect </CODE>changed (<CODE>threadpool</CODE>) 
          <LI><CODE>BeginSendToAll </CODE>reviewed (disposed check) 
          <LI>New <CODE>OnSSLClientValidateServerCertificate </CODE>event to 
          validate server's certificate 
          <LI>Idle check interval set to 0 and only created when greater than 0 
          <LI>Using <CODE>Buffer.BlockCopy </CODE>instead of <CODE>Array.Copy 
          </CODE>
          <LI>New Chat Demo </LI></UL></LI></UL><!-- Article Ends --><!-- Main Page Contents End --></DIV></SPAN>
      <FORM id=aspnetForm 
      style="PADDING-RIGHT: 0px; PADDING-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-TOP: 0px" 
      name=aspnetForm action=AsyncSocketServerandClien.aspx method=post>
      <DIV><INPUT id=__VIEWSTATE type=hidden 
      value=/wEPDwULLTEwMDUyNjYzMjhkZFzSKUmIqKVCvLGX42P3FH7n4OSH 
      name=__VIEWSTATE> </DIV>
      <H2>License</H2>
      <DIV id=ctl00_LicenseTerms>
      <P>This article, along with any associated source code and files, is 
      licensed under <A href="http://www.codeproject.com/info/cpol10.aspx">The 
      Code Project Open License (CPOL)</A></P></DIV>
      <H2>About the Author</H2>
      <TABLE cellSpacing=5 cellPadding=0 width="100%" border=0>
        <TBODY>
        <TR vAlign=top>
          <TD id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberPhotoTable 
          style="WIDTH: 155px" vAlign=top><B><A 
            id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberProfileLink 
            href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=912732">Andre 
            Azevedo</A></B><BR><BR>
            <CENTER><IMG id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberPhoto 
            style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" 
            src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/{43086D27-ED75-4124-BDEC-87FCB1277156}.jpg"></CENTER><BR><SPAN 
            class=SmallText 
            id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberType></SPAN></TD>
          <TD>- Living in São Paulo, Brazil<BR><BR>- Interesting in<BR>* NFL, 
            NBA<BR>* Lockon, Black Shark<BR>* Dream Theater, drumming<BR><BR>- 
            Developing since 1994 with<BR>* Clipper (Summer '87 and 5.02)<BR>* 
            FoxPro (DOS, 2.6), Visual Foxpro (6, 7, 8, 9)<BR>* Delphi (1, 2, 5, 
            7)<BR>* C# (1.1, 2.0)<BR><BR><BR>
            <TABLE>
              <TBODY>
              <TR id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_jobTitleRow>
                <TD class=SmallText noWrap>Occupation: </TD>
                <TD width="100%"><SPAN class=SmallText 
                  id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberJobTitle>Software 
                  Developer (Senior)</SPAN></TD></TR>
              <TR id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_locationRow>
                <TD class=SmallText>Location: </TD>
                <TD width="100%"><SPAN class=SmallText 
                  id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberLocation><IMG 
                  height=11 alt=Brazil 
                  src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/BR.gif" 
                  width=16> 
      Brazil</SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><BR>
      <TABLE id=ctl00_PopularArticlesRow cellSpacing=0 cellPadding=0 
      width="100%" border=0>
        <TBODY>
        <TR vAlign=top>
          <TD style="WIDTH: 100%">
            <H2>Other popular Internet / Network articles:</H2>
            <UL>
              <LI><A 
              href="http://www.codeproject.com/KB/IP/MyDownloader.aspx">MyDownloader: 
              A Multi-thread C# Segmented Download Manager</A>
              <DIV class=SmallText>Sample application that manages multiple 
              segmented downloads and supports HTTP, FTP and YouTube video 
              downloads</DIV>
              <LI><A href="http://www.codeproject.com/KB/IP/ndk.aspx">Network 
              Development Kit 2.0</A>
              <DIV class=SmallText>Network Development Kit is a set of simple 
              classes for a client-server architecture.</DIV>
              <LI><A 
              href="http://www.codeproject.com/KB/IP/drvfltip.aspx">Developing 
              Firewalls for Windows 2000/XP</A>
              <DIV class=SmallText>An article about developing Firewalls for 
              Windows 2000/XP</DIV>
              <LI><A 
              href="http://www.codeproject.com/KB/IP/serversocket.aspx">Multi-threaded 
              Client/Server Socket Class</A>
              <DIV class=SmallText>A multi-threaded based Client/Server Socket 
              Communication class</DIV>
              <LI><A 
              href="http://www.codeproject.com/KB/IP/iocp_server_client.aspx">A 
              simple IOCP Server/Client Class</A>
              <DIV class=SmallText>This source code uses the advanced IOCP 
              technology which can efficiently serve multiple clients. It also 
              presents some solutions to practical problems that arise with the 
              IOCP programming API, and provides a simple echo client/server 
              with file transfer.</DIV></LI></UL>
            <H2></H2></TD>
          <TD><IFRAME 
            src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\ServeThirdParty(3).htm" 
            frameBorder=0 width=300 scrolling=no 
        height=250></IFRAME></TD></TR></TBODY></TABLE>
      <DIV id=ctl00_AddTo_AddTo style="MARGIN: 10px">
      <SCRIPT language=JavaScript type=text/javascript>
var addtoMethod=1;
var AddURL = document.location.href;
var AddTitle = escape(document.title);
DrawLinks(100, 0, "SmallText Bold", "AddTo") 
</SCRIPT>
      </DIV>
      <TABLE class=RatingBar id=ctl00_RateArticleRow cellSpacing=0 cellPadding=0 
      width="100%" border=0>
        <TBODY>
        <TR>
          <TD><A 
            href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx#_top">Article 
            Top</A></TD>
          <TD align=right>
            <TABLE cellSpacing=0 cellPadding=0 width="100%">
              <TBODY>
              <TR>
                <TD class=SmallText id=voteTbl style="WHITE-SPACE: nowrap" 
                align=right>
                  <TABLE>
                    <TBODY>
                    <TR>
                      <TD id=ctl00_RateArticle_SignIn noWrap><A 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx#SignUp">Sign 
                        Up</A> to vote for this article</TD>
                      <TD><SPAN 
                    id=ctl00_RateArticle_ErrorMessage></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></FORM>
      <DIV 
      style="PADDING-RIGHT: 10px; PADDING-LEFT: 10px; PADDING-BOTTOM: 10px; OVERFLOW: hidden; PADDING-TOP: 10px; WHITE-SPACE: nowrap; TEXT-ALIGN: center"><IFRAME 
      src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\ServeThirdParty(4).htm" 
      frameBorder=0 width=468 scrolling=no height=60></IFRAME></DIV><A 
      name=_comments></A><!-- Forum Start -->
      <DIV id=_MessageBoard onclick="return SwitchMessage(event, null)">
      <TABLE class=Frm_MainTable id=ForumTable cellSpacing=0 cellPadding=0>
        <TBODY>
        <TR>
          <TD class=Frm_MsgAlert><B>You must <A 
            href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx%3ffid%3d307304%26df%3d90%26mpp%3d25%26noise%3d3%26sort%3dPosition%26view%3dQuick">Sign 
            In</A> to use this message board.</B></TD></TR>
        <TR>
          <TD>
            <FORM 
            style="PADDING-RIGHT: 0px; PADDING-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-TOP: 0px" 
            action=/script/Forums/SetOptions.aspx?floc=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx&amp;fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick 
            method=get><INPUT type=hidden value=307304 name=fid><INPUT 
            type=hidden 
            value=?floc=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx&amp;fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick 
            name=currentQS><INPUT type=hidden 
            value=/KB/IP/AsyncSocketServerandClien.aspx name=floc>
            <TABLE cellSpacing=0 cellPadding=3 width="100%" border=0>
              <TBODY>
              <TR class=Frm_HeaderRow1>
                <TD style="WHITE-SPACE: nowrap"><IMG height=16 alt=FAQ 
                  src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/forum_faq.gif" 
                  width=16 align=middle border=0>&nbsp;<A 
                  href="http://www.codeproject.com/script/Forums/FAQ.aspx"><B>FAQ</B></A>&nbsp;</TD>
                <TD style="WHITE-SPACE: nowrap; TEXT-ALIGN: right">Noise 
                  Tolerance<SELECT class=Frm_DropDown size=1 name=noise> 
                    <OPTION value=1>Very High</OPTION><OPTION 
                    value=2>High</OPTION><OPTION value=3 
                    selected>Medium</OPTION><OPTION value=4>Low</OPTION><OPTION 
                    value=5>Very Low</OPTION></SELECT></TD>
                <TD style="WHITE-SPACE: nowrap; TEXT-ALIGN: right" 
                  colSpan=2><IMG height=15 alt=Search 
                  src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/forum_search.gif" 
                  width=16 align=top border=0>&nbsp;<A 
                  href="http://www.codeproject.com/script/Forums/Search.aspx?fid=307304">Search 
                  Messages</A>&nbsp;</TD>
                <TD style="TEXT-ALIGN: right"><INPUT class=Frm_Button type=submit value="Set Options" name=submit></TD></TR>
              <TR class=Frm_HeaderRow2>
                <TD style="WIDTH: 100%">&nbsp;</TD>
                <TD 
                  style="WHITE-SPACE: nowrap; TEXT-ALIGN: right">Layout<SELECT 
                  class=Frm_DropDown size=1 name=view> <OPTION value=Quick 
                    selected>Normal</OPTION><OPTION value=Topic>Expand Root 
                    Messages</OPTION><OPTION value=Expanded>Expand All 
                    Messages</OPTION><OPTION value=Thread>Thread 
                    View</OPTION><OPTION value=Normal>No Javascript 
                    (slow)</OPTION><OPTION value=Preview>No Javascript 
                    Preview</OPTION></SELECT>&nbsp;&nbsp;</TD>
                <TD style="WHITE-SPACE: nowrap">Per page<SELECT 
                  class=Frm_DropDown size=1 name=mpp> <OPTION 
                    value=10>10</OPTION><OPTION value=25 
                    selected>25</OPTION><OPTION 
                  value=50>50</OPTION></SELECT>&nbsp;&nbsp;</TD>
                <TD colSpan=2>&nbsp;</TD></TR></TBODY></TABLE></FORM></TD></TR>
        <TR>
          <TD><A name=xx0xx></A>
            <TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
              <TBODY>
              <TR class=Frm_NavigationBar>
                <TD>&nbsp;</TD>
                <TD>Msgs 1 to 25 of 482 (Total in Forum: 482) (<A 
                  href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick">Refresh</A>)</TD>
                <TD style="WHITE-SPACE: nowrap; TEXT-ALIGN: right"><SPAN 
                  class=Frm_HL>First</SPAN><SPAN class=Frm_HL>Prev</SPAN><A 
                  class=Frm_HL 
                  href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;fr=26#xx0xx" 
                  name=Frm_HoverNL>Next</A></TD></TR></TBODY></TABLE></TD></TR>
        <TR>
          <TD>
            <TABLE class=Frm_MsgTable cellSpacing=0 cellPadding=0 width="100%" 
            border=0><!-- Column Headers -->
              <TBODY>
              <TR class=Frm_ColumnHeaders>
                <TD style="WIDTH: 100%">
                  <TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
                    <TBODY>
                    <TR>
                      <TD>Subject&nbsp;</TD>
                      <TD class=Frm_MsgAuthor>&nbsp;Author&nbsp;</TD>
                      <TD 
              class=Frm_MsgDate>Date&nbsp;</TD></TR></TBODY></TABLE></TD></TR>
              <TR>
                <TD><IMG height=5 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F2551607_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2551607xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2551607#xx2551607xx" 
                        name=2551607>Is the network getting overloaded and 
                        corrupting messages?</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=3517020">Infil</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">20:07 
                        13 May '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2551607_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Another question for you Andre, I 
                                greatly appreciate the help.<BR><BR>Originally, 
                                I thought this was a problem not relating to the 
                                networking code, but now I'm not so sure. Please 
                                look at the OnReceived function below, as well 
                                as the functions I use to get byte streams of a 
                                message:<BR><BR><CODE><BR>public void 
                                OnReceived(MessageEventArgs e)<BR>{<BR>if 
                                (e.Connection.Host.HostType == 
                                HostType.htServer)<BR>{<BR>Person 
                                user;<BR>try<BR>{<BR>connections.TryGetValue(e.Connection.ConnectionId, 
                                out user);<BR>Message m = 
                                Util.getBytesAsMessage(e.Buffer);<BR><BR>if 
                                (user != null)<BR>this.BeginInvoke(new 
                                HandleMessageServerDelegate(this.HandleMessageServer), 
                                new object[] { m, user }); // handle this 
                                message on another 
                                thread<BR>}<BR>catch<BR>{<BR>// problems 
                                here!<BR>}<BR>}<BR>else<BR>{<BR>Message 
                                m;<BR>lock (receivedLock)<BR>{<BR>try<BR>{<BR>m 
                                = 
                                Util.getBytesAsMessage(e.Buffer);<BR>this.BeginInvoke(new 
                                HandleMessageClientDelegate(this.HandleMessageClient), 
                                new object[] { m }); // handle this message on 
                                another thread<BR>}<BR>catch<BR>{<BR>// 
                                sometimes we will get binary formatting 
                                errors... <BR>// catch them and do nothing (ie, 
                                the message will be 
                                lost)<BR>}<BR>}<BR>}<BR>e.Connection.BeginReceive();<BR>}<BR></CODE><BR><BR><CODE><BR>public 
                                static byte[] getMessageAsBytes(Message 
                                m)<BR>{<BR>System.Runtime.Serialization.IFormatter 
                                formatter = new 
                                System.Runtime.Serialization.Formatters.Binary.BinaryFormatter();<BR>System.IO.MemoryStream 
                                stream = new 
                                System.IO.MemoryStream();<BR>formatter.Serialize(stream, 
                                m);<BR>return 
                                stream.GetBuffer();<BR>}<BR><BR>public static 
                                Message getBytesAsMessage(byte[] 
                                b)<BR>{<BR>System.Runtime.Serialization.IFormatter 
                                formatter = new 
                                System.Runtime.Serialization.Formatters.Binary.BinaryFormatter();<BR>System.IO.MemoryStream 
                                stream = new 
                                System.IO.MemoryStream(b);<BR>Message m = 
                                (Message)formatter.Deserialize(stream);<BR>return 
                                m;<BR>}<BR></CODE><BR><BR><BR>If a bunch of 
                                messages are sent out or received from the 
                                server at the same time, an exception is caught 
                                in the client half of the OnReceived 
                                function:<BR><BR>The input stream is not a valid 
                                binary format. The starting contents (in bytes) 
                                are: 
                                69-6E-67-2E-43-6F-6C-6F-72-05-00-00-00-0D-27-4B-6F 
                                ... at 
                                System.Runtime.Serialization.Formatters.Binary.SerializationHeaderRecord.Read(__BinaryParser 
                                input)<BR>at 
                                System.Runtime.Serialization.Formatters.Binary.__BinaryParser.ReadSerializationHeaderRecord()<BR>at 
                                System.Runtime.Serialization.Formatters.Binary.__BinaryParser.Run()<BR>at 
                                System.Runtime.Serialization.Formatters.Binary.ObjectReader.Deserialize(HeaderHandler 
                                handler, __BinaryParser serParser, Boolean 
                                fCheck, Boolean isCrossAppDomain, 
                                IMethodCallMessage methodCallMessage)<BR>at 
                                System.Runtime.Serialization.Formatters.Binary.BinaryFormatter.Deserialize(Stream 
                                serializationStream, HeaderHandler handler, 
                                Boolean fCheck, Boolean isCrossAppDomain, 
                                IMethodCallMessage methodCallMessage)<BR>at 
                                System.Runtime.Serialization.Formatters.Binary.BinaryFormatter.Deserialize(Stream 
                                serializationStream)<BR>at 
                                KotHBot.Util.getBytesAsMessage(Byte[] b) in 
                                F:\Projects\KotHBot\Util.cs:line 245<BR>at 
                                KotHBot.MainWindow.OnReceived(MessageEventArgs 
                                e) in F:\Projects\KotHBot\MainWindow.cs:line 
                                1876<BR><BR>In the OnReceived function, the 
                                field e.Buffer.Length is always 588 here (which 
                                signifies to me that the buffer was not fully 
                                received). What is causing this 
                                problem?<BR><BR>I used to think that it was only 
                                at times of extremely high network activity, but 
                                ever since I implemented the 100% CPU fix in 
                                that other thread just below this one, more 
                                messages are being dropped, even at times of 
                                only moderate network activity. Right now I just 
                                catch the exception and let the message get 
                                lost, but this is causing problems with the flow 
                                of my program now that many more messages are 
                                getting dropped. I tried some googling on this 
                                exception, but I haven't been able to find 
                                anything helpful, and I think the problem stems 
                                from the fact that the network is not receiving 
                                things properly. Is it possible I can overload 
                                the network by sending/receiving too many things 
                                at once (approximately, say, 8 small messages 
                                per second)? <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2551607">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2551607">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2551607 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=F2552267_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=34><A 
                        name=xx2552267xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2552267#xx2552267xx" 
                        name=2552267>Re: Is the network getting overloaded and 
                        corrupting messages?</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=912732">Andre 
                        Azevedo</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">3:37 14 
                        May '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2552267_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 34px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>If you're using the delimiter type 
                                dtNone showed in previous post, you can get that 
                                error. Remember that TCP is not message 
                                oriented. Sending 1000 bytes doesn't make the 
                                OnReceive event do fire 1 time with a message of 
                                1000 bytes; you can receive, for example, 1 
                                message with 588 bytes and another with 422 
                                because no delimiter checking are used. Try to 
                                set some delimimter to receive the message. 
                                <BR><BR>
                                <DIV 
                                class=ForumSig>________________________________________________________________<BR>Throwing 
                                50 TD passes is easy when you´re dating Gisele 
                                Bundchen.</DIV><BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2551607">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2552267">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2552267 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=F2553296_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=52><A 
                        name=xx2553296xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2553296#xx2553296xx" 
                        name=2553296>Re: Is the network getting overloaded and 
                        corrupting messages?</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=3517020">Infil</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">12:19 
                        14 May '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2553296_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 52px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Again, thanks for the help Andre. 
                                In order to custom the random message dropping I 
                                had received when I used delimiter type dtNone, 
                                I programmed my own acknowledgement system. I 
                                know that TCP uses its own acks normally, but 
                                the message was getting received on the client 
                                side "correctly", so TCP would send the ack, 
                                even though I couldn't deserialize it. As a 
                                result, I was flooding the network with a lot of 
                                (short) extra ack messages. It's safe to turn 
                                this system off now, correct? Should a message 
                                not get received, whether it's client-&gt;server 
                                or server-&gt;client, an OnException or 
                                OnDisconnect event will be thrown, right? It's 
                                very important that I know when the other side 
                                of the connection did not get a message, or else 
                                my whole program could get 
                                stuck.<BR><BR>Additionally, how carefully should 
                                I choose that delimiter array? I'm sending a lot 
                                of different messages (some of which include 
                                sending a file which may be 100k large or so at 
                                worst). Should I make that delimiter array 
                                stronger by making it 10 or 15 bytes long, or 
                                are those 3 bytes as safe as a 10 byte 
                                delimiter? <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2551607">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2553296">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2553296 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F2549416_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2549416xx></A><IMG height=16 alt=Question 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_question.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2549416#xx2549416xx" 
                        name=2549416>Server uses 100% of CPU, never slows down, 
                        please help!</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=3517020">Infil</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">12:53 
                        12 May '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2549416_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>This will hopefully be my last 
                                question for you, Andre. <IMG title=Smile 
                                src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/smiley_smile.gif" 
                                align=top><BR><BR>My application encompasses 
                                both client and server functionality. If you 
                                want people to connect to you, you start it as a 
                                server. If you want to connect to someone, you 
                                start it as a client (and enter IP 
                                address/port). I start the application as a 
                                server on my computer with the following 
                                code:<BR><BR><CODE><BR>server = new 
                                SocketServer(this, DelimiterType.dtNone, null, 
                                2048000, 2048000, 600, 
                                86400000);<BR>server.AddListener("Server", new 
                                System.Net.IPEndPoint(IPAddress.Any, 
                                td.Port));<BR>connections = new Dictionary<LONG, 
                                person="">();<BR>server.Start();<BR></LONG,></CODE><BR><BR>After 
                                executing this code (and opening a lobby window 
                                for chatting), everything seems fine still. I 
                                can type chat messages (to myself), and the CPU 
                                is as low as it was before I started the server 
                                object. Now, someone else will start the program 
                                in client mode and connect to my IP and port 
                                using this code:<BR><BR><CODE><BR>client = new 
                                SocketClient(this, DelimiterType.dtNone, null, 
                                2048000, 2048000, 600, 
                                86400000);<BR>client.AddConnector("Client", new 
                                System.Net.IPEndPoint(IPAddress.Parse(td.IPText), 
                                td.Port));<BR>client.Start();<BR></CODE><BR><BR>I 
                                send one or two messages between the two users 
                                to establish some initial info. As soon as this 
                                is complete and the connection is established, 
                                the CPU usage on the server machine jumps to 
                                100% and stays there forever (and the client 
                                machine's CPU usage does not change at all). I 
                                don't understand why this is the case. What is 
                                the server machine doing which causes 100% 
                                usage? I can't open dialog boxes without a 5 
                                second delay, and the program can even crash at 
                                times.<BR><BR>I should also note that if the 
                                client disconnects, the server *remains* at 100% 
                                usage, even though there is no longer anyone 
                                connected to the server. As soon as I click 
                                "disconnect" and stop the server object with the 
                                following code, the CPU instantly drops back to 
                                0%.<BR><BR><CODE><BR>foreach (Person p in 
                                connections.Values) // will be empty if no one 
                                is 
                                connected<BR>p.Socket.BeginDisconnect();<BR>server.Stop();<BR>server 
                                = null;<BR></CODE><BR><BR>Can someone explain 
                                what I am doing wrong? Is the server polling on 
                                some variable, or is some function getting 
                                executed 100 times per second or something? Is 
                                there a way I can find out which segments of 
                                code are getting repeatedly executed? I don't 
                                think I can release my program if it takes over 
                                100% of the CPU on the server's machine for 2 
                                hours. <IMG title=Smile 
                                src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/smiley_smile.gif" 
                                align=top> <BR><BR>
                                <DIV class=ForumMod>modified on Monday, May 12, 
                                2008 7:02 PM</DIV><BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2549416">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2549416">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2549416 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=F2551280_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=34><A 
                        name=xx2551280xx></A><IMG height=16 alt=Answer 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_answer.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2551280#xx2551280xx" 
                        name=2551280>Re: Server uses 100% of CPU, never slows 
                        down, please help!</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=912732">Andre 
                        Azevedo</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">11:32 
                        13 May '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2551280_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 34px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Are you using the socket settings 
                                in app.config used by demos apps? <BR><BR>
                                <DIV 
                                class=ForumSig>________________________________________________________________<BR>Throwing 
                                50 TD passes is easy when you´re dating Gisele 
                                Bundchen.</DIV><BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2549416">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2551280">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2551280 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=F2551434_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=52><A 
                        name=xx2551434xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2551434#xx2551434xx" 
                        name=2551434>Re: Server uses 100% of CPU, never slows 
                        down, please help!</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=3517020">Infil</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">14:50 
                        13 May '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2551434_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 52px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Wow, adding that app.config to my 
                                Visual Studio project and recompiling fixed all 
                                the problems.<BR><BR>Thanks Andre. Can you 
                                explain what this file does, and why I need it? 
                                What is the program doing when I don't have the 
                                file in my project, versus when I do? I'm very 
                                curious, now that this seemed to fix these 
                                problems like magic. <IMG title=Smile 
                                src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/smiley_smile.gif" 
                                align=top> <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2549416">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2551434">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2551434 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=F2551461_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=70><A 
                        name=xx2551461xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2551461#xx2551461xx" 
                        name=2551461>Re: Server uses 100% of CPU, never slows 
                        down, please help!</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=912732">Andre 
                        Azevedo</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">16:05 
                        13 May '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2551461_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 70px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Please, follow this post<BR><BR><A 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?msg=1540676#xx1540676xx">http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?msg=1540676#xx1540676xx</A>[<A 
                                title="New Window" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?msg=1540676#xx1540676xx" 
                                target=_blank>^</A>] <BR><BR>
                                <DIV 
                                class=ForumSig>________________________________________________________________<BR>Throwing 
                                50 TD passes is easy when you´re dating Gisele 
                                Bundchen.</DIV><BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2549416">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2551461">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2551461 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F2539279_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2539279xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2539279#xx2539279xx" 
                        name=2539279>Transfer file over dial up</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=722017">myzm</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">6:17 6 
                        May '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2539279_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Is there any method for throttle 
                                control? I know I can control message size to be 
                                sent out. But it will be great if there is built 
                                in mechanism for throttle control. Thanks. Lewis 
                                <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2539279">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2539279">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2539279 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F2537951_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2537951xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2537951#xx2537951xx" 
                        name=2537951>A Little Problem About Echo Demo 
                      Project</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=2053137">jasonfan143</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">19:10 5 
                        May '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2537951_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2><IMG title=Frown 
                                src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/smiley_frown.gif" 
                                align=top> Dear Andre Azevedo:<BR>I have 
                                download the source code of the last version. 
                                when I run the EchoFormClient.exe and 
                                EchoFormServer.exe , I found a little bug. when 
                                I click "start" button on both the client form 
                                and server form first time, they run correctly. 
                                After I click "stop" button on the 
                                EchoFormClient, it stoped , but when I click the 
                                "Start" button again , the client form shows the 
                                message "Started", but in fact ,the client did 
                                not work. it did not connect to the server. So 
                                Why this happened, and how can I resolve this 
                                situation?<BR>Jason <BR>2008-05-06 
                                <BR><BR>Jason<BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2537951">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2537951">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2537951 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd LoVote Rt HdUnSel " id=F2535105_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2535105xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2535105#xx2535105xx" 
                        name=2535105>Library commercial use...</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=3430444">Luigi68</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">11:38 3 
                        May '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2535105_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Hello Andre,<BR><BR>i very 
                                appreciated your work and i'm asking you the 
                                permission to use your "work" in my 
                                company<BR>project regarding build of a 
                                client/server application.<BR><BR>Thanks in 
                                advance<BR>Luigi <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2535105">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2535105">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2535105 
                                style="WHITE-SPACE: nowrap">2.00/5 (1 vote) 
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=F2545914_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=34><A 
                        name=xx2545914xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2545914#xx2545914xx" 
                        name=2545914>[Message Deleted]</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=4485744">Poggel, 
                        Steven Buraje</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">6:37 9 
                        May '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2545914_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 34px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2><BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2535105">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2545914">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2545914 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=F2546610_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=52><A 
                        name=xx2546610xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2546610#xx2546610xx" 
                        name=2546610>Re: This license must be GPL</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=912732">Andre 
                        Azevedo</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">16:27 9 
                        May '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2546610_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 52px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Sorry, I didn't understand what 
                                you mean with this post.<BR><BR>&gt;This app is 
                                using "Cryptutils" 
                                &gt;(http://sourceforge.net/projects/cryptutils/[^])<BR><BR>Which 
                                App? This library? I didn't use "Cryptutils" in 
                                this library. <BR><BR>
                                <DIV 
                                class=ForumSig>________________________________________________________________<BR>Throwing 
                                50 TD passes is easy when you´re dating Gisele 
                                Bundchen.</DIV><BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2535105">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2546610">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2546610 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=F2547578_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=70><A 
                        name=xx2547578xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2547578#xx2547578xx" 
                        name=2547578>Re: This license must be GPL</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=4485744">Poggel, 
                        Steven Buraje</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">4:42 11 
                        May '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2547578_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 70px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Sorry about that.<BR>Your internal 
                                class uses the same name "CryptUtils" like the 
                                <BR>GNU-licensed sourceforge project I was 
                                talking about.<BR><BR>Embarrasing: I got 
                                confused by a class name.<BR><BR>Thank you for 
                                pointing out.<BR><BR>Steven <BR><BR>
                                <DIV class=ForumSig>Btw, the world is a great 
                                place, actually. Must see 
it!</DIV><BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2535105">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2547578">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2547578 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F2528672_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2528672xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2528672#xx2528672xx" 
                        name=2528672>Two simple questions</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=3517020">Infil</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">2:28 29 
                        Apr '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2528672_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>In my application, someone can 
                                choose to set up a client object before the 
                                server is established. If this is the case (ie, 
                                the Connector I connect to the SocketClient 
                                object tries to connect to an IP/port that is 
                                not being listened on), I want to report a 
                                message to the user and abort the connection. 
                                How can I do this? Is there a variable set, or 
                                an event thrown if the SocketClient cannot 
                                connect first try on one of its connectors? (For 
                                the record, I only have one 
                                connector.)<BR><BR>Also, if I am using TCP, I am 
                                guaranteed that all messages will be received in 
                                the same order they are sent, correct? This is 
                                important because in my application, I am 
                                sending a very large message, possibly followed 
                                immediately by a very short message which uses 
                                data from the first. If TCP/this app can't 
                                guarantee messages are received in the same 
                                order as sent, then I will have to do some of my 
                                own acknowledgment stuff.<BR><BR>I want to once 
                                again thank Andre for his excellent tool. My 
                                project, which uses his package, is almost 
                                complete and I'm positive I wouldn't have been 
                                able to finish without such an easy-to-use tool! 
                                <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2528672">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2528672">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2528672 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd LoVote Rt HdUnSel " id=F2511392_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2511392xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2511392#xx2511392xx" 
                        name=2511392>Server Exception when client 
                      disconnects</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=3893895">JPOG</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">2:32 17 
                        Apr '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2511392_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Hello,<BR><BR>My 
                                ServerSocketService::OnException(ExceptionEventArgs 
                                e) receives the following exception when my 
                                SocketClientSync calls its Disconnect 
                                method.<BR><BR>System.Net.Sockets.SocketException: 
                                An existing connection was forcibly closed by 
                                the remote host<BR>at 
                                System.Net.Sockets.Socket.EndReceive(IAsyncResult 
                                asyncResult)<BR>at 
                                ALAZ.SystemEx.NetEx.SocketsEx.BaseSocketConnectionHost.BeginReadCallbackProcessing(Object 
                                state)<BR><BR>Is there something I am missing 
                                that I should be doing before the client calls 
                                Disconnect? Any help would be 
                                appreciated.<BR><BR>Thanks,<BR>JP <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2511392">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2511392">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2511392 
                                style="WHITE-SPACE: nowrap">1.00/5 (1 vote) 
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F2505539_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2505539xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2505539#xx2505539xx" 
                        name=2505539>c# socket framework</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=1560230">guyulmaz</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">13:24 
                        13 Apr '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2505539_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Hello,<BR>Thanks for writing this 
                                library.<BR>For doing a production project I 
                                searched a c# based non-blocking socket 
                                framework. But I couldnt find it.<BR>I mean a 
                                framework like apache mina project.<BR>Do I 
                                missed it, does it exist? <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2505539">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2505539">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2505539 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=F2505775_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=34><A 
                        name=xx2505775xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2505775#xx2505775xx" 
                        name=2505775>Re: c# socket framework</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=4241245">zhiyangxu</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">20:12 
                        13 Apr '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2505775_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 34px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2><A 
                                href="http://www.codeproject.com/KB/IP/Generic_TCP_IP_server.aspx?msg=2489157#xx2489157xx">http://www.codeproject.com/KB/IP/Generic_TCP_IP_server.aspx?msg=2489157#xx2489157xx</A>[<A 
                                title="New Window" 
                                href="http://www.codeproject.com/KB/IP/Generic_TCP_IP_server.aspx?msg=2489157#xx2489157xx" 
                                target=_blank>^</A>] <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2505539">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2505775">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2505775 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F2473482_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2473482xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2473482#xx2473482xx" 
                        name=2473482>Message</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=4245719">creacon</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">9:34 19 
                        Mar '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2473482_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Hi, I made a simple socket 
                                implementation myself, that has a small 
                                problem:<BR><BR>If the messages start arriving 
                                very fast one after the other, the server can't 
                                keep up and starts reading 2 seperate messages 
                                (strings) as one. I was thinking of adding some 
                                kind of delimiter that marks the end of the 
                                message and put the rest in a new 
                                message.<BR><BR>Before I do this, I would like 
                                to know if the library you wrote already has 
                                that kind of functionality?<BR><BR>And how you 
                                would implement this server and 
                                clientside.<BR><BR>Thanks.<BR><BR>creacon 
                                <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2473482">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2473482">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2473482 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F2466263_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2466263xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2466263#xx2466263xx" 
                        name=2466263>Chat App doesn't work</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=2132362">LastGentleman</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">23:53 
                        13 Mar '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2466263_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Hi, <BR><BR>i try the Chat App on 
                                my PC but always if I connect to myself, the 
                                Server says<BR><BR><SMALL>Client 
                                Disconnected<BR>Connection Id 
                                1005</SMALL><BR><BR>Thanks<BR>Andreas 
                                <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2466263">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2466263">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2466263 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=F2479039_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=34><A 
                        name=xx2479039xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2479039#xx2479039xx" 
                        name=2479039>Re: Chat App doesn't work</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=2119979">tinhleduc</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">0:16 25 
                        Mar '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2479039_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 34px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Hi,<BR>I met the same problem 
                                "Client Disconnected" but I can not resolve it 
                                by myself.Please help.<BR><BR>Thanks,<BR>Tony 
                                <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2466263">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2479039">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2479039 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=F2489432_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=52><A 
                        name=xx2489432xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2489432#xx2489432xx" 
                        name=2489432>Re: Chat App doesn't work</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=4986244">Ikeness</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">17:02 1 
                        Apr '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2489432_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 52px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>I have the same problem.<BR>I 
                                think that it has something to do with the 
                                encription type etRijndael.<BR>I set the 
                                encription type to etNone in both the client and 
                                the server and then this project runs pretty 
                                smoothly.<BR><BR><BR>Does the etRijndael 
                                encrption type work for anyone else?<BR>Or does 
                                everyone have this problem? <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2466263">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2489432">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2489432 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd LoVote Rt HdUnSel " id=F2448795_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2448795xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2448795#xx2448795xx" 
                        name=2448795>Primitive</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=145678">Alex_1</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">19:20 2 
                        Mar '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2448795_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Well as a simple, free and perhaps 
                                reliable solution it OK, however such solution 
                                can not be considered adequate. Basically it is 
                                a remake of C++ socket programs with still C++ 
                                concepts behind it. Wake up : we live in .Net 
                                era. The data exchange must be done by the 
                                objects, not with byte array or strings. No 
                                provision for the execution of the methods , no 
                                serialization …. <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2448795">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2448795">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2448795 
                                style="WHITE-SPACE: nowrap">1.50/5 (3 votes) 
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=F2473490_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=34><A 
                        name=xx2473490xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2473490#xx2473490xx" 
                        name=2473490>Re: Primitive</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=4245719">creacon</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">9:41 19 
                        Mar '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2473490_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 34px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>So, could you point us to such an 
                                implementation?<BR>I would be very interested to 
                                check it out.<BR><BR>Thanks <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2448795">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2473490">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2473490 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd LoVote HdUnSel " id=F2475219_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=52><A 
                        name=xx2475219xx></A><IMG height=16 alt=General 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2475219#xx2475219xx" 
                        name=2475219>Re: Primitive</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=145678">Alex_1</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">14:49 
                        20 Mar '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2475219_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 52px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>well, if you 
                                wish<BR>www.dotnetremoting.com<BR>but it is a 
                                commercial solution, not free. So, if you are 
                                focused only on free ones, please don't bother 
                                <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2448795">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2475219">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2475219 
                                style="WHITE-SPACE: nowrap">2.00/5 (1 vote) 
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=F2444815_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2444815xx></A><IMG height=16 alt=Question 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_question.gif" 
                        width=16 align=top></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2444815#xx2444815xx" 
                        name=2444815>Bug with connection.ReadCount ?</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 alt=member 
                        src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/member_sm.gif" 
                        border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=3596601">ncichris</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">21:31 
                        27 Feb '08 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=F2444815_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Hi Andre, first I would like to 
                                thank you for posting such a great project for 
                                us to use. <BR>I think there is a bug in the 
                                BaseSocketConnectionHost in the receive methods. 
                                Basically every time the begin receive is called 
                                the connection.ReadCount is incremented if there 
                                is a pending read request. If you call the 
                                BeginReceive from multiple threads this is 
                                almost guranteed to be &gt; 0 for most times. 
                                This is fine and I understand why this was done. 
                                The thing that I do not understand is that this 
                                counter is almost never decremented. In the 
                                ReadBytesFromConnection method the following 
                                code:<BR>if(!socketWasRead)<BR>{<BR>//----- 
                                Check Queue!<BR>lock 
                                (connection.SyncReadCount)<BR>{<BR>connection.ReadCount--;<BR><BR>is 
                                supposed to make this counter decrement. But the 
                                socketWasRead is set to true if we need to read 
                                the socket again (which makes this a confusing 
                                name, maybe it should be socketHasToBeRead or 
                                something). Anyway if you have some load on the 
                                server this flag will be (for most cases) set to 
                                true which means the decrement call will never 
                                be made. <BR>Also during the reading of the 
                                actual message from the socket we might find 
                                many messages and keep reading the socket until 
                                no more messages exist, and correctly you fire 
                                the FireOnReceived event and continue reading 
                                for more messages. So there are two places where 
                                the FireOnReceived call is made (which should 
                                (maybe) also decrement the ReadCount). 
                                <BR>Anyway this is a difficult issue to properly 
                                fix because the host (server or client) might 
                                call the begin receive a few times but there 
                                might be no messages to read. Therefore this 
                                counter will still have some cases when it will 
                                not be decremented. <BR>As you can tell I am a 
                                little confused and I am wondering if I 
                                misunderstood something or if there is a better 
                                way to handle the beginreceive 
                                queueing.<BR><BR>My thought is that on the first 
                                begin receive that the BaseSocketConnectionHost 
                                receives it should do a begin receive and then 
                                as soon as this one comes back then start a new 
                                one, and then a new one, so the socket will 
                                always be in reading from the socket? This will 
                                make things simpler since you will not need to 
                                maintain the counter and it will always be 
                                reading so there are no messages to be lost or 
                                timeout because the beginread or beginreceive 
                                where never called.<BR><BR>Thanks in advance 
                                <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: middle">
                                <TD class=Frm_MsgFt><A class=Frm_MHL 
                                href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fKB%2fIP%2fAsyncSocketServerandClien.aspx">Sign 
                                In</A>·<A class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2444815">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=307304&amp;msg=2444815">PermaLink</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2444815 
                                style="WHITE-SPACE: nowrap"></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR>
                <TD><IMG height=5 alt="" 
                  src="C:\Documents and Settings\valley\Desktop\New Folder\CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files\t(1).gif" 
                  width=1 border=0></TD></TR></TBODY></TABLE></TD></TR>
        <TR>
          <TD>
            <TABLE cellSpacing=0 cellPadding=2 width="100%">
              <TBODY>
              <TR class=Frm_Footer>
                <TD>Last Visit: Tuesday, May 20, 2008 8:29 PM &nbsp; &nbsp; 
                  Last Update:Tuesday, May 20, 2008 8:29 PM</TD>
                <TD style="WHITE-SPACE: nowrap; TEXT-ALIGN: right"><B>1</B><A 
                  class=Frm_HL 
                  href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;fr=26#xx0xx" 
                  name=Frm_HoverNL>2</A><A class=Frm_HL 
                  href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;fr=51#xx0xx" 
                  name=Frm_HoverNL>3</A><A class=Frm_HL 
                  href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;fr=76#xx0xx" 
                  name=Frm_HoverNL>4</A><A class=Frm_HL 
                  href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;fr=101#xx0xx" 
                  name=Frm_HoverNL>5</A><A class=Frm_HL 
                  href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;fr=126#xx0xx" 
                  name=Frm_HoverNL>6</A><A class=Frm_HL 
                  href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;fr=151#xx0xx" 
                  name=Frm_HoverNL>7</A><A class=Frm_HL 
                  href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;fr=176#xx0xx" 
                  name=Frm_HoverNL>8</A><A class=Frm_HL 
                  href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;fr=201#xx0xx" 
                  name=Frm_HoverNL>9</A><A class=Frm_HL 
                  href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;fr=226#xx0xx" 
                  name=Frm_HoverNL>10</A> <A class=Frm_HL 
                  href="http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx?fid=307304&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;fr=26#xx0xx" 
                  name=Frm_HoverNL>Next 
      »</A></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></DIV>
      <P class=SmallText><IMG height=16 alt=General 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_general.gif" 
      width=16 align=top> General &nbsp;&nbsp; <IMG height=16 alt=News 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_news.gif" 
      width=16 align=top> News &nbsp;&nbsp; <IMG height=16 alt=Question 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_question.gif" 
      width=16 align=top> Question &nbsp;&nbsp; <IMG height=16 alt=Answer 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_answer.gif" 
      width=16 align=top> Answer &nbsp;&nbsp; <IMG height=16 alt=Joke 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_joke.gif" 
      width=16 align=top> Joke &nbsp;&nbsp; <IMG height=16 alt=Rant 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_rant.gif" 
      width=16 align=top> Rant &nbsp;&nbsp; <IMG height=16 alt=Admin 
      src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/msg_admin.gif" 
      width=16 align=top> Admin &nbsp;&nbsp; </P><!-- Forum End --></DIV>
      <TABLE width="100%">
        <TBODY>
        <TR vAlign=top>
          <TD class=TinyText align=left><A id=ctl00_PermaLink 
            href="http://www.codeproject.com/script/Articles/Article.aspx?aid=14155">PermaLink</A> 
            | <A id=ctl00_PrivacyLink 
            href="http://www.codeproject.com/info/privacy.aspx">Privacy </A>| <A 
            id=ctl00_TermsOfUseLink 
            href="http://www.codeproject.com/info/TermsOfUse.aspx">Terms of 
            Use</A> <BR>Last Updated: 7 Sep 2007<BR>Editor: <A 
            id=ctl00_ArticleEditor 
            href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=3866010">Deeksha 
            Shenoy</A><BR></TD>
          <TD class=TinyText vAlign=top align=right>Copyright 2006 by Andre 
            Azevedo<BR>Everything else Copyright © <A 
            href="mailto:webmaster@codeproject.com">CodeProject</A>, 1999-2008 
            <BR>Web12 | <A id=ctl00_AdvertiseLink 
            href="http://www.codeproject.com/info/MediaKit.aspx">Advertise on 
            the Code Project </A></TD></TR></TBODY></TABLE>
      <CENTER></CENTER></TD></TR>
  <TR>
    <TD align=middle colSpan=2></TD></TR></TBODY></TABLE><BR>
<SCRIPT language=Javascript type=text/javascript>//<![CDATA[
if (document.all) try {window.attachEvent("oncopy",copyCode);}catch(e){};
//]]></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/TogglePre.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/menu132_com.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject An Asynchronous Socket Server and Client_ Free source code and programming help_files/TopNavBar.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript type=text/javascript>//<![CDATA[
new HVMenu(new menu_NavbarConfig());
//]]></SCRIPT>
</BODY></HTML>
