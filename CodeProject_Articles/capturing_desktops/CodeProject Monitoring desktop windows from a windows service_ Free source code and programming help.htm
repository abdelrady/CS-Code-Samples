<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0056)http://www.codeproject.com/KB/threads/ScreenMonitor.aspx -->
<HTML><HEAD><TITLE>CodeProject: Monitoring desktop windows from a windows service. Free source code and programming help</TITLE>
<META http-equiv=Content-Type content="text/html; charset=utf-8">
<META 
content="Capture and save desktop windows from a windows service; Author: dmihailescu; Section: Threads, Processes &amp; IPC; Chapter: General Programming" 
name=Description>
<META 
content=".NET 2.0, WinXP, Vista, C# 1.0, C# 2.0, C# 3.0, C#, Win32, Dev, Advanced,Threads, Processes &amp; IPC,General Programming,Free source code, tutorials" 
name=Keywords>
<META content="The Code Project" name=Author>
<META content=General name=Rating>
<META content="index, follow" name=Robots>
<META content="1 days" name=Revisit-After><LINK 
title="CodeProject Lounge Postings" 
href="http://www.codeproject.com/webservices/LoungeRSS.aspx" 
type=application/rss+xml rel=alternate><LINK 
title="CodeProject Latest articles - All topics" 
href="http://www.codeproject.com/webservices/articlerss.aspx?cat=1" 
type=application/rss+xml rel=alternate><LINK 
title="CodeProject Latest articles - MFC / C++" 
href="http://www.codeproject.com/webservices/articlerss.aspx?cat=2" 
type=application/rss+xml rel=alternate><LINK 
title="CodeProject Latest articles - C#" 
href="http://www.codeproject.com/webservices/articlerss.aspx?cat=3" 
type=application/rss+xml rel=alternate><LINK 
title="CodeProject Latest articles - ASP.NET" 
href="http://www.codeproject.com/webservices/articlerss.aspx?cat=4" 
type=application/rss+xml rel=alternate><LINK 
title="CodeProject Latest articles - .NET" 
href="http://www.codeproject.com/webservices/articlerss.aspx?cat=5" 
type=application/rss+xml rel=alternate><LINK 
title="CodeProject Latest articles - VB.NET" 
href="http://www.codeproject.com/webservices/articlerss.aspx?cat=6" 
type=application/rss+xml rel=alternate><LINK title=CodeProject 
href="http://www.codeproject.com/info/OpenSearch.xml" 
type=application/opensearchdescription+xml rel=search><LINK 
href="CodeProject Monitoring desktop windows from a windows service_ Free source code and programming help_files/CodeProject.css" 
type=text/css rel=stylesheet><LINK 
href="CodeProject Monitoring desktop windows from a windows service_ Free source code and programming help_files/ForumClassic.css" 
type=text/css rel=stylesheet>
<SCRIPT type=text/javascript>
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</SCRIPT>

<SCRIPT type=text/javascript>
   var pageTracker = _gat._getTracker("UA-1735123-1");
   pageTracker._setDomainName("codeproject.com");
   pageTracker._setSessionTimeout("1200"); // 20 mins
   pageTracker._initData();
   pageTracker._trackPageview();
</SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject Monitoring desktop windows from a windows service_ Free source code and programming help_files/oncopy.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject Monitoring desktop windows from a windows service_ Free source code and programming help_files/addto.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript type=text/javascript><!--
function ToggleMenu(itemName)
{
	var elm = document.getElementById(itemName);
	var i,others = document.getElementById('SectionMenu');
	for(i=0; i < others.childNodes.length; i++)
	{
		var other = others.childNodes[i];
		if ((other.className == 'MenuSectionBlock') && (other != elm))
			other.style.display='none';
	}
	if (elm.style.display == 'block') elm.style.display='none';
	else elm.style.display='block';
	return false;
}

--></SCRIPT>

<SCRIPT language=Javascript type=text/javascript><!--
function MsgVoteForm(MemberID, MsgID) {
 document.write("Rate this message: ");
 document.write(unescape("%3Ca href=\"#xx" + MsgID.toString() + "xx\" onclick=\"RateMsg(" + MemberID.toString() + ", " + MsgID.toString() + ",1)\"%3E"));
 document.write(unescape("%3Cimg height=\"14\" width=\"14\" src=\"/script/Forums/Images/thumbs_down.gif\" alt=\"vote 1\" border=\"0\" align=\"absmiddle\" /%3E%3C/a%3E "));
 for (var i=1; i<=5;i++)
  document.write(unescape("%3Ca class=\"Frm_MHL\" href=\"#xx" + MsgID.toString() + "xx\" title=\"give this message a vote of " + i.toString() + "\" onclick=\"RateMsg(" + MemberID.toString() + ", " + MsgID.toString() + ", " + i.toString() + ")\"%3E%3Cb%3E" + i.toString() + "%3C/b%3E%3C/a%3E "));
 document.write(unescape("%3Ca href=\"#xx" + MsgID.toString() + "xx\" onclick=\"RateMsg(" + MemberID.toString() + ", " + MsgID.toString() + ",5)\"%3E"));
 document.write(unescape("%3Cimg height=\"14\" width=\"14\" src=\"/script/Forums/Images/thumbs_up.gif\" alt=\"vote 5\" border=\"0\" align=\"absmiddle\" /%3E%3C/a%3E "));
}

function ReportMsg(userid, msgid, score) {
 if (confirm("Are you sure you want to report this message?") == true)
  return RateMsg(userid, msgid, score);
 else return false;
}
function RateMsg(memberid, msgid, score) {
 var req = new ActiveXObject("MSXML2.XMLHTTP");
 req.onreadystatechange = function() {
  if (req.readyState == 4) {
   if ( req.status == 200 ) {
    var respText = req.responseText;
    var re = new RegExp(unescape("\%3Cdiv\%3E([^\%3C]*)\%3C/div\%3E"), "g");
    var match = re.exec(respText);
    voteStatus.innerHTML = unescape("%3Cb%3E") + (match)?match[1]:"An error occured" + unescape("%3C/b%3E");
   }
   else
   {
    voteStatus.innerHTML = unescape("%3Cb style='color:red'%3EFailed!") + req.statusText + unescape("%3C/b%3E");
   }
  }
 }
 var voteStatus = document.getElementById("MVF" + msgid);
 if (!voteStatus) return;
 voteStatus.innerHTML = unescape("%3Cb style='color:green'%3EVoting...%3C/b%3E");
 var strAction = "/script/Forums/Vote.aspx?js=1&fmid="+memberid.toString()+"&select="+msgid.toString()+"&score="+score.toString();
 req.open("GET", strAction, true);
 req.send(null);
  return false;
}
--></SCRIPT>

<SCRIPT language=Javascript type=text/javascript><!--
var Selected = "-1";

function SwitchMessage(e, msgId)
{
  if (!msgId) {
    if(!e)e=window.event;
    var target=e.target?e.target:e.srcElement;
    while(target&&target.id!='DynMessLink')target=target.parentNode;
    if(!target||target.id!='DynMessLink')return;
    msgId=target.name;
  }
  if(Selected&&Selected!=""){
    var body=eval("document.getElementById('" + Selected + "_h1')");
    if(body) body.style.display = 'none';
    var head=eval("document.getElementById('" + Selected + "_h0')");
    if(head) head.className = head.className.replace("Sel", "UnSel");
  }
  if(Selected==msgId.toString())
    Selected="";
  else {
    Selected=msgId.toString();
    var body=eval("document.getElementById('" + Selected + "_h1')");
    if(body){
      if(body.style.display=='none') body.style.display='';
      else body.style.display = 'none';
    }
    var head=eval("document.getElementById('" + Selected + "_h0')");
    if (head) 
      head.className = head.className.replace("UnSel", "Sel");
    if(body&&head&&body.style.display!='none'){
      document.body.scrollTop = getRealPos(head, "Top") - document.body.clientHeight/10;
      EnsureMessageVisible(Selected, true);
    }
  }
  if (e){if(e.preventDefault)e.preventDefault;else e.returnValue=false;}
  return false;
}

--></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject Monitoring desktop windows from a windows service_ Free source code and programming help_files/ShortCuts.js" 
type=text/javascript></SCRIPT>
<LINK href="/favicon.ico" type=image/ico rel=icon><LINK href="/favicon.ico" 
type=image/ico rel="shortcut icon">
<SCRIPT type=text/javascript>
	function SetAsAvailable() {
	   var aid = document.getElementById("ArticleId");
	   if(aid)
		   window.location.href = "/script/Articles/UpdateArticleStatus.aspx?aid=" + articleId.value + "&rp=" + location.href;
	}
	</SCRIPT>

<META content="MSHTML 6.00.2900.2180" name=GENERATOR></HEAD>
<BODY>
<TABLE id=ctl00_AT cellSpacing=0 cellPadding=0 border=0>
  <TBODY>
  <TR vAlign=top>
    <TD colSpan=2>
      <TABLE cellSpacing=0 cellPadding=0 border=0>
        <TBODY>
        <TR>
          <TD class=HeaderLogo><A href="http://www.codeproject.com/"><IMG 
            height=90 alt=Home src="/Images/Standard/codeproject225x90.gif" 
            width=225 border=0></A></TD>
          <TD class=HeaderBanner align=right width="100%">
            <SCRIPT type=text/javascript>document.write("<a href=\"http://www.codeproject.com/Redir.aspx?adid=5268&way=ban\" target=\"_blank\" rel=\"nofollow\"><img src=\"http://www.codeproject.com/script/Ann/ServeImg.aspx?File=%2fscript%2fadmentor%2fimages%2ftwarte-nethawk-EV-728x90.gif&C=False&id=5268\" alt=\"\" border=\"0\" width=\"728\" height=\"90\"></a>");</SCRIPT>
          </TD></TR>
        <TR>
          <TD colSpan=2>
            <TABLE class=MemberNavBar cellSpacing=0 cellPadding=5 
              width="100%"><TBODY>
              <TR>
                <TD class=SmallText style="FONT-WEIGHT: bold">4,881,172 
                  members and growing! (10,528 online)</TD>
                <TD align=right>
                  <DIV class=MemberNavBarText 
                  id=ctl00_MemberMenu_LoggedOnOptions><A 
                  id=ctl00_MemberMenu_MyProfile 
                  href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=2959938">abdelrady2030</A> 
                  | <A id=ctl00_MemberMenu_MySettings 
                  href="http://www.codeproject.com/script/Membership/Modify.aspx"><IMG 
                  height=16 src="/images/tools.gif" width=16 align=absMiddle 
                  border=0> <B>My Settings</B></A> | <A 
                  id=ctl00_MemberMenu_MyBookmarks 
                  href="http://www.codeproject.com/script/Bookmarks/List.aspx?obtid=2"><IMG 
                  height=16 src="/images/fave.gif" width=16 align=absMiddle 
                  border=0> My Bookmarks</A> | <A id=ctl00_MemberMenu_MyArticles 
                  href="http://www.codeproject.com/script/Articles/MemberArticles.aspx?amid=2959938">My 
                  Articles</A> | <A id=ctl00_MemberMenu_Signout 
                  href="http://www.codeproject.com/script/Membership/LogOff.aspx?rp=%2fKB%2fthreads%2fScreenMonitor.aspx">Sign 
                  out</A> </DIV></TD></TR></TBODY></TABLE></TD></TR>
        <TR>
          <TD colSpan=2>
            <TABLE class=SiteNavBar id=tblSiteToolbar cellSpacing=0 
            cellPadding=0>
              <TBODY>
              <TR>
                <TD><A href="http://www.codeproject.com/">Home</A></TD>
                <TD class=SelCat noWrap><A 
                  href="http://www.codeproject.com/?cat=1">All Topics</A></TD>
                <TD noWrap><A 
                  href="http://www.codeproject.com/?cat=2">MFC/C++</A></TD>
                <TD noWrap><A 
                href="http://www.codeproject.com/?cat=3">C#</A></TD>
                <TD noWrap><A 
                  href="http://www.codeproject.com/?cat=6">VB.NET</A></TD>
                <TD noWrap><A 
                  href="http://www.codeproject.com/?cat=4">ASP.NET</A></TD>
                <TD noWrap><A 
                href="http://www.codeproject.com/?cat=9">SQL</A></TD>
                <TD noWrap><A 
                  href="http://www.codeproject.com/?cat=8">Architect</A></TD>
                <TD width="100%">&nbsp;</TD>
                <TD id=ctl00_TopNavBar_RightMenus><!--380-->
                  <DIV id=MenuPos 
                  style="WIDTH: 305px; POSITION: relative; TOP: 1px; HEIGHT: 22px">
                  <TABLE 
                  style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; HEIGHT: 20px; BORDER-RIGHT-WIDTH: 0px" 
                  cellSpacing=0 cellPadding=0 width=305>
                    <TBODY>
                    <TR vAlign=center>
                      <TD 
                      style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" 
                      noWrap><A 
                        href="http://www.codeproject.com/info/FAQ.aspx">Help!</A></TD>
                      <TD 
                      style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" 
                      noWrap><A 
                        href="http://www.codeproject.com/script/Articles/Latest.aspx">Articles</A></TD>
                      <TD 
                      style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" 
                      noWrap><A 
                        href="http://www.codeproject.com/script/Forums/List.aspx">Message 
                        Boards</A></TD>
                      <TD 
                      style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" 
                      noWrap><A 
                        href="http://www.codeproject.com/Lounge.aspx">Lounge</A></TD></TR></TBODY></TABLE></DIV></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
  <TR>
    <TD vAlign=top colSpan=2><A name=_top></A>
      <TABLE class=ArticleUneditedHeader id=ctl00_ArticleTopHeader_HeaderTable 
      cellSpacing=0 cellPadding=3 width="100%" border=0>
        <TBODY>
        <TR vAlign=top>
          <TD class=SmallText><A id=ctl00_ArticleTopHeader_ChapterLink 
            href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=6">General 
            Programming</A> » <A id=ctl00_ArticleTopHeader_SectionLink 
            href="http://www.codeproject.com/KB/threads/">Threads, Processes 
            &amp; IPC</A> » <A id=ctl00_ArticleTopHeader_SubsectionLink 
            href="http://www.codeproject.com/KB/threads/index.aspx?#Threads, Processes &amp; IPC - Processes">Processes</A> 
            <SPAN class=ArticleAdvanced 
            id=ctl00_ArticleTopHeader_SkillLevel>&nbsp;&nbsp;&nbsp; 
            Advanced</SPAN> <SPAN class=SmallText 
            id=ctl00_ArticleTopHeader_LicenceTerms 
            style="MARGIN-LEFT: 40px">License: <A 
            href="http://www.codeproject.com/info/cpol10.aspx">The Code Project 
            Open License (CPOL)</A></SPAN> <BR><BR>
            <H1><SPAN class=ArticleTopTitle 
            id=ctl00_ArticleTopHeader_ArticleTitle>Monitoring desktop windows 
            from a windows service</SPAN></H1><B>By <A 
            href="http://www.codeproject.com/script/Articles/MemberArticles.aspx?amid=634640">dmihailescu</A></B><BR><BR><SPAN 
            class=ArticleTopDescr id=ctl00_ArticleTopHeader_ArticleDescr>Capture 
            and save desktop windows from a windows service</SPAN> </TD>
          <TD class=SmallText style="WIDTH: 210px"><SPAN 
            id=ctl00_ArticleTopHeader_ArticleAttributes>C# (C# 1.0, C# 2.0, C# 
            3.0), C#, Windows, .NET, WinXP, Vista, .NET 2.0, Win32, 
            Dev</SPAN><BR><BR><SPAN style="PADDING-RIGHT: 2ex">Posted</SPAN>: 
            <B>28 Nov 2007</B><BR><SPAN 
            style="PADDING-RIGHT: 0.5ex">Updated</SPAN>: <B>2 Jan 2008</B> 
            <BR><SPAN style="PADDING-RIGHT: 3.2ex">Views</SPAN>: 
          <B>5,550</B><BR></TD></TR>
        <TR>
          <TD colSpan=2>
            <TABLE width="100%">
              <TBODY>
              <TR>
                <TD>
                  <DIV id=ctl00_ArticleTopHeader_UneditedDiv><B>Note: <A 
                  id=ctl00_ArticleTopHeader_UneditedLnk 
                  href="http://www.codeproject.com/script/Articles/Unedited.aspx">This 
                  is an unedited reader contribution</A></B> </DIV></TD>
                <TD class=SmallText style="WHITE-SPACE: nowrap" 
              align=right></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
  <TR vAlign=top>
    <TD class=LHNavBar id=ctl00_LeftNavCell>
      <DIV style="PADDING-TOP: 5px; TEXT-ALIGN: center">
      <SCRIPT type=text/javascript>document.write("<a href=\"http://www.codeproject.com/Redir.aspx?adid=3487&way=ban\" target=\"_blank\" rel=\"nofollow\"><img src=\"http://www.codeproject.com/script/Ann/ServeImg.aspx?File=%2fscript%2fadmentor%2fimages%2fcp_daily_150x80.gif&C=False&id=3487\" alt=\"\" border=\"0\" width=\"150\" height=\"80\"></a>");</SCRIPT>
      </DIV>
      <DIV class=FeatureBlockHeader>Announcements</DIV>
      <DIV class="FeatureBlockContent RHFeatureBar">
      <DIV style="PADDING-TOP: 0px"><IMG 
      style="PADDING-RIGHT: 14px; FLOAT: left; MARGIN-LEFT: 7px; MARGIN-RIGHT: 10px" 
      height=20 alt=Comp src="/script/Awards/Images/prize_winner.gif" width=10> 
      <A id=ctl00_Announcements_CompLink 
      href="http://www.codeproject.com/Feature/ArticleCompetition/">Monthly 
      Competition</A><BR clear=all>
      <DIV style="PADDING-BOTTOM: 5px; PADDING-TOP: 3px"><IMG 
      style="PADDING-RIGHT: 10px; FLOAT: left; MARGIN-LEFT: 7px; MARGIN-RIGHT: 8px" 
      height=16 alt=Staff src="/script/membership/images/staff_sm.gif" width=12> 
      <A href="http://www.codeproject.com/info/jobs/">We're Hiring!</A></DIV>
      <DIV style="PADDING-BOTTOM: 5px; PADDING-TOP: 3px"><IMG 
      style="PADDING-RIGHT: 0px; MARGIN-TOP: 3px; FLOAT: left; MARGIN-LEFT: 0px; MARGIN-RIGHT: 0px" 
      height=20 alt=Silverlight src="/images/silverlight_20.jpg" width=27> <A 
      href="http://www.codeproject.com/script/News/View.aspx?nwid=6024">Add 
      Silverlight to your articles</A></DIV></DIV></DIV>
      <DIV class=MenuCat>Services</DIV>
      <DIV class=MenuChapter><A 
      href="http://www.codeproject.com/Services/coffee.aspx">Code Project 
      Coffee</A></DIV>
      <DIV class=MenuChapter><A 
      href="http://www.codeproject.com/Services/TradePub.aspx">Free 
      Magazines</A></DIV>
      <DIV></DIV><BR>
      <DIV id=SectionMenu>
      <DIV class=MenuCat>Chapters</DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter1');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=1">Desktop 
      Development</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter1 style="DISPLAY: none">
      <DIV class=MI id=Section1><A 
      href="http://www.codeproject.com/KB/buttons/">Button Controls</A></DIV>
      <DIV class=MI id=Section15><A 
      href="http://www.codeproject.com/KB/clipboard/">Clipboard</A></DIV>
      <DIV class=MI id=Section2><A 
      href="http://www.codeproject.com/KB/combobox/">Combo &amp; List 
      Boxes</A></DIV>
      <DIV class=MI id=Section67><A 
      href="http://www.codeproject.com/KB/dialog/">Dialogs and Windows</A></DIV>
      <DIV class=MI id=Section107><A 
      href="http://www.codeproject.com/KB/gadgets/">Desktop Gadgets</A></DIV>
      <DIV class=MI id=Section16><A 
      href="http://www.codeproject.com/KB/docview/">Document / View</A></DIV>
      <DIV class=MI id=Section4><A 
      href="http://www.codeproject.com/KB/edit/">Edit Controls</A></DIV>
      <DIV class=MI id=Section17><A 
      href="http://www.codeproject.com/KB/files/">Files and Folders</A></DIV>
      <DIV class=MI id=Section3><A 
      href="http://www.codeproject.com/KB/grid/">Grid &amp; Data 
      Controls</A></DIV>
      <DIV class=MI id=Section48><A 
      href="http://www.codeproject.com/KB/system/">Hardware &amp; 
      System</A></DIV>
      <DIV class=MI id=Section5><A 
      href="http://www.codeproject.com/KB/list/">List Controls</A></DIV>
      <DIV class=MI id=Section6><A 
      href="http://www.codeproject.com/KB/menus/">Menus</A></DIV>
      <DIV class=MI id=Section14><A 
      href="http://www.codeproject.com/KB/miscctrl/">Miscellaneous</A></DIV>
      <DIV class=MI id=Section18><A 
      href="http://www.codeproject.com/KB/printing/">Printing</A></DIV>
      <DIV class=MI id=Section95><A 
      href="http://www.codeproject.com/KB/progress/">Progress Controls</A></DIV>
      <DIV class=MI id=Section11><A 
      href="http://www.codeproject.com/KB/selection/">Selection 
      Controls</A></DIV>
      <DIV class=MI id=Section19><A 
      href="http://www.codeproject.com/KB/shell/">Shell and IE 
      programming</A></DIV>
      <DIV class=MI id=Section68><A 
      href="http://www.codeproject.com/KB/smart/">Smart Client</A></DIV>
      <DIV class=MI id=Section8><A 
      href="http://www.codeproject.com/KB/splitter/">Splitter Windows</A></DIV>
      <DIV class=MI id=Section9><A 
      href="http://www.codeproject.com/KB/static/">Static &amp; Panel 
      Controls</A></DIV>
      <DIV class=MI id=Section10><A 
      href="http://www.codeproject.com/KB/statusbar/">Status Bar</A></DIV>
      <DIV class=MI id=Section7><A 
      href="http://www.codeproject.com/KB/tabs/">Tabs &amp; Property 
      Pages</A></DIV>
      <DIV class=MI id=Section12><A 
      href="http://www.codeproject.com/KB/toolbars/">Toolbars &amp; Docking 
      windows</A></DIV>
      <DIV class=MI id=Section13><A 
      href="http://www.codeproject.com/KB/tree/">Tree Controls</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter2');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=2">Web 
      Development</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter2 style="DISPLAY: none">
      <DIV class=MI id=Section70><A 
      href="http://www.codeproject.com/KB/ajax/">AJAX and Atlas</A></DIV>
      <DIV class=MI id=Section27><A 
      href="http://www.codeproject.com/KB/applications/">Applications &amp; 
      Tools</A></DIV>
      <DIV class=MI id=Section85><A 
      href="http://www.codeproject.com/KB/asp/">ASP</A></DIV>
      <DIV class=MI id=Section89><A 
      href="http://www.codeproject.com/KB/aspnet/">ASP.NET</A></DIV>
      <DIV class=MI id=Section28><A 
      href="http://www.codeproject.com/KB/webforms/">ASP.NET Controls</A></DIV>
      <DIV class=MI id=Section38><A 
      href="http://www.codeproject.com/KB/ATL-Server/">ATL Server</A></DIV>
      <DIV class=MI id=Section29><A 
      href="http://www.codeproject.com/KB/web-cache/">Caching</A></DIV>
      <DIV class=MI id=Section91><A 
      href="http://www.codeproject.com/KB/web-image/">Charts, Graphs and 
      Images</A></DIV>
      <DIV class=MI id=Section25><A 
      href="http://www.codeproject.com/KB/scripting/">Client side 
      scripting</A></DIV>
      <DIV class=MI id=Section30><A 
      href="http://www.codeproject.com/KB/custom-controls/">Custom 
      Controls</A></DIV>
      <DIV class=MI id=Section23><A 
      href="http://www.codeproject.com/KB/HTML/">HTML / CSS</A></DIV>
      <DIV class=MI id=Section22><A 
      href="http://www.codeproject.com/KB/IP/">Internet / Network</A></DIV>
      <DIV class=MI id=Section24><A 
      href="http://www.codeproject.com/KB/ISAPI/">ISAPI</A></DIV>
      <DIV class=MI id=Section33><A 
      href="http://www.codeproject.com/KB/server-management/">Site &amp; Server 
      Management</A></DIV>
      <DIV class=MI id=Section34><A 
      href="http://www.codeproject.com/KB/session/">Session State</A></DIV>
      <DIV class=MI id=Section113><A 
      href="http://www.codeproject.com/KB/silverlight/">Silverlight</A></DIV>
      <DIV class=MI id=Section36><A 
      href="http://www.codeproject.com/KB/trace/">Trace and Logs</A></DIV>
      <DIV class=MI id=Section31><A 
      href="http://www.codeproject.com/KB/user-controls/">User 
Controls</A></DIV>
      <DIV class=MI id=Section37><A 
      href="http://www.codeproject.com/KB/validation/">Validation</A></DIV>
      <DIV class=MI id=Section35><A 
      href="http://www.codeproject.com/KB/viewstate/">View State</A></DIV>
      <DIV class=MI id=Section26><A 
      href="http://www.codeproject.com/KB/WAP/">WAP / WML</A></DIV>
      <DIV class=MI id=Section32><A 
      href="http://www.codeproject.com/KB/web-security/">Web Security</A></DIV>
      <DIV class=MI id=Section20><A 
      href="http://www.codeproject.com/KB/webservices/">Web 
      Services</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter9');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=9">Enterprise 
      Systems</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter9 style="DISPLAY: none">
      <DIV class=MI id=Section98><A 
      href="http://www.codeproject.com/KB/MCMS/">Content Management 
      Server</A></DIV>
      <DIV class=MI id=Section99><A 
      href="http://www.codeproject.com/KB/biztalk/">Microsoft BizTalk 
      Server</A></DIV>
      <DIV class=MI id=Section102><A 
      href="http://www.codeproject.com/KB/exchange/">Microsoft 
Exchange</A></DIV>
      <DIV class=MI id=Section90><A 
      href="http://www.codeproject.com/KB/office/">Office Development</A></DIV>
      <DIV class=MI id=Section101><A 
      href="http://www.codeproject.com/KB/sharepoint/">SharePoint 
      Server</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter3');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=3">Multimedia</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter3 style="DISPLAY: none">
      <DIV class=MI id=Section42><A 
      href="http://www.codeproject.com/KB/audio-video/">Audio and 
Video</A></DIV>
      <DIV class=MI id=Section44><A 
      href="http://www.codeproject.com/KB/directx/">DirectX</A></DIV>
      <DIV class=MI id=Section46><A 
      href="http://www.codeproject.com/KB/GDI/">GDI</A></DIV>
      <DIV class=MI id=Section47><A 
      href="http://www.codeproject.com/KB/GDI-plus/">GDI+</A></DIV>
      <DIV class=MI id=Section43><A 
      href="http://www.codeproject.com/KB/graphics/">General Graphics</A></DIV>
      <DIV class=MI id=Section45><A 
      href="http://www.codeproject.com/KB/openGL/">OpenGL</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter4');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=4">Database</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter4 style="DISPLAY: none">
      <DIV class=MI id=Section66><A 
      href="http://www.codeproject.com/KB/database/">Database</A></DIV>
      <DIV class=MI id=Section100><A 
      href="http://www.codeproject.com/KB/reporting-services/">SQL Reporting 
      Services</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter8');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=8">Platforms, 
      Frameworks &amp; Libraries</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter8 style="DISPLAY: none">
      <DIV class=MI id=Section83><A 
      href="http://www.codeproject.com/KB/atl/">ATL</A></DIV>
      <DIV class=MI id=Section117><A 
      href="http://www.codeproject.com/KB/MFC/">MFC</A></DIV>
      <DIV class=MI id=Section88><A 
      href="http://www.codeproject.com/KB/stl/">STL</A></DIV>
      <DIV class=MI id=Section84><A 
      href="http://www.codeproject.com/KB/wtl/">WTL</A></DIV>
      <DIV class=MI id=Section49><A 
      href="http://www.codeproject.com/KB/COM/">COM / COM+</A></DIV>
      <DIV class=MI id=Section76><A 
      href="http://www.codeproject.com/KB/dotnet/">.NET Framework</A></DIV>
      <DIV class=MI id=Section92><A 
      href="http://www.codeproject.com/KB/winsdk/">Win32/64 SDK &amp; 
      OS</A></DIV>
      <DIV class=MI id=Section108><A 
      href="http://www.codeproject.com/KB/vista/">Vista API</A></DIV>
      <DIV class=MI id=Section110><A 
      href="http://www.codeproject.com/KB/vista-security/">Vista 
      Security</A></DIV>
      <DIV class=MI id=Section82><A 
      href="http://www.codeproject.com/KB/cross-platform/">Cross 
      Platform</A></DIV>
      <DIV class=MI id=Section69><A 
      href="http://www.codeproject.com/KB/game/">Game Development</A></DIV>
      <DIV class=MI id=Section73><A 
      href="http://www.codeproject.com/KB/mobile/">Mobile Development</A></DIV>
      <DIV class=MI id=Section106><A 
      href="http://www.codeproject.com/KB/WC/">Windows CardSpace</A></DIV>
      <DIV class=MI id=Section103><A 
      href="http://www.codeproject.com/KB/WCF/">Windows Communication 
      Foundation</A></DIV>
      <DIV class=MI id=Section104><A 
      href="http://www.codeproject.com/KB/WPF/">Windows Presentation 
      Foundation</A></DIV>
      <DIV class=MI id=Section105><A 
      href="http://www.codeproject.com/KB/WF/">Windows Workflow 
      Foundation</A></DIV>
      <DIV class=MI id=Section119><A 
      href="http://www.codeproject.com/KB/library/">Libraries</A></DIV>
      <DIV class=MI id=Section122><A 
      href="http://www.codeproject.com/KB/powershell/">Windows 
      Powershell</A></DIV>
      <DIV class=MI id=Section123><A 
      href="http://www.codeproject.com/KB/linq/">LINQ</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter5');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=5">Languages</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter5 style="DISPLAY: none">
      <DIV class=MI id=Section71><A href="http://www.codeproject.com/KB/cpp/">C 
      / C++ Language</A></DIV>
      <DIV class=MI id=Section72><A 
      href="http://www.codeproject.com/KB/mcpp/">C++ / CLI</A></DIV>
      <DIV class=MI id=Section93><A 
      href="http://www.codeproject.com/KB/cs/">C#</A></DIV>
      <DIV class=MI id=Section78><A 
      href="http://www.codeproject.com/KB/msil/">MSIL</A></DIV>
      <DIV class=MI id=Section86><A 
      href="http://www.codeproject.com/KB/vbscript/">VBScript</A></DIV>
      <DIV class=MI id=Section87><A 
      href="http://www.codeproject.com/KB/vb/">VB.NET</A></DIV>
      <DIV class=MI id=Section115><A 
      href="http://www.codeproject.com/KB/vb-interop/">VB6 Interop</A></DIV>
      <DIV class=MI id=Section77><A 
      href="http://www.codeproject.com/KB/net-languages/">Other .NET 
      Languages</A></DIV>
      <DIV class=MI id=Section21><A 
      href="http://www.codeproject.com/KB/XML/">XML</A></DIV>
      <DIV class=MI id=Section96><A 
      href="http://www.codeproject.com/KB/java/">Java</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter6');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=6">General 
      Programming</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter6>
      <DIV class=MI id=Section57><A 
      href="http://www.codeproject.com/KB/recipes/">Algorithms &amp; 
      Recipes</A></DIV>
      <DIV class=MI id=Section64><A 
      href="http://www.codeproject.com/KB/bugs/">Bugs &amp; 
Workarounds</A></DIV>
      <DIV class=MI id=Section79><A 
      href="http://www.codeproject.com/KB/collections/">Collections</A></DIV>
      <DIV class=MI id=Section56><A 
      href="http://www.codeproject.com/KB/security/">Cryptography &amp; 
      Security</A></DIV>
      <DIV class=MI id=Section50><A 
      href="http://www.codeproject.com/KB/datetime/">Date and Time</A></DIV>
      <DIV class=MI id=Section52><A 
      href="http://www.codeproject.com/KB/DLL/">DLLs &amp; Assemblies</A></DIV>
      <DIV class=MI id=Section80><A 
      href="http://www.codeproject.com/KB/exception/">Exception 
      Handling</A></DIV>
      <DIV class=MI id=Section81><A 
      href="http://www.codeproject.com/KB/locale/">Localisation</A></DIV>
      <DIV class=MI id=Section53><A 
      href="http://www.codeproject.com/KB/macros/">Macros and Add-ins</A></DIV>
      <DIV class=MI id=Section54><A 
      href="http://www.codeproject.com/KB/tips/">Programming Tips</A></DIV>
      <DIV class=MI id=Section55><A 
      href="http://www.codeproject.com/KB/string/">String handling</A></DIV>
      <DIV class=MIS id=Section58><A 
      href="http://www.codeproject.com/KB/threads/">Threads, Processes &amp; 
      IPC</A></DIV>
      <DIV class=MI id=Section59><A 
      href="http://www.codeproject.com/KB/winhelp/">WinHelp / 
      HTMLHelp</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter10');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=10">Graphics 
      / Design</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter10 style="DISPLAY: none">
      <DIV class=MI id=Section40><A 
      href="http://www.codeproject.com/KB/expression/">Expression</A></DIV>
      <DIV class=MI id=Section114><A 
      href="http://www.codeproject.com/KB/usability/">Usability</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter11');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=11">Development 
      Lifecycle</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter11 style="DISPLAY: none">
      <DIV class=MI id=Section51><A 
      href="http://www.codeproject.com/KB/debug/">Debug Tips</A></DIV>
      <DIV class=MI id=Section39><A 
      href="http://www.codeproject.com/KB/architecture/">Design and 
      Architecture</A></DIV>
      <DIV class=MI id=Section112><A 
      href="http://www.codeproject.com/KB/install/">Installation</A></DIV>
      <DIV class=MI id=Section41><A 
      href="http://www.codeproject.com/KB/work/">Work Issues</A></DIV></DIV>
      <DIV class=MenuChapter><A onclick="return ToggleMenu('Chapter7');" 
      href="http://www.codeproject.com/script/Content/Chapter.aspx?chptId=7">General 
      Reading</A></DIV>
      <DIV class=MenuSectionBlock id=Chapter7 style="DISPLAY: none">
      <DIV class=MI id=Section60><A 
      href="http://www.codeproject.com/KB/books/">Book Chapters</A></DIV>
      <DIV class=MI id=Section61><A 
      href="http://www.codeproject.com/KB/book-reviews/">Book Reviews</A></DIV>
      <DIV class=MI id=Section109><A 
      href="http://www.codeproject.com/KB/hardware-review/">Hardware 
      Reviews</A></DIV>
      <DIV class=MI id=Section63><A 
      href="http://www.codeproject.com/KB/interviews/">Interviews</A></DIV>
      <DIV class=MI id=Section65><A 
      href="http://www.codeproject.com/KB/showcase/">Product Showcase</A></DIV>
      <DIV class=MI id=Section62><A 
      href="http://www.codeproject.com/KB/scrapbook/">Scrapbook</A></DIV></DIV></DIV><BR>
      <DIV class=MenuCat>Feature Zones</DIV>
      <DIV class=MenuChapter><A 
      href="http://www.codeproject.com/kb/showcase/">Product Showcase</A></DIV>
      <DIV class=MenuChapter><A 
      href="http://www.codeproject.com/Zones/Install">Installshield 
      2008</A></DIV>
      <DIV class=MenuChapter><A href="http://www.codeproject.com/Zones/IBM">IBM 
      DeveloperWorks</A></DIV><BR><IFRAME 
      src="CodeProject Monitoring desktop windows from a windows service_ Free source code and programming help_files/ServeHTML.htm" 
      frameBorder=0 width=160 scrolling=no height=600></IFRAME><IMG height=1 
      alt="" src="/script/Common/Images/t.gif" width=160> </TD>
    <TD class=ArticlePane vAlign=top>
      <TABLE class=SearchHeaderBar cellSpacing=0 width="100%">
        <TBODY>
        <TR>
          <TD style="WIDTH: 60%; WHITE-SPACE: nowrap" vAlign=center 
            align=right><FORM style="MARGIN: 0px" name=Search 
            action=/info/search.aspx method=get><B>Search &nbsp;</B> <INPUT 
            class=SmallText style="WIDTH: 200px" name=artkw> <SELECT 
            class=SmallText style="FONT-WEIGHT: bold" name=sbo> <OPTION 
              value=kw selected>Articles</OPTION> <OPTION 
              value=fm>Messages</OPTION></SELECT> <INPUT class=SmallText style="FONT-WEIGHT: bold" type=submit value=" Go! "> 
            &nbsp; </FORM></TD>
          <TD class=TinyText style="WHITE-SPACE: nowrap"><A 
            href="http://www.codeproject.com/info/search.aspx">Advanced 
            Search</A><BR><A 
            href="http://www.codeproject.com/script/Content/SiteMap.aspx">Sitemap</A> 
            | <A id=ctl00_SearchBarCtrl_AddToIESearchLnk 
            title="Add The Code Project to your IE search Providers" 
            onclick="window.external.AddSearchProvider('http://www.codeproject.com/info/OpenSearch.xml');return false;" 
            href="http://www.codeproject.com/">Add to IE Search</A> 
        </TD></TR></TBODY></TABLE><SPAN id=ctl00_ResultMessage></SPAN>
      <DIV id=ctl00_ArtDiv>
      <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
        <TBODY>
        <TR vAlign=top>
          <TD vAlign=top>
            <TABLE>
              <TBODY></TBODY></TABLE>
            <TABLE cellSpacing=1 cellPadding=3 width=1 border=0>
              <TBODY>
              <TR class=smalltext vAlign=center>
                <TD style="WHITE-SPACE: nowrap"><IMG 
                  style="BORDER-RIGHT: 0px; BORDER-TOP: 0px; VERTICAL-ALIGN: middle; BORDER-LEFT: 0px; BORDER-BOTTOM: 0px" 
                  height=16 alt=print src="/script/Articles/Images/print.gif" 
                  width=16> <A id=ctl00_ArticleHeaderLinks_PrintLnk 
                  href="http://www.codeproject.com/KB/threads/ScreenMonitor.aspx?display=Print">Print</A> 
                </TD>
                <TD style="WHITE-SPACE: nowrap"><IMG 
                  style="BORDER-RIGHT: 0px; BORDER-TOP: 0px; VERTICAL-ALIGN: middle; BORDER-LEFT: 0px; BORDER-BOTTOM: 0px" 
                  height=16 alt="Broken Article?" 
                  src="/script/Articles/Images/broken.gif" width=16> <A 
                  id=ctl00_ArticleHeaderLinks_BrokenLnk 
                  href="http://www.codeproject.com/script/Articles/Report.aspx?aid=21492">Broken 
                  Article?</A> </TD>
                <TD style="WHITE-SPACE: nowrap"><IMG 
                  id=ctl00_ArticleHeaderLinks_ArticleBmk_BookmarkImg 
                  title="Add to bookmarks" 
                  style="BORDER-RIGHT: 0px; BORDER-TOP: 0px; VERTICAL-ALIGN: middle; BORDER-LEFT: 0px; WIDTH: 16px; BORDER-BOTTOM: 0px; HEIGHT: 16px" 
                  src="/script/Bookmarks/Images/link.png"> <A 
                  id=ctl00_ArticleHeaderLinks_ArticleBmk_BookmarkLnk 
                  href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=21492&amp;obtid=2">Add 
                  Bookmark</A> <SPAN 
                  id=ctl00_ArticleHeaderLinks_ArticleBmk_Message></SPAN></TD>
                <TD style="WHITE-SPACE: nowrap"><IMG 
                  style="BORDER-RIGHT: 0px; BORDER-TOP: 0px; VERTICAL-ALIGN: middle; BORDER-LEFT: 0px; BORDER-BOTTOM: 0px" 
                  height=16 alt=Discuss src="/script/Content/Images/discuss.gif" 
                  width=15> <A 
                  href="http://www.codeproject.com/KB/threads/ScreenMonitor.aspx#_comments">Discuss</A> 
                </TD>
                <TD style="WHITE-SPACE: nowrap"><IMG 
                  style="BORDER-RIGHT: 0px; BORDER-TOP: 0px; VERTICAL-ALIGN: middle; BORDER-LEFT: 0px; BORDER-BOTTOM: 0px" 
                  height=16 alt="Recommend Article" 
                  src="/script/Content/Images/mail.gif" width=16> <A 
                  id=ctl00_ArticleHeaderLinks_Recommend 
                  href="http://www.codeproject.com/script/common/TellFriend.aspx?obtid=2&amp;obid=21492">Send 
                  to a friend</A> </TD></TR></TBODY></TABLE></TD>
          <TD align=right>
            <TABLE>
              <TBODY>
              <TR>
                <TD class=SmallText style="WHITE-SPACE: nowrap" 
                  align=right><SPAN id=ctl00_ArticleRating_VoteLabel>9 votes for 
                  this Article.</SPAN> </TD>
                <TD>
                  <TABLE cellSpacing=0 cellPadding=0 border=1>
                    <TBODY>
                    <TR>
                      <TD width=20 bgColor=white height=5><IMG height=5 
                        src="/script/Ratings/Images/red.gif" width=20 
                      border=0></TD>
                      <TD width=20 bgColor=white height=5><IMG height=5 
                        src="/script/Ratings/Images/red.gif" width=20 
                      border=0></TD>
                      <TD width=20 bgColor=white height=5><IMG height=5 
                        src="/script/Ratings/Images/red.gif" width=20 
                      border=0></TD>
                      <TD width=20 bgColor=white height=5><IMG height=5 
                        src="/script/Ratings/Images/red.gif" width=20 
                      border=0></TD>
                      <TD noWrap width=20 bgColor=white height=5><IMG height=5 
                        src="/script/Ratings/Images/red.gif" width=12 
                      border=0></TD></TR></TBODY></TABLE></TD></TR>
              <TR id=ctl00_ArticleRating_PopularityRow>
                <TD class=SmallText align=right colSpan=2><A 
                  id=ctl00_ArticleRating_PopularityLnk 
                  title="Calculated as rating x Log10(# votes)" 
                  href="http://www.codeproject.com/script/Articles/TopArticles.aspx?ta_so=1">Popularity: 
                  4.39</A><SPAN id=ctl00_ArticleRating_PopularityLbl></SPAN> 
                  Rating: <B>4.60</B> out of 5 
      </TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
      <DIV class=SmallText id=ctl00_UneditedRow 
      style="PADDING-RIGHT: 5px; BORDER-TOP: #ff9900 1px dashed; PADDING-LEFT: 5px; PADDING-BOTTOM: 5px; MARGIN: 5px; PADDING-TOP: 5px; BORDER-BOTTOM: #ff9900 1px dashed"><B>Note:</B> 
      This is an unedited contribution. If this article is inappropriate, needs 
      attention or copies someone else's work without reference then please <A 
      id=ctl00_ReportProblem 
      href="http://www.codeproject.com/script/Articles/Report.aspx?aid=21492">Report 
      This Article</A> </DIV>
      <UL class=Callout id=ctl00_confirmError style="MARGIN-RIGHT: 20px">
        <LI class=SmallText 
        style="LIST-STYLE-IMAGE: url(/images/warning.gif)">You are signed up for 
        one or more <A id=ctl00_SubscribeLink2 
        href="http://www.codeproject.com/script/Membership/Subscribe.aspx?rp=%2fKB%2fthreads%2fScreenMonitor.aspx">newsletters</A> 
        but your email address is either unconfirmed, or has not been 
        reconfirmed in a long time. Please click <A id=ctl00_RequestConfirmLink2 
        href="http://www.codeproject.com/script/Membership/SendConfirmRequest.aspx?rp=%2fKB%2fthreads%2fScreenMonitor.aspx">here</A> 
        to have an email sent that will allow us to confirm your email address 
        and start sending you newsletters again.</LI></UL><SPAN id=intelliTXT>
      <DIV id=contentdiv><!-- Main Page Contents Start --><!-- Article Starts -->
      <UL class=download>
        <LI><A 
        href="http://www.codeproject.com/KB/threads/ScreenMonitor/ScreenMonitor_src.zip">Download 
        ScreenMonitor_src.zip - 105.9 KB</A> 
        <LI><A 
        href="http://www.codeproject.com/KB/threads/ScreenMonitor/SetupMonitor_msi.zip">Download 
        SetupMonitor_msi.zip - 251.9 KB</A> </LI></UL><IMG height=244 
      alt="Screenshot - history.png" src="ScreenMonitor/history.png" width=484> 
      <H2>Introduction</H2>
      <P>Sometime you might monitor the desktop of a computer without being 
      looking<BR>at it all the time. It could be that you are monitoring some 
      child online<BR>surfing or just checking on some status of a running 
      application that does not<BR>have a good log. If you are not interested in 
      the internals of how this<BR>application works, you can just install the 
      msi provided and skip to 'Using the Application'. <BR>If you are 
      interested about the internals of taking window snapshots from 
      a<BR>service you have to look at the code and see the tricks to make this 
      happen.<BR>There are three assemblies for this article: a windows service, 
      a UI viewer/manager<BR>and a shared library that does the real capture. 
      You have to register the windows<BR>service yourself by running 
      installserv.bat if you choose to build it from source code. </P>
      <H2>Background</H2>
      <P>In one of my previous articles I was <A 
      href="http://www.codeproject.com/cs/system/snapshot.asp">capturing windows 
      into image files. </A><BR>One of the drawbacks was the fact that it had to 
      pop the specific window to capture it. <BR>Later I found that it is 
      possible to capture a window without bringing it to<BR>the foreground, and 
      <A 
      href="http://www.codeproject.com/KB/threads/CapturingMinimizedWindow.asp">even 
      to hide it when restoring from an Icon</A>.<BR>You might loose some 
      details on certain controls like the checked list box, but that's<BR>a 
      small price to pay. </P>
      <H2>Enabling a window service to interact with the desktop</H2>
      <P>Since a windows service is usually UI-less, you have to allow it to 
      interact with the desktop.<BR>You can do this manually in the services 
      console, <A 
      href="http://www.codeproject.com/install/cswindowsservicedesktop.asp">in 
      the registry </A>and risk not<BR>synching with the service controller, or 
      better yet using WMI in the AfterInstall<BR>event like below. </P><PRE><SPAN class=code-keyword>private</SPAN> <SPAN class=code-keyword>void</SPAN> ServiceMonitorInstaller_AfterInstall(<SPAN class=code-SDKkeyword>object</SPAN> sender, InstallEventArgs e)
{
    ManagementObject wmiService = null;
    ManagementBaseObject InParam = null;
    <SPAN class=code-keyword>try</SPAN>
    {
        wmiService = <SPAN class=code-keyword>new</SPAN> ManagementObject(<SPAN class=code-SDKkeyword>string</SPAN>.Format(<SPAN class=code-string>"</SPAN><SPAN class=code-string>Win32_Service.Name='{0}'"</SPAN>, ServiceMonitorInstaller.ServiceName));
        InParam = wmiService.GetMethodParameters(<SPAN class=code-string>"</SPAN><SPAN class=code-string>Change"</SPAN>);
        InParam[<SPAN class=code-string>"</SPAN><SPAN class=code-string>DesktopInteract"</SPAN>] = <SPAN class=code-keyword>true</SPAN>;
        wmiService.InvokeMethod(<SPAN class=code-string>"</SPAN><SPAN class=code-string>Change"</SPAN>, InParam, null);
    }
    <SPAN class=code-keyword>finally</SPAN>
    {
        <SPAN class=code-keyword>if</SPAN> (InParam != null)
            InParam.Dispose();
        <SPAN class=code-keyword>if</SPAN> (wmiService != null)
            wmiService.Dispose();
    }
}</PRE>
      <P>Sometimes using the system account to allow desktop interaction is not 
      possible and you might<BR>have to allow it programmatically by 
      impersonating the interactive user. </P>
      <H2>Another way to interact with the desktop</H2>
      <P>To allow a convenient way of using the default desktop I've created the 
      ImpersonateInteractiveUser<BR>class that uses it's constructor and Dispose 
      method to switch the UI context and optionally the <BR>windows 
      impersonation.The windows impersonation is just an extra that you can use 
      setting the<BR>bimpersonate parameter to true and the curent user security 
      token is retrieved from an existing<BR>UI process like explorer.The code 
      to achieve this is presented below, but you might want to check<BR>the 
      entire class, since the code is quite complex. </P><PRE><SPAN class=code-comment>//</SPAN><SPAN class=code-comment>.ctor</SPAN>
<SPAN class=code-keyword>public</SPAN> ImpersonateInteractiveUser(Process proc, <SPAN class=code-keyword>bool</SPAN> bimpersonate)
{
    _bimpersonate = bimpersonate;
    ImpersonateUsingProcess(proc);
}

<SPAN class=code-keyword>private</SPAN> <SPAN class=code-keyword>void</SPAN> ImpersonateUsingProcess(Process proc)
{
    <SPAN class=code-SDKkeyword>IntPtr</SPAN> hToken = <SPAN class=code-SDKkeyword>IntPtr</SPAN>.Zero;
    Win32API.RevertToSelf();
    <SPAN class=code-keyword>if</SPAN> (Win32API.OpenProcessToken(proc.Handle, TokenPrivilege.TOKEN_ALL_ACCESS, <SPAN class=code-keyword>ref</SPAN> hToken) != <SPAN class=code-digit>0</SPAN>)
    {
        <SPAN class=code-keyword>try</SPAN>
        {
            SECURITY_ATTRIBUTES sa = <SPAN class=code-keyword>new</SPAN> SECURITY_ATTRIBUTES();
            sa.Length = Marshal.SizeOf(sa);
            <SPAN class=code-keyword>bool</SPAN> result = Win32API.DuplicateTokenEx(hToken, Win32API.GENERIC_ALL_ACCESS, <SPAN class=code-keyword>ref</SPAN> sa,
            (<SPAN class=code-keyword>int</SPAN>)SECURITY_IMPERSONATION_LEVEL.SecurityIdentification, (<SPAN class=code-keyword>int</SPAN>)TOKEN_TYPE.TokenPrimary, <SPAN class=code-keyword>ref</SPAN> _userTokenHandle);
            <SPAN class=code-keyword>if</SPAN> (<SPAN class=code-SDKkeyword>IntPtr</SPAN>.Zero == _userTokenHandle)
            {

                Win32Exception ex = <SPAN class=code-keyword>new</SPAN> Win32Exception(Marshal.GetLastWin32Error());
                <SPAN class=code-keyword>throw</SPAN> <SPAN class=code-keyword>new</SPAN> ApplicationException(<SPAN class=code-SDKkeyword>string</SPAN>.Format(<SPAN class=code-string>"</SPAN><SPAN class=code-string>Can't duplicate the token for {0}:\n{1}"</SPAN>, proc.ProcessName, ex.Message), ex);
            }

            <SPAN class=code-keyword>if</SPAN> (!ImpersonateDesktop())
            {
                Win32Exception ex = <SPAN class=code-keyword>new</SPAN> Win32Exception(Marshal.GetLastWin32Error());
                <SPAN class=code-keyword>throw</SPAN> <SPAN class=code-keyword>new</SPAN> ApplicationException(ex.Message, ex);
            }
        }
        <SPAN class=code-keyword>finally</SPAN>
        {
            Win32API.CloseHandle(hToken);
        }
    }
    <SPAN class=code-keyword>else</SPAN>
    {
        <SPAN class=code-SDKkeyword>string</SPAN> s = <SPAN class=code-SDKkeyword>String</SPAN>.Format(<SPAN class=code-string>"</SPAN><SPAN class=code-string>OpenProcess Failed {0}, privilege not held"</SPAN>, Marshal.GetLastWin32Error());
        <SPAN class=code-keyword>throw</SPAN> <SPAN class=code-keyword>new</SPAN> Exception(s);
    }
}

<SPAN class=code-keyword>bool</SPAN> ImpersonateDesktop()
{
    _hSaveWinSta = Win32API.GetProcessWindowStation();
    <SPAN class=code-keyword>if</SPAN> (_hSaveWinSta == <SPAN class=code-SDKkeyword>IntPtr</SPAN>.Zero)
        <SPAN class=code-keyword>return</SPAN> <SPAN class=code-keyword>false</SPAN>;
    _hSaveDesktop = Win32API.GetThreadDesktop(Win32API.GetCurrentThreadId());
    <SPAN class=code-keyword>if</SPAN> (_hSaveDesktop == <SPAN class=code-SDKkeyword>IntPtr</SPAN>.Zero)
        <SPAN class=code-keyword>return</SPAN> <SPAN class=code-keyword>false</SPAN>;
    <SPAN class=code-keyword>if</SPAN> (_bimpersonate)
    {
        WindowsIdentity newId = <SPAN class=code-keyword>new</SPAN> WindowsIdentity(_userTokenHandle);
        _impersonatedUser = newId.Impersonate();
    }
    _hWinSta = Win32API.OpenWindowStation(<SPAN class=code-string>"</SPAN><SPAN class=code-string>WinSta0"</SPAN>, <SPAN class=code-keyword>false</SPAN>, Win32API.MAXIMUM_ALLOWED);
    <SPAN class=code-keyword>if</SPAN> (_hWinSta == <SPAN class=code-SDKkeyword>IntPtr</SPAN>.Zero)
        <SPAN class=code-keyword>return</SPAN> <SPAN class=code-keyword>false</SPAN>;
    <SPAN class=code-keyword>if</SPAN> (!Win32API.SetProcessWindowStation(_hWinSta))
        <SPAN class=code-keyword>return</SPAN> <SPAN class=code-keyword>false</SPAN>;
    _hDesktop = Win32API.OpenDesktop(<SPAN class=code-string>"</SPAN><SPAN class=code-string>Default"</SPAN>, <SPAN class=code-digit>0</SPAN>, <SPAN class=code-keyword>true</SPAN>, Win32API.MAXIMUM_ALLOWED);
    <SPAN class=code-keyword>if</SPAN> (_hDesktop == <SPAN class=code-SDKkeyword>IntPtr</SPAN>.Zero)
    {
        Win32API.SetProcessWindowStation(_hSaveWinSta);
        Win32API.CloseWindowStation(_hWinSta);
        <SPAN class=code-keyword>return</SPAN> <SPAN class=code-keyword>false</SPAN>;
    }
    <SPAN class=code-keyword>if</SPAN> (!Win32API.SetThreadDesktop(_hDesktop))
        <SPAN class=code-keyword>return</SPAN> <SPAN class=code-keyword>false</SPAN>;
    <SPAN class=code-keyword>return</SPAN> <SPAN class=code-keyword>true</SPAN>;
}</PRE>
      <P>Unfortunately, sometimes certain UI APIs like 
      <CODE>SetWindowLong</CODE> won't work when run from<BR>a service, but they 
      are fine when run from a regular user process. I don't know if this 
      is<BR>a Windows bug or some "by design" feature, but the methods described 
      above<BR>won't help. To get around this limitation, I had to make sure 
      that they get called only from a<BR>process that's spawn by the service 
      when necessary, that is when you need to pop an<BR>iconic window and made 
      it transparent, so the user won't notice the flash.</P>
      <H2>Running a service like a regular process</H2>
      <P>When spawning the user process I use the same assembly as the service, 
      but with some<BR>window handles as parameters. The args.Length actually 
      determines if it's running as a service<BR>or as a regular process. You 
      can notice the use of the <CODE>ImpersonateInteractiveUser</CODE><BR>class 
      in a using statement.</P><PRE><SPAN class=code-keyword>static</SPAN> <SPAN class=code-keyword>void</SPAN> Main(<SPAN class=code-SDKkeyword>string</SPAN>[] args)
{
    <SPAN class=code-keyword>if</SPAN> (args.Length <SPAN class=code-keyword>&gt;</SPAN> <SPAN class=code-digit>0</SPAN>)
    {
        WndList lst = <SPAN class=code-keyword>new</SPAN> WndList(args.Length);
        foreach (<SPAN class=code-SDKkeyword>string</SPAN> txt <SPAN class=code-keyword>in</SPAN> args)
        {
            lst.Add(<SPAN class=code-keyword>new</SPAN> <SPAN class=code-SDKkeyword>IntPtr</SPAN>(Convert.ToInt32(txt)));
        }
        <SPAN class=code-keyword>try</SPAN>
        {
            <SPAN class=code-SDKkeyword>string</SPAN> folder = System.IO.Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location);
            ScreenMonitorLib.SnapShot snp = <SPAN class=code-keyword>new</SPAN> ScreenMonitorLib.SnapShot(folder, ScreenMonitor._interval);
            Process proc = Process.GetProcessesByName(<SPAN class=code-string>"</SPAN><SPAN class=code-string>explorer"</SPAN>)[<SPAN class=code-digit>0</SPAN>];
            <SPAN class=code-keyword>using</SPAN> (ImpersonateInteractiveUser imptst = <SPAN class=code-keyword>new</SPAN> ImpersonateInteractiveUser(proc, <SPAN class=code-keyword>false</SPAN>))
            {
                snp.SaveSnapShots(lst);
            }
        }
        <SPAN class=code-keyword>catch</SPAN> (Exception ex)
        {

            EventLog.WriteEntry(<SPAN class=code-string>"</SPAN><SPAN class=code-string>Screen Monitor"</SPAN>, <SPAN class=code-SDKkeyword>string</SPAN>.Format(<SPAN class=code-string>"</SPAN><SPAN class=code-string>exception in user proc:{0}\n at {1}"</SPAN> , ex.Message,ex.StackTrace), EventLogEntryType.Error, <SPAN class=code-digit>1</SPAN>, <SPAN class=code-digit>1</SPAN>);
        }
        <SPAN class=code-keyword>return</SPAN>;
    }
    <SPAN class=code-keyword>else</SPAN>
    {
        ScreenMonitor sm = <SPAN class=code-keyword>new</SPAN> ScreenMonitor();
        ServiceBase[] ServicesToRun;
        ServicesToRun = <SPAN class=code-keyword>new</SPAN> ServiceBase[] { sm };
        ServiceBase.Run(ServicesToRun);
    }
}
</PRE>
      <H2>Storing a hash from an image file</H2>
      <P>Since the saving of the window capture <A 
      href="http://www.codeproject.com/cs/system/snapshot.asp">is described in 
      my previous article</A>,<BR>I had to find a way to index the image files. 
      I took advantage of the MD5CryptoServiceProvider<BR>that provides a 16 
      byte array that can end up in a Guid that's stored in a data set. </P><PRE><SPAN class=code-keyword>private</SPAN> <SPAN class=code-keyword>void</SPAN> PersistCapture(<SPAN class=code-SDKkeyword>IntPtr</SPAN> hWnd, Bitmap bitmap, <SPAN class=code-keyword>bool</SPAN> isIconic, SnapShotDS.WndSettingsRow rowSettings)
{
    <SPAN class=code-keyword>using</SPAN> (MemoryStream ms = <SPAN class=code-keyword>new</SPAN> MemoryStream())
    {
        bitmap.Save(ms, ImageFormat.Jpeg);
        MD5 md5 = <SPAN class=code-keyword>new</SPAN> MD5CryptoServiceProvider();
        md5.Initialize();
        ms.Position = <SPAN class=code-digit>0</SPAN>;
        <SPAN class=code-SDKkeyword>byte</SPAN>[] result = md5.ComputeHash(ms);
        Guid guid = <SPAN class=code-keyword>new</SPAN> Guid(result);
        <SPAN class=code-keyword>int</SPAN> len = _tblSnapShots.Select(<SPAN class=code-SDKkeyword>string</SPAN>.Format(<SPAN class=code-string>"</SPAN><SPAN class=code-string>{0} = '{1}'"</SPAN>,     _tblSnapShots.FileNameColumn.ColumnName, guid.ToString())).Length;
        <SPAN class=code-SDKkeyword>string</SPAN> path = System.IO.Path.Combine(_folder, guid.ToString() + <SPAN class=code-string>"</SPAN><SPAN class=code-string>.jpg"</SPAN>);
        <SPAN class=code-keyword>if</SPAN> (len == <SPAN class=code-digit>0</SPAN> || !File.Exists(path))
        {
            <SPAN class=code-keyword>using</SPAN> (FileStream fs = File.OpenWrite(path))
            {
                ms.WriteTo(fs);
            }
        }
<SPAN class=code-comment>//</SPAN><SPAN class=code-comment> code ommited for brevity…..</SPAN>



}
</PRE>
      <H2>Managing service events</H2>
      <P>In order to manage the events from OnSessionChange and OnStop I added 
      two<BR>Windows events: _terminate to check for stopping the service and 
      create a<BR>timeout interval, and _desktopUnLocked to handle session 
      changes as shown below.</P><PRE> 
<SPAN class=code-keyword>try</SPAN>
{
    StartNewDesktopSession();
    <SPAN class=code-SDKkeyword>string</SPAN> folder = System.IO.Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location) + <SPAN class=code-string>"</SPAN><SPAN class=code-string>\\";
    ScreenMonitorLib.SnapShot snp = new ScreenMonitorLib.SnapShot(folder, _interval, this.ServiceHandle);
    bool bexit = false;
    do
    {
        bexit = _terminate.WaitOne(_interval, false);
        _desktopUnLocked.WaitOne();
        if(_blocked)
        {
            _blocked = false;
            continue;
        }
        WndList lst = snp.GetDesktopWindows(_imptst.HDesktop);
        snp.SaveAllSnapShots(lst);
    }
    while (!bexit);
}
catch (ApplicationException ex)
{
    EventLog.WriteEntry("</SPAN>Screen Monitor<SPAN class=code-string>"</SPAN><SPAN class=code-string>, string.Format("</SPAN>ApplicationException: {<SPAN class=code-digit>0</SPAN>}\n at {<SPAN class=code-digit>1</SPAN>}<SPAN class=code-string>"</SPAN><SPAN class=code-string>, ex.Message, ex.InnerException.TargetSite), EventLogEntryType.Error, 1, 1);
}
catch (Exception ex)
{
    EventLog.WriteEntry("</SPAN>Screen Monitor<SPAN class=code-string>"</SPAN><SPAN class=code-string>, string.Format("</SPAN>exception <SPAN class=code-keyword>in</SPAN> <SPAN class=code-keyword>thread</SPAN> at: {<SPAN class=code-digit>0</SPAN>}:{<SPAN class=code-digit>1</SPAN>}<SPAN class=code-string>"</SPAN><SPAN class=code-string>, ex.TargetSite.Name, ex.Message), EventLogEntryType.Error, 1, 1);
}
finally
{
    if (_imptst != null)
        _imptst.Dispose();
}
</SPAN></PRE>
      <H2>Setting the service Start mode and other parameters</H2>
      <P>The service persists the historic information stored in a table in 
      data.xml and<BR>also loads some settings from the settings.xml created by 
      the SnapShotmanager.exe. <BR>Another trick noteworthy is setting the 
      service start mode and starting it using WMI<BR>Like below: </P><PRE><SPAN class=code-comment>//</SPAN><SPAN class=code-comment>code omitted for brevity….</SPAN>



ManagementObject wmiService = null;
ManagementBaseObject InParam = null;
<SPAN class=code-keyword>try</SPAN>
{
    ConnectionOptions coOptions = <SPAN class=code-keyword>new</SPAN> ConnectionOptions();
    coOptions.Impersonation = ImpersonationLevel.Impersonate;
    ManagementScope mgmtScope = <SPAN class=code-keyword>new</SPAN> System.Management.ManagementScope(<SPAN class=code-string>@"</SPAN><SPAN class=code-string>root\CIMV2"</SPAN>, coOptions);
    mgmtScope.Connect();
    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Query WMI for additional information about this service.</SPAN>



    wmiService = <SPAN class=code-keyword>new</SPAN> ManagementObject(<SPAN class=code-string>"</SPAN><SPAN class=code-string>Win32_Service.Name='Screen Monitor'"</SPAN>);
    wmiService.Get();
    <SPAN class=code-SDKkeyword>object</SPAN> o = wmiService[<SPAN class=code-string>"</SPAN><SPAN class=code-string>StartMode"</SPAN>];<SPAN class=code-comment>//</SPAN><SPAN class=code-comment>"Auto" or "Disabled"</SPAN>



    InParam = wmiService.GetMethodParameters(<SPAN class=code-string>"</SPAN><SPAN class=code-string>ChangeStartMode"</SPAN>);
    <SPAN class=code-SDKkeyword>string</SPAN> start = _cbxStartupType.Text;
    InParam[<SPAN class=code-string>"</SPAN><SPAN class=code-string>StartMode"</SPAN>] = start;
    ManagementBaseObject outParams = wmiService.InvokeMethod(<SPAN class=code-string>"</SPAN><SPAN class=code-string>ChangeStartMode"</SPAN>, InParam, null);
      uint ret = (uint)(outParams.Properties[<SPAN class=code-string>"</SPAN><SPAN class=code-string>ReturnValue"</SPAN>].Value);
    <SPAN class=code-keyword>if</SPAN> (ret != <SPAN class=code-digit>0</SPAN>)
        MessageBox.Show(<SPAN class=code-keyword>this</SPAN>, <SPAN class=code-string>"</SPAN><SPAN class=code-string>Error"</SPAN>, <SPAN class=code-SDKkeyword>string</SPAN>.Format(<SPAN class=code-string>"</SPAN><SPAN class=code-string>Failed to set the Start mode, error code: {0}"</SPAN>, ret), MessageBoxButtons.OK, MessageBoxIcon.Warning);

    <SPAN class=code-comment>//</SPAN><SPAN class=code-comment>bad parent process</SPAN>



    <SPAN class=code-keyword>if</SPAN> (_ckStartService.Checked)
    {
        <SPAN class=code-comment>//</SPAN><SPAN class=code-comment> Start service</SPAN>



        outParams = wmiService.InvokeMethod(<SPAN class=code-string>"</SPAN><SPAN class=code-string>StartService"</SPAN>, null, null);
        ret = (uint)(outParams.Properties[<SPAN class=code-string>"</SPAN><SPAN class=code-string>ReturnValue"</SPAN>].Value);
        <SPAN class=code-keyword>if</SPAN> (ret != <SPAN class=code-digit>0</SPAN>)
            MessageBox.Show(<SPAN class=code-keyword>this</SPAN>, <SPAN class=code-string>"</SPAN><SPAN class=code-string>Error"</SPAN>, <SPAN class=code-SDKkeyword>string</SPAN>.Format(<SPAN class=code-string>"</SPAN><SPAN class=code-string>Failed to start the service with error code: {0}"</SPAN>, ret), MessageBoxButtons.OK, MessageBoxIcon.Warning);
    }
}
<SPAN class=code-keyword>catch</SPAN> (System.Management.ManagementException ex)
{
    MessageBox.Show(<SPAN class=code-keyword>this</SPAN>, <SPAN class=code-string>"</SPAN><SPAN class=code-string>The service might not be installed on this computer. or\n"</SPAN> + ex.Message, <SPAN class=code-string>"</SPAN><SPAN class=code-string>Error"</SPAN>, MessageBoxButtons.OK, MessageBoxIcon.Error);
}
<SPAN class=code-keyword>catch</SPAN> (Exception ex)
{
    MessageBox.Show(<SPAN class=code-keyword>this</SPAN>, ex.Message, <SPAN class=code-string>"</SPAN><SPAN class=code-string>Error"</SPAN>, MessageBoxButtons.OK, MessageBoxIcon.Error);
}
<SPAN class=code-keyword>finally</SPAN>
{
    <SPAN class=code-keyword>if</SPAN> (InParam != null)
        InParam.Dispose();
    <SPAN class=code-keyword>if</SPAN> (wmiService != null)
        wmiService.Dispose();
}
</PRE>
      <H2>Using the Application</H2><IMG height=198 
      alt="Screenshot - settings.png" src="ScreenMonitor/settings.png" 
      width=578> 
      <P>On the Set Up tab, you have to select the application(s) to track and 
      when to<BR>capture it. You can also specify the time interval between 
      captures and the service<BR>start type. The service can be started from 
      the services console or, more conveniently<BR>from the Snap Shot manager. 
      On the Viewer tab (see the top of this page) you can view<BR>and delete 
      the history and the associated image files.</P>
      <H2>History</H2>
      <P>This is version 1.0.0.0 and it has been tested on Windows XP. It 
      handles the<BR>Lock/Unlock desktop, LogOn/LogOff, but it does not work 
      with fast switch session feature.<BR>You might find some other cool things 
      in this application like data binding to a<BR>Combobox that's embedded in 
      a data grid cell, but this is out of the current topic.<BR>As somebody 
      pointed out you have to run under an administrator account to<BR>install 
      the service or the msi. Enjoy!<BR></P><!-- Article Ends --><!-- Main Page Contents End --></DIV></SPAN>
      <H2>License</H2>
      <P>This article, along with any associated source code and files, is 
      licensed under <A href="http://www.codeproject.com/info/cpol10.aspx">The 
      Code Project Open License (CPOL)</A></P>
      <H2>About the Author</H2>
      <TABLE cellSpacing=5 cellPadding=0 width="100%" border=0>
        <TBODY>
        <TR vAlign=top>
          <TD id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberPhotoTable 
          style="WIDTH: 155px" vAlign=top><B><A 
            id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberProfileLink 
            href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=634640">dmihailescu</A></B><BR><BR>
            <CENTER><IMG id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberPhoto 
            style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" 
            src="/script/Membership/ProfileImages/{871F48DB-8A31-43D6-B2CB-CEB201D278DC}.jpg"></CENTER><BR><SPAN 
            class=SmallText 
            id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberType></SPAN></TD>
          <TD>Decebal Mihailescu is a software engineer with interest in .Net, 
            C# and C++.<BR>
            <TABLE>
              <TBODY>
              <TR id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_jobTitleRow>
                <TD class=SmallText noWrap>Occupation: </TD>
                <TD width="100%"><SPAN class=SmallText 
                  id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberJobTitle>Web 
                  Developer</SPAN></TD></TR>
              <TR id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_locationRow>
                <TD class=SmallText>Location: </TD>
                <TD width="100%"><SPAN class=SmallText 
                  id=ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberLocation><IMG 
                  height=11 alt="United States" src="/script/Geo/Images/US.gif" 
                  width=16> United 
        States</SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><BR>
      <TABLE id=ctl00_PopularArticlesRow cellSpacing=0 cellPadding=0 
      width="100%" border=0>
        <TBODY>
        <TR vAlign=top>
          <TD style="WIDTH: 100%">
            <H2>Other popular Threads, Processes &amp; IPC articles:</H2>
            <UL>
              <LI><A 
              href="http://www.codeproject.com/KB/threads/winspy.aspx">Three 
              Ways to Inject Your Code into Another Process</A>
              <DIV class=SmallText>How to inject code into another processes 
              address space, and then execute it in the context of this 
              process.</DIV>
              <LI><A 
              href="http://www.codeproject.com/KB/threads/bridgewinjava.aspx">Bridge 
              Between Java And Windows</A>
              <DIV class=SmallText>Make your windows programs communicate with 
              java programs easily</DIV>
              <LI><A 
              href="http://www.codeproject.com/KB/threads/usingworkerthreads.aspx">Using 
              Worker Threads</A>
              <DIV class=SmallText>Learn how to create and use worker threads in 
              your applications.</DIV>
              <LI><A 
              href="http://www.codeproject.com/KB/threads/smartthreadpool.aspx">Smart 
              Thread Pool</A>
              <DIV class=SmallText>A smart Thread Pool implementation in 
              .NET.</DIV>
              <LI><A 
              href="http://www.codeproject.com/KB/threads/Rcf_Ipc_For_Cpp.aspx">RCF 
              - Interprocess communication for C++</A>
              <DIV class=SmallText>A server/client IPC framework, using the C++ 
              preprocessor as an IDL compiler.</DIV></LI></UL>
            <H2></H2></TD>
          <TD>
            <SCRIPT type=text/javascript>document.write("<a href=\"http://www.codeproject.com/Redir.aspx?adid=5367&way=ban\" target=\"_blank\" rel=\"nofollow\"><img src=\"http://www.codeproject.com/script/Ann/ServeImg.aspx?File=%2fscript%2fadmentor%2fimages%2fDevEx_spend-less-money-300x250.gif&C=False&id=5367\" alt=\"\" border=\"0\" width=\"300\" height=\"250\"></a>");</SCRIPT>
          </TD></TR></TBODY></TABLE>
      <DIV id=ctl00_AddTo style="MARGIN: 10px">
      <SCRIPT language=JavaScript type=text/javascript>
			var addtoMethod=1;
			var AddURL = document.location.href;
			var AddTitle = escape(document.title);
			DrawLinks(100, 0, "SmallText Bold", "AddTo") 
			</SCRIPT>
      </DIV>
      <TABLE class=ArticleUneditedHeader id=ctl00_RateArticleRow cellSpacing=0 
      cellPadding=0 width="100%" border=0>
        <TBODY>
        <TR>
          <TD><A 
            href="http://www.codeproject.com/KB/threads/ScreenMonitor.aspx#_top">Article 
            Top</A></TD>
          <TD align=right>
            <FORM id=aspnetForm 
            style="PADDING-RIGHT: 0px; PADDING-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-TOP: 0px" 
            name=aspnetForm action=ScreenMonitor.aspx method=post>
            <DIV><INPUT id=__VIEWSTATE type=hidden 
            value=/wEPDwULLTEwMDUyNjYzMjhkZJSZ0al3IwWR6OddAElr/ffWBQch 
            name=__VIEWSTATE> </DIV>
            <TABLE cellSpacing=0 cellPadding=0 width="100%">
              <TBODY>
              <TR>
                <TD class=SmallText style="WHITE-SPACE: nowrap" align=right>
                  <TABLE>
                    <TBODY>
                    <TR>
                      <TD id=ctl00_RateArticle_RateText 
                      style="PADDING-RIGHT: 5px"><I><B>Rate this Article for 
                        us!</B></I></TD>
                      <TD id=ctl00_RateArticle_StartForm 
                        align=right><I>&nbsp;&nbsp;Poor</I></TD>
                      <TD id=ctl00_RateArticle_VoteFormDiv 
                      style="WHITE-SPACE: nowrap" align=left>
                        <TABLE id=ctl00_RateArticle_VoteRBL border=0>
                          <TBODY>
                          <TR>
                            <TD><INPUT id=ctl00_RateArticle_VoteRBL_0 
                              type=radio value=1 
                            name=ctl00$RateArticle$VoteRBL></TD>
                            <TD><INPUT id=ctl00_RateArticle_VoteRBL_1 
                              type=radio value=2 
                            name=ctl00$RateArticle$VoteRBL></TD>
                            <TD><INPUT id=ctl00_RateArticle_VoteRBL_2 
                              type=radio value=3 
                            name=ctl00$RateArticle$VoteRBL></TD>
                            <TD><INPUT id=ctl00_RateArticle_VoteRBL_3 
                              type=radio value=4 
                            name=ctl00$RateArticle$VoteRBL></TD>
                            <TD><INPUT id=ctl00_RateArticle_VoteRBL_4 
                              type=radio value=5 
                            name=ctl00$RateArticle$VoteRBL></TD></TR></TBODY></TABLE></TD>
                      <TD id=ctl00_RateArticle_EndForm 
                        align=left><I>Excellent</I> <INPUT class=FormButton id=ctl00_RateArticle_SubmitRateBtn type=submit value=Vote name=ctl00$RateArticle$SubmitRateBtn> 
                      </TD>
                      <TD><SPAN 
                    id=ctl00_RateArticle_ErrorMessage></SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
            <DIV><INPUT id=__EVENTVALIDATION type=hidden 
            value=/wEWCALIy/HBAgLAlMXDBwLBlMXDBwLClMXDBwLDlMXDBwLElMXDBwLP+++tCwK5upDkC1SYsfyRMysv0+jCk8ZyqLxbqb6R 
            name=__EVENTVALIDATION> </DIV></FORM></TD></TR></TBODY></TABLE>
      <DIV 
      style="PADDING-RIGHT: 10px; PADDING-LEFT: 10px; PADDING-BOTTOM: 10px; OVERFLOW: hidden; PADDING-TOP: 10px; WHITE-SPACE: nowrap; TEXT-ALIGN: center">
      <SCRIPT type=text/javascript>document.write("<a href=\"http://www.codeproject.com/Redir.aspx?adid=5040&way=ban\" target=\"_blank\" rel=\"nofollow\"><img src=\"http://www.codeproject.com/script/Ann/ServeImg.aspx?File=%2fscript%2fadmentor%2fimages%2fWholeTomato_AutoSuggest_468x60_Original_newfont.gif&C=False&id=5040\" alt=\"The intellisense upgrade for Visual Studio .NET - make your IDE as smart as you.\" border=\"0\" width=\"468\" height=\"60\"></a>");</SCRIPT>
      <IFRAME 
      src="CodeProject Monitoring desktop windows from a windows service_ Free source code and programming help_files/ServeLinks.htm" 
      frameBorder=0 width=300 scrolling=no height=60></IFRAME></DIV><A 
      name=_comments></A><!-- Forum Start -->
      <DIV id=_MessageBoard onclick="return SwitchMessage(event, null)">
      <TABLE class=Frm_MainTable id=ForumTable cellSpacing=0 cellPadding=0>
        <FORM 
        action=/script/Forums/SetOptions.aspx?floc=%2fKB%2fthreads%2fScreenMonitor.aspx&amp;fid=910013&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick 
        method=get>
        <TBODY>
        <TR>
          <TD><INPUT type=hidden value=910013 name=fid><INPUT type=hidden 
            value=?floc=%2fKB%2fthreads%2fScreenMonitor.aspx&amp;fid=910013&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick 
            name=currentQS><INPUT type=hidden 
            value=/KB/threads/ScreenMonitor.aspx name=floc>
            <TABLE cellSpacing=0 cellPadding=3 width="100%" border=0>
              <TBODY>
              <TR class=Frm_HeaderRow1>
                <TD style="WHITE-SPACE: nowrap"><IMG height=16 
                  src="/script/Forums/Images/forum_faq.gif" width=16 
                  align=absMiddle border=0>&nbsp;<A 
                  href="http://www.codeproject.com/script/Forums/FAQ.aspx"><B>FAQ</B></A>&nbsp;</TD>
                <TD style="WHITE-SPACE: nowrap; TEXT-ALIGN: right">Noise 
                  Tolerance<SELECT class=Frm_DropDown size=1 name=noise> 
                    <OPTION value=1>Very High</OPTION><OPTION 
                    value=2>High</OPTION><OPTION value=3 
                    selected>Medium</OPTION><OPTION value=4>Low</OPTION><OPTION 
                    value=5>Very Low</OPTION></SELECT></TD>
                <TD style="WHITE-SPACE: nowrap; TEXT-ALIGN: right" 
                  colSpan=2><IMG height=15 
                  src="/script/Forums/Images/forum_search.gif" width=16 
                  align=absMiddle border=0>&nbsp;<A 
                  href="http://www.codeproject.com/script/Forums/Search.aspx?fid=910013">Search 
                  comments</A>&nbsp;</TD>
                <TD style="TEXT-ALIGN: right"><INPUT class=Frm_Button type=submit value="Set Options" name=submit></TD></TR>
              <TR class=Frm_HeaderRow2>
                <TD style="WIDTH: 100%">&nbsp;</TD>
                <TD 
                  style="WHITE-SPACE: nowrap; TEXT-ALIGN: right">Layout<SELECT 
                  class=Frm_DropDown size=1 name=view> <OPTION value=Quick 
                    selected>Normal</OPTION><OPTION value=Topic>Expand Root 
                    Messages</OPTION><OPTION value=Expanded>Expand All 
                    Messages</OPTION><OPTION value=Thread>Thread 
                    View</OPTION><OPTION value=Normal>No Javascript 
                    (slow)</OPTION><OPTION value=Preview>No Javascript 
                    Preview</OPTION></SELECT>&nbsp;&nbsp;</TD>
                <TD style="WHITE-SPACE: nowrap">Per page<SELECT 
                  class=Frm_DropDown size=1 name=mpp> <OPTION 
                    value=10>10</OPTION><OPTION value=25 
                    selected>25</OPTION><OPTION 
                  value=50>50</OPTION></SELECT>&nbsp;&nbsp;</TD>
                <TD colSpan=2>&nbsp;</TD></TR></TBODY></TABLE></TD></TR></FORM>
        <TR>
          <TD><A name=xx0xx></A>
            <TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
              <TBODY>
              <TR class=Frm_NavigationBar>
                <TD><IMG height=16 
                  src="/script/Forums/Images/forum_newmsg.gif" width=16 
                  align=top border=0><A class=Frm_HL 
                  title="Create a new message thread" 
                  href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=910013&amp;floc=/KB/threads/ScreenMonitor.aspx" 
                  target=_top name=Frm_HoverNL><B>New Message</B></A></TD>
                <TD>Msgs 1 to 7 of 7 (Total in Forum: 7) (<A 
                  href="http://www.codeproject.com/KB/threads/ScreenMonitor.aspx?fid=910013&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick">Refresh</A>)</TD>
                <TD style="WHITE-SPACE: nowrap; TEXT-ALIGN: right"><SPAN 
                  class=Frm_HL>First</SPAN><SPAN class=Frm_HL>Prev</SPAN><SPAN 
                  class=Frm_HL>Next</SPAN></TD></TR></TBODY></TABLE></TD></TR>
        <TR>
          <TD><!-- Column Headers -->
            <TABLE class=Frm_MsgTable cellSpacing=0 cellPadding=0 width="100%" 
            border=0>
              <TBODY>
              <TR class=Frm_ColumnHeaders>
                <TD style="WIDTH: 100%">
                  <TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
                    <TBODY>
                    <TR>
                      <TD>Subject&nbsp;</TD>
                      <TD class=Frm_MsgAuthor>&nbsp;Author&nbsp;</TD>
                      <TD 
              class=Frm_MsgDate>Date&nbsp;</TD></TR></TBODY></TABLE></TD></TR>
              <TR>
                <TD><IMG height=5 src="/script/Forums/Images/t.gif" width=1 
                  border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=2352434_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2352434xx></A><IMG height=16 
                        src="/script/Forums/Images/msg_general.gif" width=16 
                        valign="absmiddle"></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/threads/ScreenMonitor.aspx?fid=910013&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2352434#xx2352434xx" 
                        name=2352434>It's aging code</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 
                        src="/script/Membership/Images/member_sm.gif" 
                      border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=1467449">highandhigher</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">7:35 10 
                        Dec '07 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=2352434_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Beginning with Vista, services run 
                                in a different session and do not have access to 
                                the session of the logged on user. In Vista it 
                                is possible to allow UI interaction for a 
                                service but in the near future this work around 
                                will be removed. A service shall not interact 
                                with the UI!<BR><BR>As a conclusion your code 
                                only works for W2k and XP (and Vista, but it's 
                                not recommended).<BR><BR>MfG<BR>Andreas 
                                <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: top">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=910013&amp;select=2352434&amp;floc=/KB/threads/ScreenMonitor.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=910013&amp;select=2352434&amp;floc=/KB/threads/ScreenMonitor.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/threads/ScreenMonitor.aspx?fid=910013&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2352434">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=910013&amp;msg=2352434">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=2352434&amp;obtid=3">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2352434 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT language=Javascript 
type=text/javascript>
												MsgVoteForm(1467449,2352434);
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 
                  src="/script/Forums/Images/t.gif" width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=2352558_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=34><A 
                        name=xx2352558xx></A><IMG height=16 
                        src="/script/Forums/Images/msg_general.gif" width=16 
                        valign="absmiddle"></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/threads/ScreenMonitor.aspx?fid=910013&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2352558#xx2352558xx" 
                        name=2352558>may be</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 
                        src="/script/Membership/Images/member_sm.gif" 
                      border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=634640">dmihailescu</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">9:25 10 
                        Dec '07 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=2352558_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 34px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Indeed, using UI in windows 
                                services is not a best practice, but I doubt 
                                that this feature will be blocked before the 
                                next Windows version...and that's probably 2010 
                                the earliest. <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: top">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=910013&amp;select=2352558&amp;floc=/KB/threads/ScreenMonitor.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=910013&amp;select=2352558&amp;floc=/KB/threads/ScreenMonitor.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/threads/ScreenMonitor.aspx?fid=910013&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2352434">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=910013&amp;msg=2352558">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=2352558&amp;obtid=3">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2352558 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT language=Javascript 
type=text/javascript>
												MsgVoteForm(634640,2352558);
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 
                  src="/script/Forums/Images/t.gif" width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=2346724_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2346724xx></A><IMG height=16 
                        src="/script/Forums/Images/msg_general.gif" width=16 
                        valign="absmiddle"></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/threads/ScreenMonitor.aspx?fid=910013&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2346724#xx2346724xx" 
                        name=2346724>very well</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 
                        src="/script/Membership/Images/member_sm.gif" 
                      border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=1493271">zhaojicheng</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">19:16 4 
                        Dec '07 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=2346724_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>But I wanna capture the current 
                                screen like press the "printscreen" key. 
                                <BR>what should i do?<BR>thanks <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: top">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=910013&amp;select=2346724&amp;floc=/KB/threads/ScreenMonitor.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=910013&amp;select=2346724&amp;floc=/KB/threads/ScreenMonitor.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/threads/ScreenMonitor.aspx?fid=910013&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2346724">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=910013&amp;msg=2346724">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=2346724&amp;obtid=3">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2346724 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT language=Javascript 
type=text/javascript>
												MsgVoteForm(1493271,2346724);
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 
                  src="/script/Forums/Images/t.gif" width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=2347568_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=34><A 
                        name=xx2347568xx></A><IMG height=16 
                        src="/script/Forums/Images/msg_general.gif" width=16 
                        valign="absmiddle"></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/threads/ScreenMonitor.aspx?fid=910013&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2347568#xx2347568xx" 
                        name=2347568>Re: very well</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 
                        src="/script/Membership/Images/member_sm.gif" 
                      border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=634640">dmihailescu</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">7:51 5 
                        Dec '07 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=2347568_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 34px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>If you want the whole screen you 
                                have to make some code changes and basically 
                                replaced the SnapShotWindow method. <IMG 
                                src="/script/Forums/Images/smiley_frown.gif" 
                                align=absMiddle> <BR>If your window is 
                                maximized, it is the whole screen!<BR>In that 
                                case, on the viewer tab delete all the rows but 
                                the one you need and save when exiting the 
                                SnapShotmanager.<BR>Look in the folder where you 
                                have the app installed and you will see a jpg 
                                file with a long guid like name.<BR>That is your 
                                capture. <IMG 
                                src="/script/Forums/Images/smiley_smile.gif" 
                                align=absMiddle> <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: top">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=910013&amp;select=2347568&amp;floc=/KB/threads/ScreenMonitor.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=910013&amp;select=2347568&amp;floc=/KB/threads/ScreenMonitor.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/threads/ScreenMonitor.aspx?fid=910013&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2346724">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=910013&amp;msg=2347568">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=2347568&amp;obtid=3">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2347568 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT language=Javascript 
type=text/javascript>
												MsgVoteForm(634640,2347568);
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 
                  src="/script/Forums/Images/t.gif" width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd Rt HdUnSel " id=2342780_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2342780xx></A><IMG height=16 
                        src="/script/Forums/Images/msg_general.gif" width=16 
                        valign="absmiddle"></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/threads/ScreenMonitor.aspx?fid=910013&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2342780#xx2342780xx" 
                        name=2342780>Install on Vista with solution for error 
                        code 2869</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 
                        src="/script/Membership/Images/member_sm.gif" 
                      border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=2214162">redspiderke</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">3:43 30 
                        Nov '07 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=2342780_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>Nice Tool,<BR><BR>Only installing 
                                the MSI-file on a Vista machine was not so 
                                simple, I get always error code 2869<BR><BR>With 
                                a quick and dirty solution had to install the 
                                MSI from a batch file<BR>Right-click it and 
                                select "Run as Administrator". That makes it 
                                work.<BR><BR>So just make a bat-file with 
                                following command: msiexec /i 
                                "D:\software\SetupMonitor.msi"<BR>(replace 
                                D:\software\ with your path) <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: top">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=910013&amp;select=2342780&amp;floc=/KB/threads/ScreenMonitor.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=910013&amp;select=2342780&amp;floc=/KB/threads/ScreenMonitor.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/threads/ScreenMonitor.aspx?fid=910013&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2342780">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=910013&amp;msg=2342780">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=2342780&amp;obtid=3">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2342780 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT language=Javascript 
type=text/javascript>
												MsgVoteForm(2214162,2342780);
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgDivide><IMG height=1 
                  src="/script/Forums/Images/t.gif" width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd HdUnSel " id=2343209_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=34><A 
                        name=xx2343209xx></A><IMG height=16 
                        src="/script/Forums/Images/msg_general.gif" width=16 
                        valign="absmiddle"></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/threads/ScreenMonitor.aspx?fid=910013&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2343209#xx2343209xx" 
                        name=2343209>Re: Install on Vista with solution for 
                        error code 2869</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 
                        src="/script/Membership/Images/member_sm.gif" 
                      border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=634640">dmihailescu</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">7:05 30 
                        Nov '07 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=2343209_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 34px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>my bad!<BR>I forgot to mention 
                                that you have to be an administrator to install 
                                it.<BR>That is true on XP too.<IMG 
                                src="/script/Forums/Images/smiley_doh.gif" 
                                align=absMiddle><BR>Anyway, I haven't tested it 
                                on Vista and I'm glad to hear that it works on 
                                it too.<IMG 
                                src="/script/Forums/Images/smiley_smile.gif" 
                                align=absMiddle> <BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: top">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=910013&amp;select=2343209&amp;floc=/KB/threads/ScreenMonitor.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=910013&amp;select=2343209&amp;floc=/KB/threads/ScreenMonitor.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/threads/ScreenMonitor.aspx?fid=910013&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2342780">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=910013&amp;msg=2343209">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=2343209&amp;obtid=3">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2343209 
                                style="WHITE-SPACE: nowrap">
                                <SCRIPT language=Javascript 
type=text/javascript>
												MsgVoteForm(634640,2343209);
											</SCRIPT>
                                </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR class=Quick>
                <TD class=Frm_MsgRtDivide><IMG height=1 
                  src="/script/Forums/Images/t.gif" width=1 border=0></TD></TR><!-- Start Message head -->
              <TR class="MsgHd LoVote Rt HdUnSel " id=2342470_h0>
                <TD width="100%">
                  <TABLE class=QuickHd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent width=16><A 
                        name=xx2342470xx></A><IMG height=16 
                        src="/script/Forums/Images/msg_general.gif" width=16 
                        valign="absmiddle"></TD>
                      <TD class=Frm_MsgSubject><A id=DynMessLink 
                        href="http://www.codeproject.com/KB/threads/ScreenMonitor.aspx?fid=910013&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2342470#xx2342470xx" 
                        name=2342470>nice work.</A></TD>
                      <TD style="WIDTH: 20px; WHITE-SPACE: nowrap"><IMG 
                        title=member height=16 
                        src="/script/Membership/Images/member_sm.gif" 
                      border=0></TD>
                      <TD class=Frm_MsgAuthor><A 
                        href="http://www.codeproject.com/script/Membership/Profiles.aspx?mid=3080178">Foamox</A></TD>
                      <TD class=Frm_MsgDate 
                      style="VERTICAL-ALIGN: top; WHITE-SPACE: nowrap">1:20 30 
                        Nov '07 &nbsp;</TD></TR></TBODY></TABLE></TD></TR><!-- End Message head -->
              <TR id=2342470_h1 style="DISPLAY: none">
                <TD style="WIDTH: 100%">
                  <TABLE class=QuickBd cellSpacing=0 cellPadding=0 width="100%" 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD class=Frm_MsgIndent style="WIDTH: 16px"></TD>
                      <TD class="MsgBd BdSel ">
                        <TABLE cellSpacing=5 cellPadding=0 width="100%" 
border=0>
                          <TBODY>
                          <TR>
                            <TD>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                              border=0>
                                <TBODY>
                                <TR>
                                <TD colSpan=2>What a beauty~<IMG 
                                src="/script/Forums/Images/smiley_biggrin.gif" 
                                align=absMiddle> <BR><BR>Regards<BR></TD></TR>
                                <TR style="VERTICAL-ALIGN: top">
                                <TD class=Frm_MsgFt><A class=Frm_MHL title=Reply 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=910013&amp;select=2342470&amp;floc=/KB/threads/ScreenMonitor.aspx&amp;fa=r">Reply</A>·<A 
                                class=Frm_MHL title=Email 
                                href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=910013&amp;select=2342470&amp;floc=/KB/threads/ScreenMonitor.aspx&amp;fa=e">Email</A>·<A 
                                class=Frm_MHL title="View Thread" 
                                href="http://www.codeproject.com/KB/threads/ScreenMonitor.aspx?fid=910013&amp;df=90&amp;mpp=25&amp;sort=Position&amp;tid=2342470">View 
                                Thread</A>·<A class=Frm_MHL 
                                title="Get permanent link" 
                                href="http://www.codeproject.com/script/Forums/View.aspx?fid=910013&amp;msg=2342470">PermaLink</A>·<A 
                                class=Frm_MHL title="Bookmark this post" 
                                href="http://www.codeproject.com/script/Bookmarks/Add.aspx?&amp;obid=2342470&amp;obtid=3">Bookmark</A></TD>
                                <TD class=Frm_MsgFt 
                                style="TEXT-ALIGN: right"><SPAN id=MVF2342470 
                                style="WHITE-SPACE: nowrap">1.00/5 (1 vote)
                                <SCRIPT language=Javascript 
type=text/javascript>
												MsgVoteForm(3080178,2342470);
											</SCRIPT>
                                 
                        </SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
              <TR>
                <TD><IMG height=5 src="/script/Forums/Images/t.gif" width=1 
                  border=0></TD></TR></TBODY></TABLE></TD></TR>
        <TR>
          <TD>
            <TABLE cellSpacing=0 cellPadding=2 width="100%">
              <TBODY>
              <TR class=Frm_Footer>
                <TD>Last Visit: Sunday, March 2, 2008 2:00 AM &nbsp; &nbsp; 
                  Last Update:Sunday, March 2, 2008 2:00 AM</TD>
                <TD 
              style="WHITE-SPACE: nowrap; TEXT-ALIGN: right"></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></DIV>
      <P class=SmallText><IMG height=16 
      src="/script/Forums/Images/msg_general.gif" width=16 align=absMiddle> 
      General &nbsp;&nbsp; <IMG height=16 
      src="/script/Forums/Images/msg_news.gif" width=16 align=absMiddle> News 
      &nbsp;&nbsp; <IMG height=16 src="/script/Forums/Images/msg_question.gif" 
      width=16 align=absMiddle> Question &nbsp;&nbsp; <IMG height=16 
      src="/script/Forums/Images/msg_answer.gif" width=16 align=absMiddle> 
      Answer &nbsp;&nbsp; <IMG height=16 
      src="/script/Forums/Images/msg_joke.gif" width=16 align=absMiddle> Joke 
      &nbsp;&nbsp; <IMG height=16 src="/script/Forums/Images/msg_admin.gif" 
      width=16 align=absMiddle> Admin &nbsp;&nbsp; </P><!-- Forum End --></DIV>
      <TABLE width="100%">
        <TBODY>
        <TR vAlign=top>
          <TD class=TinyText align=left><A id=ctl00_PermaLink 
            href="http://www.codeproject.com/script/Articles/Article.aspx?aid=21492">PermaLink</A> 
            | <A id=ctl00_PrivacyLink 
            href="http://www.codeproject.com/info/privacy.aspx">Privacy </A>| <A 
            id=ctl00_TermsOfUseLink 
            href="http://www.codeproject.com/info/TermsOfUse.aspx">Terms of 
            Use</A> <BR>Last Updated: 2 Jan 2008<BR>Editor: <A 
            id=ctl00_ArticleEditor></A><BR></TD>
          <TD class=TinyText vAlign=top align=right>Copyright 2007 by 
            dmihailescu<BR>Everything else Copyright © <A 
            href="mailto:webmaster@codeproject.com">CodeProject</A>, 
            1999-2008<BR>Web10 | <A id=ctl00_AdvertiseLink 
            href="http://www.codeproject.com/info/MediaKit.aspx">Advertise on 
            the Code Project </A></TD></TR></TBODY></TABLE></TD></TR>
  <TR>
    <TD align=middle colSpan=2></TD></TR></TBODY></TABLE>
<SCRIPT language=Javascript 
src="CodeProject Monitoring desktop windows from a windows service_ Free source code and programming help_files/front.asp" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript type=text/javascript><!--
if (document.all) try {window.attachEvent("oncopy",copyCode);}catch(e){};
--></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject Monitoring desktop windows from a windows service_ Free source code and programming help_files/TogglePre.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject Monitoring desktop windows from a windows service_ Free source code and programming help_files/menu132_com.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript 
src="CodeProject Monitoring desktop windows from a windows service_ Free source code and programming help_files/TopNavBar.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=Javascript type=text/javascript><!--
new HVMenu(new menu_NavbarConfig());
--></SCRIPT>
</BODY></HTML>
