if(!window.MS){window.MS={};}if(!MS.Support){MS.Support={};}if(!MS.Support.Fms){MS.Support.Fms={};if(!MS.Support.Fms._implement){MS.Support.Fms._implement=true;MS.Support.Fms.Utils={findChildNodes : function(parent,evalutor){var elements=new Array();if(evalutor(parent)){elements.push(parent);}if(parent!=null&&parent.childNodes){for(var i=0;i<parent.childNodes.length;++i){var es=arguments.callee(parent.childNodes[i],evalutor);for(var j=0;j<es.length;++j){elements.push(es[j]);}}}return elements;},findFirstChild : function(parent,evalutor){if(evalutor(parent)){return parent;}else if(parent!=null&&parent.childNodes){for(var index=0;index<parent.childNodes.length;++index){var e=arguments.callee(parent.childNodes[index],evalutor);if(e!=null){return e;}}}return null;},getChildById : function(parent,childId){if(parent.all){return parent.all(childId);}else{return MS.Support.Fms.Utils.findFirstChild(parent,function(parent){return(parent!=null&&parent.id==childId);});}},getChildByAttribute : function(parent,attributeName,attributeValue){return MS.Support.Fms.Utils.findFirstChild(parent,function(parent){return parent!=null&&parent.getAttribute ?(parent.getAttribute(attributeName)==attributeValue): false;});},getChildNodesByAttribute : function(parent,attributeName,attributeValue){return MS.Support.Fms.Utils.findChildNodes(parent,function(parent){return parent!=null&&parent.getAttribute ?(parent.getAttribute(attributeName)==attributeValue): false;});}};MS.Support.Fms.ValidateResult=function(isValid,errorMessage){this.isValid=isValid;this.errorMessage=errorMessage;};MS.Support.Fms.SurveyEventDelegate=function(object,method){this.object=object;this.method=method;this.invoke=function(){if(method!=null){return method.apply(object,arguments);}};this.equal=function(another){return this.object==another.object&&this.method==another.method;};};MS.Support.Fms.SurveyEvent=function(){var handlers=new Array();this.add=function(delegate){for(var index=0;index<handlers.length;++index){if(handlers[index].equal(delegate)){return;}}handlers.push(delegate);};this.remove=function(delegate){for(var index=0;index<handlers.length;++index){if(handlers[index].equal(delegate)){handlers.splice(index,1);return;}}};this.fire=function(){for(var index=0;index<handlers.length;++index){if(!handlers[index].invoke.apply(null,arguments)){return false;}}return true;};};MS.Support.Fms.SurveyQuestionOperator={
create : function(question){var operatorPrototype=null;switch(question.getQuestionType()){case "CHOICE":
case "CHECK-LIST":
case "CHOICE-SEQ":
operatorPrototype=this.choiceOperator;break;case "CHOICE-LIST":
case "MULTI-OPTION":
operatorPrototype=this.choicelistOperator;break;case "TEXT-LINE":
case "PASSWORD":
case "TEXT-BLOCK":
operatorPrototype=this.textboxOperator;break;case "LABEL":
default:
operatorPrototype=this.emptyOperator;break;}return new operatorPrototype(question);},emptyOperator : function(question){this.validate=function(){return true;};this.getAnswers=function(){return new Array();};this.save=function(){};this.restore=function(){};},textboxOperator : function(question){var textbox=question.elements[0];this.validate=function(){return textbox.value!="";};this.getAnswers=function(){var answers=new Array();var text=textbox.value;if(text!=null&&text!=""){answers.push({id : 0,value : 0,text : text});}return answers;};this.save=function(){savedText=textbox.value;};this.restore=function(){textbox.value=savedText;};},choiceOperator : function(question){var lastRadioIndex=question.elements.length - 1;var optionalTextBox=null;var hasOptionalTextBox=lastRadioIndex>=0 ? question.elements[lastRadioIndex].type.toLowerCase()=="text" : false;if(hasOptionalTextBox){optionalTextBox=question.elements[lastRadioIndex];--lastRadioIndex;}this.validate=function(){for(var index=0;index<=lastRadioIndex;++index){var e=question.elements[index];if(e.checked){return true;}}return false;};this.getAnswers=function(){var answers=new Array();for(var index=0;index<=lastRadioIndex;++index){var e=question.elements[index];if(e.checked){var id=e.id,value=e.value,text="";if(index==lastRadioIndex&&hasOptionalTextBox){text=optionalTextBox.value;}answers.push({id : id,value: value,text : text});}}return answers;};var states=null;this.save=function(){states=new Array();for(var index=0;index<=lastRadioIndex;++index){states.push(question.elements[index].checked);}if(hasOptionalTextBox){states.push({value : optionalTextBox.value,disabled : optionalTextBox.disabled});}};this.restore=function(){for(var index=0;index<=lastRadioIndex;++index){question.elements[index].checked=states[index];}if(hasOptionalTextBox){optionalTextBox.value=states[states.length - 1].value;optionalTextBox.disabled=states[states.length - 1].disabled;}};},choicelistOperator : function(question){var selectObject=question.elements[0];var options=selectObject.options;this.validate=function(){for(var index=0;index<options.length;++index){var option=options[index];if(option.selected&&option.id!=""&&option.value!=""&&option.value!=-1){return true;}}return false;};this.getAnswers=function(){var answers=new Array();for(var index=0;index<options.length;++index){var option=options[index];if(option.selected&&option.id!=""&&option.value!=""&&option.value!=-1){answers.push({id : option.id,value : option.value,text : option.text ? option.text : ""});}}return answers;};var states=null;this.save=function(){states=new Array();states.selectedIndex=selectObject.selectedIndex;for(var index=0;index<options.length;++index){states.push(options[index].selected);}};this.restore=function(){selectObject.selectedIndex=states.selectedIndex;for(var index=0;index<options.length;++index){options[index].selected=states[index];}};}};MS.Support.Fms.BranchRule=function(optionId,optionValue,target){this.optionId=optionId;this.optionValue=optionValue;this.target=target;this.match=function(element){if(element.checked||element.selected){if(typeof(optionId)!="undefined"&&optionId!=null){if(element.id==optionId){if(typeof(optionValue)!="undefined"&&optionValue!=null){if(element.value==optionValue){return target;}}else{return target;}}}else{return target;}}else if(element.options!=null){for(var index=0;index<element.options.length;++index){if(target==this.match(element.options[index])){return target;}}}return -1;};};MS.Support.Fms.SurveyQuestion=function(domObject){var Fms=MS.Support.Fms;var Utils=Fms.Utils;var ValidateResult=Fms.ValidateResult;this.domObject=domObject;var type=Utils.getChildByAttribute(domObject,"name","type");var operator=null;var branchRules=new Array();this.findBranchRules=function(){if(this.domObject!=null){var es=Utils.findChildNodes(this.domObject,function(node){return node&&node.type&&node.type.toLowerCase()=="hidden"&&node.id.indexOf("NextRef_")==0;});for(var index=0;index<es.length;++index){var parts=es[index].id.split("_",3);branchRules.push(new MS.Support.Fms.BranchRule(parts[1],parts[2],es[index].value));}}};this.findBranchRules();var requiredHidden=Utils.getChildByAttribute(domObject,"name","required");var requiredErrorText=null;this.isRequired=function(){return requiredHidden!=null&&requiredHidden.value=="1";};if(this.isRequired()){requiredErrorText=Utils.getChildByAttribute(domObject,"name","requiredErrorText");}this.getQuestionId=function(){return this.domObject.id.replace("SURVEYQUESTION_","");};this.getQuestionType=function(){return type.value;};this.validate=function(){if(this.isRequired()){var isValid=operator.validate(this);if(isValid){return new ValidateResult(true);}return new ValidateResult(false,this.getRequiredErrorText());}else{return new ValidateResult(true);}};this.save=function(){operator.save();};this.restore=function(){operator.restore();};this.getAnswers=function(){return operator.getAnswers();};this.getRequiredErrorText=function(){if(!this.isRequired()){throw "Not a required question!";}else{return requiredErrorText.value;}};this.getNextPageByBranchRule=function(){for(var i=0;i<this.elements.length;++i){for(var j=0;j<branchRules.length;++j){var target=branchRules[j].match(this.elements[i]);if(target!=null&&target!=-1){return target;}}}
return -1;};this.elements=new Array();function isQuestionElement(node){if(node.type!=null){switch(node.type.toLowerCase()){case "text":
case "password":
case "textarea":
case "radio":
case "checkbox":
case "select-one":
case "select-multiple":
return true;}}return false;}this.discoverElements=function(){if(this.domObject!=null){var es=Utils.findChildNodes(this.domObject,isQuestionElement);for(var index=0;index<es.length;++index){this.elements.push(es[index]);}}};this.discoverElements();operator=MS.Support.Fms.SurveyQuestionOperator.create(this);this.displayBranchRules=function(){for(var i=0;i<this.elements.length;++i){var options=this.elements[i].options;if(options){var selectVisual="<ol>";for(var j=0;j<options.length;++j){selectVisual+="<li>"+options[j].innerHTML;for(var k=0;k<branchRules.length;++k){if(branchRules[k].optionId==options[j].id&&(typeof(branchRules[k].optionValue=="undefined")||branchRules[k].optionValue==options[j].value)){selectVisual+="(--&gt;"+branchRules[k].target+")";break;}}selectVisual+="</li>";}selectVisual+="</ol>";var info=document.createElement("span");info.style.color="green";info.innerHTML=selectVisual;this.elements[i].parentNode.appendChild(info);}else{for(var j=0;j<branchRules.length;++j){if(branchRules[j].optionId==this.elements[i].id&&(typeof(branchRules[j].optionValue)=="undefined"||branchRules[j].optionValue==this.elements[i].value)){var info=document.createElement("font");info.color="green";info.innerHTML="(--&gt;"+branchRules[j].target+")";this.elements[i].parentNode.appendChild(info);}}}}};};MS.Support.Fms.SurveyPage=function(domObject){var Fms=MS.Support.Fms;var Utils=Fms.Utils;var ValidateResult=Fms.ValidateResult;this.domObject=domObject;this.nextPageId=-1;this.modified=false;var nextPageByTopicRef=Utils.getChildByAttribute(domObject,"name","NextSectionByTopicRef");if(nextPageByTopicRef&&nextPageByTopicRef.value!=null&&nextPageByTopicRef.value!=""){this.nextPageId=parseInt(nextPageByTopicRef.value);}var pageId;if(this.domObject.id=="DIV_0"){pageId="0";}else if(this.domObject.id=="DIV_CLOSE"){pageId="End";}else{pageId=Utils.getChildByAttribute(domObject,"name","id").value;}this.getPageId=function(){return pageId;};this.questions=new Array();this.discoverQuestions=function(){if(this.domObject!=null){var es=Utils.getChildNodesByAttribute(this.domObject,"className","QUESTIONCONTAINER");if(es.length==0){es=Utils.getChildNodesByAttribute(this.domObject,"class","QUESTIONCONTAINER");}for(var index=0;index<es.length;++index){this.questions.push(new MS.Support.Fms.SurveyQuestion(es[index]));}}};this.discoverQuestions();this.isRequired=function(){for(var index=0;index<this.questions.length;++index){if(this.questions[index].isRequired()){return true;}}return false;};this.save=function(){for(var index=0;index<this.questions.length;++index){this.questions[index].save();}};this.restore=function(){for(var index=0;index<this.questions.length;++index){this.questions[index].restore();}};this.validate=function(){for(var index=0;index<this.questions.length;++index){var result=this.questions[index].validate();if(!result.isValid){return result;}}return new ValidateResult(true);};this.getNextPageByBranchRule=function(){var nextPageId=-1;for(var index=0;index<this.questions.length;++index){if((nextPageId=this.questions[index].getNextPageByBranchRule())!=-1){return nextPageId;}}return this.nextPageId;};this.show=function(){if(this.domObject!=null){this.domObject.style.display="block";}};this.hide=function(){if(this.domObject!=null){this.domObject.style.display="none";}};this.isVisible=function(){if(this.domObject!=null){return this.domObject.style.display=="none" ? false : true;}return false;};this.displayBranchRules=function(nextPageIdInOrder){var nextPageId;if(this.nextPageId>0){nextPageId=this.nextPageId;}else{nextPageId=nextPageIdInOrder;}var info=document.createElement("span");info.style.color="green";info.innerHTML="("+this.getPageId()+"--&gt;"+nextPageId+")";if(this.domObject!=null){this.domObject.parentNode.insertBefore(info,this.domObject);}for(var index=0;index<this.questions.length;++index){this.questions[index].displayBranchRules();}};};MS.Support.Fms.Survey=function(id){
var Fms=MS.Support.Fms;var Utils=Fms.Utils;var Event=Fms.SurveyEvent;var Page=Fms.SurveyPage;this.id=id;this.domObject=document.getElementById(id);this.name=Utils.getChildById(this.domObject,"surveyname").value;this.introduction=null;this.pages=new Array();this.thankyou=null;this.submitFields=new Array();var hasSubmitted=false;
this.onBeforeStart=new Event();this.onBeforeAccept=new Event();this.onBeforeDecline=new Event();this.onBeforeCancel=new Event();this.onBeforeNext=new Event();this.onBeforePrevious=new Event();this.onBeforeSkip=new Event();this.onBeforeClose=new Event();this.onBeforeSubmit=new Event();this.onAfterStart=new Event();this.onAfterAccept=new Event();this.onAfterDecline=new Event();this.onAfterCancel=new Event();this.onAfterNext=new Event();this.onAfterPrevious=new Event();this.onAfterSkip=new Event();this.onAfterClose=new Event();this.onAfterSubmit=new Event();this.onValidateError=new Event();this.discoverIntroduction=function(){if(this.domObject!=null){var domObject=Utils.getChildById(this.domObject,"DIV_0");if(domObject!=null){this.introduction=new Page(domObject);this.pages.push(this.introduction);}}};this.discoverPages=function(){var sections=Utils.getChildNodesByAttribute(this.domObject,"className","SURVEYSECTION");if(sections.length==0){sections=Utils.getChildNodesByAttribute(this.domObject,"class","SURVEYSECTION");}for(var index=0;index<sections.length;++index){this.pages.push(new Page(sections[index]));}};this.discoverThankyou=function(){if(this.domObject!=null){var domObject=Utils.getChildById(this.domObject,"DIV_CLOSE");if(domObject!=null){this.thankyou=new Page(domObject);this.pages.push(this.thankyou);}}};this.discoverIntroduction();this.discoverPages();this.discoverThankyou();this.addSubmitField=function(key,value){this.submitFields[key]=value;};var currentPageIndex=-1;var history=new Array();this.start=function(){if(this.onBeforeStart.fire(this,null)){this.show();if(this.pages.length>0){currentPageIndex=-1;this.next();}this.onAfterStart.fire(this,null);}};this.findPageIndexByPageId=function(pageId){for(var index=0;index<this.pages.length;++index){if(this.pages[index].getPageId()==pageId){return index;}}return -1;};this.getCurrentPage=function(){return this.pages[currentPageIndex];};this.next=function(){if(currentPageIndex>=this.pages.length||(this.thankyou!=null&&this.pages[currentPageIndex]==this.thankyou)){return;}if(this.onBeforeNext.fire(this,null)){if(currentPageIndex==-1){currentPageIndex=0;if(currentPageIndex>=this.pages.length){this.submit();}else{var showpage=parseInt(Utils.getChildById(this.domObject,"showpage").value);
if(showpage>1&&showpage<=this.pages.length){for(var i=0;i<showpage - 1;i++){history.push(i);}currentPageIndex=showpage - 1;}
else if(showpage>this.pages.length){currentPageIndex=this.pages.length - 1;}this.pages[currentPageIndex].show();this.pages[currentPageIndex].save();}}else{var validateResult=this.pages[currentPageIndex].validate();if(validateResult.isValid){history.push(currentPageIndex);this.pages[currentPageIndex].hide();this.pages[currentPageIndex].modified=true;var nextPageIndex=-1;var nextPageId=this.pages[currentPageIndex].getNextPageByBranchRule();if(nextPageId>0){nextPageIndex=this.findPageIndexByPageId(nextPageId);}if(nextPageIndex!=-1&&nextPageIndex!=currentPageIndex){currentPageIndex=nextPageIndex;}else{++currentPageIndex;}if(currentPageIndex>=this.pages.length||this.thankyou!=null&&(this.pages[currentPageIndex]==this.thankyou)){this.submit();}else{this.pages[currentPageIndex].show();this.pages[currentPageIndex].save();}}else{this.onValidateError.fire(this,validateResult);return;}}this.onAfterNext.fire(this,null);}};this.skip=function(){if(this.onBeforeSkip.fire(this,null)){if(currentPageIndex<0){throw "currentPageIndex < 0";}else if(this.pages[currentPageIndex].isRequired()){throw "Cannot skip a required question.";}else{history.push(currentPageIndex);this.pages[currentPageIndex].restore();this.pages[currentPageIndex].hide();this.pages[currentPageIndex].modified=false;var nextPageIndex=-1;var nextPageId=this.pages[currentPageIndex].nextPageId;if(nextPageId>0){nextPageIndex=this.findPageIndexByPageId(nextPageId);}if(nextPageIndex!=-1&&nextPageIndex!=currentPageIndex){currentPageIndex=nextPageIndex;}else{++currentPageIndex;}if(currentPageIndex>=this.pages.length||this.thankyou!=null&&(this.pages[currentPageIndex]==this.thankyou)){this.submit();}else{this.pages[currentPageIndex].show();this.pages[currentPageIndex].save();}}this.onAfterSkip.fire(this,null);}};this.previous=function(){if(this.onBeforePrevious.fire(this,null)){if(currentPageIndex<=0){throw "currentPageIndex <= 0";}if(history.length==0){throw "history.length == 0";}var lastPageIndex=history.pop();this.pages[currentPageIndex].hide();this.pages[currentPageIndex].modified=false;currentPageIndex=lastPageIndex;this.pages[currentPageIndex].show();this.pages[currentPageIndex].save();}this.onAfterPrevious.fire(this,null);};this.accept=function(){if(this.onBeforeAccept.fire(this,null)){if(this.next()){this.onAfterAccept.fire();}}};this.decline=function(){if(this.onBeforeDecline.fire(this,null)){if(this.cancel()){this.introduction.hide();this.onAfterDecline.fire(this,null);}}};this.close=function(){if(this.onBeforeClose.fire(this,null)){window.close();this.onAfterClose.fire(this,null);}};this.cancel=function(){if(this.onBeforeCancel.fire(this,null)){this.submit("cancel");this.onAfterCancel.fire(this,null);}else{return false;}return true;};this.giveup=function(){if(this.pages[currentPageIndex]!=null){this.pages[currentPageIndex].restore();}this.submit("giveup");};this.submit=function(action){if(hasSubmitted){return;}else{hasSubmitted=true;}if(action==null){action="persist";}if(this.submitHandler){this.submitHandler(this,action);}else{this.defaultSubmitHandler();}};this.defaultSubmitHandler=function(){
if(this.thankyou!=null){this.thankyou.show();}};this.encodeAnswers=function(textEncoder){if(!textEncoder){textEncoder=function(input){return input;};}var answers=new Array();for(var pageIndex=0;pageIndex<this.pages.length;++pageIndex){var page=this.pages[pageIndex];var pageId=page.getPageId();if(pageId!=0&&page.modified==true){for(var questionIndex=0;questionIndex<page.questions.length;++questionIndex){var question=page.questions[questionIndex];var questionId=question.getQuestionId();var answer=question.getAnswers();for(var index=0;index<answer.length;++index){answers.push(pageId+","+questionId+","+answer[index].id+","+answer[index].value+","+textEncoder(answer[index].text));}}}}return answers.join("|");};this.hide=function(){if(this.domObject!=null){this.domObject.style.display="none";}};this.show=function(){if(this.domObject!=null){this.domObject.style.display="block";}};this.displayBranchRules=function(){var index=0;for(;index<this.pages.length - 1;++index){this.pages[index].displayBranchRules(this.pages[index+1].getPageId());}if(this.thankyou==null){this.pages[index].displayBranchRules("End");}};this.handleOptionalTxt=function(optionObj){var optionname=optionObj.name;var pageObj=optionObj,page=null;do{if(pageObj.className=="SURVEYSECTION"){break;}else{pageObj=pageObj.parentNode;}}while(pageObj);if(pageObj!=null){var pageIdObj=Utils.getChildByAttribute(pageObj,"name","id");if(pageIdObj){pageId=pageIdObj.value;}else{return;}var pageIndex=this.findPageIndexByPageId(pageId);if(pageIndex!=-1){page=this.pages[pageIndex];}else{return;}}else{return;}var question=null;for(var index=0;index<page.questions.length;++index){for(var eIndex=0;eIndex<page.questions[index].elements.length;++eIndex){if(page.questions[index].elements[eIndex].name==optionname){question=page.questions[index];break;}}if(question!=null){break;}}if(question!=null){for(var i=0;i<question.elements.length - 1;i++){var e=question.elements;if((e[i].type=="radio"||e[i].type=="checkbox")&&e[i+1].className=="OPTIONALTEXTBOX"&&e[i].id==e[i+1].id){e[i+1].disabled=!e[i].checked;}}}};};}}function enforceMaxLength(oElement,iMaxLength,e){if(oElement.value.length>iMaxLength){oElement.value=(oElement.value).substring(0,iMaxLength);if(window.event){window.event.returnValue=false;}else if(e&&e.preventDefault){e.preventDefault();}}}
function KBFeedBackShowSurvey(){var gsfxSurveyScript=document.createElement("script");gsfxSurveyScript.type="text/javascript";gsfxSurveyScript.language="javascript";gsfxSurveyScript.src="/common/script/fx/gsfxsurvey.js";document.body.appendChild(gsfxSurveyScript);}

function getMsgElement(e){var p=e.previousSibling;if(!p||p.name!="FMSError"){p=document.createElement("div");p.name="FMSError";p.className="QUESTIONREQUIRED";p.innerHTML=e.failmsg;p.style.display="none";e.parentNode.insertBefore(p,e);}return p;}function isVisible(e){if(e.style&&e.style.display=="none")return false;if(!e.parentNode)return true;return isVisible(e.parentNode);}function passesFilter(e){if(!e.pattern)return true;var rx=new RegExp(e.pattern);return rx.test(e.value);}
function Replace(strOrig,str1,str2){if(strOrig.length==0||str1.length==0)
return strOrig;var index=0;var indexend=0;var len1=str1.length;var result="";do{indexend=strOrig.indexOf(str1,index);if(indexend==-1){indexend=strOrig.length;}result+=strOrig.substring(index,indexend);if(indexend!=strOrig.length)
result+=str2;index=indexend+len1;if(index>=strOrig.length)
break;}while(true);return result;}