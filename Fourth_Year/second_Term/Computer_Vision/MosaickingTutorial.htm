<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns="http://www.w3.org/TR/REC-html40"><head>


<meta http-equiv="Content-Language" content="en-us">
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link rel="File-List" href="http://www.pages.drexel.edu/%7Esis26/MosaickingTutorial_files/filelist.xml"><title>MosaickingTutorial</title><!--[if !mso]>
<style>
v\:*         { behavior: url(#default#VML) }
o\:*         { behavior: url(#default#VML) }
.shape       { behavior: url(#default#VML) }
</style>
<![endif]--><!--[if gte mso 9]>
<xml><o:shapedefaults v:ext="edit" spidmax="1027"/>
</xml><![endif]--></head><body bgcolor="#ffffcc">

<p align="left">&nbsp;</p>

<table style="border-collapse: collapse;" id="AutoNumber4" border="0" bordercolor="#111111" cellpadding="0" cellspacing="0" width="763">
  <tbody><tr>
    <td rowspan="2" bgcolor="#000080" valign="top" width="95">
    <div align="center">
      <center>
    <table id="AutoNumber3" border="0" cellpadding="0" cellspacing="0" height="100" width="100%">
      <tbody><tr>
        <td align="center" bgcolor="#ffce5a" height="100%" width="100%">
        <img src="MosaickingTutorial_files/Drexel%2520logo.gif" align="middle" border="0" height="77" width="72"></td>
      </tr>
    </tbody></table>
      </center>
    </div>
    <table style="border-collapse: collapse;" id="AutoNumber5" bgcolor="#000080" border="0" bordercolor="#111111" cellpadding="0" cellspacing="0" width="82">
      <tbody><tr>
        <td height="30" valign="middle" width="82"><b>
        <a href="http://www.pages.drexel.edu/%7Esis26/Computer%20Vision.htm"><font color="#ffff00">Home</font></a></b></td>
      </tr>
      <tr>
        <td height="27" width="82"><b>
        <a href="http://www.pages.drexel.edu/%7Esis26/IndexTutorials.htm">
        <font color="#ffff00">Tutorials</font></a></b></td>
      </tr>
      <tr>
        <td height="25" width="82"><b>
        <a href="http://www.pages.drexel.edu/%7Esis26/Contact%20info.htm">
        <font color="#ffff00">Contact info</font></a></b></td>
      </tr>
      <tr>
        <td width="82"><b><font color="#ffff00"><a href="http://www.pages.drexel.edu/%7Esis26/Tasks.htm">
        <font color="#ffff00">Tasks</font></a></font></b></td>
      </tr>
      <tr>
        <td bgcolor="#000080" width="100">&nbsp;</td>
      </tr>
    </tbody></table>
    </td>
    <td bgcolor="#000080" width="679">
    <p align="left"><img src="MosaickingTutorial_files/Drexel%2520banner.gif" border="0" height="100" width="600"></p>
    </td>
  </tr>
  <tr>
    <td width="679">
    <p align="center"><font color="#000080">&nbsp;</font></p><blockquote>
<h1 align="center"><font color="#000080" size="6">Mosaicking Tutorial<br>
</font><b><font size="3">The original tutorial has been modified with the authors 
permission.</font></b></h1>
      <p>
<font color="#000080">
<b>Keywords:</b></font> <font face="Times New Roman">Matlab, Image Mosaicking, 
Mosaicking, Image Stitching</font></p>
<center>
<p><span style="font-size: 12pt; font-family: Times New Roman;"><!--[if gte vml 1]><v:shapetype id="_x0000_t75"
 coordsize="21600,21600" o:spt="75" o:preferrelative="t" path="m@4@5l@4@11@9@11@9@5xe"
 filled="f" stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="_x0000_s1027" type="#_x0000_t75" alt="" style='width:166.5pt;
 height:213.75pt'>
 <v:imagedata src="MosaickingTutorial_files/image001.jpg" o:href="http://www.geocities.com/sd2002leap/LEFT.JPG"/>
</v:shape><![endif]--><!--[if !vml]--><img src="MosaickingTutorial_files/image002.jpg" v:shapes="_x0000_s1027" border="0" height="285" width="222"><!--[endif]-->&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <!--[if gte vml 1]><v:shape
 id="_x0000_s1030" type="#_x0000_t75" alt="" style='width:143.25pt;height:212.25pt'>
 <v:imagedata src="MosaickingTutorial_files/image003.jpg" o:href="http://www.geocities.com/sd2002leap/RIGHT.JPG"/>
</v:shape><![endif]--><!--[if !vml]--><img src="MosaickingTutorial_files/image004.jpg" v:shapes="_x0000_s1030" border="0" height="283" width="191"><!--[endif]--></span></p>
</center>
<p>
<font face="Times New Roman">These 2 photos depict examples of a scene that can 
be stitched together in Matlab. The big picture problem is to mosaic them 
together correctly. Solving this partially or completely is important because it 
will allow command and control (C2) teams to assess a disaster situation more 
accurately and quickly. This tutorial shows you how to stitch images together in 
Matlab and takes approximately 1 hour to complete.<br>
</font>
<br>
</p><h3><font color="#000080">Motivation and Audience</font></h3>

      <p><font face="Times New Roman">This tutorial has been created to help you 
      mosaic images using Matlab. Readers of this tutorial assumes the reader has the following background and interests:</font></p>
<ul>
<font color="green"><b>
<i>
</i></b><li><b><i> <font color="#008000" face="Helvetica" size="-1"><span style="font-size: 12px;">Know how to 
use Matlab and modify m files</span></font></i></b></li><li><b><i> <font color="#008000" face="Helvetica" size="-1"><span style="font-size: 12px;">Also know how to use the help command in Matlab</span></font></i></b></li><li><b><i> <font color="#008000" face="Helvetica" size="-1"><span style="font-size: 12px;">Knowledge of Photoshop, 
Paint, Microsoft Photo Editor or similar programs is a plus</span></font></i></b></li><li><b><i> <font color="#008000" face="Helvetica" size="-1"><span style="font-size: 12px;">Desire to stitch together images to gain full view of a scene</span></font></i></b></li><li><b><i> <font color="#008000" face="Helvetica" size="-1"><span style="font-size: 12px;">In addition, would like to learn more about Matlab commands and scripts</span></font></i></b></li></font></ul>
<p>
The rest of the tutorial is presented as follows:
</p><p>
</p><ul>
<li><a href="#Parts"> Parts List and Sources</a>
</li><li><a href="#Construction"> Construction</a>
</li><li><a href="#Programming"> Programming</a></li><li><a href="#Final%20Words"> Final Words</a>
</li></ul>
<p>
&nbsp;</p><h3><font color="#000080">Parts List and Sources</font></h3>

      <p>US-based vendors to obtain material to complete this tutorial include
      <br>
      <a href="http://www.mathworks.com/"><font face="Helvetica">Mathworks</font></a></p>
<p>
To complete this tutorial, you'll need the following items <br>
&nbsp;</p><center>
<table colspec="L20 L20 L20 L20 L20 L20" border="5" cellspacing="3" height="63">
<tbody><tr><td height="19">Software</td><td height="19">VENDOR</td>
  <td align="center" height="19">Version</td><td height="19">PRICE </td>
  <td height="19">QTY</td></tr>
<tr><td height="1"><font face="Helvetica">Matlab</font></td><td height="1">
  <a href="http://www.mathworks.com/"><font face="Helvetica">Mathworks</font></a></td>
  <td align="center" height="1">5.X</td><td height="1">$500</td>
  <td height="1">1</td></tr>
</tbody></table>
</center>
<p><font color="#000080" size="4"><span style="font-weight: 700;">Construction</span></font></p>

      <p><font face="Times New Roman">This
section gives step-by-step instructions along with photos on how to
mosaic images in Matlab. The photos at the beginning of this page can
be used as examples.</font></p>

    <p class="MsoNormal"><font color="#000080" size="5">
    <span style="font-weight: 700;">
    Steps</span></font></p>
      <p class="MsoNormal" style="text-indent: -0.25in; margin-left: 0.5in;">1.<font face="Times New Roman"> 
      Create a folder on your desktop called Mosaic. </font></p></blockquote>
      <blockquote>
      <p class="MsoNormal" style="text-indent: -0.25in; margin-left: 0.5in;">2. <font face="Times New Roman"> Save 2 images 
      (such as the ones at the top of this page)&nbsp; and the mosaic.m and 
      ginput2.m files into the folder you just created. (<a href="http://www.pages.drexel.edu/%7Esis26/Vision/MosaicKit.zip">MosaicKit</a>)</font></p><p class="MsoNormal" style="text-indent: -0.25in; margin-left: 0.5in;">
3. <font face="Times New Roman">Open Matlab program on the personal computer you are working on.</font></p><p class="MsoNormal" style="text-indent: -0.25in; margin-left: 0.5in;">
      &nbsp;4. Open the mosaic.m file by typing <b>open mosaic</b></p><p class="MsoNormal" style="text-indent: -0.25in; margin-left: 0.5in;">
      <span style="font-family: &quot;Times New Roman&quot;; font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp; </span>
      <span style="font-style: normal; font-variant: normal; font-weight: normal; font-family: Times New Roman;">
      5. </span><font face="Times New Roman">Change the script so that it uses 
      the images you want to mosaic. In our example they are called Left.jpg and 
      Right.jpg. Save the changes and close the window.</font></p></blockquote>
      <blockquote>
      <p class="MsoNormal" style="text-indent: -0.25in; margin-left: 0.5in;">6. <font face="Times New Roman">
      In the Matlab command window type <b>mosaic</b></font></p><p class="MsoNormal" style="text-indent: -0.25in; margin-left: 0.5in;">
      7.<font face="Times New Roman"> A new window will appear entitled 'Figure 
      No. 1'. Select two points, in the first image, that would match two other 
      points on the second image.&nbsp; Red crosses would mark the desired 
      points.</font></p>
    </blockquote>
      <p align="center">
      <span style="font-size: 12pt; font-family: Times New Roman;"><!--[if gte vml 1]><v:shape
 id="_x0000_s1031" type="#_x0000_t75" alt="" style='width:218.25pt;height:387.75pt'>
 <v:imagedata src="MosaickingTutorial_files/image005.jpg" o:href="http://www.geocities.com/sd2002leap/document1.jpg"/>
</v:shape><![endif]--><!--[if !vml]--><img src="MosaickingTutorial_files/image005.jpg" v:shapes="_x0000_s1031" border="0" height="517" width="291"><!--[endif]--></span></p>
      <p class="MsoNormal" style="text-indent: -0.25in; margin-left: 0.5in;" align="center">&nbsp;</p><blockquote>
      <p class="MsoNormal" style="text-indent: -0.25in; margin-left: 0.5in;">
8.<i> </i><font face="Times New Roman">Use the mouse again to click on the 
second image. Be sure to select the points on the same order you did the first 
ones.</font></p><p align="center">
      <span style="font-size: 12pt; font-family: Times New Roman;"><!--[if gte vml 1]><v:shape
 id="_x0000_s1032" type="#_x0000_t75" alt="" style='width:354pt;height:339.75pt'>
 <v:imagedata src="MosaickingTutorial_files/image006.jpg" o:href="http://www.geocities.com/sd2002leap/document3.jpg"/>
</v:shape><![endif]--><!--[if !vml]--><img src="MosaickingTutorial_files/image007.jpg" v:shapes="_x0000_s1032" border="0" height="453" width="472"><!--[endif]--></span></p>
      <p class="MsoNormal" style="text-indent: -0.25in; margin-left: 0.5in;" align="center">
&nbsp;</p><p class="MsoNormal" style="text-indent: -0.25in; margin-left: 0.5in;">
<font face="Times New Roman">9. Review the mosaicked image in Figure No. 2. If the image is distorted, at odd angles, or 
it is not satisfactory in general, run the script one more time.&nbsp; </font>
      </p><p align="center">
      <span style="font-size: 12pt; font-family: Times New Roman;"><!--[if gte vml 1]><v:shape
 id="_x0000_s1033" type="#_x0000_t75" alt="" style='width:348.75pt;height:305.25pt'>
 <v:imagedata src="MosaickingTutorial_files/image008.jpg" o:href="http://www.geocities.com/sd2002leap/document5.jpg"/>
</v:shape><![endif]--><!--[if !vml]--><img src="MosaickingTutorial_files/image009.jpg" v:shapes="_x0000_s1033" border="0" height="407" width="465"><!--[endif]--></span></p>
      <p class="MsoNormal" style="text-indent: -0.25in; margin-left: 0.5in;" align="center">
&nbsp;</p><p class="MsoNormal" style="text-indent: -0.25in; margin-left: 0.5in;">
10. <font face="Times New Roman">Go to File &gt; Save As, and save the image as 
*.jpg</font></p><p class="MsoNormal" style="text-indent: -0.25in; margin-left: 0.5in;">
11. <font face="Times New Roman">Open the image with the software of your choice 
(Photoshop, Paint, or any other) and make any changes if desired. </font></p><p class="MsoNormal" style="text-indent: -0.25in; margin-left: 0.5in;">
<font face="Times New Roman">12. Repeat steps 4 through 11 to mosaic two more 
images. You could use the image you just created to add one more sequence to it.</font></p><p>
<font face="Times New Roman">The source code to image mosaicking in Matlab is provided below:</font></p><p>
</p><hr size="4" width="90%">
<center>
<p>
<b><font face="Times New Roman">To be compiled with Matlab Editor/Debugger</font></b><br>
<font face="Times New Roman">Note: download the <a href="http://www.pages.drexel.edu/%7Esis26/Vision/MosaicKit.zip">MosaicKit</a> rather than cutting and pasting from below.<br>Use unzipping software to unzip the 
file. All the necessary files are included.</font></p>
</center>
<pre><font face="Times New Roman"><font size="3">Example of mosiac.m script for mosaicing images in Matlab:</font><br><br>I1 = double(imread('left.jpg'));                         	<font color="#008100">% loads image 1</font><br> [h1 w1 d1] = size(I1); <br>I2 = double(imread('right.jpg'));                       	<font color="#008100">% load images 2</font><br> [h2 w2 d2] = size(I2);&nbsp; <br><br> figure; 		 	              	<font color="#008100">% creates a new figure window</font>
subplot(1,2,1); 			</font><font color="#008100" face="Times New Roman" size="2">% divides current figure into 1(row) by 2(columns), it focuses 
				     on the 1st subfigure</font><font face="Times New Roman">
image(I1/255); 			<font color="#008100">% displays the image</font>
axis image; 				<font color="#008100">% displays the axis on the image</font>
hold on; <br>title('first input image'); <br>[X1 Y1] = ginput2(2); 			<font color="#008100">% gets two points from the user</font> 	<br>subplot(1,2,2); 			</font><font color="#008100" face="Times New Roman" size="2">% takes the previous figure window and focuses 
				     on the 2nd subfigure</font><font face="Times New Roman">
image(I2/255); axis image; hold on; <br>title('second input image'); <br>[X2 Y2] = ginput2(2); % get two points from the user&nbsp; <br><br><font color="#008100">% estimate parameter vector (t) </font><br>Z = [ X2'; Y2' ; Y2' -X2' ; 1 1 0 0; ; 0 0 1 1 ]';<br>xp = [ X1 ; Y1 ];<br>t = Z \ xp;                                      % solve the linear system<br>a = t(1); % = s cos(alpha)<br>b = t(2); % = s sin(alpha)<br>tx = t(3); <br>ty = t(4);&nbsp; <br><br><font color="#008100">% construct transformation matrix (T) </font><br>T = [a b tx ; -b a ty ; 0 0 1];&nbsp; <br><br><font color="#008100">% warps incoming corners to determine the size of the output image (in to out) </font><br>cp = T*[ 1 1 w2 w2 ; 1 h2 1 h2 ; 1 1 1 1 ];<br>Xpr = min( [ cp(1,:) 0 ] ) : max( [cp(1,:) w1] ); % min x : max x <br>Ypr = min( [ cp(2,:) 0 ] ) : max( [cp(2,:) h1] ); % min y : max y <br>[Xp,Yp] = ndgrid(Xpr,Ypr); <br>[wp hp] = size(Xp); % = size(Yp)&nbsp; <br><br><font color="#008100">% do backwards transform (from out to in) </font><br>X = T \ [ Xp(:) Yp(:) ones(wp*hp,1) ]'; % warp&nbsp; <br><br><font color="#008100">% re-sample pixel values with bilinear interpolation </font><br>clear Ip; <br>xI = reshape( X(1,:),wp,hp)'; <br>yI = reshape( X(2,:),wp,hp)'; <br>Ip(:,:,1) = interp2(I2(:,:,1), xI, yI, '*bilinear'); % red <br>Ip(:,:,2) = interp2(I2(:,:,2), xI, yI, '*bilinear'); % green <br>Ip(:,:,3) = interp2(I2(:,:,3), xI, yI, '*bilinear'); % blue&nbsp; <br><br><font color="#008100">% offset and copy original image into the warped image </font><br>offset =&nbsp; -round( [ min( [ cp(1,:) 0 ] ) min( [ cp(2,:) 0 ] ) ] ); <br>Ip(1+offset(2):h1+offset(2),1+offset(1):w1+offset(1),:) = <br>double(I1(1:h1,1:w1,:));&nbsp; <br><br><font color="#008100">% show the result </font><br>figure; image(Ip/255); axis image; <br>title('mosaic image');</font>
</pre>
<hr size="4" width="90%">

<h4><b><font face="Times New Roman">mosaic.m Code Description</font></b></h4>

<p><font face="Times New Roman">The mosaic.m script operates as follows: <br>
First, it converts the values of the images from unsigned int to double. This is 
done</font><font face="Times New Roman" size="3"> because most of the MATLAB 
operations use double as default type. Then, it asks for the points to be 
matched. Once it has this information it performs a transformation based on an 
estimate. The value of each pixel is then chosen using a bilinear interpolation. 
Finally, the mosaicked image is displayed.</font></p>

<font face="Times New Roman" size="3">      </font>

<h2>Final Words</h2>
      <p><font face="Times New Roman">The objective of this tutorial was to 
      teach the reader how to stitch together images by mosaicking them in 
      Matlab. We have created some more examples to give you a better idea of 
      what you can do with it. By now you should be able to mosaic any two 
      images. </font></p>
      <p><font face="Times New Roman">To give you an idea about the applications 
      of the system, it could be utilized for disaster migration, by providing 
      just one image of all the affected zones. It could also be used to create 
      rode maps, or monitor changes on a given area.</font></p>
      <p><font face="Times New Roman" size="4"><a href="http://www.pages.drexel.edu/%7Esis26/Mosaicking.htm">See more 
      examples</a></font></p>
<p>
<br>
<font face="Times New Roman">Click </font> <a href="mailto:sis26@drexel.edu">here</a> 
to email me  
</p><p>
    </p></blockquote>
      </td>
  </tr>
  </tbody></table>

</body></html>