<html><head>


<meta http-equiv="Content-Language" content="en-us">
<link rel="stylesheet" href="%5BDirect%20I_O%5D_files/style.css" type="text/css">
<script src="directio_data/code.js" type="text/javascript"></script>
<!-- base --><title>Samples</title>

<meta name="Microsoft Theme" content="paule 000, default">
<meta name="Microsoft Border" content="tb, default"></head><body onload="detect('/_nav/acaa.htm');" alink="#000000" bgcolor="#ffffff" link="#000000" text="#000000" vlink="#000000"><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><!--mstheme--><font face="arial, Arial, Helvetica"><!--mstheme--></font><table border="0" cellpadding="0" cellspacing="0" width="100%">
  <tbody><tr>
    <td rowspan="2" nowrap="nowrap" valign="middle" width="82"><!--mstheme--><font face="arial, Arial, Helvetica">
    <img src="directio_data/cfolder.gif" height="82" width="82"><!--mstheme--></font></td>
    <td nowrap="nowrap" valign="bottom" width="100%"><!--mstheme--><font face="arial, Arial, Helvetica"><strong><font color="#0094ff" size="6">&nbsp;&nbsp;Samples</font></strong><!--mstheme--></font></td>
  </tr>
  <tr>
    <td align="right" nowrap="nowrap" valign="top" width="100%"><!--mstheme--><font face="arial, Arial, Helvetica"><hr noshade="noshade" size="1">
    <!--mstheme--></font><table border="0" cellpadding="0" cellspacing="0">
      <tbody><tr>
        <td style="padding-top: 2px;" nowrap="nowrap" valign="top"><!--mstheme--><font face="arial, Arial, Helvetica"><form>
          <p><select name="Sel" size="1" onchange="Go(this.form.Sel.options[this.form.Sel.options.selectedIndex].value);">
            <option value="-">Goto ...</option>
            <option value="http://www.paule.de">Home of Paule</option>
            <option value="/directio.htm">- Direct I/O</option>
            <option value="/Direct-IO/whatsnew.htm">&nbsp;&nbsp;- What's New</option>
            <option value="/Direct-IO/faq.htm">&nbsp;&nbsp;- FAQ</option>
            <option value="/Direct-IO/samples.htm">&nbsp;&nbsp;- Samples</option>
            <option value="/Direct-IO/download.htm">&nbsp;&nbsp;- Download</option>
            <option value="/Direct-IO/order.htm">&nbsp;&nbsp;- Order</option>
            <option value="/Direct-IO/comments.htm">&nbsp;&nbsp;- Comments</option>
            <option value="/Direct-IO/contact.htm">&nbsp;&nbsp;- Contact</option>
            <option value="/kb/kbsearch.htm">&nbsp;&nbsp;- Knowledge Base</option>
            <option value="/search.htm">- Search</option>
          </select>&nbsp;&nbsp;&nbsp;&nbsp;</p>
        </form>
        <!--mstheme--></font></td>
        <td nowrap="nowrap" valign="top"><!--mstheme--><font face="arial, Arial, Helvetica">
        <a href="http://www.direct-io.com/Direct-IO/faq.htm"><img src="directio_data/back_cmp_paule000_back.gif" alt="Prev" align="middle" border="0" height="22" width="72"></a> <a href="http://www.direct-io.com/directio.htm"><img src="directio_data/up_cmp_paule000_up.gif" alt="Up" align="middle" border="0" height="22" width="72"></a> <a href="http://www.direct-io.com/Direct-IO/download.htm"><img src="directio_data/next_cmp_paule000_next.gif" alt="Next" align="middle" border="0" height="22" width="72"></a><!--mstheme--></font></td>
      </tr>
    </tbody></table><!--mstheme--><font face="arial, Arial, Helvetica"><!--mstheme--></font></td>
  </tr>
  <tr>
    <td colspan="2" height="10" nowrap="nowrap"><!--mstheme--><font face="arial, Arial, Helvetica"><!--mstheme--></font></td>
  </tr>
</tbody></table><!--mstheme--><font face="arial, Arial, Helvetica"><!--mstheme--></font></td></tr><!--msnavigation--></tbody></table><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><!--msnavigation--><td valign="top"><!--mstheme--><font face="arial, Arial, Helvetica"><span id="contentstart">
<p>To give you an idea how easy it is to use 
<!--webbot bot="Substitution"
S-Variable="DirectIo" startspan -->Direct I/O<!--webbot bot="Substitution" endspan i-checksum="18435" --> we would like to show you step-by-step how to integrate 
<!--webbot
bot="Substitution" S-Variable="DirectIo" startspan -->Direct I/O<!--webbot
bot="Substitution" endspan i-checksum="18435" --> with your own application.<br>
Let's imagine you have to write an application named MYAPP.EXE to control a special
hardware with I/O ports in the range 310-31Fh. </p>

<ol>
  <li>Enter the resources needed:<br>
    <img src="directio_data/cpl_port.gif" alt="Port tab of the Control Panel" border="0" height="257" vspace="10" width="344"></li>
  <li>Give your application the right to access these resources:<br>
    <img src="directio_data/cpl_security.gif" alt="Security tab of Control Panel" height="257" vspace="10" width="344"></li>
  <li>Write your application:<ul>
      <li><a href="#C">C / C++</a></li>
      <li><a href="#VB">VisualBasic</a></li>
      <li><a href="#Delphi">Delphi</a></li>
      <li>Other languages (if you want to share your solution <a href="http://www.direct-io.com/Direct-IO/Contact.htm#Email">write us</a> and we add it to the list giving you the
        credits you deserve)</li>
    </ul>
    <p>Note: During debugging you may have to add your development application to the Security
    section (see 2.) too.<br>
    Some debuggers - for example VB - execute your code under their control.<br>
    &nbsp;</p>
  </li>
</ol>

<p>And that's all folks! As I said... Easy.</p>

<hr noshade="noshade" size="1">

<h3><a name="C">C / C++ Code:</a></h3>
<div align="left">

<!--mstheme--><table bgcolor="#ffffff" border="0" cellpadding="10" cellspacing="1">
  <tbody><tr>
    <td bgcolor="#000000"><!--mstheme--><font face="arial, Arial, Helvetica"><!--mstheme--></font><pre><code><font color="#ffffff">// part of the really cool application MYAPP
HANDLE hDevice;
hDevice = CreateFile(
    "\\\\.\\DirectIo0",	                // pointer to name of the file
    GENERIC_READ | GENERIC_WRITE,       // access (read-write) mode
    FILE_SHARE_READ | FILE_SHARE_WRITE,	// share mode
    NULL,                               // pointer to security attributes
    OPEN_EXISTING,                      // how to create
    0,                                  // file attributes
    NULL);                              // handle to file with attributes to copy
if (hDevice == INVALID_HANDLE_VALUE)    // did we succeed?
{
    // possibly call GetLastError() to get a hint what failed
    // and terminate (it is useless to continue if we can&#8217;t connect to Direct I/O)
}

// some more processing...

while (_inp(0x310) &amp; 0x01)    // loop while not ready
    ;
_outpw(0x312, 0x1234);    // write a secret word</font></code>                         </pre><!--mstheme--><font face="arial, Arial, Helvetica"><!--mstheme--></font></td>
  </tr>
</tbody></table><!--mstheme--><font face="arial, Arial, Helvetica">
</font></div>

<hr noshade="noshade" size="1">

<h3><font face="arial, Arial, Helvetica"><a name="VB"><strong>VisualBasic Code:</strong></a></font></h3>
<div align="left">

<!--mstheme--><table bgcolor="#ffffff" border="0" cellpadding="10" cellspacing="1">
  <tbody><tr>
    <td bgcolor="#000000"><!--mstheme--><font face="arial, Arial, Helvetica"><!--mstheme--></font><pre><code><font color="#ffffff">' We have to call the Win32 API (see Direct I/O online help)
' Declare the neccessary functions and constants
Private Declare Function CreateFile Lib "KERNEL32" Alias "CreateFileA" ( _
    ByVal lpFileName As String, _
    ByVal dwDesiredAccess As Long, _
    ByVal dwShareMode As Long, _
    ByVal lpSecurityAttributes As Long, _
    ByVal dwCreationDisposition As Long, _
    ByVal dwFlagsAndAttributes As Long, _
    ByVal hTemplateFile As Long) As Long
Private Const GENERIC_READ As Long = &amp;H80000000
Private Const GENERIC_WRITE As Long = &amp;H40000000
Private Const FILE_SHARE_READ As Long = 1
Private Const FILE_SHARE_WRITE As Long = 2
Private Const OPEN_EXISTING As Long = 3
Private Const INVALID_HANDLE_VALUE As Long = -1

' Unfortunately (?!?) VB doesn't provide functions for hardware access.
' So we have to take a 3rd party supplement (there are many freeware libs around, 
' search the web for Win95io.zip or inpout32.zip).
' The following code is taken from Win95io:
Private Declare Sub vbOut Lib "WIN95IO.DLL" ( _
    ByVal nPort As Integer, _
    ByVal nData As Integer)
Private Declare Sub vbOutw Lib "WIN95IO.DLL" ( _
    ByVal nPort As Integer, _
    ByVal nData As Integer)
Private Declare Function vbInp Lib "WIN95IO.DLL" ( _
    ByVal nPort As Integer) As Integer
Private Declare Function vbInpw Lib "WIN95IO.DLL" ( _
    ByVal nPort As Integer) As Integer


Private Sub Form_Load()
    Dim hDevice As Long
    hDevice = CreateFile("\\.\DirectIo0", GENERIC_READ Or GENERIC_WRITE, _
        FILE_SHARE_READ Or FILE_SHARE_WRITE, 0&amp;, OPEN_EXISTING, 0&amp;, 0&amp;)
    If hDevice = INVALID_HANDLE_VALUE Then
        ' ask what went wrong
        MsgBox "Unable to open driver (error code = " &amp; Err.LastDllError &amp; _
            "). Aborting..."
        ' terminate (it is useless to continue if we can&#8217;t connect to Direct I/O)
        End
    End If
End Sub


Private Sub Read_Click()
    Value = vbInp(Port)
End Sub


Private Sub Write_Click()
    vbOut Port, Value
End Sub                         </font></code>                                                 </pre><!--mstheme--><font face="arial, Arial, Helvetica"><!--mstheme--></font></td>
  </tr>
</tbody></table><!--mstheme--><font face="arial, Arial, Helvetica"><font face="arial, Arial, Helvetica">
</font></font></div>

<p><font face="arial, Arial, Helvetica"><font face="arial, Arial, Helvetica">Download the support DLL for the sample above:</font></font></p>

<!--mstheme--><font face="arial, Arial, Helvetica"><font face="arial, Arial, Helvetica"></font><table border="0" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td align="center" width="150"><!--mstheme--><font face="arial, Arial, Helvetica"><a href="ftp://ftp.softcircuits.com/tools/win95io.zip" class="TL" name="ftp://ftp.softcircuits.com/tools/win95io.zip"><img src="directio_data/zip.gif" border="0" height="32" width="32"><br>
    Win95io.zip<br>
    (3 k)<br>
    Jul 31, 1997</a><!--mstheme--></font></td>
  </tr>
</tbody></table><!--mstheme--><font face="arial, Arial, Helvetica">

</font></font><p><font face="arial, Arial, Helvetica"><font face="arial, Arial, Helvetica">Note: Ignore the warnings about 
<!--webbot bot="Substitution" S-Variable="WindowsNT" startspan
-->Windows NT<!--webbot bot="Substitution" endspan i-checksum="18823"
-->. You have <!--webbot bot="Substitution" S-Variable="DirectIo" startspan -->Direct I/O<!--webbot bot="Substitution" endspan i-checksum="18435" --> :-)</font></font></p>

<hr noshade="noshade" size="1">

<h3><font face="arial, Arial, Helvetica"><font face="arial, Arial, Helvetica"><a name="Delphi"><strong>Delphi Code:</strong></a></font></font></h3>

<p><font face="arial, Arial, Helvetica"><font face="arial, Arial, Helvetica">This sample has been provided by <a href="mailto:claudio.klingler@newtec.de">Claudio
Klingler</a></font></font></p>
<div align="left">

<!--mstheme--><table bgcolor="#ffffff" border="0" cellpadding="10" cellspacing="1">
  <tbody><tr>
    <td bgcolor="#000000"><!--mstheme--><font face="arial, Arial, Helvetica"><!--mstheme--></font><pre><code><font color="#ffffff">unit directio;
interface
uses
  Windows, Messages, SysUtils, Classes, Graphics, Controls, Forms, Dialogs, WinTypes;

type
  TForm1 = class(TForm)
    procedure FormCreate(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form1: TForm1;

implementation

{$R *.DFM}

function PortIn(IOAddr : WORD) : WORD;
begin
    asm
        mov dx,IOAddr
        in  ax,dx
        mov result,ax
    end;
end;

procedure PortOut(IOAddr : WORD; Data : WORD);
begin
    asm
        mov  dx,IOAddr
        mov  ax,Data
        out  dx,ax
    end;
end;

procedure TForm1.FormCreate(Sender: TObject);
var hDevice : HWND;
begin
    hDevice := CreateFile(
        '\\.\DirectIo0',                 // pointer to name of the file
        GENERIC_READ or GENERIC_WRITE,       // access (read-write) mode
        FILE_SHARE_READ or FILE_SHARE_WRITE, // share mode
        NIL,                               // pointer to security attributes
        OPEN_EXISTING,                      // how to create
        0,                                  // file attributes
        0);                              // handle to file with attributes to copy
    if (hDevice = INVALID_HANDLE_VALUE) then    // did we succeed?
    begin
        Application.MessageBox('Error', 'error', MB_OK);
        // possibly call GetLastError() to get a hint what failed
        // and terminate (it is useless to continue if we can&#8217;t connect to Direct I/O)
    end;

    // some more processing...

    while (PortIn($0310) and $01 = $01) do
    begin
        // Loop
    end;
    PortOut($0312, $01234);    // write a secret word
end;

end.</font></code>                                                 </pre><!--mstheme--><font face="arial, Arial, Helvetica"><!--mstheme--></font></td>
  </tr>
</tbody></table><!--mstheme--><font face="arial, Arial, Helvetica"><font face="arial, Arial, Helvetica"><font face="arial, Arial, Helvetica">
</font></font></font></div>
</span><!--mstheme--><font face="arial, Arial, Helvetica"><font face="arial, Arial, Helvetica"><font face="arial, Arial, Helvetica"></font><!--msnavigation--></font></font></font></td></tr><!--msnavigation--></tbody></table><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><!--mstheme--><font face="arial, Arial, Helvetica">
<hr noshade="noshade" size="1">

<!--mstheme--></font><table style="border-collapse: collapse;" id="AutoNumber1" border="0" cellpadding="0" cellspacing="0" width="100%">
  <tbody><tr>
    <td colspan="2"><!--mstheme--><font face="arial, Arial, Helvetica"><small>
    Direct I/O<sup>®</sup> and Paule<sup>®</sup>
are registrated trademarks of 
Ingenieurbuero Paule.
All other products mentioned are registered trademarks or trademarks of their respective
<span lang="de">owners</span>.</small><!--mstheme--></font></td>
  </tr>
  <tr>
    <td><!--mstheme--><font face="arial, Arial, Helvetica"><small>Questions or problems regarding this web site should be directed to <a href="mailto:webmaster@direct-io.com">Webmaster</a>.<br>
Copyright © <span lang="de">1998-</span>200<span lang="de">7</span> 
Ingenieurbuero Paule. All rights
reserved. <a target="_blank" href="http://www.direct-io.com/Direct-IO/impressum.htm">Impressum</a>.<br>
Last modified: 
2003-11-12.</small><!--mstheme--></font></td>
    <td align="right" valign="bottom"><!--mstheme--><font face="arial, Arial, Helvetica">
    <a href="javascript:PrintThisPage();">
    <img src="directio_data/printer.gif" alt="Printer friendly" border="0" height="29" width="32"></a><!--mstheme--></font></td>
  </tr>
</tbody></table><!--mstheme--><font face="arial, Arial, Helvetica"><!--mstheme--></font></td></tr><!--msnavigation--></tbody></table></body></html>