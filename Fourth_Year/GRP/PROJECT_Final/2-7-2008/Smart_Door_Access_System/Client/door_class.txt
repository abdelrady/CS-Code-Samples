using System;
using System.Collections.Generic;
using System.Text;
using System.Threading;
using System.Windows.Forms;

namespace SmartDoor
{

    class Door
    {
        private Thread DoorOpen_CloseThread;  
        private  int PinOpen  = 1;
        private  int PinClose = 2;
        private  int PinStop = 0;
        ClientFrm ggg;
        public Door(bool Invertbins,ClientFrm gg)
        {
            ggg = gg;          
            DoorOpen_CloseThread = new Thread(new ThreadStart(CheckStatus));
            DoorOpen_CloseThread.Start();
            porting.Out(int.Parse(Configuration.LptPortAddressBase), PinStop);
            if (Invertbins)
            { 
                PinOpen  = 2; 
                PinClose = 1; 
            }
        }

        public void InvertBins()
        {
            int temp = PinOpen;
            PinOpen = PinClose;
            PinClose = temp; 
        }

        public void Open_The_Door()
        {
            lock (this)
            {
                //open The Door
                porting.Out(int.Parse(Configuration.LptPortAddressBase), PinOpen);

                //wait To Enter
                Thread.Sleep(int.Parse(Configuration.WaitOnOpened)); 

                //Close The Door
                porting.Out(int.Parse(Configuration.LptPortAddressBase), PinClose);   
              }           
        }

        private void CheckStatus()
        {
            int x;
            while (true)
            {
                Thread.Sleep(300);
                x = porting.Inp(int.Parse(Configuration.LptPortAddressBase)+1);
                ggg.settxt(x.ToString());
                if (x == 88 || x == 104)
                {
                    porting.Out(int.Parse(Configuration.LptPortAddressBase), PinStop);                       

                }
                        
            }    

        }       
    }
}
