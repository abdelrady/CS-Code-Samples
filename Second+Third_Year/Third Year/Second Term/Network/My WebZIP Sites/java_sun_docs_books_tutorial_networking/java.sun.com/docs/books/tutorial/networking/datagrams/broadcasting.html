<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
    <head>
        <title>Broadcasting to Multiple Recipients (The Java&trade; Tutorials &gt; 
            Custom Networking &gt; All About Datagrams)
</title>
<style type="text/css">
    .FigureCaption   { 
        margin-left: 1in; 
        margin-right: 1in; 
        font-family: sans-serif; 
        font-size: smaller; 
        text-align: justify;
    }
    #TopBar_bl {
        background: url(../../images/java_bar_bl.gif) 0 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_br {
        background: url(../../images/java_bar_br.gif) 100% 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tl {
        background: url(../../images/java_bar_tl.gif) 0 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tr {
        background: url(../../images/java_bar_tr.gif) 100% 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar {
        background: #35556B url(../../images/java_bar.gif);
        margin: 10px 10px 0 10px;
        height:60px;
        min-width:700px;
        color: white;
        font-family: sans-serif; 
        font-weight: bold;
    }
    @media print {
        #BreadCrumbs, #Download {
            display: none;
        }
    }
    #TopBar_right {
        line-height: 14px;
        float: right;
        padding-top: 2px;
        padding-right: 30px;
        text-align: center;
    }
    @media print {
        #TopBar_right {
            display: none;
        }
    }
    #TopBar_right a {
        font-size: 12px;
        margin: 3px;
        padding: 0;
    }
    #TopBar a:visited, #TopBar a:link {
        color: white;
        text-decoration: none;
    }
    #TopBar a:hover, #TopBar a:active  {
        background-color: white;
        color: #35556B;
    }
    #BreadCrumbs {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
        float: right;
    }
    #BreadCrumbs a {
        color: blue;
    }
    #BreadCrumbs a:visited, #BreadCrumbs a:link {
        text-decoration: none;
    }
    #BreadCrumbs a:hover, #BreadCrumbs a:active {
        text-decoration: underline;
    }
    #PageTitle {
        margin: 0 5px 0.5em 0;
        color: #E76F00;
        font-family: sans-serif; 
        font-weight: bold;
        font-size: 20px;
    }
    .LeftBar_shown {
        width: 13em;
        float: left;
        margin-left: 10px;
        margin-top: 4px;
        margin-bottom: 2em;
    }
    @media print {
        .LeftBar_shown {
            display: none;
        }
    }
    .LeftBar_hidden {
        display: none;
    }
    #Footer {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    .NavBit  {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
    }
    @media print {
        .NavBit {
            display: none;
        }
    }
    #TagNotes {
        text-align: right;
        font-size: smaller;
        font-family: sans-serif; 
    }
    @media print {
        #TagNotes a:visited, #TagNotes a:link {
            color: #35556B;
            text-decoration: none;
        }
    }
    #Contents a, .NavBit a, #TagNotes a {
        color: blue
    }
    #TagNotes a:visited, #TagNotes a:link,
    #Contents a:visited, #Contents a:link,
    .NavBit a:visited, .NavBit a:link {
        text-decoration: none;
    }
    #TagNotes a:hover, #TagNotes a:active,   
    #Contents a:hover, #Contents a:active,   
    .NavBit a:hover, .NavBit a:active {  
        text-decoration: underline;
    }
    #Contents {
        float: left;
        font-family: sans-serif; 
    }
    @media print {
        #Contents {
            display: none;
        }
    }
    @media screen {
        div.PrintHeaders {
            display: none;
        }
    }
    .linkLESSON, .nolinkLESSON {
        margin-left: 0.5em;
        text-indent: -0.5em
    }
    .linkAHEAD, .nolinkAHEAD, .linkQUESTIONS, .nolinkQUESTIONS   {
        margin-left: 1.5em; 
        text-indent: -0.5em
    }
    .linkBHEAD, .nolinkBHEAD   {
        margin-left: 2.5em;
        text-indent: -0.5em
    }
    .linkCHEAD, .nolinkCHEAD   {
        margin-left: 3.5em;
        text-indent: -0.5em
    }
    .nolinkLESSON, .nolinkAHEAD, .nolinkBHEAD, .nolinkCHEAD,
    .nolinkQUESTIONS {
        font-weight: bold;
        color: #E76F00;
    }
    .MainFlow_indented {
        margin-right: 10px;
        margin-left: 15em;
        margin-bottom: 2em;

    }
    .MainFlow_wide {
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 2em;

    }
    @media print {
        .MainFlow_indented, .MainFlow_wide {
            padding-top: 0;
            margin-top: 10px;
            margin-right: 10px;
            margin-left: 0;
        }
    }
    h3, h4, h5 {
        color: #E76F00;
        font-family: sans-serif;
    }
    #ToggleLeft {
        display: none;
    }

    /t

</style>
<script type="text/javascript">
    function leftBar() {
        var nameq = 'tutorial_showLeftBar='
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookieString = cookies[i];
            while (cookieString.charAt(0) == ' ') {
                cookieString = cookieString.substring(1, cookieString.length);
            }
            if (cookieString.indexOf(nameq) == 0) {
                cookieValue =  cookieString.substring(nameq.length,
                        cookieString.length);
                return cookieValue == 'yes';
            }
        }
        return true;
    }

    function showLeft(b) {
        var contents = document.getElementById("LeftBar");
        var main = document.getElementById("MainFlow");
        var toggle = document.getElementById("ToggleLeft");
        if (b) {
            contents.className = "LeftBar_shown";
            main.className = "MainFlow_indented";
            toggle.innerHTML = "Hide the TOC";
            document.cookie = 'tutorial_showLeftBar=yes; path=/';
        } else {
            contents.className = "LeftBar_hidden";
            main.className = "MainFlow_wide";
            toggle.innerHTML = "Show the TOC";
            document.cookie = 'tutorial_showLeftBar=no; path=/';
        }
    }

    function toggleLeft() {
        showLeft(document.getElementById("LeftBar").className ==
                "LeftBar_hidden");
        document.getElementById("ToggleLeft").blur();
    }

    function load() {
        showLeft(leftBar());
        document.getElementById("ToggleLeft").style.display="inline";
    }
    
</script>

    </head>
<body onload="load()">


<!-- Copyright © 2005. Spidersoft Ltd -->
<style>
A.applink:hover {border: 2px dotted #DCE6F4;padding:2px;background-color:#ffff00;color:green;text-decoration:none}
A.applink       {border: 2px dotted #DCE6F4;padding:2px;color:#2F5BFF;background:transparent;text-decoration:none}
A.info          {color:#2F5BFF;background:transparent;text-decoration:none}
A.info:hover    {color:green;background:transparent;text-decoration:underline}
</style>
<div style='BORDER: 1px solid #DCE6F4; MARGIN-TOP: 20px; MARGIN-BOTTOM: 20px; MARGIN-LEFT: 5px; MARGIN-RIGHT: 5px; PADDING: 5px; BACKGROUND-COLOR: #eef8ff;line-height:180%; COLOR: #000000; font-family: Arial; font-size: 8pt; width=100%; FILTER: progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr="#FFFFFFFF", EndColorStr="#F2F5FAFF");'>
This page was saved using <a class="applink" href="http://www.spidersoft.com"><b>WebZIP 7.0.3.1030</b></a> <a class="applink" href="http://www.spidersoft.com"><b>offline browser</b></a>  (Unregistered) on  02/12/07 7:59:23 PM.<br>
<b>Address:</b> <a class="info" href="http://java.sun.com/docs/books/tutorial/networking/datagrams/broadcasting.html">http://java.sun.com/docs/books/tutorial/networking/datagrams/broadcasting.html</a><br>
<b>Title:</b> Broadcasting to Multiple Recipients (The Java&trade; Tutorials &gt;             Custom Networking &gt; All About Datagrams) &nbsp;&bull;&nbsp; <b>Size:</b> 16287 &nbsp;&bull;&nbsp; <b>Last Modified:</b> Fri, 10 Nov 2006 00:58:21 GMT<br></div>
<!-- /Copyright © 2005. Spidersoft Ltd -->


    <div id=TopBar> <div id=TopBar_tr> <div id=TopBar_tl> <div id=TopBar_br> <div id=TopBar_bl> 
                        <div id=TopBar_right> 
                            <a target="_blank"
                                href="http://java.sun.com/javase/6/download.jsp">Download
                                the JDK</a>
                            <br>
                            <a href="http://java.sun.com/docs/books/tutorial/search.html" target="_blank">Search the
                                Tutorials</a>
                            <br>
                            <a href="javascript:toggleLeft()"
                                id="ToggleLeft">Hide the TOC</a>
                        </div>
                    </div> </div> </div> </div> </div>
    <div class=PrintHeaders>
        <b>Trail:</b> Custom Networking
        <br><b>Lesson:</b> All About Datagrams
    </div>

    <div id=LeftBar class=LeftBar_shown>
        <div id=Contents>
            <div class="linkLESSON"><a href="index.html">All About Datagrams</a></div>
<div class="linkAHEAD"><a href="definition.html">What Is a Datagram?</a></div>
<div class="linkAHEAD"><a href="clientServer.html">Writing a Datagram Client and Server</a></div>
<div class="nolinkAHEAD">Broadcasting to Multiple Recipients</div>
</div>
    </div>
    <div id=MainFlow class=MainFlow_indented>
            <span id=BreadCrumbs>
                <a href=http://java.sun.com/docs/books/tutorial/index.html target=_top>Home Page</a>
                &gt;
                <a href=../index.html target=_top>Custom Networking</a>
                &gt;
                <a href=index.html target=_top>All About Datagrams</a>
            </span>
            <div class=NavBit>
                <a target=_top href=clientServer.html>&laquo;&nbsp;Previous</a>&nbsp;&bull;&nbsp;<a target=_top href=../TOC.html>Trail</a>&nbsp;&bull;&nbsp;<a target=_top href=../end.html>Next&nbsp;&raquo;</a>
            </div>
            <div id=PageTitle>Broadcasting to Multiple Recipients</div>
            <blockquote>
In addition to <code>DatagramSocket</code>, which lets programs send
packets to one another, java.net includes a class called
<code>MulticastSocket</code>. This kind of socket is used on the
client-side to listen for packets that the server broadcasts to
multiple clients.
<p>
Let's rewrite the quote server so that it broadcasts
<code>DatagramPacket</code>s to multiple recipients. Instead of sending
quotes to a specific client that makes a request, the new server now
needs to broadcast quotes at a regular interval. The client needs to be
modified so that it passively listens for quotes and does so on a
<code>MulticastSocket</code>.
<p>
This example is comprised of three classes which are modifications of
the three classes from the previous example:

<a class="SourceLink" target="_blank" href="examples/MulticastServer.java"><code>MulticastServer</code></a>,

<a class="SourceLink" target="_blank" href="examples/MulticastServerThread.java"><code>MulticastServerThread</code></a>, and

<a class="SourceLink" target="_blank" href="examples/MulticastClient.java"><code>MulticastClient</code></a>.
This discussion highlights
the interesting parts of these classes.
<p>
Here is the new version of the server's main program.
The differences between this code and the previous version,
<code>QuoteServer</code>, are shown in bold:
<blockquote><pre>
import java.io.*;
public class <strong>MulticastServer</strong> {
    public static void main(String[] args) throws IOException {
        new <strong>MulticastServerThread</strong>().start();
    }
}
</pre></blockquote>
Basically, the server got a new name
and creates a <code>MulticastServerThread</code>
instead of a <code>QuoteServerThread</code>.
Now let's look at the <code>MulticastServerThread</code>
which contains the heart of the server. Here's its class declaration:
<blockquote><pre>
public class MulticastServerThread extends QuoteServerThread {
    ...
}
</pre></blockquote>
We've made this class a subclass of <code>QuoteServerThread</code>
so that it can use the constructor,
and inherit some member variable and the <code>getNextQuote</code> method.
Recall that <code>QuoteServerThread</code> creates a
<code>DatagramSocket</code> bound to port 4445 and opens the quote file.
The <code>DatagramSocket</code>'s port number doesn't actually matter
in this example because the client never send anything to the server.
<p>
The only method explicitly implemented in <code>MulticastServerThread</code>
is its <code>run</code> method. The differences between this <code>run</code>
method and the one in <code>QuoteServerThread</code> are shown in bold:
<blockquote><pre>
public void run() {
    while (moreQuotes) {
        try {
            byte[] buf new byte[256];
            <strong>// don't wait for request...just send a quote</strong>

            String dString = null;
            if (in == null)
                dString = new Date().toString();
            else
                dString = getNextQuote();
            buf = dString.getBytes();

            <strong>InetAddress group = InetAddress.getByName(
                                            "230.0.0.1");</strong>
            DatagramPacket packet;
            packet = new DatagramPacket(buf, buf.length, 
                                        <strong>group, 4446</strong>);
            socket.send(packet);

            try {
                sleep((long)Math.random() * FIVE_SECONDS);
            } catch (InterruptedException e) { }
        } catch (IOException e) {
            e.printStackTrace();
            moreQuotes = false;
        }
    }
    socket.close();
}
</pre></blockquote>
The interesting change is how the <code>DatagramPacket</code> is
constructed, in particular, the <code>InetAddress</code> and port used to construct
the <code>DatagramPacket</code>. Recall that the previous example
retrieved the <code>InetAddress</code> and port number from the packet sent to the
server from the client. This was because the server needed to reply
directly to the client. Now, the server needs to address multiple
clients. So this time both the <code>InetAddress</code> and the port number are
hard-coded.
<p>
The hard-coded port number is 4446 (the client must have a
<code>MulticastSocket</code> bound to this port). The hard-coded
<code>InetAddress</code> of the <code>DatagramPacket</code> is "230.0.0.1" and is a
group identifier (rather than the Internet address of the machine on
which a single client is running). This particular address was
arbitrarily chosen from the reserved for this purpose.
<p>
Created in this way, the <code>DatagramPacket</code> is destined for
all clients listening to port number 4446 who are member of the
"230.0.0.1" group.
<p>
To listen to port number 4446, the new client program just created its
<code>MulticastSocket</code> with that port number. To become a member
of the "230.0.0.1" group, the client calls the
<code>MulticastSocket</code>'s <code>joinGroup</code> method with the
<code>InetAddress</code> that identifies the group. Now, the client is set up to
receive <code>DatagramPacket</code>s destined for the port and group
specified. Here's the relevant code from the new client program (which
was also rewritten to passively receive quotes rather than actively
request them). The bold statements are the ones that interact with the
<code>MulticastSocket</code>:
<blockquote><pre>
<strong>MulticastSocket socket = new MulticastSocket(4446);
InetAddress group = InetAddress.getByName("230.0.0.1");
socket.joinGroup(group);</strong>

DatagramPacket packet;
for (int i = 0; i &lt; 5; i++) {
    byte[] buf = new byte[256];
    packet = new DatagramPacket(buf, buf.length);
    <strong>socket.receive(packet);</strong>

    String received = new String(packet.getData());
    System.out.println("Quote of the Moment: " + received);
}
<strong>socket.leaveGroup(group);</strong>
socket.close();
</pre></blockquote>
Notice that the server uses a <code>DatagramSocket</code> to broadcast
packet received by the client over a <code>MulticastSocket</code>.
Alternatively, it could have used a <code>MulticastSocket</code>. The
socket used by the server to send the <code>DatagramPacket</code> is
not important. What's important when broadcasting packets is the
addressing information contained in the <code>DatagramPacket</code>,
and the socket used by the client to listen for it
<p>

<blockquote><hr><strong>Try this:</strong>&nbsp;
Run the <code>MulticastServer</code> and several clients.
Watch how the clients all get the same quotes.	
<hr></blockquote>

        </blockquote>
        <div class=NavBit>
            <a target=_top href=clientServer.html>&laquo; Previous</a>
            &bull;
            <a target=_top href=../TOC.html>Trail</a>
            &bull;
            <a target=_top href=../end.html>Next &raquo;</a>
        </div>
    </div>
    <div id=Footer>
<div id=TagNotes>
    Problems with the examples? Try <a target="_blank"
        href=http://java.sun.com/docs/books/tutorial/information/run-examples.html>Compiling and Running
        the Examples: FAQs</a>.
    <br>
    Complaints? Compliments? Suggestions? <a target="_blank"
        href="http://developer.sun.com/contact/tutorial_feedback.jsp">Give
    us your feedback</a>.
<br><br>
    <a target="_blank" href="http://java.sun.com/docs/books/tutorial/information/copyright.html">Copyright</a>
    1995-2006 Sun Microsystems, Inc.  All rights reserved.
    <span id=Download>
</span></div> 

    </div>
    <div class=PrintHeaders>
        <b>Previous page:</b> Writing a Datagram Client and Server
        <br><b>Next page:</b> End of Trail
    </div>
    </body>
<script language="JavaScript" src="../../../../../js/omi/jsc/s_code_remote.js"></script></html> 
