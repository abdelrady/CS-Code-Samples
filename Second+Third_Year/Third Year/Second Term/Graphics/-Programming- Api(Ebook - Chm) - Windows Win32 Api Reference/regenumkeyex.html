<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<HTML lang="en-us">
<HEAD>
<TITLE>Windows API Guide: RegEnumKeyEx Function</TITLE>
<META content="vbapi@vbapi.com" name="author">
<META content="Information about the RegEnumKeyEx function in the Windows API, geared towards the Visual Basic user." name="description">
<META content="Kuliniewicz,Windows,Windows 95,Windows NT,Windows 98,Windows CE,Windows 2000,API,Application Programming Interface,Programming,Visual Basic,Basic,VB,RegEnumKeyEx" name="keywords">
<META content="Omicron HTML Editor" name="generator">
<LINK href="default.css" tppabs="http://www.vbapi.com/css/default.css" rel="stylesheet" type="text/css">
<LINK href="index-1.html" tppabs="http://www.vbapi.com/index.html" rel="home">
<LINK href="glossary.html" tppabs="http://www.vbapi.com/ref/glossary.html" rel="glossary">
<LINK href="copyrite.html" tppabs="http://www.vbapi.com/copyrite.html" rel="copyright">
</HEAD>
<BODY>

<!-- Begin Adslot1 -->
<CENTER>
<SCRIPT language="JAVASCRIPT">
<!-- hide from older browsers
now = new Date();
my_random = now.getTime();
document.write('<A href="http://adex3.flycast.com/server/socket/127.0.0.1:2800/click/VBWorldnet/VBAPI/' + my_random + '">');
document.write('<IMG width="468" height="60" border="1" src="http://adex3.flycast.com/server/socket/127.0.0.1:2800/ad/VBWorldnet/VBAPI/' + my_random + '"></A>');
// -->
</SCRIPT>
</CENTER>
<!-- End Adslot1 -->

<HR>

<H1>RegEnumKeyEx Function</H1>

<P><CODE class="declare">Declare Function RegEnumKeyEx Lib "advapi32.dll" Alias "RegEnumKeyExA" (ByVal hKey As Long, ByVal dwIndex As Long, ByVal lpName As String, lpcbName As Long, lpReserved As Long, ByVal lpClass As String, lpcbClass As Long, lpftLastWriteTime As <A href="filetime.html" tppabs="http://www.vbapi.com/ref/f/filetime.html">FILETIME</A>) As Long</CODE></P>

<H2>Platforms</H2>
<UL>
<LI><B>Windows 95:</B> Supported.
<LI><B>Windows 98:</B> Supported.
<LI><B>Windows NT:</B> Requires Windows NT 3.1 or later.
<LI><B>Windows 2000:</B> Supported.
<LI><B>Windows CE:</B> Requires Windows CE 1.0 or later.
</UL>

<H2>Description &amp; Usage</H2>
<P><B>RegEnumKeyEx</B> enumerates all of the subkeys under a given key.  The function retrieves the subkey name, class name, and last write time of each subkey.  The key under which the subkeys are enumerated must have been opened with subkey-enumeration access (see the example).  The program must use the function in a loop, incrementing the index value (which determines which subkey is identified) until the list has been exhaused.  The subkeys are not retrieved in any clear order.</P>

<H2>Return Value</H2>
<P>If an error occured, the function returns a non-zero error code.  If successful, the function returns 0.</P>

<H2>Visual Basic-Specific Issues</H2>
<P>None.</P>

<H2>Parameters</H2>
<P><DL>
<DT><VAR>hKey</VAR><DD>A <A class="def" href="glossary.html#handle" tppabs="http://www.vbapi.com/ref/glossary.html#handle" rel="glossary">handle</A> to the open registry key containing the subkeys to be enumerated (having been opened with subkey-enumeration access).  This could also be one of the following flags identifying a predefined base keys:
<DL>
<DT>HKEY_CLASSES_ROOT<DD>The HKEY_CLASSES_ROOT base key.
<DT>HKEY_CURRENT_CONFIG<DD>The HKEY_CURRENT_CONFIG base key.
<DT>HKEY_CURRENT_USER<DD>The HKEY_CURRENT_USER base key.
<DT>HKEY_DYN_DATA<DD><B>Windows 95, 98:</B> The HKEY_DYN_DATA base key.
<DT>HKEY_LOCAL_MACHINE<DD>The HKEY_LOCAL_MACHINE base key.
<DT>HKEY_PERFORMANCE_DATA<DD><B>Windows NT, 2000:</B> The HKEY_PERFORMANCE_DATA base key.
<DT>HKEY_USERS<DD>The HKEY_USERS base key.
</DL>
<DT><VAR>dwIndex</VAR><DD>The index of the particular subkey to retrieve information about.  Valid indices begin with 0 and go up to one less than the number of subkeys.
<DT><VAR>lpName</VAR><DD>String which receives the name of the subkey whose information is being retrieved.  This must be initialized to a sufficient size to receive the string.
<DT><VAR>lpcbName</VAR><DD>The size of the string passed as <VAR>lpName</VAR>.  This also receives the length of the string the function places in <VAR>lpName</VAR>.
<DT><VAR>lpReserved</VAR><DD>Reserved -- set to 0.  Visual Basic users must use the ByVal keyword immediately before the 0.
<DT><VAR>lpClass</VAR><DD>String which receives the name of the subkey's class.  This must be initialized to a sufficient size to receive the string.
<DT><VAR>lpcbClass</VAR><DD>The size of the string passed as <VAR>lpClass</VAR>.  This also receives the length of the string the function places in <VAR>lpClass</VAR>.
<DT><VAR>lpftLastWriteTime</VAR><DD>Receives the time and date on which the subkey was last written to.
</DL></P>

<H2>Constant Definitions</H2>
<P><PRE><CODE class="const">Const HKEY_CLASSES_ROOT = &amp;H80000000
Const HKEY_CURRENT_CONFIG = &amp;H80000005
Const HKEY_CURRENT_USER = &amp;H80000001
Const HKEY_DYN_DATA = &amp;H80000006
Const HKEY_LOCAL_MACHINE = &amp;H80000002
Const HKEY_PERFORMANCE_DATA = &amp;H80000004
Const HKEY_USERS = &amp;H80000003</CODE></PRE></P>

<H2>Example</H2>
<P><PRE><CODE class="example"><SPAN class="com">' This code is licensed according to the terms and conditions listed <A href="copyrite.html#license" tppabs="http://www.vbapi.com/copyrite.html#license" rel="copyright">here</A>.</SPAN>

' Enumerate the subkeys under HKEY_LOCAL_MACHINE\Software.  The name
' and class of each subkey is displayed for the user.  Note the use of the loop which
' starts at 0 and keeps incrementing the index until no more subkeys exist.
Dim keyname As String  ' receives name of each subkey
Dim keylen As Long  ' length of keyname
Dim classname As String  ' receives class of each subkey
Dim classlen As Long  ' length of classname
Dim lastwrite As <A href="filetime.html" tppabs="http://www.vbapi.com/ref/f/filetime.html">FILETIME</A> ' receives last-write-to time, but we ignore it here
Dim hkey As Long  ' handle to the HKEY_LOCAL_MACHINE\Software key
Dim index As Long  ' counter variable for index
Dim retval As Long  ' function's return value

' Open the desired registry key.  Note the access level requested.
retval = <A href="regopenkeyex.html" tppabs="http://www.vbapi.com/ref/r/regopenkeyex.html">RegOpenKeyEx</A>(HKEY_LOCAL_MACHINE, "Software", 0, KEY_ENUMERATE_SUB_KEYS, hkey)
' Test to make sure the key was opened successfully.
If retval &lt;&gt; 0 Then
  Debug.Print "Registry key could not be opened -- aborting."
  End  ' terminate the program
End If

' List through each possible subkey.  Note how the strings receiving the information
' must be reinitialized each loop iteration.
index = 0  ' initial index value
While retval = 0  ' while we keep having success (retval equals 0 from the above API call)
  keyname = Space(255): classname = Space(255)  ' make room in string buffers
  keylen = 255: classlen = 255  ' identify the allocated space
  ' Get information about the next subkey, if one exists.
  retval = <B>RegEnumKeyEx</B>(hkey, index, keyname, keylen, ByVal 0, classname, classlen, lastwrite)
  If retval = 0  ' only display info if another subkey was found
    ' Extract the useful information from the string buffers.
    keyname = Left(keyname, keylen)  ' trim off the excess space
    classname = Left(classname, classlen)
    ' Display the returned information.
    Debug.Print "HKEY_LOCAL_MACHINE\Software\"; keyname  ' display full subkey name
    Debug.Print "  (class: "; classname  ' display subkey's class
  End If
  index = index + 1  ' increment the index counter
Wend  ' end the loop

' Close the registry key after enumeration is complete.
retval = <A href="regclosekey.html" tppabs="http://www.vbapi.com/ref/r/regclosekey.html">RegCloseKey</A>(hkey)</CODE></PRE></P>

<H2>See Also</H2>
<P><A href="regenumvalue.html" tppabs="http://www.vbapi.com/ref/r/regenumvalue.html">RegEnumValue</A></P>

<H2>Category</H2>
<P><A href="funcc.html#registry" tppabs="http://www.vbapi.com/ref/funcc.html#registry">Registry</A></P>

<P><A href="funca.html" tppabs="http://www.vbapi.com/ref/funca.html">Go back to the alphabetical Function listing.</A><BR>
<A href="index.html" tppabs="http://www.vbapi.com/ref/index.html">Go back to the Reference section index.</A></P>

<HR>

<P><B>Last Modified:</B> March 19, 2000<BR>
This page is copyright &copy; 2000 Paul Kuliniewicz.  
<A href="copyrite.html" tppabs="http://www.vbapi.com/copyrite.html" rel="copyright">Copyright Information</A>  <B>Revised October 29, 2000</B>
.<BR>
<A href="index-1.html" tppabs="http://www.vbapi.com/index.html">Go back to the Windows API Guide home page.</A><BR>
E-mail: <A href="javascript:if(confirm('http://www.vbapi.com/email.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.vbapi.com/email.html'" tppabs="http://www.vbapi.com/email.html">vbapi@vbapi.com</A>  <A href="javascript:if(confirm('http://www.vbapi.com/email.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.vbapi.com/email.html#secure'" tppabs="http://www.vbapi.com/email.html#secure">Send Encrypted E-Mail</A><BR>
This page is at <A href="regenumkeyex.html" tppabs="http://www.vbapi.com/ref/r/regenumkeyex.html">http://www.vbapi.com/ref/r/regenumkeyex.html</A></P>
</BODY>
</HTML>