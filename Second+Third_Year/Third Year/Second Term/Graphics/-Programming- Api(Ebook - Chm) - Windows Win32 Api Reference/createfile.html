<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<HTML lang="en-us">
<HEAD>
<TITLE>Windows API Guide: CreateFile Function</TITLE>
<META content="vbapi@vbapi.com" name="author">
<META content="Information about the CreateFile function in the Windows API, geared towards the Visual Basic user." name="description">
<META content="Kuliniewicz,Windows,Windows 95,Windows NT,Windows 98,Windows CE,Windows 2000,API,Application Programming Interface,Programming,Visual Basic,Basic,VB,CreateFile" name="keywords">
<META content="Omicron HTML Editor" name="generator">
<META content="Fri, 01 Oct 1999 03:09:00 GMT" http-equiv="Last-Modified">
<LINK href="default.css" tppabs="http://www.vbapi.com/css/default.css" rel="stylesheet" type="text/css">
<LINK href="index-1.html" tppabs="http://www.vbapi.com/index.html" rel="home">
<LINK href="index-4.html" tppabs="http://www.vbapi.com/ref/help/index.html">
<LINK href="glossary.html" tppabs="http://www.vbapi.com/ref/glossary.html" rel="glossary">
<LINK href="copyrite.html" tppabs="http://www.vbapi.com/copyrite.html" rel="copyright">
</HEAD>
<BODY>

<!-- Begin Adslot1 -->
<CENTER>
<SCRIPT language="JAVASCRIPT">
<!-- hide from older browsers
now = new Date();
my_random = now.getTime();
document.write('<A href="http://adex3.flycast.com/server/socket/127.0.0.1:2800/click/VBWorldnet/VBAPI/' + my_random + '">');
document.write('<IMG width="468" height="60" border="1" src="http://adex3.flycast.com/server/socket/127.0.0.1:2800/ad/VBWorldnet/VBAPI/' + my_random + '"></A>');
// -->
</SCRIPT>
</CENTER>
<!-- End Adslot1 -->

<HR>

<H1>CreateFile Function</H1>

<P><CODE class="declare">Declare Function CreateFile Lib "kernel32.dll" Alias "CreateFileA" (ByVal lpFileName As String, ByVal dwDesiredAccess As Long, ByVal dwShareMode As Long, lpSecurityAttributes As Any, ByVal dwCreationDisposition As Long, ByVal dwFlagsAndAttributes As Long, ByVal hTemplateFile As Long) As Long</CODE></P>

<H2>Platforms</H2>
<P><UL>
<LI><B>Windows 95:</B> Supported.
<LI><B>Windows 98:</B> Supported.
<LI><B>Windows NT:</B> Requires Windows NT 3.1 or later.
<LI><B>Windows 2000:</B> Supported.
<LI><B>Windows CE:</B> Requires Windows CE 1.0 or later.
</UL></P>

<H2>Description &amp; Usage</H2>
<P><B>CreateFile</B> creates or opens a console, communications resource, directory (can only open), disk devices (<B>Windows NT, 2000</B> only), files, mailslots, and pipes.  Obviously, files are the most common thing opened by the function.  The object opened can then be read from or written to, as the access level allows.  After your program is finished using the <A class="def" href="glossary.html#handle" tppabs="http://www.vbapi.com/ref/glossary.html#handle" rel="glossary">handle</A> generated by the function, it must call <A href="closehandle.html" tppabs="http://www.vbapi.com/ref/c/closehandle.html">CloseHandle</A> to close the open object.</P>

<H2>Return Value</H2>
<P>If an error occured, the function returns -1 (use <A href="getlasterror.html" tppabs="http://www.vbapi.com/ref/g/getlasterror.html">GetLastError</A> to get the error code).  If successful, the function returns a handle to the opened or created file or other object.</P>

<H2>Visual Basic-Specific Issues</H2>
<P>When passing 0 as the <VAR>lpSecurityAttributes</VAR> parameter, the expression ByVal CLng(0) must be used to pass the zero correctly.  See the example for a demonstration.</P>

<H2>Parameters</H2>
<DL>
<DT><VAR>lpFileName</VAR><DD>The name of the file or other allowed object to create or open.
<DT><VAR>dwDesiredAccess</VAR><DD>A combination of the following flags (if any) specifying the amounts of read/write access to the file or other object:
<DL>
<DT>GENERIC_READ<DD>Allow the program to read data from the file or other object.
<DT>GENERIC_WRITE<DD>Allow the program to write data to the file or other object.
</DL>
<DT><VAR>dwShareMode</VAR><DD>A combination of the following flags (if any) specifying the amounts of read/write access to grant other programs attempting to access the file or other object while your program still has it open:
<DL>
<DT>FILE_SHARE_READ<DD>Allow other programs to read data from the file or other object.
<DT>FILE_SHARE_WRITE<DD>Allow other programs to write data to the file or other object.
</DL>
<DT><VAR>lpSecurityAppributes</VAR><DD><B>Windows NT, 2000</B>: A <A href="security_attributes.html" tppabs="http://www.vbapi.com/ref/s/security_attributes.html">SECURITY_ATTRIBUTES</A> structure specifying the security attributes to give the created or opened file or other object.  <B>Windows 95, 98, CE:</B> This parameter must be 0.
<DT><VAR>dwCreationDisposition</VAR><DD>Exactly one of the following flags specifying how and when to create or open the file or other object depending if it already does or does not exist:
<DL>
<DT>CREATE_ALWAYS<DD>Create a new file or other object.  Overwrite the file or other object (i.e., delete the old one first) if it already exists.
<DT>CREATE_NEW<DD>Create a new file or other object.  The function fails if the file or other object already exists.
<DT>OPEN_ALWAYS<DD>Open an existing file or other object.  If the file or other object does not exist, it will be created.
<DT>OPEN_EXISTING<DD>Open an existing file or other object.  The function fails if the file or other object does not exist.
<DT>TRUNCATE_EXISTING<DD>Open an existing file or other object and delete its contents.  The function fails if the file or other object does not exist.
</DL>
<DT><VAR>dwFlagsAndAttributes</VAR><DD>The combination of the following flags specifying both the file attributes of a newly created file and other options for creating or opening the file.  One flag specifying the file attributes must be included.
<DL>
<DT>FILE_ATTRIBUTE_ARCHIVE<DD>An archive file (which most files are).
<DT>FILE_ATTRIBUTE_HIDDEN<DD>A hidden file, not normally visible to the user.
<DT>FILE_ATTRIBUTE_NORMAL<DD>An attribute-less file (cannot be combined with other attributes).
<DT>FILE_ATTRIBUTE_READONLY<DD>A read-only file.
<DT>FILE_ATTRIBUTE_SYSTEM<DD>A system file, used exclusively by the operating system.
<DT>FILE_FLAG_DELETE_ON_CLOSE<DD>Delete the file once it is closed.
<DT>FILE_FLAG_NO_BUFFERING<DD>Do not use any buffers or caches.  If used, the following things must be done: access to the file must begin at whole number multiples of the disk's sector size; the amounts of data accessed must be a whole number multiple of the disk's sector size; and buffer addresses for I/O operations must be aligned on whole number multiples of the disk's sector size.
<DT>FILE_FLAG_OVERLAPPED<DD>Allow asynchronous I/O; i.e., allow the file to be read from and written to simultaneously.  If used, functions that read and write to the file must specify the <A href="overlapped.html" tppabs="http://www.vbapi.com/ref/o/overlapped.html">OVERLAPPED</A> structure identifying the file pointer.  (<B>Windows 95, 98, CE:</B> Overlapped files are not supported, although other overlapped objects are.)
<DT>FILE_FLAG_POSIX_SEMANTICS<DD>Allow file names to be case-sensitive.
<DT>FILE_FLAG_RANDOM_ACCESS<DD>Optimize the file cache for random access (skipping around to various parts of the file).
<DT>FILE_FLAG_SEQUENTIAL_SCAN<DD>Optimize the file cache for sequential access (starting at the beginning and continuing to the end of the file).
<DT>FILE_FLAG_WRITE_THROUGH<DD>Bypass any disk cache and instead read and write directly to the file.
</DL>
<DT><VAR>hTemplateFile</VAR><DD>A handle to an open file to copy the attributes of, or 0 to not copy the attributes of any open file.
</DL>

<H2>Constant Definitions</H2>
<P><PRE><CODE class="const">Const GENERIC_READ = &amp;H80000000
Const GENERIC_WRITE = &amp;H40000000
Const FILE_SHARE_READ = &amp;H1
Const FILE_SHARE_WRITE = &amp;H2
Const CREATE_ALWAYS = 2
Const CREATE_NEW = 1
Const OPEN_ALWAYS = 4
Const OPEN_EXISTING = 3
Const TRUNCATE_EXISTING = 5
Const FILE_ATTRIBUTE_ARCHIVE = &amp;H20
Const FILE_ATTRIBUTE_HIDDEN = &amp;H2
Const FILE_ATTRIBUTE_NORMAL = &amp;H80
Const FILE_ATTRIBUTE_READONLY = &amp;H1
Const FILE_ATTRIBUTE_SYSTEM = &amp;H4
Const FILE_FLAG_DELETE_ON_CLOSE = &amp;H4000000
Const FILE_FLAG_NO_BUFFERING = &amp;H20000000
Const FILE_FLAG_OVERLAPPED = &amp;H40000000
Const FILE_FLAG_POSIX_SEMANTICS = &amp;H1000000
Const FILE_FLAG_RANDOM_ACCESS = &amp;H10000000
Const FILE_FLAG_SEQUENTIAL_SCAN = &amp;H8000000
Const FILE_FLAG_WRITE_THROUGH = &amp;H80000000</CODE></PRE></P>

<H2>Example</H2>
<P><PRE><CODE class="example"><SPAN class="com">' This code is licensed according to the terms and conditions listed <A href="copyrite.html#license" tppabs="http://www.vbapi.com/copyrite.html#license" rel="copyright">here</A>.</SPAN>

' Display the date on which the file C:\MyApp\test.txt was
' created.  Note how the time zone conversion is necessary.
Dim hFile As Long  ' handle to the opened file
Dim ctime As <A href="filetime.html" tppabs="http://www.vbapi.com/ref/f/filetime.html">FILETIME</A>  ' receives time of creation
Dim atime As <A href="filetime.html" tppabs="http://www.vbapi.com/ref/f/filetime.html">FILETIME</A>  ' receives time of last access
Dim mtime As <A href="filetime.html" tppabs="http://www.vbapi.com/ref/f/filetime.html">FILETIME</A>  ' receives time of last modification
Dim thetime As <A href="systemtime.html" tppabs="http://www.vbapi.com/ref/s/systemtime.html">SYSTEMTIME</A>  ' used to manipulate the time
Dim retval As Long  ' return value

' First, open the file C:\MyApp\test.txt for read-level access.  Note the
' expression necessary to pass 0 as lpSecurityAttributes.
hFile = <B>CreateFile</B>("C:\MyApp\test.txt", GENERIC_READ, FILE_SHARE_READ, ByVal CLng(0), OPEN_EXISTING, FILE_ATTRIBUTE_ARCHIVE, 0)
If hFile = -1 Then
  Debug.Print "Could not open the file successfully -- aborting."
  End  ' terminate the program
End If

' Next, get the creation, last-access, and last-modification times.
retval = <A href="getfiletime.html" tppabs="http://www.vbapi.com/ref/g/getfiletime.html">GetFileTime</A>(hFile, ctime, atime, mtime)
' Convert the creation time to the local time zone.
retval = <A href="filetimetolocalfiletime.html" tppabs="http://www.vbapi.com/ref/f/filetimetolocalfiletime.html">FileTimeToLocalFileTime</A>(ctime, ctime)
' Convert the FILETIME format to the SYSTEMTIME format.
retval = <A href="filetimetosystemtime.html" tppabs="http://www.vbapi.com/ref/f/filetimetosystemtime.html">FileTimeToSystemTime</A>(ctime, thetime)

' Display the date of creation of the file to the user.
Debug.Print "The file was created on "; thetime.wMonth; "-"; thetime.wDay; "-"; thetime.wYear

' Close the file to free up resources.
retval = <A href="closehandle.html" tppabs="http://www.vbapi.com/ref/c/closehandle.html">CloseHandle</A>(hFile)</CODE></PRE></P>

<H2>Category</H2>
<P><A href="funcc.html#files" tppabs="http://www.vbapi.com/ref/funcc.html#files">Files</A></P>

<P><A href="funca.html" tppabs="http://www.vbapi.com/ref/funca.html">Go back to the alphabetical Function listing.</A><BR>
<A href="index.html" tppabs="http://www.vbapi.com/ref/index.html">Go back to the Reference section index.</A></P>

<HR>

<P><B>Last Modified:</B> September 30, 1999<BR>
This page is copyright &copy; 1999 Paul Kuliniewicz.  
<A href="copyrite.html" tppabs="http://www.vbapi.com/copyrite.html" rel="copyright">Copyright Information</A>  <B>Revised October 29, 2000</B><BR>

<A href="index-1.html" tppabs="http://www.vbapi.com/index.html">Go back to the Windows API Guide home page.</A><BR>
E-mail: <A href="javascript:if(confirm('http://www.vbapi.com/email.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.vbapi.com/email.html'" tppabs="http://www.vbapi.com/email.html">vbapi@vbapi.com</A>  <A href="javascript:if(confirm('http://www.vbapi.com/email.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.vbapi.com/email.html#secure'" tppabs="http://www.vbapi.com/email.html#secure">Send Encrypted E-Mail</A><BR>
This page is at <A href="createfile.html" tppabs="http://www.vbapi.com/ref/c/createfile.html">http://www.vbapi.com/ref/c/createfile.html</A>
</P>
</BODY>
</HTML>