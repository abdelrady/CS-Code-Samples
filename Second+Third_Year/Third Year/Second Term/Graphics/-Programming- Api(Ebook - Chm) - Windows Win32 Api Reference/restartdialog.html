<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<HTML lang="en-us">
<HEAD>
<TITLE>Windows API Guide: RestartDialog Function</TITLE>
<META content="vbapi@vbapi.com" name="author">
<META content="Information about the RestartDialog function in the Windows API, geared towards the Visual Basic user." name="description">
<META content="Kuliniewicz,Windows,Windows 95,Windows NT,Windows 98,Windows CE,Windows 2000,API,Application Programming Interface,Programming,Visual Basic,Basic,VB,RestartDialog" name="keywords">
<META content="Omicron HTML Editor" name="generator">
<LINK href="default.css" tppabs="http://www.vbapi.com/css/default.css" rel="stylesheet" type="text/css">
<LINK href="index-1.html" tppabs="http://www.vbapi.com/index.html" rel="home">
<LINK href="glossary.html" tppabs="http://www.vbapi.com/ref/glossary.html" rel="glossary">
<LINK href="copyrite.html" tppabs="http://www.vbapi.com/copyrite.html" rel="copyright">
</HEAD>
<BODY>

<!-- Begin Adslot1 -->
<CENTER>
<SCRIPT language="JAVASCRIPT">
<!-- hide from older browsers
now = new Date();
my_random = now.getTime();
document.write('<A href="http://adex3.flycast.com/server/socket/127.0.0.1:2800/click/VBWorldnet/VBAPI/' + my_random + '">');
document.write('<IMG width="468" height="60" border="1" src="http://adex3.flycast.com/server/socket/127.0.0.1:2800/ad/VBWorldnet/VBAPI/' + my_random + '"></A>');
// -->
</SCRIPT>
</CENTER>
<!-- End Adslot1 -->

<HR>

<H1>RestartDialog Function</H1>

<P><CODE class="declare"><SPAN class="kw">Declare Function</SPAN> RestartDialog <SPAN class="kw">Lib</SPAN> "shell32.dll" <SPAN class="kw">Alias</SPAN> "#59" (<SPAN class="kw">ByVal</SPAN> hwndOwner <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> lpstrReason <SPAN class="kw">As String</SPAN>, <SPAN class="kw">ByVal</SPAN> uFlags <SPAN class="kw">As Long</SPAN>) <SPAN class="kw">As Long</SPAN></CODE></P>

<H2>Platforms</H2>
<P><UL>
<LI><B>Windows 95:</B> Supported.
<LI><B>Windows 98:</B> Supported.
<LI><B>Windows NT:</B> Requires Windows NT 3.1 or later.
<LI><B>Windows 2000:</B> Supported.
<LI><B>Windows CE:</B> Unknown.
</UL>
The <B>RestartDialog</B> function is officially undocumented.</P>

<H2>Description &amp; Usage</H2>
<P><B>RestartDialog</B> prompts the user with a yes-or-no dialog box asking to either reboot, shut down, or log off the system.  This dialog box is typically displayed at the end of an install routine, when a reboot is necessary to load altered system settings.  If the user clicks the "Yes" button of the dialog, the reboot/shut down/log off operation is automatically begun.</P>

<P><B>Windows NT, 2000:</B> All strings used by this function must be Unicode.  Therefore, any strings passed to the function must first be converted into Unicode.  Likewise, any strings output by the function also must be converted from Unicode into ANSI.</P>

<H2>Return Value</H2>
<P>If successful, the function returns one of the following values.  However, if an error occured, the function will return IDYES anyway.  Therefore, the return value is an unreliable method of determining what the user selected.</P>

<P><DL>
<DT>IDNO<DD>The user selected "No".
<DT>IDYES<DD>The user selected "Yes".
</DL></P>

<H2>Visual Basic-Specific Issues</H2>
<P>None.</P>

<H2>Parameters</H2>
<P><DL>
<DT><VAR>hwndOwner</VAR><DD>A <A class="def" href="glossary.html#handle" tppabs="http://www.vbapi.com/ref/glossary.html#handle" rel="glossary">handle</A> to the window that is requesting the dialog box.
<DT><VAR>lpstrReason</VAR><DD>Text to display inside the dialog box explaining why the reboot, shut down, or log off is necessary.  Windows will append additional text to this message, so this string should end in one or two carriage return/line feed pairs (the intrinsic vbCrLf constant) or at least a space.
<DT><VAR>uFlags</VAR><DD>One of the following flags specifying which operation to prompt the user about:
<DL>
<DT>EWX_LOGOFF<DD>Prompt the user to log off the system.  The text appended to <VAR>lpstrReason</VAR> is as follows: "You must restart your computer before the new settings will take effect. (new line) Do you want to restart your computer now?"
<DT>EWX_REBOOT<DD>Prompt the user to reboot the system.  The text appended to <VAR>lpstrReason</VAR> is as follows: "You must restart your computer before the new settings will take effect. (new line) Do you want to restart your computer now?"
<DT>EWX_SHUTDOWN<DD>Prompt the user to shut the system down.  The text appended to <VAR>lpstrReason</VAR> is as follows: "Do you want to shut down now?"
</DL>
</DL></P>

<H2>Constant Definitions</H2>
<P><PRE><CODE class="const"><SPAN class="kw">Const</SPAN> IDNO = 7
<SPAN class="kw">Const</SPAN> IDYES = 6
<SPAN class="kw">Const</SPAN> EWX_LOGOFF = &H0
<SPAN class="kw">Const</SPAN> EWX_SHUTDOWN = &H1
<SPAN class="kw">Const</SPAN> EWX_REBOOT = &H2</CODE></PRE></P>

<H2>Example</H2>
<P><PRE><CODE class="example"><SPAN class="com">' This code is licensed according to the terms and conditions listed <A href="copyrite.html#license" tppabs="http://www.vbapi.com/copyrite.html#license" rel="copyright">here</A>.</SPAN>

<SPAN class="com">' Declarations and such needed for the example:
' (Copy them to the (declarations) section of a module.)</SPAN>
<SPAN class="kw">Public Declare Function</SPAN> <B>RestartDialog</B> <SPAN class="kw">Lib</SPAN> "shell32.dll" <SPAN class="kw">Alias</SPAN> "#59" (<SPAN class="kw">ByVal</SPAN> hwndOwner _
	<SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> lpstrReason <SPAN class="kw">As String</SPAN>, <SPAN class="kw">ByVal</SPAN> uFlags <SPAN class="kw">As Long</SPAN>) <SPAN class="kw">As Long</SPAN>
<SPAN class="kw">Public Const</SPAN> EWX_REBOOT = &H2
<SPAN class="kw">Public Type</SPAN> <A href="osversioninfo.html" tppabs="http://www.vbapi.com/ref/o/osversioninfo.html">OSVERSIONINFO</A>
	dwOSVersionInfoSize <SPAN class="kw">As Long</SPAN>
	dwMajorVersion <SPAN class="kw">As Long</SPAN>
	dwMinorVersion <SPAN class="kw">As Long</SPAN>
	dwBuildNumber <SPAN class="kw">As Long</SPAN>
	dwPlatformId <SPAN class="kw">As Long</SPAN>
	szCSDVersion <SPAN class="kw">As String</SPAN> * 128
<SPAN class="kw">End Type</SPAN>
<SPAN class="kw">Public Const</SPAN> VER_PLATFORM_WIN32_NT = 2
<SPAN class="kw">Public Const</SPAN> VER_PLATFORM_WIN32_WINDOWS = 1
<SPAN class="kw">Public Declare Function</SPAN> <A href="getversionex.html" tppabs="http://www.vbapi.com/ref/g/getversionex.html">GetVersionEx</A> <SPAN class="kw">Lib</SPAN> "kernel32.dll" <SPAN class="kw">Alias</SPAN> "GetVersionExA" _
	(lpVersionInformation <SPAN class="kw">As</SPAN> <A href="osversioninfo.html" tppabs="http://www.vbapi.com/ref/o/osversioninfo.html">OSVERSIONINFO</A>) <SPAN class="kw">As Long</SPAN>

<SPAN class="com">' Prompt the user to reboot the computer.  If he says "Yes", the function will
' automatically reboot the system.  There's nothing much to it!</SPAN>
<SPAN class="kw">Private Sub</SPAN> Command1_Click()
	<SPAN class="kw">Dim</SPAN> s <SPAN class="kw">As String</SPAN>  <SPAN class="com">' the string to display in the dialog</SPAN>
	<SPAN class="kw">Dim</SPAN> ovi <SPAN class="kw">As</SPAN> <A href="osversioninfo.html" tppabs="http://www.vbapi.com/ref/o/osversioninfo.html">OSVERSIONINFO</A>  <SPAN class="com">' version of the OS</SPAN>
	<SPAN class="kw">Dim</SPAN> retval <SPAN class="kw">As Long</SPAN>  <SPAN class="com">' return value</SPAN>
	
	<SPAN class="com">' Display the following message in the dialog, in front of the text that
	' Windows will automatically place there.</SPAN>
	s = "The install routine has made some changes to your computer.  "
	
	<SPAN class="com">' If this is Windows NT or 2000, convert the string to Unicode.</SPAN>
	ovi.dwOSVersionInfoSize = Len(ovi)
	retval = <A href="getversionex.html" tppabs="http://www.vbapi.com/ref/g/getversionex.html">GetVersionEx</A>(ovi)
	<SPAN class="kw">If</SPAN> ovi.dwPlatformId = VER_PLATFORM_WIN32_NT <SPAN class="kw">Then</SPAN>
		s = StrConv(s, vbUnicode)
	<SPAN class="kw">End If</SPAN>
	
	<SPAN class="com">' Prompt the user.</SPAN>
	retval = <B>RestartDialog</B>(Form1.hWnd, s, EWX_RESTART)
<SPAN class="kw">End Sub</SPAN></CODE></PRE></P>

<H2>See Also</H2>
<P><A href="exitwindowsdialog.html" tppabs="http://www.vbapi.com/ref/e/exitwindowsdialog.html">ExitWindowsDialog</A></P>

<H2>Category</H2>
<P><A href="funcc.html#shell" tppabs="http://www.vbapi.com/ref/funcc.html#shell">Shell</A></P>

<P><A href="funca.html" tppabs="http://www.vbapi.com/ref/funca.html">Back to the Function list.</A><BR>
<A href="index.html" tppabs="http://www.vbapi.com/ref/index.html" rel="index">Back to the Reference section.</A></P>

<HR>

<P><B>Last Modified:</B> July 4, 2000<BR>
This page is copyright &copy; 2000 Paul Kuliniewicz.  
<A href="copyrite.html" tppabs="http://www.vbapi.com/copyrite.html" rel="copyright">Copyright Information</A>  <B>Revised October 29, 2000</B><BR>
<A href="index-1.html" tppabs="http://www.vbapi.com/index.html" rel="home">Go back to the Windows API Guide home page.</A><BR>
E-mail: <A href="javascript:if(confirm('http://www.vbapi.com/email.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.vbapi.com/email.html'" tppabs="http://www.vbapi.com/email.html">vbapi@vbapi.com</A>  <A href="javascript:if(confirm('http://www.vbapi.com/email.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.vbapi.com/email.html#secure'" tppabs="http://www.vbapi.com/email.html#secure">Send Encrypted E-Mail</A><BR>
This page is at <A href="restartdialog.html" tppabs="http://www.vbapi.com/ref/r/restartdialog.html">http://www.vbapi.com/ref/r/restartdialog.html</A></P>
</BODY>
</HTML>