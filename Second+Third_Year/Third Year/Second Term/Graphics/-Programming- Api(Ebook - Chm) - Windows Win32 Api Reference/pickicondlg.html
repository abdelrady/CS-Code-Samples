<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<HTML lang="en-us">
<HEAD>
<TITLE>Windows API Guide: PickIconDlg Function</TITLE>
<META content="vbapi@vbapi.com" name="author">
<META content="Information about the PickIconDlg function in the Windows API, geared towards the Visual Basic user." name="description">
<META content="Kuliniewicz,Windows,Windows 95,Windows NT,Windows 98,Windows CE,Windows 2000,API,Application Programming Interface,Programming,Visual Basic,Basic,VB,PickIconDlg" name="keywords">
<META content="Omicron HTML Editor" name="generator">
<LINK href="default.css" tppabs="http://www.vbapi.com/css/default.css" rel="stylesheet" type="text/css">
<LINK href="index-1.html" tppabs="http://www.vbapi.com/index.html" rel="home">
<LINK href="glossary.html" tppabs="http://www.vbapi.com/ref/glossary.html" rel="glossary">
<LINK href="copyrite.html" tppabs="http://www.vbapi.com/copyrite.html" rel="copyright">
</HEAD>
<BODY>

<!-- Begin Adslot1 -->
<CENTER>
<SCRIPT language="JAVASCRIPT">
<!-- hide from older browsers
now = new Date();
my_random = now.getTime();
document.write('<A href="http://adex3.flycast.com/server/socket/127.0.0.1:2800/click/VBWorldnet/VBAPI/' + my_random + '">');
document.write('<IMG width="468" height="60" border="1" src="http://adex3.flycast.com/server/socket/127.0.0.1:2800/ad/VBWorldnet/VBAPI/' + my_random + '"></A>');
// -->
</SCRIPT>
</CENTER>
<!-- End Adslot1 -->

<HR>

<H1>PickIconDlg Function</H1>

<P><CODE class="declare"><SPAN class="kw">Declare Function</SPAN> PickIconDlg <SPAN class="kw">Lib</SPAN> "shell32.dll" <SPAN class="kw">Alias</SPAN> "#62" (<SPAN class="kw">ByVal</SPAN> hwndOwner <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> lpstrFile <SPAN class="kw">As String</SPAN>, <SPAN class="kw">ByVal</SPAN> nMaxFile <SPAN class="kw">As Long</SPAN>, lpdwIconIndex <SPAN class="kw">As Long</SPAN>) <SPAN class="kw">As Long</SPAN></CODE></P>

<H2>Platforms</H2>
<P><UL>
<LI><B>Windows 95:</B> Supported.
<LI><B>Windows 98:</B> Supported.
<LI><B>Windows NT:</B> Requires Windows NT 3.1 or later.
<LI><B>Windows 2000:</B> Supported.
<LI><B>Windows CE:</B> Unknown.
</UL>
<B>PickIconDlg</B> is officially undocumented.</P>

<H2>Description &amp; Usage</H2>
<P><B>PickIconDlg</B> displays the standard Windows "icon selection" dialog box.  It allows the user to choose an icon found inside a file.  The function then reports which icon the user selected, if any.</P>

<P><B>Windows NT, 2000:</B> All strings used by this function must be Unicode.  Therefore, any strings passed to the function must first be converted into Unicode.  Likewise, any strings output by the function also must be converted from Unicode into ANSI.</P>

<H2>Return Value</H2>
<P>If successful, the function returns a non-zero value.  If an error occured or the user did not choose an icon (for example, the user clicked "Cancel"), the function returns 0.</P>

<H2>Visual Basic-Specific Issues</H2>
<P>None.</P>

<H2>Parameters</H2>
<P><DL>
<DT><VAR>hwndOwner</VAR><DD>A <A class="def" href="glossary.html#handle" tppabs="http://www.vbapi.com/ref/glossary.html#handle" rel="glossary">handle</A> to the window which is opening the icon selection dialog box.
<DT><VAR>lpstrFile</VAR><DD>A null-terminated string specifying the default icon-containing file to look inside.  This string will also receive the name of the file which holds the user's selection.  Therefore, this string must have enough empty space after the terminating null character to receive the final string.
<DT><VAR>nMaxFile</VAR><DD>The length of the string passed as <VAR>lpstrFile</VAR>.
<DT><VAR>lpdwIconIndex</VAR><DD>The zero-based index of the icon to select by default.  This variable also receives the zero-based index of the icon the user selected.
</DL></P>

<H2>Example</H2>
<P><PRE><CODE class="example"><SPAN class="com">' This code is licensed according to the terms and conditions listed <A href="copyrite.html#license" tppabs="http://www.vbapi.com/copyrite.html#license" rel="copyright">here</A>.</SPAN>

<SPAN class="com">' Declarations and such needed for the example:
' (Copy them to the (declarations) section of a module.)</SPAN>
<SPAN class="kw">Public Declare Function</SPAN> <B>PickIconDlg</B> <SPAN class="kw">Lib</SPAN> "shell32.dll" <SPAN class="kw">Alias</SPAN> "#62" (<SPAN class="kw">ByVal</SPAN> hwndOwner <SPAN class="kw">As Long</SPAN>, _
	<SPAN class="kw">ByVal</SPAN> lpstrFile <SPAN class="kw">As String</SPAN>, <SPAN class="kw">ByVal</SPAN> nMaxFile <SPAN class="kw">As Long</SPAN>, lpdwIconIndex <SPAN class="kw">As Long</SPAN>) <SPAN class="kw">As Long</SPAN>
<SPAN class="kw">Public Type</SPAN> <A href="osversioninfo.html" tppabs="http://www.vbapi.com/ref/o/osversioninfo.html">OSVERSIONINFO</A>
	dwOSVersionInfoSize <SPAN class="kw">As Long</SPAN>
	dwMajorVersion <SPAN class="kw">As Long</SPAN>
	dwMinorVersion <SPAN class="kw">As Long</SPAN>
	dwBuildNumber <SPAN class="kw">As Long</SPAN>
	dwPlatformId <SPAN class="kw">As Long</SPAN>
	szCSDVersion <SPAN class="kw">As String</SPAN> * 128
<SPAN class="kw">End Type</SPAN>
<SPAN class="kw">Public Const</SPAN> VER_PLATFORM_WIN32_NT = 2
<SPAN class="kw">Public Const</SPAN> VER_PLATFORM_WIN32_WINDOWS = 1
<SPAN class="kw">Public Declare Function</SPAN> <A href="getversionex.html" tppabs="http://www.vbapi.com/ref/g/getversionex.html">GetVersionEx</A> <SPAN class="kw">Lib</SPAN> "kernel32.dll" <SPAN class="kw">Alias</SPAN> "GetVersionExA" _
	(lpVersionInformation <SPAN class="kw">As</SPAN> <A href="osversioninfo.html" tppabs="http://www.vbapi.com/ref/o/osversioninfo.html">OSVERSIONINFO</A>) <SPAN class="kw">As Long</SPAN>
<SPAN class="kw">Public Declare Function</SPAN> <A href="extracticon.html" tppabs="http://www.vbapi.com/ref/e/extracticon.html">ExtractIcon</A> <SPAN class="kw">Lib</SPAN> "shell32.dll" <SPAN class="kw">Alias</SPAN> "ExtractIconA" (<SPAN class="kw">ByVal</SPAN> hInst _
	<SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> lpszExeFileName <SPAN class="kw">As String</SPAN>, <SPAN class="kw">ByVal</SPAN> nIconIndex <SPAN class="kw">As Long</SPAN>) <SPAN class="kw">As Long</SPAN>
<SPAN class="kw">Public Declare Function</SPAN> <A href="drawicon.html" tppabs="http://www.vbapi.com/ref/d/drawicon.html">DrawIcon</A> <SPAN class="kw">Lib</SPAN> "user32.dll" (<SPAN class="kw">ByVal</SPAN> hDC <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> x <SPAN class="kw">As Long</SPAN>, _
	<SPAN class="kw">ByVal</SPAN> y <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> hIcon <SPAN class="kw">As Long</SPAN>) <SPAN class="kw">As Long</SPAN>
<SPAN class="kw">Public Declare Function</SPAN> <A href="destroyicon.html" tppabs="http://www.vbapi.com/ref/d/destroyicon.html">DestroyIcon</A> <SPAN class="kw">Lib</SPAN> "user32.dll" (<SPAN class="kw">ByVal</SPAN> hIcon <SPAN class="kw">As Long</SPAN>) <SPAN class="kw">As Long</SPAN>
<SPAN class="kw">Public Declare Function</SPAN> <A href="getsystemdirectory.html" tppabs="http://www.vbapi.com/ref/g/getsystemdirectory.html">GetSystemDirectory</A> <SPAN class="kw">Lib</SPAN> "kernel32.dll" <SPAN class="kw">Alias</SPAN> "GetSystemDirectoryA" _
	(<SPAN class="kw">ByVal</SPAN> lpBuffer <SPAN class="kw">As String</SPAN>, <SPAN class="kw">ByVal</SPAN> nSize <SPAN class="kw">As Long</SPAN>) <SPAN class="kw">As Long</SPAN>

<SPAN class="com">' When the user presses button Command1, display an icon selection dialog box.  If the
' user chooses an icon, then draw it in the corner of window Form1's client area.</SPAN>
<SPAN class="kw">Private Sub</SPAN> Command1_Click()
	<SPAN class="kw">Dim</SPAN> iconfile <SPAN class="kw">As String</SPAN>  <SPAN class="com">' file that contains the desired icon</SPAN>
	<SPAN class="kw">Dim</SPAN> iconindex <SPAN class="kw">As Long</SPAN>  <SPAN class="com">' index of the desired icon</SPAN>
	<SPAN class="kw">Dim</SPAN> slength <SPAN class="kw">As Long</SPAN>  <SPAN class="com">' length of returned string</SPAN>
	<SPAN class="kw">Dim</SPAN> hIcon <SPAN class="kw">As Long</SPAN>  <SPAN class="com">' handle to the icon once it is extracted</SPAN>
	<SPAN class="kw">Dim</SPAN> ovi <SPAN class="kw">As</SPAN> <A href="osversioninfo.html" tppabs="http://www.vbapi.com/ref/o/osversioninfo.html">OSVERSIONINFO</A>  <SPAN class="com">' identifies the Windows platform</SPAN>
	<SPAN class="kw">Dim</SPAN> retval <SPAN class="kw">As Long</SPAN>  <SPAN class="com">' return value</SPAN>
	
	<SPAN class="com">' First, determine if the computer is running Windows NT or 2000.  In either case,
	' all strings used with PickIconDlg must be converted into Unicode.</SPAN>
	ovi.dwOSVersionInfoSize = Len(ovi)
	retval = <A href="getversionex.html" tppabs="http://www.vbapi.com/ref/g/getversionex.html">GetVersionEx</A>(ovi)
	
	<SPAN class="com">' Figure out where the System directory is.</SPAN>
	iconfile = Space(256)
	slength = <A href="getsystemdirectory.html" tppabs="http://www.vbapi.com/ref/g/getsystemdirectory.html">GetSystemDirectory</A>(iconfile, Len(iconfile))
	iconfile = Left(iconfile, slength)
	
	<SPAN class="com">' Have the default selection be the third icon in pifmgr.dll.  Include plenty
	' of extra space in the string so it can receive the user's selection.</SPAN>
	iconfile = iconfile &amp; "\pifmgr.dll" &amp; vbNullChar &amp; Space(256)
	iconindex = 2
	
	<SPAN class="com">' Display the icon selection dialog.  If Windows NT or 2000 is running, convert
	' the string to and from Unicode immediately before and after calling the function.</SPAN>
	<SPAN class="kw">If</SPAN> ovi.dwPlatformId = VER_PLATFORM_WIN32_NT <SPAN class="kw">Then</SPAN>
		iconfile = StrConv(iconfile, vbUnicode)
	<SPAN class="kw">End If</SPAN>
	retval = <B>PickIconDlg</B>(Form1.hWnd, iconfile, Len(iconfile), iconindex)
	<SPAN class="kw">If</SPAN> ovi.dwPlatformId = VER_PLATFORM_WIN32_NT <SPAN class="kw">Then</SPAN>
		iconfile = StrConv(iconfile, vbFromUnicode)
	<SPAN class="kw">End If</SPAN>
	<SPAN class="com">' Remove the terminating null and empty space from the string.</SPAN>
	iconfile = Left(iconfile, InStr(iconfile, vbNullChar) - 1)
	
	<SPAN class="com">' If the user selected something, draw the icon on Form1.</SPAN>
	<SPAN class="kw">If</SPAN> retval &lt;&gt; 0 <SPAN class="kw">Then</SPAN>
		<SPAN class="com">' Extract the icon from the file.</SPAN>
		hIcon = <A href="extracticon.html" tppabs="http://www.vbapi.com/ref/e/extracticon.html">ExtractIcon</A>(App.hInstance, iconfile, iconindex)
		<SPAN class="com">' Draw it in the corner of the window.</SPAN>
		retval = <A href="drawicon.html" tppabs="http://www.vbapi.com/ref/d/drawicon.html">DrawIcon</A>(Form1.hDC, 0, 0, hIcon)
		<SPAN class="com">' Destroy the icon to free resources.</SPAN>
		retval = <A href="destroyicon.html" tppabs="http://www.vbapi.com/ref/d/destroyicon.html">DestroyIcon</A>(hIcon)
	<SPAN class="kw">End If</SPAN>
<SPAN class="kw">End Sub</SPAN></CODE></PRE></P>

<H2>Category</H2>
<P><A href="funcc.html#shell" tppabs="http://www.vbapi.com/ref/funcc.html#shell">Shell</A></P>

<P><A href="funca.html" tppabs="http://www.vbapi.com/ref/funca.html">Back to the Function list.</A><BR>
<A href="index.html" tppabs="http://www.vbapi.com/ref/index.html" rel="index">Back to the Reference section.</A></P>

<HR>

<P><B>Last Modified:</B> June 4, 2000<BR>
This page is copyright &copy; 2000 Paul Kuliniewicz.  
<A href="copyrite.html" tppabs="http://www.vbapi.com/copyrite.html" rel="copyright">Copyright Information</A>  <B>Revised October 29, 2000</B><BR>
<A href="index-1.html" tppabs="http://www.vbapi.com/index.html" rel="home">Go back to the Windows API Guide home page.</A><BR>
E-mail: <A href="javascript:if(confirm('http://www.vbapi.com/email.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.vbapi.com/email.html'" tppabs="http://www.vbapi.com/email.html">vbapi@vbapi.com</A>  <A href="javascript:if(confirm('http://www.vbapi.com/email.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.vbapi.com/email.html#secure'" tppabs="http://www.vbapi.com/email.html#secure">Send Encrypted E-Mail</A><BR>
This page is at <A href="pickicondlg.html" tppabs="http://www.vbapi.com/ref/p/pickicondlg.html">http://www.vbapi.com/ref/p/pickicondlg.html</A></P>
</BODY>
</HTML>