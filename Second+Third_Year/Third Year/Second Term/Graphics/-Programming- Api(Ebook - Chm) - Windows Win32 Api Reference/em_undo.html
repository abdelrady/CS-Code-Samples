<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<HTML lang="en-us">
<HEAD>
<TITLE>Windows API Guide: EM_UNDO Message</TITLE>
<META content="vbapi@vbapi.com" name="author">
<META content="Information about the EM_UNDO message in the Windows API, geared towards the Visual Basic user." name="description">
<META content="Kuliniewicz,Windows,Windows 95,Windows NT,Windows 98,Windows CE,Windows 2000,API,Application Programming Interface,Programming,Visual Basic,Basic,VB,EM_UNDO" name="keywords">
<META content="Omicron HTML Editor" name="generator">
<LINK href="default.css" tppabs="http://www.vbapi.com/css/default.css" rel="stylesheet" type="text/css">
<LINK href="index-1.html" tppabs="http://www.vbapi.com/index.html" rel="home">
<LINK href="glossary.html" tppabs="http://www.vbapi.com/ref/glossary.html" rel="glossary">
<LINK href="copyrite.html" tppabs="http://www.vbapi.com/copyrite.html" rel="copyright">
</HEAD>
<BODY>

<!-- Begin Adslot1 -->
<CENTER>
<SCRIPT language="JAVASCRIPT">
<!-- hide from older browsers
now = new Date();
my_random = now.getTime();
document.write('<A href="http://adex3.flycast.com/server/socket/127.0.0.1:2800/click/VBWorldnet/VBAPI/' + my_random + '">');
document.write('<IMG width="468" height="60" border="1" src="http://adex3.flycast.com/server/socket/127.0.0.1:2800/ad/VBWorldnet/VBAPI/' + my_random + '"></A>');
// -->
</SCRIPT>
</CENTER>
<!-- End Adslot1 -->

<HR>

<H1>EM_UNDO Message</H1>

<H2>Platforms</H2>
<P><UL>
<LI><B>Windows 95:</B> Supported.
<LI><B>Windows 98:</B> Supported.
<LI><B>Windows NT:</B> Requires Windows NT 3.1 or later.
<LI><B>Windows 2000:</B> Supported.
<LI><B>Windows CE:</B> Requires Windows CE 1.0 or later.
</UL></P>

<H2>Description &amp; Usage</H2>
<P>Sending the <B>EM_UNDO</B> message to an edit control undoes the last change made to the control's text.  Most changes to an edit control can be undone.  However, programmatically setting the text (such as using <A href="wm_settext.html" tppabs="http://www.vbapi.com/ref/w/wm_settext.html">WM_SETTEXT</A>, for example) cannot be undone.  On the other hand, though, undo operations themselves can be undone.  The <B>EM_UNDO</B> message has the same effect as selecting "Undo" from the edit control's context menu.</P>

<H2>Return Value</H2>
<P>If the edit control is a single-line edit control, the message always returns a nonzero value.</P>

<P>If the edit control is a multi-line edit control, the message returns a nonzero value if the undo was successful and zero if the undo failed.

<H2>Visual Basic-Specific Issues</H2>
<P>None.</P>

<H2>Parameters</H2>
<P><DL>
<DT><VAR>wParam</VAR><DD>Not used -- set to 0.
<DT><VAR>lParam</VAR><DD>Not used -- set to 0.
</DL></P>

<H2>Constant Definitions</H2>
<P><PRE><CODE class="const"><SPAN class="kw">Const</SPAN> EM_UNDO = &amp;HC7</CODE></PRE></P>

<H2>Example</H2>
<P>Demonstrate undo operations for an edit control.  Place three controls on a form window: an edit control (text box) named txtBox, a command button named cmdUndo, and another command button named cmdSet.  Pressing cmdSet sets the contents of txtBox to a predetermined string, a change that cannot be undone.  Pressing cmdUndo, naturally, undoes the last change made by the user to txtBox.  Whenever the contents of txtBox change, the enabled status of cmdUndo is changed so that the button is enabled if and only if an undo is possible.</P>

<P><PRE><CODE class="example"><SPAN class="com">' This code is licensed according to the terms and conditions listed <A href="copyrite.html#license" tppabs="http://www.vbapi.com/copyrite.html#license" rel="copyright">here</A>.</SPAN>

<SPAN class="com">' Declarations and such needed for the example:
' (Copy them to the (declarations) section of a module.)</SPAN>
<SPAN class="kw">Public Declare Function</SPAN> <A href="sendmessage.html" tppabs="http://www.vbapi.com/ref/s/sendmessage.html">SendMessage</A> <SPAN class="kw">Lib</SPAN> "user32.dll" <SPAN class="kw">Alias</SPAN> "SendMessageA" (<SPAN class="kw">ByVal</SPAN> hWnd <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> _
	Msg <SPAN class="kw">As Long</SPAN>, wParam <SPAN class="kw">As Any</SPAN>, lParam <SPAN class="kw">As Any</SPAN>) <SPAN class="kw">As Long</SPAN>
<SPAN class="kw">Public Const</SPAN> <A href="em_canundo.html" tppabs="http://www.vbapi.com/ref/e/em_canundo.html">EM_CANUNDO</A> = &amp;HC6
<SPAN class="kw">Public Const</SPAN> <B>EM_UNDO</B> = &amp;HC7

<SPAN class="com">' *** Place the following code inside a form window. ***</SPAN>

<SPAN class="kw">Private Sub</SPAN> Form_Load()
	<SPAN class="com">' Make sure cmdUndo is initially disabled.</SPAN>
	cmdUndo.Enabled = <SPAN class="kw">False</SPAN>
<SPAN class="kw">End Sub</SPAN>

<SPAN class="kw">Private Sub</SPAN> txtBox_Change()
	<SPAN class="com">' Whenever the contents of txtBox change, see if an undo is possible.</SPAN>
	<SPAN class="kw">Dim</SPAN> possible <SPAN class="kw">As Long</SPAN>  <SPAN class="com">' is it possible?</SPAN>
	
	possible = <A href="sendmessage.html" tppabs="http://www.vbapi.com/ref/s/sendmessage.html">SendMessage</A>(txtBox.hWnd, <A href="em_canundo.html" tppabs="http://www.vbapi.com/ref/e/em_canundo.html">EM_CANUNDO</A>, <SPAN class="kw">ByVal CLng(</SPAN>0<SPAN class="kw">)</SPAN>, <SPAN class="kw">ByVal CLng(</SPAN>0<SPAN class="kw">)</SPAN>)
	<SPAN class="com">' Since 0 = False and anything else = True, we can do this:</SPAN>
	cmdUndo.Enabled = possible
<SPAN class="kw">End Sub</SPAN>

<SPAN class="kw">Private Sub</SPAN> cmdUndo_Click()
	<SPAN class="com">' Undo the last change the user made to the contents of txtBox.</SPAN>
	<SPAN class="kw">Dim</SPAN> retval <SPAN class="kw">As Long</SPAN>  <SPAN class="com">' return value</SPAN>
	
	retval = <A href="sendmessage.html" tppabs="http://www.vbapi.com/ref/s/sendmessage.html">SendMessage</A>(txtBox.hWnd, <B>EM_UNDO</B>, <SPAN class="kw">ByVal CLng(</SPAN>0<SPAN class="kw">)</SPAN>, <SPAN class="kw">ByVal CLng(</SPAN>0<SPAN class="kw">)</SPAN>)
	<SPAN class="com">' Since undo operations can themselves be undone, there's no
	' reason to send the EM_CANUNDO message here.  cmdUndo is already enabled.</SPAN>
<SPAN class="kw">End Sub</SPAN>

<SPAN class="kw">Private Sub</SPAN> cmdSet_Click()
	<SPAN class="com">' Set the contents of txtBox to a predetermined string.  This can't be undone
	' using the Undo command or the EM_UNDO message.</SPAN>
	txtBox.Text = "You can't use Undo until you change this text!"
<SPAN class="kw">End Sub</SPAN></CODE></PRE></P>

<H2>See Also</H2>
<P><A href="em_canundo.html" tppabs="http://www.vbapi.com/ref/e/em_canundo.html">EM_CANUNDO</A></P>

<H2>Category</H2>
<P><A href="msgc.html#editcontrols" tppabs="http://www.vbapi.com/ref/msgc.html#editcontrols">Edit Controls</A></P>

<P><A href="msga.html" tppabs="http://www.vbapi.com/ref/msga.html">Back to the Message list.</A><BR>
<A href="index.html" tppabs="http://www.vbapi.com/ref/index.html" rel="index">Back to the Reference section.</A></P>

<HR>

<P><B>Last Modified:</B> August 26, 2000<BR>
This page is copyright &copy; 2000 Paul Kuliniewicz.  
<A href="copyrite.html" tppabs="http://www.vbapi.com/copyrite.html" rel="copyright">Copyright Information</A>  <B>Revised October 29, 2000</B><BR>
<A href="index-1.html" tppabs="http://www.vbapi.com/index.html" rel="home">Go back to the Windows API Guide home page.</A><BR>
E-mail: <A href="javascript:if(confirm('http://www.vbapi.com/email.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.vbapi.com/email.html'" tppabs="http://www.vbapi.com/email.html">vbapi@vbapi.com</A>  <A href="javascript:if(confirm('http://www.vbapi.com/email.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.vbapi.com/email.html#secure'" tppabs="http://www.vbapi.com/email.html#secure">Send Encrypted E-Mail</A><BR>
This page is at <A href="em_undo.html" tppabs="http://www.vbapi.com/ref/e/em_undo.html">http://www.vbapi.com/ref/e/em_undo.html</A></P>
</BODY>
</HTML>