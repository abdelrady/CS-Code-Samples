<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<HTML lang="en-us">
<HEAD>
<TITLE>Windows API Guide: RegCreateKeyEx Function</TITLE>
<META content="vbapi@vbapi.com" name="author">
<META content="Information about the RegCreateKeyEx function in the Windows API, geared towards the Visual Basic user." name="description">
<META content="Kuliniewicz,Windows,Windows 95,Windows NT,Windows 98,Windows CE,Windows 2000,API,Application Programming Interface,Programming,Visual Basic,Basic,VB,RegCreateKeyEx" name="keywords">
<META content="Omicron HTML Editor" name="generator">
<LINK href="default.css" tppabs="http://www.vbapi.com/css/default.css" rel="stylesheet" type="text/css">
<LINK href="index-1.html" tppabs="http://www.vbapi.com/index.html" rel="home">
<LINK href="glossary.html" tppabs="http://www.vbapi.com/ref/glossary.html" rel="glossary">
<LINK href="copyrite.html" tppabs="http://www.vbapi.com/copyrite.html" rel="copyright">
</HEAD>
<BODY>

<!-- Begin Adslot1 -->
<CENTER>
<SCRIPT language="JAVASCRIPT">
<!-- hide from older browsers
now = new Date();
my_random = now.getTime();
document.write('<A href="http://adex3.flycast.com/server/socket/127.0.0.1:2800/click/VBWorldnet/VBAPI/' + my_random + '">');
document.write('<IMG width="468" height="60" border="1" src="http://adex3.flycast.com/server/socket/127.0.0.1:2800/ad/VBWorldnet/VBAPI/' + my_random + '"></A>');
// -->
</SCRIPT>
</CENTER>
<!-- End Adslot1 -->

<HR>

<H1>RegCreateKeyEx Function</H1>

<P><CODE class="declare"><SPAN class="kw">Declare Function</SPAN> RegCreateKeyEx <SPAN class="kw">Lib</SPAN> "advapi32.dll" <SPAN class="kw">Alias</SPAN> "RegCreateKeyExA" (<SPAN class="kw">ByVal</SPAN> hKey <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> lpSubKey <SPAN class="kw">As String</SPAN>, <SPAN class="kw">ByVal</SPAN> Reserved <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> lpClass <SPAN class="kw">As String</SPAN>, <SPAN class="kw">ByVal</SPAN> dwOptions <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> samDesired <SPAN class="kw">As Long</SPAN>, lpSecurityAttributes <SPAN class="kw">As</SPAN> <A href="security_attributes.html" tppabs="http://www.vbapi.com/ref/s/security_attributes.html">SECURITY_ATTRIBUTES</A>, phkResult <SPAN class="kw">As Long</SPAN>, lpdwDisposition <SPAN class="kw">As Long</SPAN>) <SPAN class="kw">As Long</SPAN></CODE></P>

<H2>Platforms</H2>
<P><UL>
<LI><B>Windows 95:</B> Supported.
<LI><B>Windows 98:</B> Supported.
<LI><B>Windows NT:</B> Requires Windows NT 3.1 or later.
<LI><B>Windows 2000:</B> Supported.
<LI><B>Windows CE:</B> Requires Windows CE 1.0 or later.
</UL></P>

<H2>Description &amp; Usage</H2>
<P><B>RegCreateKeyEx</B> creates a new registry key.  If the key you want to create already exists, the existing key will be opened (as if <A href="regopenkeyex.html" tppabs="http://www.vbapi.com/ref/r/regopenkeyex.html">RegOpenKeyEx</A> had been used).  A <A class="def" href="glossary.html#handle" tppabs="http://www.vbapi.com/ref/glossary.html#handle" rel="glossary">handle</A> to the created/opened key is put into the variable passed as <VAR>phkResult</VAR>.</P>

<H2>Return Value</H2>
<P>If successful, the function returns zero.  If an error occured, the function returns a non-zero error code.</P>

<H2>Visual Basic-Specific Information</H2>
<P>None.</P>

<H2>Parameters</H2>
<P><DL>
<DT><VAR>hKey</VAR><DD>Specifies an existing registry under which the new registry key will be created.  This is either a handle to an open registry key or exactly one of the following flags that identify a registry base key.  (The base key flags are named identically to the base keys they specify.)
<DL>
<DT>HKEY_CLASSES_ROOT
<DT>HKEY_CURRENT_CONFIG
<DT>HKEY_CURRENT_USER
<DT>HKEY_DYN_DATA <B>(Windows 95, 98 only)</B>
<DT>HKEY_LOCAL_MACHINE
<DT>HKEY_PERFORMANCE_DATA <B>(Windows NT, 2000 only)</B>
<DT>HKEY_USERS
</DL>
<DT><VAR>lpSubkey</VAR><DD>The name of the new key to create.
<DT><VAR>Reserved</VAR><DD>Reserved -- set to 0.
<DT><VAR>lpClass</VAR><DD>The name of the class or object type of the key.  You can specify an empty string.
<DT><VAR>dwOptions</VAR><DD>If this is 0, the key will be saved to the registry.  If this is 1, the key will not be permanently saved to the registry, and will disappear when Windows shuts down.
<DT><VAR>samDesired</VAR><DD>One or more of the following flags specifying the desired read/write access:
<DL>
<DT>KEY_ALL_ACCESS<DD>Permission for all types of access.
<DT>KEY_CREATE_LINK<DD>Permission to create symbolic links.
<DT>KEY_CREATE_SUB_KEY<DD>Permission to create subkeys.
<DT>KEY_ENUMERATE_SUB_KEYS<DD>Permission to enumerate subkeys.
<DT>KEY_EXECUTE<DD>Same as KEY_READ.
<DT>KEY_NOTIFY<DD>Permission to give change notification.
<DT>KEY_QUERY_VALUE<DD>Permission to query subkey data.
<DT>KEY_READ<DD>Permission for general read access.
<DT>KEY_SET_VALUE<DD>Permission to set subkey data.
<DT>KEY_WRITE<DD>Permission for general write access.
</DL>
<DT><VAR>lpSecurityAttributes</VAR><DD><B>Windows NT, 2000:</B> Specifies the security attributes to assign to the newly created key.  <B>Windows 95, 98:</B> Ignored.
<DT><VAR>phkResult</VAR><DD>Receives a handle to the newly created or opened registry key.
<DT><VAR>lpdwDisposition</VAR><DD>Receives 1 if the registry key was newly created, or 2 if an existing key was simply opened.
</DL></P>

<H2>Constant Definitions</H2>
<P><PRE><CODE class="const"><SPAN class="kw">Const</SPAN> HKEY_CLASSES_ROOT = &amp;H80000000
<SPAN class="kw">Const</SPAN> HKEY_CURRENT_CONFIG = &amp;H80000005
<SPAN class="kw">Const</SPAN> HKEY_CURRENT_USER = &amp;H80000001
<SPAN class="kw">Const</SPAN> HKEY_DYN_DATA = &amp;H80000006
<SPAN class="kw">Const</SPAN> HKEY_LOCAL_MACHINE = &amp;H80000002
<SPAN class="kw">Const</SPAN> HKEY_PERFORMANCE_DATA = &amp;H80000004
<SPAN class="kw">Const</SPAN> HKEY_USERS = &amp;H80000003
<SPAN class="kw">Const</SPAN> KEY_ALL_ACCESS = &amp;HF003F
<SPAN class="kw">Const</SPAN> KEY_CREATE_LINK = &amp;H20
<SPAN class="kw">Const</SPAN> KEY_CREATE_SUB_KEY = &amp;H4
<SPAN class="kw">Const</SPAN> KEY_ENUMERATE_SUB_KEYS = &amp;H8
<SPAN class="kw">Const</SPAN> KEY_EXECUTE = &amp;H20019
<SPAN class="kw">Const</SPAN> KEY_NOTIFY = &amp;H10
<SPAN class="kw">Const</SPAN> KEY_QUERY_VALUE = &amp;H1
<SPAN class="kw">Const</SPAN> KEY_READ = &amp;H20019
<SPAN class="kw">Const</SPAN> KEY_SET_VALUE = &amp;H2
<SPAN class="kw">Const</SPAN> KEY_WRITE = &amp;H20006
</CODE></PRE></P>

<H2>Example</H2>
<P>This example creates a new registry called "HKEY_CURRENT_USER\Software\MyCorp\MyProgram\Config".  Under that key, it creates a "username" value and sets its value to the string "Rimmer".  Place a command button named Command1 in a form window to run this example.  The example executes when Command1 is clicked.</P>

<P><PRE><CODE class="example"><SPAN class="com">' This code is licensed according to the terms and conditions listed <A href="copyrite.html#license" tppabs="http://www.vbapi.com/copyrite.html#license" rel="copyright">here</A>.</SPAN>

<SPAN class="com">' Declarations and such needed for the example:
' (Copy them to the (declarations) section of a module.)</SPAN>
<SPAN class="kw">Public Type</SPAN> <A href="security_attributes.html" tppabs="http://www.vbapi.com/ref/s/security_attributes.html">SECURITY_ATTRIBUTES</A>
	nLength <SPAN class="kw">As Long</SPAN>
	lpSecurityDescriptor <SPAN class="kw">As Long</SPAN>
	bInheritHandle <SPAN class="kw">As Long</SPAN>
<SPAN class="kw">End Type</SPAN>
<SPAN class="kw">Public Declare Function</SPAN> <B>RegCreateKeyEx</B> <SPAN class="kw">Lib</SPAN> "advapi32.dll" <SPAN class="kw">Alias</SPAN> "RegCreateKeyExA" (<SPAN class="kw">ByVal</SPAN> _
	hKey <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> lpSubKey <SPAN class="kw">As String</SPAN>, <SPAN class="kw">ByVal</SPAN> Reserved <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> lpClass _
	<SPAN class="kw">As String</SPAN>, <SPAN class="kw">ByVal</SPAN> dwOptions <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> samDesired <SPAN class="kw">As Long</SPAN>, lpSecurityAttributes _
	<SPAN class="kw">As</SPAN> <A href="security_attributes.html" tppabs="http://www.vbapi.com/ref/s/security_attributes.html">SECURITY_ATTRIBUTES</A>, phkResult <SPAN class="kw">As Long</SPAN>, lpdwDisposition <SPAN class="kw">As Long</SPAN>) <SPAN class="kw">As Long</SPAN>
<SPAN class="kw">Public Declare Function</SPAN> <A href="regsetvalueex.html" tppabs="http://www.vbapi.com/ref/r/regsetvalueex.html">RegSetValueEx</A> <SPAN class="kw">Lib</SPAN> "advapi32.dll" <SPAN class="kw">Alias</SPAN> "RegSetValueExA" (<SPAN class="kw">ByVal</SPAN> _
	hKey <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> lpValueName <SPAN class="kw">As String</SPAN>, <SPAN class="kw">ByVal</SPAN> Reserved <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> dwType _
	<SPAN class="kw">As Long</SPAN>, lpData <SPAN class="kw">As Any</SPAN>, <SPAN class="kw">ByVal</SPAN> cbData <SPAN class="kw">As Long</SPAN>) <SPAN class="kw">As Long</SPAN>
<SPAN class="kw">Public Declare Function</SPAN> <A href="regclosekey.html" tppabs="http://www.vbapi.com/ref/r/regclosekey.html">RegCloseKey</A> <SPAN class="kw">Lib</SPAN> "advapi32.dll" (<SPAN class="kw">ByVal</SPAN> hKey <SPAN class="kw">As Long</SPAN>) <SPAN class="kw">As Long</SPAN>
<SPAN class="kw">Public Const</SPAN> HKEY_CURRENT_USER = &amp;H80000001
<SPAN class="kw">Public Const</SPAN> KEY_WRITE = &amp;H20006
<SPAN class="kw">Public Const</SPAN> REG_SZ = 1

<SPAN class="com">' *** Place the following code inside the form. ***</SPAN>

<SPAN class="kw">Private Sub</SPAN> Command1_Click()
	<SPAN class="kw">Dim</SPAN> hKey <SPAN class="kw">As Long</SPAN>            <SPAN class="com">' receives handle to the registry key</SPAN>
	<SPAN class="kw">Dim</SPAN> secattr <SPAN class="kw">As</SPAN> <A href="security_attributes.html" tppabs="http://www.vbapi.com/ref/s/security_attributes.html">SECURITY_ATTRIBUTES</A>  <SPAN class="com">' security settings for the key</SPAN>
	<SPAN class="kw">Dim</SPAN> subkey <SPAN class="kw">As String</SPAN>        <SPAN class="com">' name of the subkey to create or open</SPAN>
	<SPAN class="kw">Dim</SPAN> neworused <SPAN class="kw">As Long</SPAN>       <SPAN class="com">' receives flag for if the key was created or opened</SPAN>
	<SPAN class="kw">Dim</SPAN> stringbuffer <SPAN class="kw">As String</SPAN>  <SPAN class="com">' the string to put into the registry</SPAN>
	<SPAN class="kw">Dim</SPAN> retval <SPAN class="kw">As Long</SPAN>          <SPAN class="com">' return value</SPAN>
	
	<SPAN class="com">' Set the name of the new key and the default security settings</SPAN>
	subkey = "Software\MyCorp\MyProgram\Config"
	secattr.nLength = Len(secattr)
	secattr.lpSecurityDescriptor = 0
	secattr.bInheritHandle = 1
	
	<SPAN class="com">' Create (or open) the registry key.</SPAN>
	retval = <B>RegCreateKeyEx</B>(HKEY_CURRENT_USER, subkey, 0, "", 0, KEY_WRITE, _
		secattr, hKey, neworused)
	<SPAN class="kw">If</SPAN> retval &lt;&gt; 0 <SPAN class="kw">Then</SPAN>
		<SPAN class="kw">Debug</SPAN>.<SPAN class="kw">Print</SPAN> "Error opening or creating registry key -- aborting."
		<SPAN class="kw">Exit Sub</SPAN>
	<SPAN class="kw">End If</SPAN>
	
	<SPAN class="com">' Write the string to the registry.  Note the use of ByVal in the second-to-last
	' parameter because we are passing a string.</SPAN>
	stringbuffer = "Rimmer" & vbNullChar  <SPAN class="com">' the terminating null is necessary</SPAN>
	retval = <A href="regsetvalueex.html" tppabs="http://www.vbapi.com/ref/r/regsetvalueex.html">RegSetValueEx</A>(hKey, "username", 0, REG_SZ, <SPAN class="kw">ByVal</SPAN> stringbuffer, _
		Len(stringbuffer))
	
	<SPAN class="com">' Close the registry key.</SPAN>
	retval = <A href="regclosekey.html" tppabs="http://www.vbapi.com/ref/r/regclosekey.html">RegCloseKey</A>(hKey)
<SPAN class="kw">End Sub</SPAN></CODE></PRE>

<H2>See Also</H2>
<P><A href="regclosekey.html" tppabs="http://www.vbapi.com/ref/r/regclosekey.html">RegCloseKey</A>, 
<A href="regdeletekey.html" tppabs="http://www.vbapi.com/ref/r/regdeletekey.html">RegDeleteKey</A>, 
<A href="regopenkeyex.html" tppabs="http://www.vbapi.com/ref/r/regopenkeyex.html">RegOpenKeyEx</A></P>

<H2>Category</H2>
<P><A href="funcc.html#registry" tppabs="http://www.vbapi.com/ref/funcc.html#registry">Registry</A></P>

<P><A href="funca.html" tppabs="http://www.vbapi.com/ref/funca.html">Go back to the Function listing.</A><BR>
<A href="index.html" tppabs="http://www.vbapi.com/ref/index.html">Go back to the Reference section index.</A></P>

<HR>

<P><B>Last Modified:</B> July 30, 2000<BR>
This page is copyright &copy; 2000 Paul Kuliniewicz.  <A href="copyrite.html" tppabs="http://www.vbapi.com/copyrite.html" rel="copyright">Copyright Information.</A><BR>
<A href="index-1.html" tppabs="http://www.vbapi.com/index.html">Go back to the Windows API Guide home page.</A><BR>
E-mail: <A href="javascript:if(confirm('http://www.vbapi.com/email.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.vbapi.com/email.html'" tppabs="http://www.vbapi.com/email.html">vbapi@vbapi.com</A>  <A href="javascript:if(confirm('http://www.vbapi.com/email.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.vbapi.com/email.html#secure'" tppabs="http://www.vbapi.com/email.html#secure">Send Encrypted E-Mail</A><BR>
This page is at <A href="regcreatekeyex.html" tppabs="http://www.vbapi.com/ref/r/regcreatekeyex.html">http://www.vbapi.com/ref/r/regcreatekeyex.html</A></P>
</BODY>
</HTML>