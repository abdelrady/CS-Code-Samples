<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<HTML lang="en-us">
<HEAD>
<TITLE>Windows API Guide: SetFilePointer Function</TITLE>
<META content="vbapi@vbapi.com" name="author">
<META content="Information about the SetFilePointer function in the Windows API, geared towards the Visual Basic user." name="description">
<META content="Kuliniewicz,Windows,Windows 95,Windows NT,Windows 98,Windows CE,Windows 2000,API,Application Programming Interface,Programming,Visual Basic,Basic,VB,SetFilePointer" name="keywords">
<META content="Omicron HTML Editor" name="generator">
<LINK href="default.css" tppabs="http://www.vbapi.com/css/default.css" rel="stylesheet" type="text/css">
<LINK href="index-1.html" tppabs="http://www.vbapi.com/index.html" rel="home">
<LINK href="glossary.html" tppabs="http://www.vbapi.com/ref/glossary.html" rel="glossary">
<LINK href="copyrite.html" tppabs="http://www.vbapi.com/copyrite.html" rel="copyright">
</HEAD>
<BODY>

<!-- Begin Adslot1 -->
<CENTER>
<SCRIPT language="JAVASCRIPT">
<!-- hide from older browsers
now = new Date();
my_random = now.getTime();
document.write('<A href="http://adex3.flycast.com/server/socket/127.0.0.1:2800/click/VBWorldnet/VBAPI/' + my_random + '">');
document.write('<IMG width="468" height="60" border="1" src="http://adex3.flycast.com/server/socket/127.0.0.1:2800/ad/VBWorldnet/VBAPI/' + my_random + '"></A>');
// -->
</SCRIPT>
</CENTER>
<!-- End Adslot1 -->

<HR>

<H1>SetFilePointer Function</H1>

<P><CODE class="declare"><SPAN class="kw">Declare Function</SPAN> SetFilePointer <SPAN class="kw">Lib</SPAN> "kernel32.dll" (<SPAN class="kw">ByVal</SPAN> hFile <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> lDistanceToMove <SPAN class="kw">As Long</SPAN>, lpDistanceToMoveHigh <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> dwMoveMethod <SPAN class="kw">As Long</SPAN>) <SPAN class="kw">As Long</SPAN></CODE></P>

<H2>Platforms</H2>
<P><UL>
<LI><B>Windows 95:</B> Supported.
<LI><B>Windows 98:</B> Supported.
<LI><B>Windows NT:</B> Requires Windows NT 3.1 or later.
<LI><B>Windows 2000:</B> Supported.
<LI><B>Windows CE:</B> Requires Windows CE 1.0 or later.
</UL></P>

<H2>Description &amp; Usage</H2>
<P><B>SetFilePointer</B> changes the position of the <A class="def" href="glossary.html#filepointer" tppabs="http://www.vbapi.com/ref/glossary.html#filepointer" rel="glossary">file pointer</A> in an open file.  The pointer can be moved either forwards or backwards relative to the beginning of the file, the current file pointer position, or the end of the file.  The file pointer cannot be moved more than one byte past the last byte of the file (where it would point to the end of the file).</P>

<P>When calculating the value for <VAR>lDistanceToMove</VAR> and the value to set the variable passed as <VAR>lpDistanceToMoveHigh</VAR> for negative numbers (i.e., moving the file pointer backwards), you cannot simply take the negative of the absolute value.  First put the absolute values into those parameters.  For <VAR>lpDistanceToMoveHigh</VAR>, perform a bitwise NOT operation on the value.  For <VAR>lDistanceToMove</VAR>, perform a bitwise NOT operation followed by adding 1.  See the example for a demonstration of this procedure, which is necessary to product a 64-bit negative number from a composite of the two <A class="def" href="glossary.html#dword" tppabs="http://www.vbapi.com/ref/glossary.html#dword" rel="glossary">dwords</A>.</P>

<H2>Return Value</H2>
<P>If successful, the function returns the low-order dword of the new file pointer position.  The high-order dword of the file pointer position is placed into the variable passed as <VAR>lpDistanceToMoveHigh</VAR>.  If an error occured, the function returns -1 (use <A href="getlasterror.html" tppabs="http://www.vbapi.com/ref/g/getlasterror.html">GetLastError</A> to get the error code).

<H2>Visual Basic-Specific Issues</H2>
<P>None.</P>

<H2>Parameters</H2>
<P><DL>
<DT><VAR>hFile</VAR><DD>A <A class="def" href="glossary.html#handle" tppabs="http://www.vbapi.com/ref/glossary.html#handle" rel="glossary">handle</A> to the open file to move the file pointer of.
<DT><VAR>lDistanceToMove</VAR><DD>The low-order dword of the 64-bit integer identifying the number of bytes to move the file pointer.  For negative values, consult the second paragraph under <B>Description &amp; Usage</B> above.
<DT><VAR>lpDistanceToMoveHigh</VAR><DD>Variable that contains the high-order dword of the 64-bit integer identifying the number of bytes to move the file pointer.  For negative values, consult the second paragraph under <B>Description &amp; Usage</B> above.  After the call, the variable receives the high-order dword of the new file pointer.
<DT><VAR>dwMoveMethod</VAR><DD>One of the following flags specifying the reference point to move the file pointer from:
<DL>
<DT>FILE_BEGIN<DD>The beginning of the file; i.e., the very first byte of the file.
<DT>FILE_CURRENT<DD>The current position of the file pointer.
<DT>FILE_END<DD>The end of the file; i.e., immediately after the very last byte of the file.
</DL>
</DL></P>

<H2>Constant Definitions</H2>
<P><PRE><CODE class="const"><SPAN class="kw">Const</SPAN> FILE_BEGIN = 0
<SPAN class="kw">Const</SPAN> FILE_CURRENT = 1
<SPAN class="kw">Const</SPAN> FILE_END = 2</CODE></PRE></P>

<H2>Example</H2>
<P>Read two four-character strings from the file "C:\Test\myfile.txt": one string starting at the third byte from the beginning, and the other starting five bytes from the end.  To use this example, place a command button named Command1 on a form window.</P>

<P><PRE><CODE class="example"><SPAN class="com">' This code is licensed according to the terms and conditions listed <A href="copyrite.html#license" tppabs="http://www.vbapi.com/copyrite.html#license" rel="copyright">here</A>.</SPAN>

<SPAN class="com">' Declarations and such needed for the example:
' (Copy them to the (declarations) section of a module.)</SPAN>
<SPAN class="kw">Public Declare Function</SPAN> <A href="createfile.html" tppabs="http://www.vbapi.com/ref/c/createfile.html">CreateFile</A> <SPAN class="kw">Lib</SPAN> "kernel32.dll" <SPAN class="kw">Alias</SPAN> "CreateFileA" (<SPAN class="kw">ByVal</SPAN> lpFileName <SPAN class="kw">As String</SPAN>, _
	<SPAN class="kw">ByVal</SPAN> dwDesiredAccess <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> dwShareMode <SPAN class="kw">As Long</SPAN>, lpSecurityAttributes <SPAN class="kw">As Any</SPAN>, _
	<SPAN class="kw">ByVal</SPAN> dwCreationDisposition <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> dwFlagsAndAttributes <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> hTemplateFile _
	<SPAN class="kw">As Long</SPAN>) <SPAN class="kw">As Long</SPAN>
<SPAN class="kw">Public Const</SPAN> GENERIC_READ = &amp;H80000000
<SPAN class="kw">Public Const</SPAN> FILE_SHARE_READ = &amp;H1
<SPAN class="kw">Public Const</SPAN> OPEN_EXISTING = 3
<SPAN class="kw">Public Const</SPAN> FILE_ATTRIBUTE_ARCHIVE = &amp;H20
<SPAN class="kw">Public Declare Function</SPAN> <B>SetFilePointer</B> <SPAN class="kw">Lib</SPAN> "kernel32.dll" (<SPAN class="kw">ByVal</SPAN> hFile <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> lDistanceToMove _
	<SPAN class="kw">As Long</SPAN>, lpDistanceToMoveHigh <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> dwMoveMethod <SPAN class="kw">As Long</SPAN>) <SPAN class="kw">As Long</SPAN>
<SPAN class="kw">Public Const</SPAN> FILE_BEGIN = 0
<SPAN class="kw">Public Const</SPAN> FILE_END = 2
<SPAN class="kw">Public Declare Function</SPAN> <A href="readfile.html" tppabs="http://www.vbapi.com/ref/r/readfile.html">ReadFile</A> <SPAN class="kw">Lib</SPAN> "kernel32.dll" (<SPAN class="kw">ByVal</SPAN> hFile <SPAN class="kw">As Long</SPAN>, lpBuffer <SPAN class="kw">As Any</SPAN>, _
	<SPAN class="kw">ByVal</SPAN> nNumberOfBytesToRead <SPAN class="kw">As Long</SPAN>, lpNumberOfBytesRead <SPAN class="kw">As Long</SPAN>, lpOverlapped <SPAN class="kw">As Any</SPAN>) <SPAN class="kw">As Long</SPAN>
<SPAN class="kw">Public Declare Function</SPAN> <A href="closehandle.html" tppabs="http://www.vbapi.com/ref/c/closehandle.html">CloseHandle</A> <SPAN class="kw">Lib</SPAN> "kernel32.dll" (<SPAN class="kw">ByVal</SPAN> hObject <SPAN class="kw">As Long</SPAN>) <SPAN class="kw">As Long</SPAN>

<SPAN class="com">' *** Place the following code inside the form window. ***</SPAN>

<SPAN class="kw">Private Sub</SPAN> Command1_Click()
	<SPAN class="kw">Dim</SPAN> strbuf <SPAN class="kw">As String</SPAN> * 4  <SPAN class="com">' receives four-byte string from the file</SPAN>
	<SPAN class="kw">Dim</SPAN> lowbyte <SPAN class="kw">As Long</SPAN>       <SPAN class="com">' low dword of file pointer position</SPAN>
	<SPAN class="kw">Dim</SPAN> highbyte <SPAN class="kw">As Long</SPAN>      <SPAN class="com">' high dword of file pointer position</SPAN>
	<SPAN class="kw">Dim</SPAN> numread <SPAN class="kw">As Long</SPAN>       <SPAN class="com">' receives number of bytes read from file</SPAN>
	<SPAN class="kw">Dim</SPAN> hFile <SPAN class="kw">As Long</SPAN>         <SPAN class="com">' handle of the open file</SPAN>
	<SPAN class="kw">Dim</SPAN> retval <SPAN class="kw">As Long</SPAN>        <SPAN class="com">' return value</SPAN>
	
	<SPAN class="com">' Open the file for read-level access, if it already exists.</SPAN>
	hFile = <A href="createfile.html" tppabs="http://www.vbapi.com/ref/c/createfile.html">CreateFile</A>("C:\Test\myfile.txt", GENERAL_READ, FILE_SHARE_READ, <SPAN class="kw">ByVal CLng(</SPAN>0<SPAN class="kw">)</SPAN>, _
		OPEN_EXISTING, FILE_ATTRIBUTE_ARCHIVE, 0)
	<SPAN class="kw">If</SPAN> hFile = -1 <SPAN class="kw">Then</SPAN>
		<SPAN class="kw">Debug</SPAN>.<SPAN class="kw">Print</SPAN> "Unable to open the file -- it probably does not exist."
		<SPAN class="kw">Exit Sub</SPAN>
	<SPAN class="kw">End If</SPAN>
	
	<SPAN class="com">' Keep in mind that, although the lpDistanceToMoveHigh parameter
	' must be passed a variable, the lDistanceToMove parameter can be
	' passed either a variable or a literal constant.  For clarity, the
	' following code uses a variable for lDistanceToMove.</SPAN>
	
	<SPAN class="com">' Set the file pointer to 2 bytes after the beginning of the file -- i.e., the third byte position.</SPAN>
	lowbyte = 2
	highbyte = 0
	lowbyte = <B>SetFilePointer</B>(hFile, lowbyte, highbyte, FILE_BEGIN)
	<SPAN class="com">' Now read four characters and display them.</SPAN>
	retval = <A href="readfile.html" tppabs="http://www.vbapi.com/ref/r/readfile.html">ReadFile</A>(hFile, <SPAN class="kw">ByVal</SPAN> strbuf, 4, numread, <SPAN class="kw">ByVal CLng(</SPAN>0<SPAN class="kw">)</SPAN>)
	<SPAN class="kw">Debug</SPAN>.<SPAN class="kw">Print</SPAN> "Four-character string starting at byte 3: "; strbuf
	
	<SPAN class="com">' Set the file pointer to 5 bytes before the beginning of the file.  Note how the lowbyte 
	' and highbyte numbers must be manipulated to represent a negative value.</SPAN>
	lowbyte = (<SPAN class="kw">Not</SPAN> 5) + 1
	highbyte = <SPAN class="kw">Not</SPAN> 0
	lowbyte = <B>SetFilePointer</B>(hFile, lowbyte, highbyte, FILE_END)
	<SPAN class="com">' Now read four characters from here and display them.</SPAN>
	retval = <A href="readfile.html" tppabs="http://www.vbapi.com/ref/r/readfile.html">ReadFile</A>(hFile, <SPAN class="kw">ByVal</SPAN> strbuf, 4, numread, <SPAN class="kw">ByVal CLng(</SPAN>0<SPAN class="kw">)</SPAN>)
	<SPAN class="kw">Debug</SPAN>.<SPAN class="kw">Print</SPAN> "Four-character string starting at the fifth byte from the end: "; strbuf
	
	<SPAN class="com">' Close the file.</SPAN>
	retval = <A href="closehandle.html" tppabs="http://www.vbapi.com/ref/c/closehandle.html">CloseHandle</A>(hFile)
<SPAN class="kw">End Sub</SPAN></CODE></PRE></P>

<H2>See Also</H2>
<P><A href="readfile.html" tppabs="http://www.vbapi.com/ref/r/readfile.html">ReadFile</A>, 
<A href="writefile.html" tppabs="http://www.vbapi.com/ref/w/writefile.html">WriteFile</A></P>

<H2>Category</H2>
<P><A href="funcc.html#files" tppabs="http://www.vbapi.com/ref/funcc.html#files">Files</A></P>

<P><A href="funca.html" tppabs="http://www.vbapi.com/ref/funca.html">Go back to the Function listing.</A><BR>
<A href="index.html" tppabs="http://www.vbapi.com/ref/index.html">Go back to the Reference section index.</A></P>

<HR>

<P><B>Last Modified:</B> January 21, 2001<BR>
This page is copyright &copy; 2001 Paul Kuliniewicz.  
<A href="copyrite.html" tppabs="http://www.vbapi.com/copyrite.html" rel="copyright">Copyright Information</A>  <B>Revised October 29, 2000</B><BR>
<A href="index-1.html" tppabs="http://www.vbapi.com/index.html">Go back to the Windows API Guide home page.</A><BR>
E-mail: <A href="javascript:if(confirm('http://www.vbapi.com/email.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.vbapi.com/email.html'" tppabs="http://www.vbapi.com/email.html">vbapi@vbapi.com</A>  <A href="javascript:if(confirm('http://www.vbapi.com/email.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.vbapi.com/email.html#secure'" tppabs="http://www.vbapi.com/email.html#secure">Send Encrypted E-Mail</A><BR>
This page is at <A href="setfilepointer.html" tppabs="http://www.vbapi.com/ref/s/setfilepointer.html">http://www.vbapi.com/ref/s/setfilepointer.html</A></P>
</BODY>
</HTML>