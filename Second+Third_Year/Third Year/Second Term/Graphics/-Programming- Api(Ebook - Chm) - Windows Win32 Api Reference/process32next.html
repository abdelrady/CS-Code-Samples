<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<HTML lang="en-us">
<HEAD>
<TITLE>Windows API Guide: Process32Next Function</TITLE>
<META content="vbapi@vbapi.com" name="author">
<META content="Information about the Process32Next function in the Windows API, geared towards the Visual Basic user." name="description">
<META content="Kuliniewicz,Windows,Windows 95,Windows NT,Windows 98,Windows CE,Windows 2000,API,Application Programming Interface,Programming,Visual Basic,Basic,VB,Process32Next" name="keywords">
<META content="Omicron HTML Editor" name="generator">
<LINK href="default.css" tppabs="http://www.vbapi.com/css/default.css" rel="stylesheet" type="text/css">
<LINK href="index-1.html" tppabs="http://www.vbapi.com/index.html" rel="home">
<LINK href="glossary.html" tppabs="http://www.vbapi.com/ref/glossary.html" rel="glossary">
<LINK href="copyrite.html" tppabs="http://www.vbapi.com/copyrite.html" rel="copyright">
</HEAD>
<BODY>

<!-- Begin Adslot1 -->
<CENTER>
<SCRIPT language="JAVASCRIPT">
<!-- hide from older browsers
now = new Date();
my_random = now.getTime();
document.write('<A href="http://adex3.flycast.com/server/socket/127.0.0.1:2800/click/VBWorldnet/VBAPI/' + my_random + '">');
document.write('<IMG width="468" height="60" border="1" src="http://adex3.flycast.com/server/socket/127.0.0.1:2800/ad/VBWorldnet/VBAPI/' + my_random + '"></A>');
// -->
</SCRIPT>
</CENTER>
<!-- End Adslot1 -->

<HR>

<H1>Process32First Function</H1>

<P><CODE class="declare"><SPAN class="kw">Declare Function</SPAN> Process32Next <SPAN class="kw">Lib</SPAN> "kernel32.dll" (<SPAN class="kw">ByVal</SPAN> hSnapshot <SPAN class="kw">As Long</SPAN>, lppe <SPAN class="kw">As</SPAN> <A href="processentry32.html" tppabs="http://www.vbapi.com/ref/p/processentry32.html">PROCESSENTRY32</A>) <SPAN class="kw">As Long</SPAN></CODE></P>

<H2>Platforms</H2>
<P><UL>
<LI><B>Windows 95:</B> Supported.
<LI><B>Windows 98:</B> Supported.
<LI><B>Windows NT:</B> Not Supported.
<LI><B>Windows 2000:</B> Supported.
<LI><B>Windows CE:</B> Not Supported.
</UL></P>

<H2>Description &amp; Usage</H2>
<P><B>Process32Next</B> retrieves information about the next unread process in the process list contained in a system snapshot.  This snapshot must have previously been generated using the <A href="createtoolhelp32snapshot.html" tppabs="http://www.vbapi.com/ref/c/createtoolhelp32snapshot.html">CreateToolhelp32Snapshot</A> function.  Calling this function repeatedly, after an initial call to <A href="process32first.html" tppabs="http://www.vbapi.com/ref/p/process32first.html">Process32First</A>, will allow your program to read the entire process list.</P>

<H2>Return Value</H2>
<P>If successful, the function returns a nonzero value.  If an error occured, most likely if there are no more unread processes in the list, the function returns zero.</P>

<H2>Visual Basic-Specific Issues</H2>
<P>None.</P>

<H2>Parameters</H2>
<P><DL>
<DT><VAR>hSnapshot</VAR><DD>A <A class="def" href="glossary.html#handle" tppabs="http://www.vbapi.com/ref/glossary.html#handle" rel="glossary">handle</A> to the system snapshot created by the <A href="createtoolhelp32snapshot.html" tppabs="http://www.vbapi.com/ref/c/createtoolhelp32snapshot.html">CreateToolhelp32Snapshot</A> function.  This snapshot contains the process list from which the next unread process is read.
<DT><VAR>lppe</VAR><DD>Receives information about the next unread process in the snapshot.  The <VAR>dwSize</VAR> member of this structure must be initialized before calling the function.
</DL></P>


<H2>Example</H2>
<P>Print a list of all the processes currently running on the computer when the user clicks button Command1.  To do this, a snapshot of the running process list is taken, and then each process in it is analyzed.  The filename of the process and the number of threads owned by it is then displayed.  To use this example, place a command button named Command1 on a form window.</P>

<P><PRE><CODE class="example"><SPAN class="com">' This code is licensed according to the terms and conditions listed <A href="copyrite.html#license" tppabs="http://www.vbapi.com/copyrite.html#license" rel="copyright">here</A>.</SPAN>

<SPAN class="com">' Declarations and such needed for the example:
' (Copy them to the (declarations) section of a module.)</SPAN>
<SPAN class="kw">Public Declare Function</SPAN> <A href="createtoolhelp32snapshot.html" tppabs="http://www.vbapi.com/ref/c/createtoolhelp32snapshot.html">CreateToolhelp32Snapshot</A> <SPAN class="kw">Lib</SPAN> "kernel32.dll" (<SPAN class="kw">ByVal</SPAN> dwFlags <SPAN class="kw">As Long</SPAN>, <SPAN class="kw">ByVal</SPAN> _
	th32ProcessID <SPAN class="kw">As Long</SPAN>) <SPAN class="kw">As Long</SPAN>
<SPAN class="kw">Public Const</SPAN> TH32CS_SNAPPROCESS = &H2
<SPAN class="kw">Public Type</SPAN> <A href="processentry32.html" tppabs="http://www.vbapi.com/ref/p/processentry32.html">PROCESSENTRY32</A>
	dwSize <SPAN class="kw">As Long</SPAN>
	cntUsage <SPAN class="kw">As Long</SPAN>
	th32ProcessID <SPAN class="kw">As Long</SPAN>
	th32DefaultHeapID <SPAN class="kw">As Long</SPAN>
	th32ModuleID <SPAN class="kw">As Long</SPAN>
	cntThreads <SPAN class="kw">As Long</SPAN>
	th32ParentProcessID <SPAN class="kw">As Long</SPAN>
	pcPriClassBase <SPAN class="kw">As Long</SPAN>
	dwFlags <SPAN class="kw">As Long</SPAN>
	szExeFile <SPAN class="kw">As String</SPAN> * 260
<SPAN class="kw">End Type</SPAN>
<SPAN class="kw">Public Declare Function</SPAN> <A href="process32first.html" tppabs="http://www.vbapi.com/ref/p/process32first.html">Process32First</A> <SPAN class="kw">Lib</SPAN> "kernel32.dll" (<SPAN class="kw">ByVal</SPAN> hSnapshot <SPAN class="kw">As Long</SPAN>, _
	lppe <SPAN class="kw">As</SPAN> <A href="processentry32.html" tppabs="http://www.vbapi.com/ref/p/processentry32.html">PROCESSENTRY32</A>) <SPAN class="kw">As Long</SPAN>
<SPAN class="kw">Public Declare Function</SPAN> <B>Process32Next</B> <SPAN class="kw">Lib</SPAN> "kernel32.dll" (<SPAN class="kw">ByVal</SPAN> hSnapshot <SPAN class="kw">As Long</SPAN>, _
	lppe <SPAN class="kw">As</SPAN> <A href="processentry32.html" tppabs="http://www.vbapi.com/ref/p/processentry32.html">PROCESSENTRY32</A>) <SPAN class="kw">As Long</SPAN>
<SPAN class="kw">Public Declare Function</SPAN> <A href="closehandle.html" tppabs="http://www.vbapi.com/ref/c/closehandle.html">CloseHandle</A> <SPAN class="kw">Lib</SPAN> "kernel32.dll" (<SPAN class="kw">ByVal</SPAN> hObject <SPAN class="kw">As Long</SPAN>) <SPAN class="kw">As Long</SPAN>

<SPAN class="com">' *** Place the following code inside a form window. ***</SPAN>

<SPAN class="kw">Private Sub</SPAN> Command1_Click()
	<SPAN class="kw">Dim</SPAN> hSnapshot <SPAN class="kw">As Long</SPAN>  <SPAN class="com">' handle to the snapshot of the process list</SPAN>
	<SPAN class="kw">Dim</SPAN> processInfo <SPAN class="kw">As</SPAN> <A href="processentry32.html" tppabs="http://www.vbapi.com/ref/p/processentry32.html">PROCESSENTRY32</A>  <SPAN class="com">' information about a process in that list</SPAN>
	<SPAN class="kw">Dim</SPAN> success <SPAN class="kw">As Long</SPAN>    <SPAN class="com">' success of having gotten info on another process</SPAN>
	<SPAN class="kw">Dim</SPAN> exeName <SPAN class="kw">As String</SPAN>  <SPAN class="com">' filename of the process</SPAN>
	<SPAN class="kw">Dim</SPAN> retval <SPAN class="kw">As Long</SPAN>     <SPAN class="com">' generic return value</SPAN>
	
	<SPAN class="com">' First, make a snapshot of the current process list.</SPAN>
	hSnapshot = <A href="createtoolhelp32snapshot.html" tppabs="http://www.vbapi.com/ref/c/createtoolhelp32snapshot.html">CreateToolhelp32Snapshot</A>(TH32CS_SNAPPROCESS, 0)
	
	<SPAN class="com">' Get information about the first process in the list.</SPAN>
	processInfo.dwSize = Len(processInfo)
	success = <A href="process32first.html" tppabs="http://www.vbapi.com/ref/p/process32first.html">Process32First</A>(hSnapshot, processInfo)
	<SPAN class="com">' Make sure a handle was returned.</SPAN>	
	<SPAN class="kw">If</SPAN> hSnapshot = -1 <SPAN class="kw">Then</SPAN>
		<SPAN class="kw">Debug</SPAN>.<SPAN class="kw">Print</SPAN> "Unable to take snapshot of process list!"
		<SPAN class="kw">Exit Sub</SPAN>
	<SPAN class="kw">End If</SPAN>

	<SPAN class="com">' Loop for each process on the list.</SPAN>
	<SPAN class="kw">While</SPAN> success &lt;&gt; 0
		<SPAN class="com">' Extract the filename of the process (i.e., remove the empty space)</SPAN>
		exeName = Left(processInfo.szExeFile, InStr(processInfo.szExeFile, vbNullChar) - 1)
		<SPAN class="com">' Display the process name and the number of threads it owns.</SPAN>
		<SPAN class="kw">Debug</SPAN>.<SPAN class="kw">Print</SPAN> "Process: "; exeName
		<SPAN class="kw">Debug</SPAN>.<SPAN class="kw">Print</SPAN> "  - Number of threads:"; processInfo.cntThreads
		
		<SPAN class="com">' Get information about the next process, if there is one.</SPAN>
		processInfo.dwSize = Len(processInfo)
		success = <B>Process32Next</B>(hSnapshot, processInfo)
	<SPAN class="kw">Wend</SPAN>
	
	<SPAN class="com">' Destroy the snapshot, now that we no longer need it.</SPAN>
	retval = <A href="closehandle.html" tppabs="http://www.vbapi.com/ref/c/closehandle.html">CloseHandle</A>(hSnapshot)
<SPAN class="kw">End Sub</SPAN></CODE></PRE></P>

<H2>See Also</H2>
<P><A href="process32first.html" tppabs="http://www.vbapi.com/ref/p/process32first.html">Process32First</A></P>

<H2>Category</H2>
<P><A href="funcc.html#toolhelp" tppabs="http://www.vbapi.com/ref/funcc.html#toolhelp">Tool Help</A></P>

<P><A href="funca.html" tppabs="http://www.vbapi.com/ref/funca.html">Back to the Function list.</A><BR>
<A href="index.html" tppabs="http://www.vbapi.com/ref/index.html" rel="index">Back to the Reference section.</A></P>

<HR>

<P><B>Last Modified:</B> September 24, 2000<BR>
This page is copyright &copy; 2000 Paul Kuliniewicz.  
<A href="copyrite.html" tppabs="http://www.vbapi.com/copyrite.html" rel="copyright">Copyright Information</A>  <B>Revised October 29, 2000</B><BR>
<A href="index-1.html" tppabs="http://www.vbapi.com/index.html" rel="home">Go back to the Windows API Guide home page.</A><BR>
E-mail: <A href="javascript:if(confirm('http://www.vbapi.com/email.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.vbapi.com/email.html'" tppabs="http://www.vbapi.com/email.html">vbapi@vbapi.com</A>  <A href="javascript:if(confirm('http://www.vbapi.com/email.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.vbapi.com/email.html#secure'" tppabs="http://www.vbapi.com/email.html#secure">Send Encrypted E-Mail</A><BR>
This page is at <A href="process32next.html" tppabs="http://www.vbapi.com/ref/p/process32next.html">http://www.vbapi.com/ref/p/process32next.html</A></P>
</BODY>
</HTML>